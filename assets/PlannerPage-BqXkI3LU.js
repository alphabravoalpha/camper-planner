var hs=Object.defineProperty;var us=(s,t,r)=>t in s?hs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var Pe=(s,t,r)=>us(s,typeof t!="symbol"?t+"":t,r);import{c as U,r as Jt,a as We,b as L,j as e,u as re,d as oe,e as Yt,R as Oe,f as de,g as ot,h as xs,i as gs,V as mt,M as we,k as ps,l as It,m as fs,n as bs,o as xe}from"./index-DGYMbSFh.js";import{R as St,a as d}from"./react-vendor-DB9SfNWA.js";import{P as yt,M as Le,a as _e,L as Ue,u as Qt,T as Rt,l as Te,b as lt,c as ys}from"./map-vendor-D1_z6wB-.js";import"./state-vendor--7Lts539.js";const vs=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],js=U("arrow-left-right",vs);const Ns=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],At=U("bed",Ns);const ws=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],ks=U("briefcase",ws);const Cs=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],ht=U("calculator",Cs);const Ms=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],De=U("calendar",Ms);const Ss=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ls=U("camera",Ss);const Ds=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],Ge=U("car",Ds);const Ts=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],es=U("chart-column",Ts);const Es=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ve=U("check",Es);const Is=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Rs=U("chevron-down",Is);const As=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],zs=U("chevron-left",As);const Ps=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ts=U("chevron-right",Ps);const $s=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Fs=U("chevron-up",$s);const Bs=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ke=U("circle-check-big",Bs);const Os=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Se=U("clock",Os);const Ws=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],_s=U("cloud-rain",Ws);const Vs=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Hs=U("cloud",Vs);const Us=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],Gs=U("coffee",Us);const qs=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Zs=U("copy",qs);const Ks=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Xs=U("download",Ks);const Js=[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]],vt=U("euro",Js);const Ys=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Lt=U("external-link",Ys);const Qs=[["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 4 0v-6.998a2 2 0 0 0-.59-1.42L18 5",key:"1wtuz0"}],["path",{d:"M14 21V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16",key:"e09ifn"}],["path",{d:"M2 21h13",key:"1x0fut"}],["path",{d:"M3 9h11",key:"1p7c0w"}]],ss=U("fuel",Qs);const ea=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],ta=U("globe",ea);const sa=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],aa=U("heart",sa);const ra=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],as=U("info",ra);const na=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],ia=U("leaf",na);const oa=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],jt=U("loader-circle",oa);const la=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],ve=U("map-pin",la);const ca=[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]],da=U("mountain",ca);const ma=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],Nt=U("navigation",ma);const ha=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],zt=U("save",ha);const ua=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],xa=U("search",ua);const ga=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],rs=U("settings",ga);const pa=[["path",{d:"M12 10.189V14",key:"1p8cqu"}],["path",{d:"M12 2v3",key:"qbqxhf"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 2.81 7.76",key:"7tigtc"}],["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1s1.2 1 2.5 1c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"1924j5"}]],Dt=U("ship",pa);const fa=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],ba=U("snowflake",fa);const ya=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Pt=U("star",ya);const va=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],ja=U("sun",va);const Na=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],ut=U("target",Na);const wa=[["path",{d:"M3.5 21 14 3",key:"1szst5"}],["path",{d:"M20.5 21 10 3",key:"1310c3"}],["path",{d:"M15.5 21 12 15l-3.5 6",key:"1ddtfw"}],["path",{d:"M2 21h20",key:"1nyx9w"}]],$t=U("tent",wa);const ka=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],Ft=U("thermometer",ka);const Ca=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ma=U("trash-2",Ca);const Sa=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],La=U("trending-down",Sa);const Da=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],xt=U("trending-up",Da);const Ta=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ye=U("triangle-alert",Ta);const Ea=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ia=U("upload",Ea);const Ra=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],wt=U("users",Ra);const Aa=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],tt=U("x",Aa),pe={BASIC_ROUTING:!0,CAMPSITE_DISPLAY:!0,ROUTE_OPTIMIZATION:!0},st=[{id:"dover-calais",name:"Dover → Calais",type:"ferry",departure:{name:"Dover",lat:51.1279,lng:1.3134,country:"GB"},arrival:{name:"Calais",lat:50.9513,lng:1.8587,country:"FR"},duration:90,frequency:"Up to 30 sailings per day",operators:["P&O Ferries","DFDS"],bookingUrls:["https://www.poferries.com/en/dover-calais","https://www.dfds.com/en-gb/passenger-ferries/dover-calais"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Most popular crossing. Frequent sailings, short crossing time.",estimatedCost:{low:100,high:300,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"dover-dunkirk",name:"Dover → Dunkirk",type:"ferry",departure:{name:"Dover",lat:51.1279,lng:1.3134,country:"GB"},arrival:{name:"Dunkirk",lat:51.0486,lng:2.3767,country:"FR"},duration:120,frequency:"Up to 12 sailings per day",operators:["DFDS"],bookingUrls:["https://www.dfds.com/en-gb/passenger-ferries/dover-dunkirk"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Good alternative to Calais. Often cheaper, slightly longer crossing.",estimatedCost:{low:80,high:250,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"eurotunnel",name:"Folkestone → Calais",type:"tunnel",departure:{name:"Folkestone",lat:51.0947,lng:1.1354,country:"GB"},arrival:{name:"Calais (Coquelles)",lat:50.9268,lng:1.8134,country:"FR"},duration:35,frequency:"Up to 4 departures per hour",operators:["Eurotunnel Le Shuttle"],bookingUrls:["https://www.eurotunnel.com/uk/travelling-with-us/motorhomes-caravans/"],vehicleTypes:["motorhome","campervan"],maxVehicleLength:18,notes:"Fastest crossing. Drive on, drive off. Caravans accepted on some services — check height restrictions (max 2.85m for standard, 3.95m for high-loader).",estimatedCost:{low:120,high:400,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"portsmouth-caen",name:"Portsmouth → Caen (Ouistreham)",type:"ferry",departure:{name:"Portsmouth",lat:50.7989,lng:-1.0872,country:"GB"},arrival:{name:"Caen (Ouistreham)",lat:49.283,lng:-.2488,country:"FR"},duration:360,frequency:"Up to 3 sailings per day",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/portsmouth-caen"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Arrives in Normandy. Good for western France, Spain, and Portugal routes. Day and overnight sailings available.",estimatedCost:{low:150,high:450,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"portsmouth-lehavre",name:"Portsmouth → Le Havre",type:"ferry",departure:{name:"Portsmouth",lat:50.7989,lng:-1.0872,country:"GB"},arrival:{name:"Le Havre",lat:49.4872,lng:.1063,country:"FR"},duration:330,frequency:"1-2 sailings per day",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/portsmouth-le-havre"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing. Arrives early morning, good for heading south through France.",estimatedCost:{low:150,high:400,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"portsmouth-stmalo",name:"Portsmouth → St Malo",type:"ferry",departure:{name:"Portsmouth",lat:50.7989,lng:-1.0872,country:"GB"},arrival:{name:"St Malo",lat:48.6493,lng:-2.007,country:"FR"},duration:540,frequency:"1 sailing per day (seasonal)",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/portsmouth-st-malo"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing to Brittany. Longer but arrives further west. Seasonal service.",estimatedCost:{low:180,high:500,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"plymouth-roscoff",name:"Plymouth → Roscoff",type:"ferry",departure:{name:"Plymouth",lat:50.366,lng:-4.1422,country:"GB"},arrival:{name:"Roscoff",lat:48.7267,lng:-3.981,country:"FR"},duration:360,frequency:"1-2 sailings per day (seasonal)",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/plymouth-roscoff"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Best for travelers from the West Country. Arrives in Brittany. Seasonal service (March-November).",estimatedCost:{low:150,high:450,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"poole-cherbourg",name:"Poole → Cherbourg",type:"ferry",departure:{name:"Poole",lat:50.7076,lng:-1.987,country:"GB"},arrival:{name:"Cherbourg",lat:49.6386,lng:-1.6163,country:"FR"},duration:270,frequency:"1-2 sailings per day",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/poole-cherbourg"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Shorter western crossing. Good for Normandy and heading south.",estimatedCost:{low:130,high:380,currency:"GBP"},region:"western",overnightCrossing:!1},{id:"newhaven-dieppe",name:"Newhaven → Dieppe",type:"ferry",departure:{name:"Newhaven",lat:50.7924,lng:.0613,country:"GB"},arrival:{name:"Dieppe",lat:49.9266,lng:1.077,country:"FR"},duration:240,frequency:"Up to 3 sailings per day",operators:["DFDS"],bookingUrls:["https://www.dfds.com/en-gb/passenger-ferries/newhaven-dieppe"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Arrives in upper Normandy. Good alternative to Dover for London/South East travelers.",estimatedCost:{low:90,high:280,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"harwich-hookofholland",name:"Harwich → Hook of Holland",type:"ferry",departure:{name:"Harwich",lat:51.9461,lng:1.2474,country:"GB"},arrival:{name:"Hook of Holland",lat:51.9811,lng:4.123,country:"NL"},duration:420,frequency:"2 sailings per day",operators:["Stena Line"],bookingUrls:["https://www.stenaline.co.uk/routes/harwich-hook-of-holland"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing to the Netherlands. Best for Germany, Benelux, and Scandinavia routes.",estimatedCost:{low:120,high:350,currency:"GBP"},region:"northern",overnightCrossing:!0},{id:"hull-rotterdam",name:"Hull → Rotterdam (Europoort)",type:"ferry",departure:{name:"Hull",lat:53.7383,lng:-.2903,country:"GB"},arrival:{name:"Rotterdam (Europoort)",lat:51.9546,lng:4.1452,country:"NL"},duration:660,frequency:"1 sailing per day (overnight)",operators:["P&O Ferries"],bookingUrls:["https://www.poferries.com/en/hull-rotterdam"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing. Best for travelers from the North of England. Arrives early morning.",estimatedCost:{low:130,high:380,currency:"GBP"},region:"northern",overnightCrossing:!0},{id:"newcastle-amsterdam",name:"Newcastle → Amsterdam (IJmuiden)",type:"ferry",departure:{name:"Newcastle",lat:54.996,lng:-1.4402,country:"GB"},arrival:{name:"Amsterdam (IJmuiden)",lat:52.4614,lng:4.602,country:"NL"},duration:960,frequency:"1 sailing per day (overnight)",operators:["DFDS"],bookingUrls:["https://www.dfds.com/en-gb/passenger-ferries/newcastle-amsterdam"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing from the North East. Mini-cruise experience. Best for Netherlands, Germany, and beyond.",estimatedCost:{low:150,high:400,currency:"GBP"},region:"northern",overnightCrossing:!0}];function He(s,t){const r=s>=49.9&&s<=60.9&&t>=-8.2&&t<=1.8,a=s>=51.4&&s<=55.4&&t>=-10.5&&t<=-5.9;return r||a}function Bt(s,t){return s>=35&&s<=72&&t>=-10&&t<=40&&!He(s,t)}function ns(s,t,r,a){const i=He(s,t),n=He(r,a),o=Bt(s,t),c=Bt(r,a);return i&&c||o&&n}function za(s,t,r,a){const i=(o,c,l,u)=>{const m=(l-o)*Math.PI/180,x=(u-c)*Math.PI/180,p=Math.sin(m/2)**2+Math.cos(o*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(x/2)**2;return 12742*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))},n=He(s,t);return[...st].map(o=>{const c=n?o.departure:o.arrival,l=n?o.arrival:o.departure,u=i(s,t,c.lat,c.lng),h=i(l.lat,l.lng,r,a),m=(u+h)/80+o.duration/60;return{crossing:o,totalTime:m}}).sort((o,c)=>o.totalTime-c.totalTime).map(({crossing:o})=>o)}const is={relaxed:{maxDailyHours:4,maxDailyDistance:250,description:"Take it easy. Short drives with plenty of time to explore, arrive early and enjoy your campsite.",shortDescription:"~4 hours / ~250 km per day"},moderate:{maxDailyHours:6,maxDailyDistance:350,description:"A good balance. Enough driving to make progress, with time to stop and explore along the way.",shortDescription:"~6 hours / ~350 km per day"},intensive:{maxDailyHours:8,maxDailyDistance:450,description:"Cover ground efficiently. Longer driving days for experienced road-trippers who want to reach their destination faster.",shortDescription:"~8 hours / ~450 km per day"}};function ke(s,t,r,a){const n=(r-s)*Math.PI/180,o=(a-t)*Math.PI/180,c=Math.sin(n/2)**2+Math.cos(s*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(o/2)**2;return 6371*2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))}async function Pa(s,t){try{const r=`https://nominatim.openstreetmap.org/reverse?lat=${s}&lon=${t}&format=json&zoom=10&accept-language=en`,a=await fetch(r,{headers:{"User-Agent":"EuropeanCamperPlanner/1.0"}});if(!a.ok)return`${s.toFixed(2)}°N, ${t.toFixed(2)}°E`;const i=await a.json(),n=i.address;if(n){const o=n.city||n.town||n.village||n.hamlet||"",c=n.state||n.county||"",l=n.country||"";if(o&&l)return`${o}, ${l}`;if(c&&l)return`${c}, ${l}`;if(l)return l}return i.display_name?.split(",").slice(0,2).join(",").trim()||`${s.toFixed(2)}°N, ${t.toFixed(2)}°E`}catch{return`${s.toFixed(2)}°N, ${t.toFixed(2)}°E`}}class os{static async generateItinerary(t){const r=is[t.drivingStyle],a=[],i=this.buildRouteWaypoints(t),n=await Jt.calculateRoute({waypoints:i,vehicleProfile:t.vehicleProfile,options:{geometry:!0,instructions:!0}});if(n.status==="error"||n.routes.length===0)throw new Error(n.errors?.join(", ")||"Failed to calculate route");const o=n.routes[0],c=o.geometry.coordinates,l=o.summary.distance/1e3,u=o.summary.duration/3600,h=this.splitRouteIntoDays(c,r.maxDailyDistance,l),m=[],x=c[0];m.push({lat:x[1],lng:x[0],name:t.start.name,distanceFromStart:0});for(let g=0;g<h.length;g++){const j=h[g];g>0&&await this.delay(1100);const C=await Pa(j.lat,j.lng);m.push({...j,name:C})}const p=c[c.length-1];m.push({lat:p[1],lng:p[0],name:t.end.name,distanceFromStart:l});const N=[];let M=1,y=new Date(t.startDate),k=0;for(let g=0;g<m.length-1;g++){const j=m[g],C=m[g+1],O=C.distanceFromStart-j.distanceFromStart,R=O*(u/l),B=!!(t.crossing&&this.isPointNearCrossing(j,C,t.crossing));let _=[];const G=g===m.length-2;G||(_=await this.findCampsitesNearPoint(C.lat,C.lng,t.vehicleProfile));const A={dayNumber:M,date:new Date(y),type:B?"crossing":"driving",start:{name:j.name,lat:j.lat,lng:j.lng},end:{name:C.name,lat:C.lat,lng:C.lng},distance:Math.round(O),drivingTime:Math.round(R*10)/10,overnightOptions:_,selectedOvernight:_[0]||void 0,crossing:B?t.crossing:void 0,notes:this.generateDayNotes(O,R,r,B,G)};N.push(A),M++,y=new Date(y.getTime()+1440*60*1e3),k++,t.restDayFrequency>0&&k>=t.restDayFrequency&&!G&&(N.push({dayNumber:M,date:new Date(y),type:"rest",start:{name:C.name,lat:C.lat,lng:C.lng},end:{name:C.name,lat:C.lat,lng:C.lng},distance:0,drivingTime:0,overnightOptions:A.overnightOptions,selectedOvernight:A.selectedOvernight,notes:["Rest day — explore the area, relax, or do laundry!"]}),M++,y=new Date(y.getTime()+1440*60*1e3),k=0)}return l>2500&&a.push("This is a long trip. Consider adding rest days for comfort."),t.crossing?.overnightCrossing&&a.push(`The ${t.crossing.name} is an overnight crossing — you'll sleep on the ferry.`),{days:N,crossing:t.crossing,totalDistance:Math.round(l),totalDrivingTime:Math.round(u*10)/10,totalDays:N.length,routeGeometry:c.map(([g,j])=>[j,g]),warnings:a}}static buildRouteWaypoints(t){const r=[],a=He(t.start.lat,t.start.lng);return r.push({id:"wizard-start",lat:t.start.lat,lng:t.start.lng,type:"start",name:t.start.name}),t.crossing&&(a?(r.push({id:"wizard-crossing-depart",lat:t.crossing.departure.lat,lng:t.crossing.departure.lng,type:"waypoint",name:`${t.crossing.departure.name} (${t.crossing.type==="tunnel"?"Tunnel":"Ferry"} Terminal)`}),r.push({id:"wizard-crossing-arrive",lat:t.crossing.arrival.lat,lng:t.crossing.arrival.lng,type:"waypoint",name:`${t.crossing.arrival.name} (Arrival)`})):(r.push({id:"wizard-crossing-depart",lat:t.crossing.arrival.lat,lng:t.crossing.arrival.lng,type:"waypoint",name:`${t.crossing.arrival.name} (${t.crossing.type==="tunnel"?"Tunnel":"Ferry"} Terminal)`}),r.push({id:"wizard-crossing-arrive",lat:t.crossing.departure.lat,lng:t.crossing.departure.lng,type:"waypoint",name:`${t.crossing.departure.name} (Arrival)`}))),r.push({id:"wizard-end",lat:t.end.lat,lng:t.end.lng,type:"end",name:t.end.name}),r}static splitRouteIntoDays(t,r,a){const i=[];if(t.length<2)return i;let n=0,o=0;for(let c=1;c<t.length;c++){const l=t[c-1][0],u=t[c-1][1],h=t[c][0],m=t[c][1],x=ke(u,l,m,h);n+=x,o+=x,o>=r&&a-n>r*.3&&(i.push({lat:m,lng:h,distanceFromStart:n}),o=0)}return i}static async findCampsitesNearPoint(t,r,a){const n=.009009009009009009,o={south:t-15*n,north:t+15*n,west:r-15*n/Math.cos(t*Math.PI/180),east:r+15*n/Math.cos(t*Math.PI/180)};try{const c=await We.searchCampsites({bounds:o,types:["campsite","caravan_site"],maxResults:20});return!c.campsites||c.campsites.length===0?[]:c.campsites.map(u=>{const h=ke(t,r,u.lat,u.lng),m=this.getAmenityList(u),x=this.scoreCampsite(u,h,a);return{campsite:u,distanceFromRoute:Math.round(h*10)/10,suitabilityScore:x,amenitySummary:m}}).filter(u=>u.distanceFromRoute<=15).sort((u,h)=>h.suitabilityScore-u.suitabilityScore).slice(0,3)}catch(c){return console.warn("Failed to find campsites near point:",c),[]}}static scoreCampsite(t,r,a){let i=50;return t.amenities.showers&&(i+=10),t.amenities.electricity&&(i+=10),t.amenities.toilets&&(i+=8),t.amenities.drinking_water&&(i+=5),t.amenities.wifi&&(i+=5),t.amenities.restaurant&&(i+=3),t.amenities.laundry&&(i+=3),t.amenities.swimming_pool&&(i+=2),t.amenities.playground&&(i+=2),t.amenities.shop&&(i+=2),t.name&&!t.name.startsWith("campsite ")&&(i+=5),r<2?i+=10:r<5?i+=5:r>10&&(i-=10),t.type==="campsite"?i+=5:t.type==="caravan_site"&&(i+=3),Math.min(100,Math.max(0,i))}static getAmenityList(t){const r=[];return t.amenities.showers&&r.push("Showers"),t.amenities.electricity&&r.push("Electric"),t.amenities.toilets&&r.push("Toilets"),t.amenities.drinking_water&&r.push("Water"),t.amenities.wifi&&r.push("WiFi"),t.amenities.restaurant&&r.push("Restaurant"),t.amenities.laundry&&r.push("Laundry"),t.amenities.swimming_pool&&r.push("Pool"),t.amenities.shop&&r.push("Shop"),t.amenities.playground&&r.push("Playground"),r}static generateDayNotes(t,r,a,i,n){const o=[];if(i&&o.push("This day includes a channel crossing — allow extra time for check-in and boarding."),n&&o.push("Arrival day! You've made it to your destination."),r>a.maxDailyHours*.9&&o.push("Long driving day — make sure to take regular breaks."),r<2&&!n&&o.push("Short driving day — plenty of time to explore the area."),t>200){const c=Math.floor(r/2);c>0&&o.push(`Plan for ${c} rest stop${c>1?"s":""} during the drive.`)}return o}static isPointNearCrossing(t,r,a){const i=ke(t.lat,t.lng,a.departure.lat,a.departure.lng)<50||ke(r.lat,r.lng,a.departure.lat,a.departure.lng)<50,n=ke(t.lat,t.lng,a.arrival.lat,a.arrival.lng)<50||ke(r.lat,r.lng,a.arrival.lat,a.arrival.lng)<50;return i||n}static needsCrossing(t,r,a,i){return ns(t,r,a,i)}static getRecommendedCrossings(t,r,a,i){return za(t,r,a,i)}static delay(t){return new Promise(r=>setTimeout(r,t))}}const ls=({isOpen:s,title:t,message:r,confirmLabel:a="Confirm",cancelLabel:i="Cancel",confirmVariant:n="primary",onConfirm:o,onCancel:c})=>{if(St.useEffect(()=>{if(!s)return;const u=h=>{h.key==="Escape"?c():h.key==="Enter"&&o()};return document.addEventListener("keydown",u),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",u),document.body.style.overflow="auto"}},[s,c,o]),!s)return null;const l=L("px-4 py-2 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",{"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500":n==="danger","bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":n==="primary","bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500":n==="warning"});return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:c}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors","aria-label":"Close dialog",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:r})}),e.jsxs("div",{className:"flex space-x-3 justify-end",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:i}),e.jsx("button",{onClick:o,className:l,children:a})]})]})})]})},$a=({isOpen:s,position:t,items:r,onClose:a})=>{const i=d.useRef(null);return d.useEffect(()=>{if(!s)return;const n=c=>{i.current&&!i.current.contains(c.target)&&a()},o=c=>{c.key==="Escape"&&a()};return document.addEventListener("mousedown",n),document.addEventListener("keydown",o),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("keydown",o)}},[s,a]),d.useEffect(()=>{if(!s||!i.current)return;const n=i.current,o=n.getBoundingClientRect(),c={width:window.innerWidth,height:window.innerHeight};let{x:l,y:u}=t;l+o.width>c.width&&(l=c.width-o.width-10),u+o.height>c.height&&(u=c.height-o.height-10),n.style.left=`${Math.max(10,l)}px`,n.style.top=`${Math.max(10,u)}px`},[s,t]),s?e.jsx("div",{ref:i,className:"fixed z-50 min-w-48 bg-white border border-gray-200 rounded-lg shadow-lg py-2 animate-fade-in",style:{left:t.x,top:t.y},children:r.map(n=>{const o=L("flex items-center justify-between px-4 py-2 text-sm cursor-pointer transition-colors",{"text-gray-700 hover:bg-gray-50":n.variant==="default"||!n.variant,"text-red-600 hover:bg-red-50":n.variant==="danger","text-blue-600 hover:bg-blue-50":n.variant==="primary","text-gray-400 cursor-not-allowed":n.disabled});return e.jsxs("button",{className:o,onClick:()=>{n.disabled||(n.onClick(),a())},disabled:n.disabled,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[n.icon&&e.jsx("span",{className:"flex-shrink-0",children:n.icon}),e.jsx("span",{children:n.label})]}),n.shortcut&&e.jsx("span",{className:"text-xs text-gray-400 ml-4",children:n.shortcut})]},n.id)})}):null},Fa={petrol:1.65,diesel:1.55,lpg:.85,electricity:.35},Ot={motorhome:{small:{petrol:12,diesel:10,lpg:14},medium:{petrol:15,diesel:12,lpg:17},large:{petrol:18,diesel:15,lpg:20}},caravan:{small:{petrol:10,diesel:8,lpg:12},medium:{petrol:13,diesel:10,lpg:15},large:{petrol:16,diesel:13,lpg:18}},campervan:{small:{petrol:9,diesel:7,lpg:11},medium:{petrol:11,diesel:9,lpg:13},large:{petrol:14,diesel:11,lpg:16}}};class nt{static initializeSettings(t,r){this.fuelConsumptionSettings=t,this.fuelPriceSettings=r}static getDefaultConsumption(t){const r=t.type,a=this.determineVehicleSize(t);return{consumptionType:"l_per_100km",consumption:Ot[r]?.[a]?.diesel||12,fuelType:"diesel",tankCapacity:80}}static getCurrentFuelPrices(){return this.fuelPriceSettings?.priceType==="manual"&&this.fuelPriceSettings.manualPrices?this.fuelPriceSettings.manualPrices:Fa}static async calculateRouteCosts(t,r,a,i){if(t.length<2)return this.createEmptyCostBreakdown();const n=a||this.fuelConsumptionSettings||(r?this.getDefaultConsumption(r):{consumptionType:"l_per_100km",consumption:12,fuelType:"diesel"}),o=i||this.fuelPriceSettings||{priceType:"default_european",currency:"EUR"},c=await this.calculateRouteSegments(t,n,o),l=this.calculateDailyBreakdown(c),u=c.reduce((x,p)=>x+p.fuelCost,0),h=c.reduce((x,p)=>x+(p.tollCost||0),0),m=c.reduce((x,p)=>x+(p.accommodationCost||0),0);return{totalCost:u+h+m,fuelCost:u,tollCost:h,accommodationCost:m,otherCosts:0,currency:o.currency,segments:c,dailyBreakdown:l}}static async calculateCostOptimizations(t,r){const a=[];if(r){const o=this.fuelConsumptionSettings?.consumption||12,c=this.getOptimalConsumption(r);if(o>c*1.1){const l=this.calculateFuelEfficiencySaving(t.fuelCost,o,c);a.push({type:"fuel_efficiency",description:"Improve fuel efficiency through eco-driving techniques",potentialSaving:l,actionRequired:"Maintain steady speeds, avoid rapid acceleration, plan efficient routes"})}}const i=t.fuelCost*.05;a.push({type:"route_alternative",description:"Consider alternative routes to reduce fuel consumption",potentialSaving:i,actionRequired:"Use route optimization with fuel efficiency priority"}),t.segments.length>3&&a.push({type:"fuel_stop",description:"Optimize fuel stops at cheaper stations",potentialSaving:t.fuelCost*.03,actionRequired:"Plan fuel stops at hypermarkets or discount stations"});const n=a.reduce((o,c)=>o+c.potentialSaving,0);return{currentCost:t.totalCost,optimizedCost:t.totalCost-n,savings:n,suggestions:a.sort((o,c)=>c.potentialSaving-o.potentialSaving)}}static convertConsumption(t,r,a){let i;switch(r){case"l_per_100km":i=t;break;case"mpg_imperial":i=282.481/t;break;case"mpg_us":i=235.215/t;break}switch(a){case"l_per_100km":return i;case"mpg_imperial":return 282.481/i;case"mpg_us":return 235.215/i}}static calculateFuelCost(t,r,a){const i=this.convertConsumption(r.consumption,r.consumptionType,"l_per_100km"),n=t/100*i,c=this.getCurrentFuelPrices()[r.fuelType];return n*c}static async calculateRouteSegments(t,r,a){const i=[];for(let n=0;n<t.length-1;n++){const o=t[n],c=t[n+1],l=this.calculateDistance(o,c),u=this.estimateDrivingTime(l),h=this.calculateFuelCost(l,r,a);let m="driving",x=0;c.type==="campsite"||c.type==="accommodation"?(m="overnight",x=this.estimateAccommodationCost(c)):n>0&&l<50&&(m="stop"),i.push({startWaypoint:o,endWaypoint:c,distance:l,duration:u,fuelCost:h,accommodationCost:x,segmentType:m,tollCost:0})}return i}static calculateDailyBreakdown(t){const r=[];let a=new Date,i=0,n=0,o=0;return t.forEach((c,l)=>{i+=c.distance,n+=c.fuelCost,(c.segmentType==="overnight"||l===t.length-1)&&(o+=c.accommodationCost||0,r.push({date:new Date(a),distance:i,fuelCost:n,accommodationCost:o,totalDailyCost:n+o}),a=new Date(a.getTime()+1440*60*1e3),i=0,n=0,o=0)}),r}static createEmptyCostBreakdown(){return{totalCost:0,fuelCost:0,tollCost:0,accommodationCost:0,otherCosts:0,currency:"EUR",segments:[],dailyBreakdown:[]}}static determineVehicleSize(t){const r=t.length||6;return r<6?"small":r<8?"medium":"large"}static getOptimalConsumption(t){const r=t.type,a=this.determineVehicleSize(t);return Ot[r]?.[a]?.diesel||12}static calculateFuelEfficiencySaving(t,r,a){const i=(r-a)/r;return t*i}static calculateDistance(t,r){const i=(r.lat-t.lat)*Math.PI/180,n=(r.lng-t.lng)*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(r.lat*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}static estimateDrivingTime(t){return t/70*60}static estimateAccommodationCost(t){switch(t.type){case"campsite":return 25;case"accommodation":return 80;default:return 0}}}Pe(nt,"fuelConsumptionSettings",null),Pe(nt,"fuelPriceSettings",null);const gt="camper-planner-trips",pt="camper-planner-trip-history",ft="1.0.0",Ba=50;class ue{static async saveTrip(t){const r=new Date,a=await this.getAllTrips(),i=a.find(c=>c.metadata.id===t.metadata.id),n={...t,timestamps:{created:i?.timestamps.created||r,modified:r,lastOpened:i?.timestamps.lastOpened||r,version:ft}},o=a.findIndex(c=>c.metadata.id===t.metadata.id);return o>=0?a[o]=n:a.push(n),localStorage.setItem(gt,JSON.stringify(a)),await this.addToHistory(n),n}static async loadTrip(t){const a=(await this.getAllTrips()).find(i=>i.metadata.id===t);return a&&(a.timestamps.lastOpened=new Date,await this.saveTrip(a)),a||null}static async getAllTrips(){try{const t=localStorage.getItem(gt);return t?JSON.parse(t).map(a=>({...a,timestamps:{...a.timestamps,created:new Date(a.timestamps.created),modified:new Date(a.timestamps.modified),lastOpened:new Date(a.timestamps.lastOpened)},data:{...a.data,costCalculations:a.data.costCalculations?{...a.data.costCalculations,lastCalculated:new Date(a.data.costCalculations.lastCalculated)}:void 0,optimization:a.data.optimization?{...a.data.optimization,appliedAt:new Date(a.data.optimization.appliedAt)}:void 0}})):[]}catch(t){return console.error("Failed to load trips:",t),[]}}static async getTripSummaries(t){let a=await this.getAllTrips();return t?.excludeTemplates&&(a=a.filter(i=>!i.metadata.isTemplate)),t?.category&&(a=a.filter(i=>i.metadata.category===t.category)),t?.tags&&t.tags.length>0&&(a=a.filter(i=>t.tags.some(n=>i.metadata.tags.includes(n)))),a.map(i=>({id:i.metadata.id,name:i.metadata.name,category:i.metadata.category,tags:i.metadata.tags,duration:i.metadata.duration,estimatedCost:i.metadata.estimatedCost,currency:i.metadata.currency,waypointCount:i.data.waypoints.length,countries:i.metadata.countries,lastModified:i.timestamps.modified,lastOpened:i.timestamps.lastOpened,isTemplate:i.metadata.isTemplate})).sort((i,n)=>n.lastModified.getTime()-i.lastModified.getTime())}static async deleteTrip(t){try{const r=await this.getAllTrips(),a=r.length,i=r.filter(n=>n.metadata.id!==t);return i.length===a?!1:(localStorage.setItem(gt,JSON.stringify(i)),!0)}catch(r){return console.error("Failed to delete trip:",r),!1}}static async duplicateTrip(t,r){const a=await this.loadTrip(t);if(!a)return null;const i=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={...a,metadata:{...a.metadata,id:i,name:r||`${a.metadata.name} (Copy)`,isTemplate:!1,isPublic:!1}};return await this.saveTrip(n)}static async exportTrip(t){const r=await this.loadTrip(t);if(!r)return null;const a={...r,exportInfo:{exportedAt:new Date,exportedBy:"camper-planner",version:ft,exportId:`export_${Date.now()}`}};return JSON.stringify(a,null,2)}static async importTrip(t,r){try{const a=JSON.parse(t);if(!a.metadata||!a.data)throw new Error("Invalid trip data structure");const i=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={metadata:{...a.metadata,id:i,name:r||`${a.metadata.name} (Imported)`,isTemplate:!1,isPublic:!1},data:a.data,timestamps:{created:new Date,modified:new Date,lastOpened:new Date,version:ft},sharing:{originalTripId:a.metadata.id,sharedBy:a.exportInfo?.exportedBy||"unknown",sharedAt:a.exportInfo?.exportedAt?new Date(a.exportInfo.exportedAt):new Date,exportId:a.exportInfo?.exportId}};return await this.saveTrip(n)}catch(a){return console.error("Failed to import trip:",a),null}}static async getRecentTrips(t=10){return(await this.getTripSummaries({excludeTemplates:!0})).sort((a,i)=>i.lastOpened.getTime()-a.lastOpened.getTime()).slice(0,t)}static async addToHistory(t){try{const r=localStorage.getItem(pt);let a=[];r&&(a=JSON.parse(r).map(i=>({...i,accessedAt:new Date(i.accessedAt)}))),a=a.filter(i=>i.tripId!==t.metadata.id),a.unshift({tripId:t.metadata.id,accessedAt:new Date,tripName:t.metadata.name}),a=a.slice(0,Ba),localStorage.setItem(pt,JSON.stringify(a))}catch(r){console.error("Failed to update trip history:",r)}}static async getTripHistory(){try{const t=localStorage.getItem(pt);return t?JSON.parse(t).map(r=>({...r,accessedAt:new Date(r.accessedAt)})):[]}catch(t){return console.error("Failed to load trip history:",t),[]}}static async compareTrips(t){try{const a=(await Promise.all(t.map(l=>this.loadTrip(l)))).filter(l=>l!==null);if(a.length<2)return null;const i={trips:a,comparison:{costs:{},routes:{},analysis:{cheapest:"",shortest:"",fastest:"",mostScenic:"",recommendations:[]}}};let n=1/0,o=1/0,c=1/0;return a.forEach(l=>{const u=l.metadata.id,h=l.data.costCalculations?.breakdown;h&&(i.comparison.costs[u]={total:h.totalCost,fuel:h.fuelCost,accommodation:h.accommodationCost,tolls:h.tollCost},h.totalCost<n&&(n=h.totalCost,i.comparison.analysis.cheapest=u));const m=this.calculateTotalDistance(l.data.waypoints),x=m/70;i.comparison.routes[u]={distance:m,duration:x,waypointCount:l.data.waypoints.length,countries:l.metadata.countries},m<o&&(o=m,i.comparison.analysis.shortest=u),x<c&&(c=x,i.comparison.analysis.fastest=u)}),a.forEach(l=>{const u=l.metadata.id,h=[];u===i.comparison.analysis.cheapest&&h.push({tripId:u,reason:"Most cost-effective option",advantage:`Lowest total cost: €${i.comparison.costs[u]?.total.toFixed(2)||"N/A"}`}),u===i.comparison.analysis.shortest&&h.push({tripId:u,reason:"Shortest distance",advantage:`Least driving: ${o.toFixed(0)}km`}),(l.metadata.tags.includes("scenic")||l.metadata.tags.includes("nature"))&&(i.comparison.analysis.mostScenic=u,h.push({tripId:u,reason:"Most scenic route",advantage:"Best for sightseeing and photography"})),i.comparison.analysis.recommendations.push(...h)}),i}catch(r){return console.error("Failed to compare trips:",r),null}}static async getTripCategories(){const t=await this.getAllTrips(),r=new Map;return t.forEach(a=>{if(!a.metadata.isTemplate){const i=r.get(a.metadata.category)||0;r.set(a.metadata.category,i+1)}}),Array.from(r.entries()).map(([a,i])=>({category:a,count:i})).sort((a,i)=>i.count-a.count)}static async getAllTags(){const t=await this.getAllTrips(),r=new Map;return t.forEach(a=>{a.metadata.isTemplate||a.metadata.tags.forEach(i=>{const n=r.get(i)||0;r.set(i,n+1)})}),Array.from(r.entries()).map(([a,i])=>({tag:a,count:i})).sort((a,i)=>i.count-a.count)}static async searchTrips(t){const r=await this.getTripSummaries(),a=t.toLowerCase();return r.filter(i=>i.name.toLowerCase().includes(a)||i.tags.some(n=>n.toLowerCase().includes(a))||i.countries.some(n=>n.toLowerCase().includes(a)))}static calculateTotalDistance(t){if(t.length<2)return 0;let r=0;for(let a=0;a<t.length-1;a++)r+=this.calculateDistance(t[a],t[a+1]);return r}static calculateDistance(t,r){const i=(r.lat-t.lat)*Math.PI/180,n=(r.lng-t.lng)*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(r.lat*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}}function at(s,t,r){if(!s.routes.length)throw new Error("No routes available for export");const a=s.routes[0],i=new Date().toISOString(),n=t.map((m,x)=>({id:m.id,name:m.name||`Waypoint ${x+1}`,description:void 0,lat:m.lat,lng:m.lng,elevation:void 0,type:m.type,order:x})),o=a.geometry.coordinates,c={north:Math.max(...o.map(m=>m[1])),south:Math.min(...o.map(m=>m[1])),east:Math.max(...o.map(m=>m[0])),west:Math.min(...o.map(m=>m[0]))},l=a.segments.map((m,x)=>{const p=[],N=Math.floor(o.length/a.segments.length),M=x*N,y=x===a.segments.length-1?o.length:(x+1)*N;let k=0;for(let j=M;j<y;j++){const C=o[j];if(j>M){const O=o[j-1];k+=Oa(O[1],O[0],C[1],C[0])}p.push({lat:C[1],lng:C[0],elevation:C[2],distance:k})}const g=(m.steps||[]).map(j=>({distance:j.distance,duration:j.duration,instruction:j.instruction,streetName:j.name,coordinates:j.wayPoints}));return{points:p,distance:m.distance,duration:m.duration,instructions:g.length>0?g:void 0}}),u={name:r||`Route ${s.id}`,segments:l,totalDistance:a.summary.distance,totalDuration:a.summary.duration,bounds:c},h={creator:"European Camper Trip Planner",version:"1.0.0",timestamp:i,service:s.metadata.service,profile:s.metadata.profile,vehicleProfile:s.metadata.query.vehicleProfile,restrictions:s.restrictions?{violatedDimensions:s.restrictions.violatedDimensions,warnings:s.warnings||[]}:void 0};return{id:s.id,name:r||`European Camper Route - ${new Date().toLocaleDateString()}`,description:`Generated route with ${t.length} waypoints. Distance: ${Math.round(a.summary.distance/1e3)} km, Duration: ${Math.round(a.summary.duration/3600)}h ${Math.round(a.summary.duration%3600/60)}m`,waypoints:n,track:u,metadata:h}}function Oa(s,t,r,a){const n=(r-s)*Math.PI/180,o=(a-t)*Math.PI/180,c=Math.sin(n/2)*Math.sin(n/2)+Math.cos(s*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function rt(s){if(!s.id||!s.waypoints.length||!s.track.segments.length)return!1;for(const t of s.waypoints)if(!t.id||!t.name||!Wt(t.lat,t.lng))return!1;for(const t of s.track.segments){if(!t.points.length)return!1;for(const r of t.points)if(!Wt(r.lat,r.lng))return!1}return!0}function Wt(s,t){return s>=-90&&s<=90&&t>=-180&&t<=180}const _t={gpx:{format:"gpx",mimeType:"application/gpx+xml",extension:".gpx",supportsElevation:!0,supportsInstructions:!0},kml:{format:"kml",mimeType:"application/vnd.google-earth.kml+xml",extension:".kml",supportsElevation:!0,supportsInstructions:!1},json:{format:"json",mimeType:"application/json",extension:".json",supportsElevation:!0,supportsInstructions:!0},csv:{format:"csv",mimeType:"text/csv",extension:".csv",supportsElevation:!0,supportsInstructions:!1}};class cs{static async exportToGPX(t,r,a,i={}){try{const n={...this.DEFAULT_OPTIONS,...i},o=at(t,r,a);if(!rt(o))return{success:!1,error:"Invalid route data for export",format:"gpx"};const c=this.generateGPXContent(o,n),l=this.generateFilename(o.name,"gpx");return{success:!0,data:c,filename:l,format:"gpx",size:new Blob([c]).size}}catch(n){return console.error("GPX export error:",n),{success:!1,error:n instanceof Error?n.message:"Unknown export error",format:"gpx"}}}static generateGPXContent(t,r){const a=this.escapeXML(t.name),i=this.escapeXML(t.description);let n=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="${this.escapeXML(r.creator||"Camper Planner")}"
     xmlns="http://www.topografix.com/GPX/1/1"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
`;return r.includeMetadata&&(n+=`  <metadata>
    <name>${a}</name>
    <desc>${i}</desc>
    <author>
      <name>${this.escapeXML(t.metadata.creator)}</name>
    </author>
    <time>${t.metadata.timestamp}</time>
    <bounds minlat="${t.track.bounds.south}" minlon="${t.track.bounds.west}"
            maxlat="${t.track.bounds.north}" maxlon="${t.track.bounds.east}"/>
`,t.metadata.vehicleProfile&&(n+=`    <extensions>
      <vehicle_profile>
        <height>${t.metadata.vehicleProfile.height}</height>
        <width>${t.metadata.vehicleProfile.width}</width>
        <length>${t.metadata.vehicleProfile.length}</length>
        <weight>${t.metadata.vehicleProfile.weight}</weight>
      </vehicle_profile>
`,t.metadata.restrictions&&(n+=`      <restrictions>
        <violated_dimensions>${t.metadata.restrictions.violatedDimensions.join(", ")}</violated_dimensions>
        <warnings>${t.metadata.restrictions.warnings.join("; ")}</warnings>
      </restrictions>
`),n+=`    </extensions>
`),n+=`  </metadata>
`),r.includeWaypoints&&t.waypoints.forEach(o=>{n+=`  <wpt lat="${o.lat}" lon="${o.lng}">
    <name>${this.escapeXML(o.name)}</name>
    <type>${o.type}</type>
`,o.description&&(n+=`    <desc>${this.escapeXML(o.description)}</desc>
`),o.elevation&&r.includeElevation&&(n+=`    <ele>${o.elevation}</ele>
`),n+=`    <extensions>
      <order>${o.order}</order>
      <waypoint_type>${o.type}</waypoint_type>
    </extensions>
`,n+=`  </wpt>
`}),r.includeTrackPoints&&(n+=`  <trk>
    <name>${a} Track</name>
    <desc>Route track with ${t.track.segments.length} segments</desc>
    <extensions>
      <total_distance>${t.track.totalDistance}</total_distance>
      <total_duration>${t.track.totalDuration}</total_duration>
      <service>${this.escapeXML(t.metadata.service)}</service>
      <profile>${this.escapeXML(t.metadata.profile)}</profile>
    </extensions>
`,t.track.segments.forEach((o,c)=>{n+=`    <trkseg>
`,o.points.forEach(l=>{n+=`      <trkpt lat="${l.lat}" lon="${l.lng}">
`,l.elevation&&r.includeElevation&&(n+=`        <ele>${l.elevation}</ele>
`),l.time&&(n+=`        <time>${l.time}</time>
`),l.distance!==void 0&&(n+=`        <extensions>
          <distance>${l.distance}</distance>
        </extensions>
`),n+=`      </trkpt>
`}),r.includeInstructions&&o.instructions&&o.instructions.forEach((l,u)=>{n+=`      <!-- Instruction ${u+1}: ${this.escapeXML(l.instruction)} -->
      <trkpt lat="${l.coordinates[1]}" lon="${l.coordinates[0]}">
        <name>Instruction ${u+1}</name>
        <desc>${this.escapeXML(l.instruction)}</desc>
        <extensions>
          <instruction>
            <text>${this.escapeXML(l.instruction)}</text>
            <distance>${l.distance}</distance>
            <duration>${l.duration}</duration>
            ${l.direction?`<direction>${this.escapeXML(l.direction)}</direction>`:""}
            ${l.streetName?`<street>${this.escapeXML(l.streetName)}</street>`:""}
          </instruction>
        </extensions>
      </trkpt>
`}),n+=`    </trkseg>
`}),n+=`  </trk>
`),n+=`  <rte>
    <name>${a} Route</name>
    <desc>Waypoint-based route</desc>
`,t.waypoints.forEach(o=>{n+=`    <rtept lat="${o.lat}" lon="${o.lng}">
      <name>${this.escapeXML(o.name)}</name>
      <desc>${o.type}</desc>
    </rtept>
`}),n+=`  </rte>
`,n+="</gpx>",n}static async downloadGPX(t,r,a,i){try{const n=await this.exportToGPX(t,r,a,i);if(!n.success||!n.data||!n.filename)throw new Error(n.error||"Export failed");const o=new Blob([n.data],{type:"application/gpx+xml"}),c=URL.createObjectURL(o),l=document.createElement("a");return l.href=c,l.download=n.filename,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),!0}catch(n){return console.error("GPX download error:",n),!1}}static validateGPX(t){const r=[];t.includes("<?xml")||r.push("Missing XML declaration"),t.includes("<gpx")||r.push("Missing GPX root element"),t.includes("</gpx>")||r.push("Missing closing GPX tag"),t.includes("<metadata>")||r.push("Missing metadata section");const a=/lat="(-?\d+\.?\d*)" lon="(-?\d+\.?\d*)"/g,i=[...t.matchAll(a)];for(const n of i){const o=parseFloat(n[1]),c=parseFloat(n[2]);(o<-90||o>90)&&r.push(`Invalid latitude: ${o}`),(c<-180||c>180)&&r.push(`Invalid longitude: ${c}`)}return{valid:r.length===0,errors:r}}static getExportStats(t){const r=t.track.segments.reduce((n,o)=>n+o.points.length,0),a=t.track.segments.some(n=>n.points.some(o=>o.elevation!==void 0)),i=t.track.segments.some(n=>n.instructions&&n.instructions.length>0);return{waypoints:t.waypoints.length,trackPoints:r,segments:t.track.segments.length,distance:`${(t.track.totalDistance/1e3).toFixed(1)} km`,duration:this.formatDuration(t.track.totalDuration),hasElevation:a,hasInstructions:i}}static escapeXML(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}static generateFilename(t,r){const a=t.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"_").toLowerCase(),i=new Date().toISOString().split("T")[0];return`${a}_${i}.${r}`}static formatDuration(t){const r=Math.floor(t/3600),a=Math.floor(t%3600/60);return r>0?`${r}h ${a}m`:`${a}m`}}Pe(cs,"DEFAULT_OPTIONS",{includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner"});class Wa{static async exportRoute(t,r,a,i,n={}){const o={includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner",format:a,...n};try{switch(a){case"gpx":return await cs.exportToGPX(t,r,i,o);case"kml":return await this.exportToKML(t,r,i,o);case"json":return await this.exportToJSON(t,r,i,o);case"csv":return await this.exportToCSV(t,r,i,o);default:return{success:!1,error:`Unsupported format: ${a}`,format:a}}}catch(c){return console.error(`${a.toUpperCase()} export error:`,c),{success:!1,error:c instanceof Error?c.message:"Unknown export error",format:a}}}static async exportToKML(t,r,a,i={}){const n=at(t,r,a);if(!rt(n))return{success:!1,error:"Invalid route data for KML export",format:"kml"};const o=this.generateKMLContent(n,i),c=this.generateFilename(n.name,"kml");return{success:!0,data:o,filename:c,format:"kml",size:new Blob([o]).size}}static generateKMLContent(t,r){const a=this.escapeXML(t.name),i=this.escapeXML(t.description);let n=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <name>${a}</name>
    <description>${i}</description>
`;return n+=`    <!-- Styles -->
    <Style id="start-point">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/grn-circle.png</href></Icon>
        <scale>1.2</scale>
      </IconStyle>
    </Style>
    <Style id="end-point">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/red-circle.png</href></Icon>
        <scale>1.2</scale>
      </IconStyle>
    </Style>
    <Style id="waypoint">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/blu-circle.png</href></Icon>
      </IconStyle>
    </Style>
    <Style id="campsite">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/ylw-stars.png</href></Icon>
      </IconStyle>
    </Style>
    <Style id="route-line">
      <LineStyle>
        <color>ff0000ff</color>
        <width>4</width>
      </LineStyle>
    </Style>
`,r.includeWaypoints&&(n+=`    <!-- Waypoints -->
    <Folder>
      <name>Waypoints</name>
`,t.waypoints.forEach((o,c)=>{let l="waypoint";o.type==="start"?l="start-point":o.type==="end"?l="end-point":o.type==="campsite"&&(l="campsite"),n+=`      <Placemark>
        <name>${this.escapeXML(o.name)}</name>
        <description>
          <![CDATA[
            <strong>Type:</strong> ${o.type}<br/>
            <strong>Position:</strong> ${c+1} of ${t.waypoints.length}<br/>
            <strong>Coordinates:</strong> ${o.lat.toFixed(4)}, ${o.lng.toFixed(4)}
            ${o.description?`<br/><strong>Description:</strong> ${o.description}`:""}
          ]]>
        </description>
        <styleUrl>#${l}</styleUrl>
        <Point>
          <coordinates>${o.lng},${o.lat}${o.elevation?`,${o.elevation}`:""}</coordinates>
        </Point>
      </Placemark>
`}),n+=`    </Folder>
`),r.includeTrackPoints&&(n+=`    <!-- Route Track -->
    <Placemark>
      <name>${a} Track</name>
      <description>
        <![CDATA[
          <strong>Distance:</strong> ${(t.track.totalDistance/1e3).toFixed(1)} km<br/>
          <strong>Duration:</strong> ${this.formatDuration(t.track.totalDuration)}<br/>
          <strong>Service:</strong> ${t.metadata.service}<br/>
          <strong>Profile:</strong> ${t.metadata.profile}
        ]]>
      </description>
      <styleUrl>#route-line</styleUrl>
      <LineString>
        <tessellate>1</tessellate>
        <coordinates>
`,t.track.segments.forEach(o=>{o.points.forEach(c=>{n+=`          ${c.lng},${c.lat}${c.elevation?`,${c.elevation}`:",0"}
`})}),n+=`        </coordinates>
      </LineString>
    </Placemark>
`),r.includeInstructions&&(n+=`    <!-- Instructions -->
    <Folder>
      <name>Turn Instructions</name>
`,t.track.segments.forEach((o,c)=>{o.instructions&&o.instructions.forEach((l,u)=>{n+=`      <Placemark>
        <name>Instruction ${c+1}.${u+1}</name>
        <description>
          <![CDATA[
            ${this.escapeXML(l.instruction)}<br/>
            <strong>Distance:</strong> ${(l.distance/1e3).toFixed(1)} km<br/>
            <strong>Duration:</strong> ${this.formatDuration(l.duration)}
            ${l.streetName?`<br/><strong>Street:</strong> ${this.escapeXML(l.streetName)}`:""}
            ${l.direction?`<br/><strong>Direction:</strong> ${this.escapeXML(l.direction)}`:""}
          ]]>
        </description>
        <Point>
          <coordinates>${l.coordinates[0]},${l.coordinates[1]},0</coordinates>
        </Point>
      </Placemark>
`})}),n+=`    </Folder>
`),n+=`  </Document>
</kml>`,n}static async exportToJSON(t,r,a,i={}){const n=at(t,r,a);if(!rt(n))return{success:!1,error:"Invalid route data for JSON export",format:"json"};const o={...n,exportInfo:{format:"json",version:"1.0",exportedAt:new Date().toISOString(),exportedBy:i.creator||"European Camper Trip Planner",options:{includeWaypoints:i.includeWaypoints,includeTrackPoints:i.includeTrackPoints,includeInstructions:i.includeInstructions,includeElevation:i.includeElevation,includeMetadata:i.includeMetadata}},statistics:{totalWaypoints:n.waypoints.length,totalTrackPoints:n.track.segments.reduce((u,h)=>u+h.points.length,0),totalSegments:n.track.segments.length,totalInstructions:n.track.segments.reduce((u,h)=>u+(h.instructions?.length||0),0),hasElevation:n.track.segments.some(u=>u.points.some(h=>h.elevation!==void 0)),bounds:n.track.bounds}},c=JSON.stringify(o,null,2),l=this.generateFilename(n.name,"json");return{success:!0,data:c,filename:l,format:"json",size:new Blob([c]).size}}static async exportToCSV(t,r,a,i={}){const n=at(t,r,a);if(!rt(n))return{success:!1,error:"Invalid route data for CSV export",format:"csv"};let o="";i.includeWaypoints&&(o+=`# Waypoints
`,o+=`ID,Name,Type,Latitude,Longitude,Elevation,Order,Description
`,n.waypoints.forEach(l=>{o+=`"${l.id}","${this.escapeCSV(l.name)}","${l.type}",${l.lat},${l.lng},${l.elevation||""},${l.order},"${this.escapeCSV(l.description||"")}"
`}),o+=`
`),i.includeTrackPoints&&(o+=`# Track Points
`,o+=`Segment,Point_Index,Latitude,Longitude,Elevation,Distance,Time
`,n.track.segments.forEach((l,u)=>{l.points.forEach((h,m)=>{o+=`${u+1},${m+1},${h.lat},${h.lng},${h.elevation||""},${h.distance||""},${h.time||""}
`})}),o+=`
`),i.includeInstructions&&(o+=`# Instructions
`,o+=`Segment,Instruction_Index,Instruction,Distance,Duration,Direction,Street_Name,Latitude,Longitude
`,n.track.segments.forEach((l,u)=>{l.instructions&&l.instructions.forEach((h,m)=>{o+=`${u+1},${m+1},"${this.escapeCSV(h.instruction)}",${h.distance},${h.duration},"${this.escapeCSV(h.direction||"")}","${this.escapeCSV(h.streetName||"")}",${h.coordinates[1]},${h.coordinates[0]}
`})}),o+=`
`),o+=`# Route Summary
`,o+=`Property,Value
`,o+=`"Route Name","${this.escapeCSV(n.name)}"
`,o+=`"Description","${this.escapeCSV(n.description)}"
`,o+=`"Total Distance (km)","${(n.track.totalDistance/1e3).toFixed(2)}"
`,o+=`"Total Duration","${this.formatDuration(n.track.totalDuration)}"
`,o+=`"Total Waypoints","${n.waypoints.length}"
`,o+=`"Total Segments","${n.track.segments.length}"
`,o+=`"Service","${n.metadata.service}"
`,o+=`"Profile","${n.metadata.profile}"
`,o+=`"Created","${n.metadata.timestamp}"
`;const c=this.generateFilename(n.name,"csv");return{success:!0,data:o,filename:c,format:"csv",size:new Blob([o]).size}}static async downloadRoute(t,r,a,i,n){try{const o=await this.exportRoute(t,r,a,i,n);if(!o.success||!o.data||!o.filename)throw new Error(o.error||"Export failed");const c=_t[a],l=new Blob([o.data],{type:c.mimeType}),u=URL.createObjectURL(l),h=document.createElement("a");return h.href=u,h.download=o.filename,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(u),!0}catch(o){return console.error(`${a.toUpperCase()} download error:`,o),!1}}static getAvailableFormats(){return Object.values(_t).map(t=>({...t,capabilities:["Waypoints",...t.supportsElevation?["Elevation"]:[],...t.supportsInstructions?["Turn Instructions"]:[],"Track Points","Metadata"]}))}static escapeXML(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}static escapeCSV(t){return t?t.replace(/"/g,'""'):""}static generateFilename(t,r){const a=t.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"_").toLowerCase(),i=new Date().toISOString().split("T")[0];return`${a}_${i}.${r}`}static formatDuration(t){const r=Math.floor(t/3600),a=Math.floor(t%3600/60);return r>0?`${r}h ${a}m`:`${a}m`}}const _a=({className:s="",onTripLoad:t,onClose:r,isVisible:a=!0})=>{const{waypoints:i}=re(),{profile:n}=oe(),{fuelConsumptionSettings:o,fuelPriceSettings:c}=Yt(),[l,u]=d.useState("my_trips"),[h,m]=d.useState([]),[x,p]=d.useState([]),[N,M]=d.useState([]),[y,k]=d.useState([]),[g,j]=d.useState(null),[C,O]=d.useState(""),[R,B]=d.useState("all"),[_,G]=d.useState("all"),[A,F]=d.useState(!1),[T,z]=d.useState(null),[X,K]=d.useState(!1),[J,ne]=d.useState({name:"",description:"",category:"leisure",tags:[],isPublic:!1}),[ae,v]=d.useState(!1),[V,Z]=d.useState(""),[se,D]=d.useState(!1),[E,w]=d.useState(null),[P,b]=d.useState("gpx"),[I,W]=d.useState({includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner"});d.useEffect(()=>{te(),le(),Y()},[]);const H=h.filter(f=>{const $=f.name.toLowerCase().includes(C.toLowerCase())||f.tags.some(Q=>Q.toLowerCase().includes(C.toLowerCase())),S=R==="all"||f.category===R;return $&&S}),q=x.filter(f=>{const $=f.metadata.name.toLowerCase().includes(C.toLowerCase())||f.metadata.tags.some(Ne=>Ne.toLowerCase().includes(C.toLowerCase())),S=R==="all"||f.metadata.category===R,Q=_==="all"||f.metadata.difficulty===_;return $&&S&&Q}),te=async()=>{try{const f=await ue.getTripSummaries({excludeTemplates:!0});m(f)}catch(f){z("Failed to load trips"),console.error("Load trips error:",f)}},le=async()=>{try{p([])}catch(f){z("Failed to load templates"),console.error("Load templates error:",f)}},Y=async()=>{try{const f=await ue.getRecentTrips(10);M(f)}catch(f){console.error("Load recent trips error:",f)}},ee=async()=>{if(i.length<2){z("Add at least 2 waypoints to save a trip");return}K(!0)},ie=async()=>{if(!J.name.trim()){z("Trip name is required");return}F(!0);try{const f=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,$=Ae(i),S=Math.ceil(i.length/2),Q=100*i.length,Ne={metadata:{id:f,name:J.name,description:J.description,category:J.category,tags:J.tags,duration:S,difficulty:"moderate",season:"year_round",countries:$,estimatedCost:Q,currency:"EUR",isTemplate:!1,isPublic:J.isPublic},data:{waypoints:i,vehicleProfile:n||void 0,routePreferences:{avoidTolls:!1,avoidFerries:!1,preferScenic:!1,fuelEfficient:!0},campsiteSelections:[],costCalculations:{breakdown:{totalCost:Q,fuelCost:Q*.6,tollCost:0,accommodationCost:Q*.4,otherCosts:0,currency:"EUR",segments:[],dailyBreakdown:[]},fuelSettings:o,priceSettings:c,lastCalculated:new Date}}};await ue.saveTrip(Ne),await te(),K(!1),ne({name:"",description:"",category:"leisure",tags:[],isPublic:!1})}catch(f){z("Failed to save trip"),console.error("Save trip error:",f)}finally{F(!1)}},ce=async f=>{F(!0);try{const $=await ue.loadTrip(f);$&&t&&(t($),await Y())}catch($){z("Failed to load trip"),console.error("Load trip error:",$)}finally{F(!1)}},me=async f=>{F(!0);try{await ue.duplicateTrip(f),await te()}catch($){z("Failed to duplicate trip"),console.error("Duplicate trip error:",$)}finally{F(!1)}},Ee=async f=>{if(confirm("Are you sure you want to delete this trip?")){F(!0);try{await ue.deleteTrip(f),await te()}catch($){z("Failed to delete trip"),console.error("Delete trip error:",$)}finally{F(!1)}}},je=f=>{w(f),D(!0)},Ie=async()=>{if(E)try{F(!0);const f=await ue.loadTrip(E);if(!f)throw new Error("Trip not found");const $=Ze(f),S={format:P,includeWaypoints:I.includeWaypoints??!0,includeTrackPoints:I.includeTrackPoints??!0,includeInstructions:I.includeInstructions??!0,includeElevation:I.includeElevation??!0,includeMetadata:I.includeMetadata??!0,creator:I.creator||"European Camper Trip Planner",description:`${f.metadata.name} - ${f.metadata.description||"Exported from Trip Manager"}`};if(await Wa.downloadRoute($,f.data.waypoints,P,f.metadata.name,S))D(!1),w(null);else throw new Error("Export download failed")}catch(f){z("Failed to export trip"),console.error("Export trip error:",f)}finally{F(!1)}},qe=async()=>{if(!V.trim()){z("Please paste trip data to import");return}F(!0);try{await ue.importTrip(V)?(await te(),v(!1),Z("")):z("Invalid trip data format")}catch(f){z("Failed to import trip"),console.error("Import trip error:",f)}finally{F(!1)}},ct=async f=>{F(!0);try{z("Templates not available in MVP version")}catch($){z("Failed to create trip from template"),console.error("Template to trip error:",$)}finally{F(!1)}},dt=async()=>{if(y.length<2){z("Select at least 2 trips to compare");return}F(!0);try{const f=await ue.compareTrips(y);j(f),u("comparison")}catch(f){z("Failed to compare trips"),console.error("Compare trips error:",f)}finally{F(!1)}},Re=(f,$)=>{const Q=($.lat-f.lat)*Math.PI/180,Ne=($.lng-f.lng)*Math.PI/180,Et=Math.sin(Q/2)*Math.sin(Q/2)+Math.cos(f.lat*Math.PI/180)*Math.cos($.lat*Math.PI/180)*Math.sin(Ne/2)*Math.sin(Ne/2);return 6371*(2*Math.atan2(Math.sqrt(Et),Math.sqrt(1-Et)))},fe=f=>{if(f.length<2)return 0;let $=0;for(let S=0;S<f.length-1;S++)$+=Re(f[S],f[S+1]);return $},Ze=f=>{const $=f.data.waypoints;return{id:`trip_${f.metadata.id}`,status:"success",routes:[{geometry:{coordinates:$.map(S=>[S.lng,S.lat]),type:"LineString"},summary:{distance:$.length>1?fe($)*1e3:0,duration:$.length>1?fe($)/70*3600:0},waypoints:$.map((S,Q)=>Q),segments:[{distance:$.length>1?fe($)*1e3:0,duration:$.length>1?fe($)/70*3600:0,steps:$.map((S,Q)=>({instruction:Q===0?`Start at ${S.name}`:`Continue to ${S.name}`,name:S.name,distance:Q>0?Re($[Q-1],S)*1e3:0,duration:Q>0?Re($[Q-1],S)/70*3600:0,geometry:{coordinates:[S.lng,S.lat]},maneuver:{location:[S.lng,S.lat]},wayPoints:[0,1]}))}]}],metadata:{service:"openrouteservice",profile:f.data.vehicleProfile?.type||"driving-hgv",timestamp:Date.now(),query:{waypoints:$,vehicleProfile:f.data.vehicleProfile},attribution:"OpenRouteService"}}},Ae=f=>{const $=new Set;return f.forEach(S=>{S.lat>=46&&S.lat<=51&&S.lng>=-5&&S.lng<=10&&$.add("France"),S.lat>=47&&S.lat<=55&&S.lng>=5&&S.lng<=15&&$.add("Germany"),S.lat>=36&&S.lat<=47&&S.lng>=6&&S.lng<=19&&$.add("Italy"),S.lat>=36&&S.lat<=44&&S.lng>=-10&&S.lng<=5&&$.add("Spain")}),Array.from($)},he=(f,$="EUR")=>new Intl.NumberFormat("en-EU",{style:"currency",currency:$,minimumFractionDigits:0,maximumFractionDigits:0}).format(f),ge=f=>{switch(f){case"adventure":return e.jsx(da,{className:"w-4 h-4"});case"romantic":return e.jsx(aa,{className:"w-4 h-4"});case"business":return e.jsx(ks,{className:"w-4 h-4"});case"family":return e.jsx(wt,{className:"w-4 h-4"});default:return e.jsx(Ge,{className:"w-4 h-4"})}},ze=f=>{switch(f){case"easy":return"text-green-600 bg-green-100";case"moderate":return"text-yellow-600 bg-yellow-100";case"challenging":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return a?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Nt,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Trip Manager"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ee,disabled:i.length<2,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(zt,{className:"w-4 h-4"}),"Save Current"]}),r&&e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(tt,{className:"w-4 h-4 text-gray-600"})})]})]}),e.jsx("div",{className:"flex border-b bg-gray-50",children:[{id:"my_trips",label:"My Trips",icon:e.jsx(zt,{className:"w-4 h-4"})},{id:"templates",label:"Templates",icon:e.jsx(Pt,{className:"w-4 h-4"})},{id:"recent",label:"Recent",icon:e.jsx(Se,{className:"w-4 h-4"})}].map(f=>e.jsxs("button",{onClick:()=>u(f.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors ${l===f.id?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[f.icon,f.label]},f.id))}),T&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:T}),e.jsx("button",{onClick:()=>z(null),className:"ml-auto p-1 hover:bg-red-100 rounded",children:e.jsx(tt,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(xa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search trips, tags, or countries...",value:C,onChange:f=>O(f.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:R,onChange:f=>B(f.target.value),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"leisure",children:"Leisure"}),e.jsx("option",{value:"adventure",children:"Adventure"}),e.jsx("option",{value:"romantic",children:"Romantic"}),e.jsx("option",{value:"family",children:"Family"}),e.jsx("option",{value:"business",children:"Business"})]}),l==="templates"&&e.jsxs("select",{value:_,onChange:f=>G(f.target.value),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"challenging",children:"Challenging"})]})]})]})}),e.jsxs("div",{className:"p-4",children:[l==="my_trips"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800",children:["My Trips (",H.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-3 py-2 border rounded-lg hover:bg-gray-50 text-sm",children:[e.jsx(Ia,{className:"w-4 h-4"}),"Import"]}),y.length>=2&&e.jsxs("button",{onClick:dt,className:"flex items-center gap-2 px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm",children:[e.jsx(es,{className:"w-4 h-4"}),"Compare (",y.length,")"]})]})]}),H.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Nt,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No trips found. Start by saving your current route or using a template."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:H.map(f=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y.includes(f.id),onChange:$=>{$.target.checked?k([...y,f.id]):k(y.filter(S=>S!==f.id))},className:"rounded"}),e.jsxs("div",{className:"flex items-center gap-2",children:[ge(f.category),e.jsx("h4",{className:"font-semibold text-gray-800",children:f.name})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ce(f.id),className:"p-1 hover:bg-blue-100 rounded text-blue-600",title:"Load trip",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>me(f.id),className:"p-1 hover:bg-green-100 rounded text-green-600",title:"Duplicate trip",children:e.jsx(Zs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>je(f.id),className:"p-1 hover:bg-purple-100 rounded text-purple-600",title:"Export trip",children:e.jsx(Xs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ee(f.id),className:"p-1 hover:bg-red-100 rounded text-red-600",title:"Delete trip",children:e.jsx(Ma,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),f.duration," days"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vt,{className:"w-4 h-4"}),he(f.estimatedCost)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),f.waypointCount," stops"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ta,{className:"w-4 h-4"}),f.countries.length," countries"]})]}),f.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[f.tags.slice(0,3).map($=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs",children:$},$)),f.tags.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded-full text-xs",children:["+",f.tags.length-3," more"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last modified: ",f.lastModified.toLocaleDateString()]})]},f.id))})]}),l==="templates"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-800",children:["Trip Templates (",q.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:q.map(f=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ge(f.metadata.category),e.jsx("h4",{className:"font-semibold text-gray-800",children:f.metadata.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${ze(f.metadata.difficulty)}`,children:f.metadata.difficulty}),e.jsx("button",{onClick:()=>ct(),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Use Template"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:f.metadata.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),f.metadata.duration," days"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vt,{className:"w-4 h-4"}),he(f.metadata.estimatedCost)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),f.data.waypoints.length," stops"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pt,{className:"w-4 h-4"}),f.templateInfo.popularity,"% popularity"]})]}),e.jsxs("div",{className:"text-sm mb-3",children:[e.jsx("strong",{children:"Countries: "}),f.metadata.countries.join(", ")]}),e.jsxs("div",{className:"text-sm mb-3",children:[e.jsx("strong",{children:"Best months: "}),f.templateInfo.recommendedMonths.map($=>new Date(2024,$-1,1).toLocaleDateString("en",{month:"short"})).join(", ")]}),f.templateInfo.highlights.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Highlights:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[f.templateInfo.highlights.slice(0,2).map(($,S)=>e.jsxs("li",{className:"text-gray-600",children:["• ",$]},S)),f.templateInfo.highlights.length>2&&e.jsxs("li",{className:"text-gray-500",children:["• +",f.templateInfo.highlights.length-2," more highlights"]})]})]})]},f.metadata.id))})]}),l==="recent"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-800",children:["Recent Trips (",N.length,")"]})}),N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Se,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No recent trips. Start planning your next adventure!"})]}):e.jsx("div",{className:"space-y-3",children:N.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>ce(f.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ge(f.category),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:f.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[f.duration," days"]}),e.jsx("span",{children:he(f.estimatedCost)}),e.jsxs("span",{children:[f.waypointCount," stops"]})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:f.lastOpened.toLocaleDateString()})]},f.id))})]}),l==="comparison"&&g&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Trip Comparison"}),e.jsx("button",{onClick:()=>u("my_trips"),className:"text-blue-600 hover:text-blue-700",children:"Back to My Trips"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Cost Comparison"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.trips.map(f=>{const $=g.comparison.costs[f.metadata.id],S=g.comparison.analysis.cheapest===f.metadata.id;return e.jsxs("div",{className:`p-4 rounded-lg border ${S?"border-green-500 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[ge(f.metadata.category),e.jsx("h5",{className:"font-medium",children:f.metadata.name}),S&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs",children:"Cheapest"})]}),$&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"font-medium",children:he($.total)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Fuel:"}),e.jsx("span",{children:he($.fuel)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Accommodation:"}),e.jsx("span",{children:he($.accommodation)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tolls:"}),e.jsx("span",{children:he($.tolls)})]})]})]},f.metadata.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Route Comparison"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-200 rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Trip"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Distance"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Duration"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Waypoints"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Countries"})]})}),e.jsx("tbody",{children:g.trips.map(f=>{const $=g.comparison.routes[f.metadata.id],S=g.comparison.analysis.shortest===f.metadata.id,Q=g.comparison.analysis.fastest===f.metadata.id;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[ge(f.metadata.category),f.metadata.name]})}),e.jsxs("td",{className:"border border-gray-200 px-4 py-2",children:[e.jsxs("span",{className:S?"font-semibold text-green-600":"",children:[$.distance.toFixed(0),"km"]}),S&&e.jsx("span",{className:"ml-1 text-xs text-green-600",children:"(shortest)"})]}),e.jsxs("td",{className:"border border-gray-200 px-4 py-2",children:[e.jsxs("span",{className:Q?"font-semibold text-blue-600":"",children:[$.duration.toFixed(1),"h"]}),Q&&e.jsx("span",{className:"ml-1 text-xs text-blue-600",children:"(fastest)"})]}),e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:$.waypointCount}),e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:$.countries.join(", ")})]},f.metadata.id)})})]})})]}),g.comparison.analysis.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Recommendations"}),e.jsx("div",{className:"space-y-3",children:g.comparison.analysis.recommendations.map((f,$)=>{const S=g.trips.find(Q=>Q.metadata.id===f.tripId);return e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[S&&ge(S.metadata.category),e.jsx("span",{className:"font-medium text-blue-800",children:S?.metadata.name})]}),e.jsxs("div",{className:"text-blue-700",children:[e.jsx("div",{className:"font-medium",children:f.reason}),e.jsx("div",{className:"text-sm",children:f.advantage})]})]},$)})})]})]})]})]}),A&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Save Current Trip"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trip Name *"}),e.jsx("input",{type:"text",value:J.name,onChange:f=>ne({...J,name:f.target.value}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"My European Adventure"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:J.description,onChange:f=>ne({...J,description:f.target.value}),className:"w-full px-3 py-2 border rounded-lg resize-none",rows:3,placeholder:"Describe your trip..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{value:J.category,onChange:f=>ne({...J,category:f.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"leisure",children:"Leisure"}),e.jsx("option",{value:"adventure",children:"Adventure"}),e.jsx("option",{value:"romantic",children:"Romantic"}),e.jsx("option",{value:"family",children:"Family"}),e.jsx("option",{value:"business",children:"Business"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:J.tags.join(", "),onChange:f=>ne({...J,tags:f.target.value.split(",").map($=>$.trim()).filter(Boolean)}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"scenic, historic, wine-tasting"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isPublic",checked:J.isPublic,onChange:f=>ne({...J,isPublic:f.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"isPublic",className:"ml-2 text-sm text-gray-700",children:"Make trip public (for future sharing features)"})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>K(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:ie,disabled:!J.name.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Save Trip"})]})]})}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Import Trip"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paste trip data (JSON format):"}),e.jsx("textarea",{value:V,onChange:f=>Z(f.target.value),className:"w-full px-3 py-2 border rounded-lg resize-none font-mono text-sm",rows:8,placeholder:"Paste the exported trip JSON data here..."})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:qe,disabled:!V.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Import Trip"})]})]})}),se&&E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Export Trip"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"gpx",label:"GPX",desc:"For GPS devices"},{id:"kml",label:"KML",desc:"For Google Earth"},{id:"json",label:"JSON",desc:"Complete trip data"},{id:"csv",label:"CSV",desc:"For spreadsheets"}].map(f=>e.jsxs("label",{className:"relative",children:[e.jsx("input",{type:"radio",name:"exportFormat",value:f.id,checked:P===f.id,onChange:$=>b($.target.value),className:"sr-only"}),e.jsxs("div",{className:`p-2 border-2 rounded-lg cursor-pointer transition-all text-center ${P===f.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:f.label}),e.jsx("div",{className:"text-xs text-gray-500",children:f.desc})]})]},f.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Include Data"}),e.jsx("div",{className:"space-y-2",children:[{key:"includeWaypoints",label:"Route Waypoints"},{key:"includeTrackPoints",label:"Track Points"},{key:"includeInstructions",label:"Turn Instructions"},{key:"includeElevation",label:"Elevation Data"},{key:"includeMetadata",label:"Trip Metadata"}].map(f=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:I[f.key],onChange:$=>W(S=>({...S,[f.key]:$.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:f.label})]},f.key))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Creator"}),e.jsx("input",{type:"text",value:I.creator||"",onChange:f=>W($=>({...$,creator:f.target.value})),placeholder:"European Camper Trip Planner",className:"w-full px-3 py-2 border rounded-lg text-sm"})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{D(!1),w(null)},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:Ie,disabled:A,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:A?"Exporting...":"Export Trip"})]})]})})]}):null},Vt={motorhome:{maxDailyDistance:300,maxDailyDrivingTime:6,recommendedBreakInterval:2,breakDuration:20,averageSpeed:65},caravan:{maxDailyDistance:350,maxDailyDrivingTime:7,recommendedBreakInterval:2.5,breakDuration:15,averageSpeed:70},campervan:{maxDailyDistance:400,maxDailyDrivingTime:8,recommendedBreakInterval:3,breakDuration:15,averageSpeed:75},default:{maxDailyDistance:350,maxDailyDrivingTime:7,recommendedBreakInterval:2.5,breakDuration:15,averageSpeed:70}},Ht={winter:{speedMultiplier:.8,distanceMultiplier:.7,difficultyIncrease:30},spring:{speedMultiplier:.95,distanceMultiplier:.9,difficultyIncrease:0},summer:{speedMultiplier:1,distanceMultiplier:1,difficultyIncrease:0},autumn:{speedMultiplier:.9,distanceMultiplier:.85,difficultyIncrease:10}};class Ce{static createTripPlan(t,r,a,i="summer"){if(t.length<2)throw new Error("At least 2 waypoints required for trip planning");const n=this.getDrivingLimits(r,i),o=this.calculateRouteSegments(t),c=this.planDailyStages(o,n,a,i),l=this.analyzeFeasibility(c,n),u=o.reduce((x,p)=>x+p.distance,0),h=o.reduce((x,p)=>x+p.drivingTime,0),m=this.calculateRestDays(c);return{totalDays:c.length+m,totalDistance:u,totalDrivingTime:h,startDate:a,endDate:a?new Date(a.getTime()+(c.length+m-1)*24*60*60*1e3):void 0,dailyStages:c,restDays:m,feasibilityScore:l.score,overallFeasibility:l.overall,warnings:l.warnings,recommendations:l.recommendations}}static getDrivingLimits(t,r="summer"){const a=t?.type||"default",i=Vt[a]||Vt.default,n=Ht[r]||Ht.summer;let o=1;if(t){const c=t.length||6,l=t.weight||3e3;c>8||l>4e3?o=.8:(c>7||l>3500)&&(o=.9)}return{maxDailyDistance:Math.round(i.maxDailyDistance*n.distanceMultiplier*o),maxDailyDrivingTime:Math.round(i.maxDailyDrivingTime*n.speedMultiplier*o*10)/10,recommendedBreakInterval:i.recommendedBreakInterval,breakDuration:i.breakDuration,averageSpeed:Math.round(i.averageSpeed*n.speedMultiplier)}}static calculateRouteSegments(t){const r=[];for(let a=0;a<t.length-1;a++){const i=t[a],n=t[a+1],o=this.calculateDistance(i,n),c=o/70;r.push({startWaypoint:i,endWaypoint:n,distance:o,drivingTime:c})}return r}static planDailyStages(t,r,a,i="summer"){const n=[];let o=1,c=a||new Date,l=0,u=0,h=[];return t.forEach((m,x)=>{(l+m.distance>r.maxDailyDistance||u+m.drivingTime>r.maxDailyDrivingTime)&&h.length>0&&(n.push(this.createDailyStage(o,c,h,l,u,r,i)),o++,c=new Date(c.getTime()+1440*60*1e3),l=0,u=0,h=[]),h.push(m),l+=m.distance,u+=m.drivingTime,x===t.length-1&&h.length>0&&n.push(this.createDailyStage(o,c,h,l,u,r,i))}),n}static createDailyStage(t,r,a,i,n,o,c){const l=a[0].startWaypoint,u=a[a.length-1].endWaypoint,h=this.planStopsForDay(a,n,o),m=this.determineAccommodationType(u,c),x=this.assessDayFeasibility(i,n,o),p=this.generateDayWarnings(i,n,o,c),N=this.generateDayRecommendations(i,n,o,c);return{day:t,date:r,startWaypoint:l,endWaypoint:u,distance:i,drivingTime:n,stops:h,accommodationType:m,feasibility:x,warnings:p,recommendations:N}}static planStopsForDay(t,r,a){const i=[],n=Math.floor(r/a.recommendedBreakInterval);for(let o=0;o<n;o++)i.push({waypointId:`break_${o}`,type:"rest",minDuration:a.breakDuration/60,recommendedDuration:a.breakDuration/60,maxDuration:1,reasoning:`Mandatory rest break after ${a.recommendedBreakInterval} hours of driving`});return t.forEach(o=>{this.isPointOfInterest(o.endWaypoint)&&i.push({waypointId:o.endWaypoint.id,type:"sightseeing",minDuration:1,recommendedDuration:2,maxDuration:4,reasoning:"Recommended sightseeing stop at point of interest"})}),r>4&&i.push({waypointId:"lunch",type:"lunch",minDuration:.5,recommendedDuration:1,maxDuration:2,reasoning:"Lunch break for long driving day"}),i}static determineAccommodationType(t,r){return!t||t.type==="campsite"?"campsite":t.type==="accommodation"||r==="winter"?"hotel":"campsite"}static assessDayFeasibility(t,r,a){const i=t/a.maxDailyDistance,n=r/a.maxDailyDrivingTime,o=Math.max(i,n);return o<=.7?"excellent":o<=.9?"good":o<=1.1?"challenging":"unrealistic"}static generateDayWarnings(t,r,a,i){const n=[];return t>a.maxDailyDistance&&n.push(`Daily distance of ${t.toFixed(0)}km exceeds recommended limit of ${a.maxDailyDistance}km`),r>a.maxDailyDrivingTime&&n.push(`Driving time of ${r.toFixed(1)}h exceeds recommended limit of ${a.maxDailyDrivingTime}h`),t>a.maxDailyDistance*1.2&&n.push("This is a very long driving day - consider splitting into multiple days"),i==="winter"&&t>a.maxDailyDistance*.8&&n.push("Winter driving conditions - allow extra time and reduce daily distance"),n}static generateDayRecommendations(t,r,a,i){const n=[];return r>4&&n.push("Plan multiple rest stops for this long driving day"),t<a.maxDailyDistance*.5&&n.push("Light driving day - perfect opportunity for sightseeing"),i==="summer"&&t>a.maxDailyDistance*.8&&n.push("Start early to avoid afternoon heat and traffic"),i==="winter"&&n.push("Check weather conditions and road status before departure"),n}static analyzeFeasibility(t,r){let a=0;const i=[],n=[];t.forEach((h,m)=>{let x=100;h.feasibility==="excellent"?x=100:h.feasibility==="good"?x=80:h.feasibility==="challenging"?x=60:h.feasibility==="unrealistic"&&(x=30),a+=x,h.feasibility==="unrealistic"&&i.push(`Day ${h.day}: Unrealistic driving distance/time`)});const o=t.reduce((h,m)=>h+m.distance,0)/t.length,c=this.findConsecutiveIntensiveDays(t);o>r.maxDailyDistance*.9&&(i.push("Overall trip intensity is very high - consider adding rest days"),a*=.9),c>=3&&(i.push("Multiple consecutive intensive driving days detected"),n.push("Consider adding rest days between intensive driving periods"),a*=.85),t.length>14&&n.push("Long trip - ensure adequate rest and recovery time");const l=a/t.length*(t.length<=21?1:.9);let u;return l>=85?u="excellent":l>=70?u="good":l>=50?u="challenging":u="unrealistic",{score:Math.round(l),overall:u,warnings:i,recommendations:n}}static getSeasonalFactors(t,r){const i={spring:{season:"spring",temperature:{min:8,max:18},precipitation:"medium",touristDensity:"medium",campsiteAvailability:"good",drivingConditions:"good",recommendations:["Perfect weather for touring, but pack layers","Some mountain passes may still be closed","Booking campsite in advance recommended"],warnings:["Variable weather conditions possible","Some seasonal businesses may not be open yet"]},summer:{season:"summer",temperature:{min:15,max:28},precipitation:"low",touristDensity:"high",campsiteAvailability:"limited",drivingConditions:"excellent",recommendations:["Book accommodations well in advance","Start driving early to avoid heat and traffic","Stay hydrated and use sun protection"],warnings:["Peak tourist season - expect crowds and higher prices","Extreme heat possible in southern regions"]},autumn:{season:"autumn",temperature:{min:5,max:15},precipitation:"medium",touristDensity:"low",campsiteAvailability:"good",drivingConditions:"good",recommendations:["Beautiful fall colors and fewer crowds","Pack warm clothing for cooler evenings","Great time for wine regions"],warnings:["Some campsites may close for winter","Daylight hours are decreasing"]},winter:{season:"winter",temperature:{min:-5,max:8},precipitation:"high",touristDensity:"low",campsiteAvailability:"poor",drivingConditions:"challenging",recommendations:["Focus on southern routes and cities","Book heated accommodations","Carry winter driving equipment"],warnings:["Many campsites closed in northern regions","Snow and ice possible - check road conditions","Shorter daylight hours limit driving time"]}}[t];return r.some(n=>["Norway","Sweden","Finland"].includes(n))&&t==="winter"?{...i,temperature:{min:-15,max:0},drivingConditions:"challenging",warnings:[...i.warnings,"Arctic conditions possible","Winter tires mandatory"]}:r.some(n=>["Spain","Portugal","Italy","Greece"].includes(n))&&t==="summer"?{...i,temperature:{min:20,max:40},warnings:[...i.warnings,"Extreme heat in inland areas","Air conditioning essential"]}:i}static calculateTripMetrics(t,r){const a=t.totalDistance/t.totalDays,i=t.restDays/t.totalDays,n=new Set(t.dailyStages.map(m=>this.getCountryFromWaypoint(m.endWaypoint))),o=new Set(t.dailyStages.map(m=>m.endWaypoint.type)),c=Math.min(100,n.size*20+o.size*10),l=t.dailyStages.filter(m=>m.feasibility==="challenging"||m.feasibility==="unrealistic").length,u=Math.min(100,l/t.dailyStages.length*100+a/500*50);let h;return a<200&&t.feasibilityScore>80?h="relaxed":a<300&&t.feasibilityScore>60?h="moderate":a<400&&t.feasibilityScore>40?h="intensive":h="extreme",{drivingIntensity:Math.round(a),restRatio:Math.round(i*100)/100,varietyScore:Math.round(c),difficultyScore:Math.round(u),comfortLevel:h,suitability:{beginners:h==="relaxed"&&u<30,families:h!=="extreme"&&u<50,experienced:!0,seniors:h==="relaxed"&&t.feasibilityScore>70}}}static generatePlanningRecommendations(t,r,a,i){const n=[];return r.difficultyScore>70&&n.push({type:"safety",priority:"high",title:"High Difficulty Trip",description:"This trip has challenging daily stages that may be tiring",action:"Add rest days between intensive driving periods",impact:"Improved safety and enjoyment"}),(r.comfortLevel==="intensive"||r.comfortLevel==="extreme")&&n.push({type:"comfort",priority:"medium",title:"Intensive Driving Schedule",description:"Multiple long driving days may be exhausting",action:"Consider reducing daily distances or adding overnight stops",impact:"More relaxed and enjoyable travel experience"}),a==="winter"&&n.push({type:"season",priority:"high",title:"Winter Travel Considerations",description:"Winter conditions require special preparation",action:"Pack winter gear, check road conditions, reduce daily distances",impact:"Safe winter travel"}),i&&i.type==="motorhome"&&i.length&&i.length>8&&n.push({type:"route",priority:"medium",title:"Large Vehicle Considerations",description:"Your large motorhome may face restrictions on some routes",action:"Check height and length restrictions, avoid narrow mountain roads",impact:"Avoid routing problems and damage"}),t.dailyStages.some(o=>o.accommodationType==="hotel")&&n.push({type:"cost",priority:"low",title:"Accommodation Cost Optimization",description:"Hotel stays increase trip costs significantly",action:"Consider campsites or wild camping where legal",impact:"Reduced accommodation costs"}),t.dailyStages.length>14&&n.push({type:"timing",priority:"medium",title:"Extended Trip Duration",description:"Long trips require careful planning and preparation",action:"Plan for vehicle maintenance, ensure adequate supplies",impact:"Smooth extended travel experience"}),n.sort((o,c)=>{const l={high:3,medium:2,low:1};return l[c.priority]-l[o.priority]})}static calculateRestDays(t){const r=t.filter(a=>a.distance>300||a.drivingTime>6).length;return Math.floor(r/3)}static findConsecutiveIntensiveDays(t){let r=0,a=0;return t.forEach(i=>{i.distance>300||i.drivingTime>6?(a++,r=Math.max(r,a)):a=0}),r}static isPointOfInterest(t){return!t||!t.name?!1:["castle","museum","cathedral","palace","historic","scenic"].some(a=>t.name.toLowerCase().includes(a))}static getCountryFromWaypoint(t){return t.lat>=46&&t.lat<=51&&t.lng>=-5&&t.lng<=10?"France":t.lat>=47&&t.lat<=55&&t.lng>=5&&t.lng<=15?"Germany":t.lat>=36&&t.lat<=47&&t.lng>=6&&t.lng<=19?"Italy":t.lat>=36&&t.lat<=44&&t.lng>=-10&&t.lng<=5?"Spain":"Europe"}static calculateDistance(t,r){const i=(r.lat-t.lat)*Math.PI/180,n=(r.lng-t.lng)*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(r.lat*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}}const Va=({className:s="",onPlanUpdate:t,isVisible:r=!0})=>{const{waypoints:a}=re(),{profile:i}=oe(),[n,o]=d.useState("overview"),[c,l]=d.useState("summer"),[u,h]=d.useState(""),[m,x]=d.useState(null),[p,N]=d.useState(null),[M,y]=d.useState([]),[k,g]=d.useState(null),[j,C]=d.useState(null),[O,R]=d.useState(!1),[B,_]=d.useState(null),[G,A]=d.useState(new Set);d.useEffect(()=>{a.length>=2?F():(x(null),N(null),y([]))},[a,i,c,u]);const F=async()=>{R(!0),_(null);try{const v=u?new Date(u):void 0,V=Ce.createTripPlan(a,i||void 0,v,c),Z=Ce.calculateTripMetrics(V,i||void 0),se=Ce.getDrivingLimits(i||void 0,c),D=Ce.generatePlanningRecommendations(V,Z,c,i||void 0),E=[...new Set(V.dailyStages.map(P=>Ce.getCountryFromWaypoint(P.endWaypoint)))],w=Ce.getSeasonalFactors(c,E);x(V),N(Z),y(D),g(w),C(se),t&&t(V)}catch(v){console.error("Trip planning error:",v),_("Failed to calculate trip plan. Please check your route.")}finally{R(!1)}},T=v=>v.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),z=v=>{const V=Math.floor(v),Z=Math.round((v-V)*60);return`${V}h ${Z}m`},X=v=>{switch(v){case"excellent":return"text-green-600 bg-green-100";case"good":return"text-blue-600 bg-blue-100";case"challenging":return"text-yellow-600 bg-yellow-100";case"unrealistic":return"text-red-600 bg-red-100"}},K=v=>{switch(v){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-blue-600 bg-blue-100"}},J=v=>{switch(v){case"safety":return e.jsx(ye,{className:"w-4 h-4"});case"comfort":return e.jsx(wt,{className:"w-4 h-4"});case"cost":return e.jsx(xt,{className:"w-4 h-4"});case"timing":return e.jsx(Se,{className:"w-4 h-4"});case"season":return e.jsx(Ft,{className:"w-4 h-4"});case"route":return e.jsx(Oe,{className:"w-4 h-4"})}},ne=v=>{switch(v){case"overnight":return e.jsx(At,{className:"w-4 h-4"});case"sightseeing":return e.jsx(Ls,{className:"w-4 h-4"});case"lunch":return e.jsx(Gs,{className:"w-4 h-4"});case"fuel":return e.jsx(ss,{className:"w-4 h-4"});case"rest":return e.jsx(Se,{className:"w-4 h-4"})}},ae=v=>{const V=new Set(G);V.has(v)?V.delete(v):V.add(v),A(V)};return r?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-purple-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Trip Planning Tools"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(rs,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Travel Season"}),e.jsxs("select",{value:c,onChange:v=>l(v.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"spring",children:"Spring (Mar-May)"}),e.jsx("option",{value:"summer",children:"Summer (Jun-Aug)"}),e.jsx("option",{value:"autumn",children:"Autumn (Sep-Nov)"}),e.jsx("option",{value:"winter",children:"Winter (Dec-Feb)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",value:u,onChange:v=>h(v.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Type"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white border rounded-lg text-sm",children:[e.jsx(Ge,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"capitalize",children:[i?.type||"Default",i?.length&&` (${i.length}m)`]})]})]})]})}),e.jsx("div",{className:"flex border-b bg-gray-50",children:[{id:"overview",label:"Overview",icon:e.jsx(es,{className:"w-4 h-4"})},{id:"calendar",label:"Daily Plan",icon:e.jsx(De,{className:"w-4 h-4"})},{id:"recommendations",label:"Tips",icon:e.jsx(Ke,{className:"w-4 h-4"})},{id:"metrics",label:"Analysis",icon:e.jsx(xt,{className:"w-4 h-4"})}].map(v=>e.jsxs("button",{onClick:()=>o(v.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors ${n===v.id?"text-purple-600 border-b-2 border-purple-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[v.icon,v.label]},v.id))}),B&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:B})]})}),e.jsx("div",{className:"p-4",children:O?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Calculating trip plan..."})]}):a.length<2?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Nt,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Add at least 2 waypoints to your route to start planning."})]}):m?e.jsxs(e.Fragment,{children:[n==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(De,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:"Duration"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:m.totalDays}),e.jsx("div",{className:"text-sm text-blue-600",children:"days total"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Distance"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:Math.round(m.totalDistance)}),e.jsx("div",{className:"text-sm text-green-600",children:"km total"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-purple-600 font-medium",children:"Driving"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:Math.round(m.totalDrivingTime)}),e.jsx("div",{className:"text-sm text-purple-600",children:"hours total"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm text-orange-600 font-medium",children:"Feasibility"})]}),e.jsx("div",{className:"text-xl font-bold text-orange-800 capitalize",children:m.overallFeasibility}),e.jsxs("div",{className:"text-sm text-orange-600",children:[m.feasibilityScore,"% score"]})]})]}),j&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Daily Driving Limits (Based on Vehicle & Season)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Distance:"}),e.jsxs("div",{className:"font-semibold",children:[j.maxDailyDistance,"km"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Time:"}),e.jsxs("div",{className:"font-semibold",children:[j.maxDailyDrivingTime,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Break Every:"}),e.jsxs("div",{className:"font-semibold",children:[j.recommendedBreakInterval,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Average Speed:"}),e.jsxs("div",{className:"font-semibold",children:[j.averageSpeed,"km/h"]})]})]})]}),k&&e.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ft,{className:"w-4 h-4 text-blue-600"}),e.jsxs("h4",{className:"font-medium text-gray-800 capitalize",children:[c," Travel Conditions"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Expected Conditions:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Temperature: ",k.temperature.min,"°C - ",k.temperature.max,"°C"]}),e.jsxs("div",{children:["Tourist Density: ",e.jsx("span",{className:"capitalize",children:k.touristDensity})]}),e.jsxs("div",{children:["Campsite Availability: ",e.jsx("span",{className:"capitalize",children:k.campsiteAvailability})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Top Recommendations:"}),e.jsx("ul",{className:"space-y-1 text-sm",children:k.recommendations.slice(0,3).map((v,V)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx(Ke,{className:"w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:v})]},V))})]})]})]}),m.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"w-4 h-4 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800",children:"Important Warnings"})]}),e.jsx("ul",{className:"space-y-1",children:m.warnings.slice(0,3).map((v,V)=>e.jsxs("li",{className:"text-sm text-yellow-700",children:["• ",v]},V))})]})]}),n==="calendar"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Daily Itinerary"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[m.dailyStages.length," driving days + ",m.restDays," rest days"]})]}),m.dailyStages.map(v=>e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50",onClick:()=>ae(v.day),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-semibold",children:v.day}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-800",children:[v.startWaypoint.name," → ",v.endWaypoint.name]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[v.date&&T(v.date)," • ",Math.round(v.distance),"km • ",z(v.drivingTime)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${X(v.feasibility)}`,children:v.feasibility}),G.has(v.day)?e.jsx(Fs,{className:"w-4 h-4 text-gray-400"}):e.jsx(Rs,{className:"w-4 h-4 text-gray-400"})]})]})}),G.has(v.day)&&e.jsxs("div",{className:"px-4 pb-4 border-t bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Accommodation"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(At,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"capitalize",children:v.accommodationType.replace("_"," ")})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Average Speed"}),e.jsxs("div",{className:"text-sm",children:[Math.round(v.distance/v.drivingTime),"km/h"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Stops Planned"}),e.jsxs("div",{className:"text-sm",children:[v.stops.length," stops"]})]})]}),v.stops.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Planned Stops:"}),e.jsx("div",{className:"space-y-2",children:v.stops.map((V,Z)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[ne(V.type),e.jsx("span",{className:"capitalize",children:V.type.replace("_"," ")}),e.jsxs("span",{className:"text-gray-600",children:["(",z(V.recommendedDuration),")"]}),e.jsxs("span",{className:"text-gray-500",children:["- ",V.reasoning]})]},Z))})]}),v.warnings.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium mb-1",children:"Warnings:"}),e.jsx("ul",{className:"space-y-1",children:v.warnings.map((V,Z)=>e.jsxs("li",{className:"text-sm text-red-700 flex items-start gap-1",children:[e.jsx(ye,{className:"w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"}),V]},Z))})]}),v.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Recommendations:"}),e.jsx("ul",{className:"space-y-1",children:v.recommendations.map((V,Z)=>e.jsxs("li",{className:"text-sm text-blue-700 flex items-start gap-1",children:[e.jsx(as,{className:"w-3 h-3 text-blue-500 mt-0.5 flex-shrink-0"}),V]},Z))})]})]})]},v.day))]}),n==="recommendations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-4",children:["Planning Recommendations (",M.length,")"]}),M.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ke,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No specific recommendations - your trip plan looks great!"})]}):e.jsx("div",{className:"space-y-3",children:M.map((v,V)=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${K(v.priority)}`,children:J(v.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-800",children:v.title}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${K(v.priority)}`,children:[v.priority," priority"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:v.description}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Action: "}),e.jsx("span",{className:"text-gray-600",children:v.action})]}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Impact: "}),e.jsx("span",{className:"text-gray-600",children:v.impact})]})]})]})},V))}),k&&k.warnings.length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Hs,{className:"w-4 h-4 text-orange-600"}),e.jsx("h5",{className:"font-medium text-orange-800",children:"Seasonal Considerations"})]}),e.jsx("ul",{className:"space-y-1",children:k.warnings.map((v,V)=>e.jsxs("li",{className:"text-sm text-orange-700 flex items-start gap-1",children:[e.jsx(ye,{className:"w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"}),v]},V))})]})]}),n==="metrics"&&p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-4",children:"Trip Analysis & Metrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Oe,{className:"w-4 h-4 text-blue-600"}),e.jsx("h5",{className:"font-medium text-blue-800",children:"Driving Intensity"})]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-800 mb-1",children:[p.drivingIntensity,"km"]}),e.jsx("div",{className:"text-sm text-blue-600",children:"average per day"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Comfort Level: ",e.jsx("span",{className:"font-medium capitalize",children:p.comfortLevel})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(xt,{className:"w-4 h-4 text-green-600"}),e.jsx("h5",{className:"font-medium text-green-800",children:"Trip Variety"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800 mb-1",children:p.varietyScore}),e.jsx("div",{className:"text-sm text-green-600",children:"variety score"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Rest Ratio: ",(p.restRatio*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ut,{className:"w-4 h-4 text-purple-600"}),e.jsx("h5",{className:"font-medium text-purple-800",children:"Difficulty Score"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800 mb-1",children:p.difficultyScore}),e.jsx("div",{className:"text-sm text-purple-600",children:"out of 100"}),e.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min(100,p.difficultyScore)}%`}})})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(wt,{className:"w-4 h-4 text-orange-600"}),e.jsx("h5",{className:"font-medium text-orange-800",children:"Trip Suitability"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beginners:"}),e.jsx("span",{className:p.suitability.beginners?"text-green-600":"text-red-600",children:p.suitability.beginners?"✓ Suitable":"✗ Not recommended"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Families:"}),e.jsx("span",{className:p.suitability.families?"text-green-600":"text-red-600",children:p.suitability.families?"✓ Suitable":"✗ Not recommended"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Seniors:"}),e.jsx("span",{className:p.suitability.seniors?"text-green-600":"text-red-600",children:p.suitability.seniors?"✓ Suitable":"✗ Not recommended"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-3",children:"Detailed Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-2",children:"Trip Characteristics:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["• Total driving days: ",m.dailyStages.length]}),e.jsxs("li",{children:["• Recommended rest days: ",m.restDays]}),e.jsxs("li",{children:["• Average daily distance: ",p.drivingIntensity,"km"]}),e.jsxs("li",{children:["• Total driving time: ",Math.round(m.totalDrivingTime),"h"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-2",children:"Planning Insights:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["• Comfort level: ",p.comfortLevel]}),e.jsxs("li",{children:["• Difficulty: ",p.difficultyScore,"/100"]}),e.jsxs("li",{children:["• Route variety: ",p.varietyScore,"/100"]}),e.jsxs("li",{children:["• Feasibility: ",m.feasibilityScore,"%"]})]})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ut,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Unable to create trip plan. Please check your route."})]})})]}):null},Xe="camper-planner-map-state",Ut="1.0",Ha=10080*60*1e3;class Ua{getMapState(){try{const t=localStorage.getItem(Xe);if(!t)return null;const r=JSON.parse(t);return r.version!==Ut?(console.warn("Map storage version mismatch, clearing stored state"),this.clearMapState(),null):r.mapState&&r.mapState.timestamp&&Date.now()-r.mapState.timestamp>Ha?(console.log("Map state expired, clearing stored state"),this.clearMapState(),null):r.mapState||null}catch(t){return console.error("Error reading map state from storage:",t),this.clearMapState(),null}}saveMapState(t){try{if(!this.validateCoordinates(t.center[0],t.center[1])){console.warn("Invalid coordinates, not saving map state:",t.center);return}if(t.zoom<1||t.zoom>20){console.warn("Invalid zoom level, not saving map state:",t.zoom);return}const r={mapState:{center:[Number(t.center[0].toFixed(6)),Number(t.center[1].toFixed(6))],zoom:Math.round(t.zoom),timestamp:Date.now()},version:Ut};localStorage.setItem(Xe,JSON.stringify(r))}catch(r){console.error("Error saving map state to storage:",r)}}clearMapState(){try{localStorage.removeItem(Xe)}catch(t){console.error("Error clearing map state from storage:",t)}}getStorageInfo(){try{const t=localStorage.getItem(Xe);if(!t)return{size:0,lastUpdated:null};const r=JSON.parse(t);return{size:new Blob([t]).size,lastUpdated:r.mapState?.timestamp||null}}catch(t){return console.error("Error getting storage info:",t),{size:0,lastUpdated:null}}}validateCoordinates(t,r){return typeof t=="number"&&typeof r=="number"&&t>=-90&&t<=90&&r>=-180&&r<=180&&!isNaN(t)&&!isNaN(r)}isStorageAvailable(){try{const t="__storage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}}const bt=new Ua,Ga=s=>Ue.divIcon({html:`
      <div class="relative w-6 h-6 flex items-center justify-center">
        <div
          class="w-4 h-4 bg-blue-500 text-white flex items-center justify-center rounded-full shadow-md transform transition-transform"
          style="transform: rotate(${s}deg)"
        >
          <svg class="w-2 h-2" fill="currentColor" viewBox="0 0 12 12">
            <path d="M6 1l5 4-5 4V6H1V4h5V1z"/>
          </svg>
        </div>
      </div>
    `,className:"direction-arrow",iconSize:[24,24],iconAnchor:[12,12]}),qa=(s,t,r,a)=>{const i=a-t,n=r-s;return(Math.atan2(i,n)*(180/Math.PI)+360)%360},kt=(s,t,r,a)=>[(s+r)/2,(t+a)/2],ds=s=>s<1e3?`${Math.round(s)}m`:`${(s/1e3).toFixed(1)}km`,ms=s=>{const t=Math.floor(s/3600),r=Math.floor(s%3600/60);return t>0?`${t}h ${r}m`:`${r}m`},Za=(s,t,r=!1)=>{const a=ds(s),i=ms(t);return Ue.divIcon({html:`
      <div class="route-info-label ${r?"highlighted":""}">
        <div class="bg-white border-2 border-blue-500 rounded-lg px-2 py-1 shadow-lg text-xs font-medium text-gray-800">
          <div class="text-blue-600 font-semibold">${a}</div>
          <div class="text-gray-600">${i}</div>
        </div>
      </div>
    `,className:"route-info-marker",iconSize:[60,30],iconAnchor:[30,15]})},Ka=s=>{const t=n=>n==="error"?"#dc2626":"#f59e0b",r=n=>{switch(n){case"height":return"↕️";case"width":return"↔️";case"weight":return"⚖️";case"length":return"📏";default:return"⚠️"}},a=t(s.severity),i=r(s.restriction);return Ue.divIcon({html:`
      <div class="relative">
        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center shadow-lg animate-pulse"
             style="background-color: ${a}; border-color: ${a}">
          <span class="text-white text-xs font-bold">${i}</span>
        </div>
        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2">
          <div class="w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent"
               style="border-top-color: ${a}"></div>
        </div>
      </div>
    `,className:"restriction-warning-icon",iconSize:[32,36],iconAnchor:[16,36],popupAnchor:[0,-36]})},Xa=({waypoint:s,index:t,total:r})=>{const{updateWaypoint:a,removeWaypoint:i}=re(),{addNotification:n}=de(),[o,c]=d.useState(!1),[l,u]=d.useState(s.name||""),[h,m]=d.useState(s.notes||""),x=()=>s.type==="start"?"bg-green-500 border-green-600":s.type==="end"?"bg-red-500 border-red-600":"bg-blue-500 border-blue-600",p=d.useCallback(()=>{const j={};l.trim()!==(s.name||"")&&(j.name=l.trim()),h!==(s.notes||"")&&(j.notes=h),Object.keys(j).length>0&&(a(s.id,j),n({type:"success",message:"Waypoint updated successfully"})),c(!1)},[s.id,s.name,s.notes,l,h,a,n]),N=d.useCallback(()=>{u(s.name||""),m(s.notes||""),c(!1)},[s.name,s.notes]),M=d.useCallback(()=>{i(s.id),n({type:"success",message:`Removed ${s.name||"waypoint"} from route`})},[s.id,s.name,i,n]),y=()=>s.type==="start"?"S":s.type==="end"?"E":(t+1).toString(),k=()=>s.type==="start"||s.type==="end"?"🏁":s.type==="campsite"?"🏕️":s.type==="accommodation"?"🏨":"📍",g=Ue.divIcon({html:`
      <div class="relative waypoint-marker">
        <!-- Main waypoint container -->
        <div class="${L("relative w-10 h-10 rounded-full border-3 text-white font-bold text-sm","flex items-center justify-center shadow-lg","transform hover:scale-110 transition-all duration-300","cursor-pointer",x())}">
          <!-- Icon background -->
          <div class="absolute inset-1 rounded-full bg-white bg-opacity-20"></div>

          <!-- Main content -->
          <div class="relative z-10 flex flex-col items-center">
            <div class="text-xs">${k()}</div>
            <div class="text-xs font-bold -mt-1">${y()}</div>
          </div>
        </div>

        <!-- Pulse animation for important waypoints -->
        <div class="${L("absolute inset-0 rounded-full border-2 animate-pulse opacity-20",x())}"></div>

        <!-- Route progress indicator -->
        ${r>1?`
          <div class="absolute -bottom-3 left-1/2 transform -translate-x-1/2">
            <div class="w-2 h-4 bg-gray-300 rounded-full border border-gray-400">
              <div
                class="w-full bg-gradient-to-t from-green-500 to-blue-500 rounded-full transition-all duration-500"
                style="height: ${(t+1)/r*100}%"
              ></div>
            </div>
          </div>
        `:""}

        <!-- Waypoint name label -->
        <div class="absolute top-12 left-1/2 transform -translate-x-1/2 whitespace-nowrap">
          <div class="bg-white bg-opacity-90 text-gray-800 text-xs font-medium px-2 py-1 rounded shadow-md border">
            ${s.name||`Stop ${t+1}`}
          </div>
        </div>
      </div>
    `,className:"enhanced-waypoint-marker",iconSize:[40,60],iconAnchor:[20,30],popupAnchor:[0,-30]});return e.jsx(Le,{position:[s.lat,s.lng],icon:g,zIndexOffset:2e3,children:e.jsx(_e,{eventHandlers:{click:j=>j.originalEvent?.stopPropagation()},children:e.jsxs("div",{className:"p-3 min-w-[250px]",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:k()}),e.jsx("h3",{className:"font-semibold text-sm",children:s.name||`Waypoint ${t+1}`})]}),!o&&e.jsx("button",{onClick:j=>{j.stopPropagation(),j.preventDefault(),c(!0)},className:"bg-blue-600 text-white hover:bg-blue-700 px-2 py-1 rounded text-xs font-medium transition-colors",title:"Edit waypoint",children:"Edit"})]}),o?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:l,onChange:j=>u(j.target.value),onClick:j=>j.stopPropagation(),onFocus:j=>j.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter waypoint name",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:h,onChange:j=>m(j.target.value),onClick:j=>j.stopPropagation(),onFocus:j=>j.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3,placeholder:"Add notes about this waypoint..."})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),j.preventDefault(),p()},className:"flex-1 px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:j=>{j.stopPropagation(),j.preventDefault(),N()},className:"flex-1 px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:s.type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Position:"}),e.jsxs("span",{className:"font-medium",children:[t+1," of ",r]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Coordinates:"}),e.jsxs("span",{className:"font-mono text-xs",children:[s.lat.toFixed(4),", ",s.lng.toFixed(4)]})]}),s.visitDate&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Visit Date:"}),e.jsx("span",{className:"font-medium",children:s.visitDate})]}),s.duration&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Stay Duration:"}),e.jsxs("span",{className:"font-medium",children:[s.duration,"h"]})]}),s.notes&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Notes:"}),e.jsx("div",{className:"text-gray-600",children:s.notes})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),j.preventDefault(),c(!0)},className:"flex-1 px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:j=>{j.stopPropagation(),j.preventDefault(),M()},className:"flex-1 px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Delete"})]})]})]})})})},Ja=({route:s})=>{const t=s?.routes?.[0],r=d.useMemo(()=>t?.geometry?.coordinates?t.geometry.coordinates.map(([n,o])=>[o,n]):[],[t]);if(!s||!s.routes||s.routes.length===0)return null;const a=()=>s.restrictions?.cannotAccommodate?"#dc2626":s.restrictions?.violatedDimensions.length||s.warnings&&s.warnings.length>0?"#f59e0b":s.metadata.service==="openrouteservice"?"#059669":"#3b82f6",i=()=>{if(s.restrictions?.cannotAccommodate)return"5, 10";if(s.restrictions?.violatedDimensions.length)return"10, 5";if(s.warnings&&s.warnings.length>0)return"15, 5"};return r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(yt,{positions:r,color:"#ffffff",weight:8,opacity:.6,className:"calculated-route-outline",interactive:!1}),e.jsx(yt,{positions:r,color:a(),weight:6,opacity:.8,className:"calculated-route",dashArray:i()}),t.segments?.map((n,o)=>{const c=r[Math.floor(o*r.length/t.segments.length)],l=r[Math.floor((o+1)*r.length/t.segments.length)];if(c&&l){const u=kt(c[0],c[1],l[0],l[1]),h=Za(n.distance,n.duration);return e.jsx(Le,{position:u,icon:h,zIndexOffset:1500,children:e.jsx(_e,{children:e.jsxs("div",{className:"p-2",children:[e.jsxs("h3",{className:"font-semibold text-sm mb-2",children:["Route Segment ",o+1]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Distance:"}),e.jsx("span",{className:"font-medium",children:ds(n.distance)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duration:"}),e.jsx("span",{className:"font-medium",children:ms(n.duration)})]}),n.steps&&n.steps.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-gray-600 font-medium",children:"Instructions:"}),e.jsxs("div",{className:"max-h-24 overflow-y-auto",children:[n.steps.slice(0,3).map((m,x)=>e.jsxs("div",{className:"text-xs text-gray-700 mt-1",children:["• ",m.instruction]},x)),n.steps.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["... and ",n.steps.length-3," more steps"]})]})]})]})]})})},`segment-info-${o}`)}return null}),s.restrictions?.restrictedSegments?.map((n,o)=>{if(n.coordinates.length>=2){const c=n.coordinates[0],l=n.coordinates[n.coordinates.length-1],u=kt(c[1],c[0],l[1],l[0]),h=Ka(n);return e.jsx(Le,{position:u,icon:h,zIndexOffset:3e3,children:e.jsx(_e,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2 text-red-600",children:"Route Restriction"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:n.restriction})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Severity:"}),e.jsx("span",{className:`font-medium capitalize ${n.severity==="error"?"text-red-600":"text-amber-600"}`,children:n.severity})]}),e.jsx("div",{className:"mt-2 text-gray-600",children:n.severity==="error"?"Vehicle cannot pass this section":"Caution: Check vehicle dimensions"})]})]})})},`restriction-${o}`)}return null})]})},Ya=({waypoints:s})=>{const t=d.useMemo(()=>{if(s.length<2)return[];const a=[];for(let i=0;i<s.length-1;i++)a.push({start:s[i],end:s[i+1],segmentIndex:i,totalSegments:s.length-1});return a},[s]),r=(a,i)=>{if(i===1)return"#94a3b8";const n=a/(i-1),o={r:34,g:197,b:94},c={r:239,g:68,b:68},l=Math.round(o.r+(c.r-o.r)*n),u=Math.round(o.g+(c.g-o.g)*n),h=Math.round(o.b+(c.b-o.b)*n);return`rgb(${l}, ${u}, ${h})`};return e.jsx(e.Fragment,{children:t.map((a,i)=>{const n=qa(a.start.lat,a.start.lng,a.end.lat,a.end.lng),o=kt(a.start.lat,a.start.lng,a.end.lat,a.end.lng),c=Ga(n),l=r(a.segmentIndex,a.totalSegments);return e.jsxs(St.Fragment,{children:[e.jsx(yt,{positions:[[a.start.lat,a.start.lng],[a.end.lat,a.end.lng]],color:l,weight:4,opacity:.6,className:"straight-line-route",dashArray:"8, 4"}),e.jsx(Le,{position:o,icon:c,zIndexOffset:1e3})]},`segment-${a.start.id}-${a.end.id}`)})})},Qa=()=>{const{waypoints:s,calculatedRoute:t}=re();return s.length===0?null:e.jsxs(e.Fragment,{children:[t?e.jsx(Ja,{route:t}):s.length>=2?e.jsx(Ya,{waypoints:s}):null,s.map((r,a)=>e.jsx(Xa,{waypoint:r,index:a,total:s.length},`number-${r.id}`))]})},er=()=>{const{undo:s,redo:t,canUndo:r,canRedo:a,clearRoute:i,waypoints:n,isValidForRouting:o}=re();return d.useEffect(()=>{const c=l=>{if(l.target instanceof HTMLInputElement||l.target instanceof HTMLTextAreaElement||l.target?.contentEditable==="true")return;const u={"ctrl+z":()=>{r()&&(l.preventDefault(),s())},"ctrl+y":()=>{a()&&(l.preventDefault(),t())},"ctrl+shift+z":()=>{a()&&(l.preventDefault(),t())},delete:()=>{n.length>0&&console.log("Delete shortcut pressed - UI should handle confirmation")},backspace:()=>{n.length>0&&console.log("Backspace shortcut pressed - UI should handle confirmation")},escape:()=>{console.log("Escape pressed")},"ctrl+a":()=>{l.preventDefault(),console.log("Select all waypoints")},"ctrl+shift+c":()=>{n.length>0&&(l.preventDefault(),console.log("Clear all shortcut pressed - UI should handle confirmation"))}},m=(p=>{const N=[];return(p.ctrlKey||p.metaKey)&&N.push("ctrl"),p.shiftKey&&N.push("shift"),p.altKey&&N.push("alt"),N.push(p.key.toLowerCase()),N.join("+")})(l),x=u[m];x&&x()};return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[s,t,r,a,i,n,o]),{shortcuts:[{key:"Ctrl+Z",description:"Undo last action",available:r()},{key:"Ctrl+Y",description:"Redo last action",available:a()},{key:"Ctrl+Shift+Z",description:"Redo last action",available:a()},{key:"Delete",description:"Delete selected waypoint",available:n.length>0},{key:"Ctrl+Shift+C",description:"Clear all waypoints",available:n.length>0},{key:"Escape",description:"Close dialogs/deselect",available:!0}],isValidForRouting:o()}},tr=(s,t,r=!1,a=!1,i=!1)=>{const n={start:"bg-green-500 border-green-600 text-white shadow-green-200",waypoint:"bg-blue-500 border-blue-600 text-white shadow-blue-200",end:"bg-red-500 border-red-600 text-white shadow-red-200"},o={start:"🚩",waypoint:t.toString(),end:"🏁"},c=i?56:48,h=L("flex items-center justify-center rounded-full border-3 font-bold cursor-pointer relative touch-manipulation",i?"w-14 h-14":"w-12 h-12",i?"text-lg":"text-base","transform transition-all duration-200",n[s]),m=L(r&&"scale-125 ring-4 ring-white ring-opacity-60",a&&"scale-110 shadow-2xl z-50",!a&&!r&&"hover:scale-105 active:scale-95 hover:shadow-lg shadow-md"),x=i?`
    <div class="absolute -inset-2 rounded-full" style="touch-action: none;"></div>
  `:"";return Ue.divIcon({html:`
      <div class="${h} ${m}">
        ${x}
        <!-- Main icon content -->
        <span class="relative z-10">${o[s]}</span>

        <!-- Pulse effect for start/end points -->
        ${s==="start"||s==="end"?`
          <div class="absolute inset-0 rounded-full ${n[s].split(" ")[0]} opacity-20 animate-ping"></div>
        `:""}

        <!-- Selection indicator -->
        ${r?`
          <div class="absolute -inset-1 rounded-full border-2 border-white animate-pulse"></div>
        `:""}

        <!-- Drag drop zone indicator -->
        ${a?`
          <div class="absolute -inset-3 rounded-full border-2 border-dashed border-yellow-400 bg-yellow-100 bg-opacity-20"></div>
        `:""}
      </div>
    `,className:L("waypoint-marker",a&&"dragging",i&&"touch-target"),iconSize:[c,c],iconAnchor:[c/2,c/2],popupAnchor:[0,-c/2]})},sr=(s,t)=>{switch(s){case"start":return"Start Point";case"end":return"Destination";case"waypoint":return`Waypoint ${t}`;default:return`Point ${t+1}`}},Ct=(s,t,r,a)=>({id:`waypoint-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,lat:Number(s.toFixed(6)),lng:Number(t.toFixed(6)),type:r,name:sr(r,a)}),ar=({waypoint:s,index:t,onDelete:r,onUpdate:a,onInsertAfter:i,onDragEnd:n})=>{const{selectedWaypoint:o,setSelectedWaypoint:c}=ot(),[l,u]=d.useState(null),[h,m]=d.useState(!1),[x,p]=d.useState(s.name),[N,M]=d.useState(s.notes||""),[y,k]=d.useState(!1),[,g]=d.useState(!1),j="ontouchstart"in window||navigator.maxTouchPoints>0,C=o===s.id,O=d.useCallback(()=>{c(s.id)},[s.id,c]),R=d.useCallback(v=>{v?.stopPropagation(),r(s.id)},[s.id,r]),B=d.useCallback(()=>{k(!0),"vibrate"in navigator&&navigator.vibrate(50)},[]),_=d.useCallback(v=>{k(!1);const V=v.target.getLatLng().lat,Z=v.target.getLatLng().lng;n(s.id,V,Z),"vibrate"in navigator&&navigator.vibrate([50,100,50])},[s.id,n]),G=d.useCallback(()=>{g(!0)},[]),A=d.useCallback(()=>{g(!1)},[]),F=d.useCallback(v=>{v.originalEvent.preventDefault();const{clientX:V,clientY:Z}=v.originalEvent;u({x:V,y:Z})},[]),T=d.useCallback(()=>{const v={};x.trim()!==s.name&&(v.name=x.trim()),N!==(s.notes||"")&&(v.notes=N),Object.keys(v).length>0&&a(s.id,v),m(!1)},[s.id,s.name,s.notes,x,N,a]),z=d.useCallback(()=>{p(s.name),M(s.notes||""),m(!1)},[s.name,s.notes]),X=d.useCallback(()=>{const v=Ct(s.lat-.01,s.lng-.01,"waypoint",t);i(v,s.id)},[s,t,i]),K=d.useCallback(()=>{const v=Ct(s.lat+.01,s.lng+.01,"waypoint",t+1);i(v,s.id)},[s,t,i]),J=[{id:"edit",label:"Edit Waypoint",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),onClick:()=>m(!0),shortcut:"E"},{id:"insert-before",label:"Insert Before",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),onClick:X,shortcut:"Shift+↑"},{id:"insert-after",label:"Insert After",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),onClick:K,shortcut:"Shift+↓"},{id:"delete",label:"Delete Waypoint",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:R,variant:"danger",shortcut:"Del"}],ne=s.type==="campsite"||s.type==="accommodation"?"waypoint":s.type,ae=tr(ne,t+1,C,y,j);return e.jsxs(e.Fragment,{children:[e.jsx(Le,{position:[s.lat,s.lng],icon:ae,draggable:!0,eventHandlers:{click:O,contextmenu:F,dragstart:B,dragend:_,mouseover:G,mouseout:A},children:e.jsx(_e,{eventHandlers:{click:v=>v.originalEvent?.stopPropagation()},children:e.jsxs("div",{className:"min-w-72 p-2",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:L("px-2 py-1 rounded text-xs font-semibold",s.type==="start"&&"bg-green-100 text-green-800",s.type==="waypoint"&&"bg-blue-100 text-blue-800",s.type==="end"&&"bg-red-100 text-red-800"),children:s.type==="start"?"START":s.type==="end"?"END":`WAYPOINT ${t+1}`}),e.jsx("span",{className:"text-xs text-gray-500",children:"Drag to move"})]}),e.jsxs("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),m(!h)},className:"bg-blue-600 text-white hover:bg-blue-700 px-3 py-2 rounded text-sm font-bold transition-colors flex items-center space-x-2 border-2 border-blue-800 shadow-lg",title:"Edit waypoint","aria-label":"Edit waypoint",style:{minWidth:"80px",zIndex:1e3},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{children:"EDIT"})]})]}),h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:x,onChange:v=>p(v.target.value),onClick:v=>v.stopPropagation(),onFocus:v=>v.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter waypoint name",autoFocus:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:N,onChange:v=>M(v.target.value),onClick:v=>v.stopPropagation(),onFocus:v=>v.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3,placeholder:"Add notes about this waypoint..."})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),T()},className:"flex-1 px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),z()},className:"flex-1 px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:s.name}),s.notes&&e.jsx("div",{className:"text-xs text-gray-600 bg-gray-50 rounded p-2",children:s.notes})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Coordinates"}),e.jsxs("div",{className:"text-xs text-gray-600 font-mono",children:[e.jsxs("div",{children:["Lat: ",s.lat.toFixed(6)]}),e.jsxs("div",{children:["Lng: ",s.lng.toFixed(6)]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),m(!0)},className:"flex-1 px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),R()},className:"flex-1 px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Delete"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),v.preventDefault(),c(null)},className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Close"})]})]})]})})}),e.jsx($a,{isOpen:!!l,position:l||{x:0,y:0},items:J,onClose:()=>u(null)})]})},rr=({onMapRightClick:s})=>(Qt({contextmenu:t=>{t.originalEvent.preventDefault();const{lat:r,lng:a}=t.latlng,{clientX:i,clientY:n}=t.originalEvent;s(r,a,i,n)},dblclick:t=>{const{lat:r,lng:a}=t.latlng,{clientX:i,clientY:n}=t.originalEvent;s(r,a,i,n)}}),null),nr=()=>{const{waypoints:s,addWaypoint:t,removeWaypoint:r,updateWaypoint:a,insertWaypoint:i}=re(),{addNotification:n}=de(),[o,c]=d.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[l,u]=d.useState({isOpen:!1,position:{x:0,y:0},coordinates:{lat:0,lng:0}});er();const h=d.useCallback((y,k,g,j)=>{u({isOpen:!0,position:{x:g,y:j},coordinates:{lat:y,lng:k}})},[]),m=d.useCallback((y,k)=>{const g=Ct(y,k,"waypoint",s.length);try{t(g),n({type:"success",message:`Added ${g.name} to route`})}catch{n({type:"error",message:"Failed to add waypoint"})}},[s.length,t,n]),x=d.useCallback(y=>{const k=s.find(g=>g.id===y);try{r(y),n({type:"success",message:`Removed ${k?.name||"waypoint"} from route`})}catch{n({type:"error",message:"Failed to remove waypoint"})}},[s,r,n]),p=d.useCallback((y,k)=>{try{a(y,k),(k.name||k.notes)&&n({type:"success",message:"Waypoint updated successfully"})}catch{n({type:"error",message:"Failed to update waypoint"})}},[a,n]),N=d.useCallback((y,k)=>{try{i(y,k),n({type:"success",message:`Inserted ${y.name} into route`})}catch{n({type:"error",message:"Failed to insert waypoint"})}},[i,n]),M=d.useCallback((y,k,g)=>{try{a(y,{lat:Number(k.toFixed(6)),lng:Number(g.toFixed(6))}),n({type:"success",message:"Waypoint position updated"})}catch{n({type:"error",message:"Failed to update waypoint position"})}},[a,n]);return e.jsxs(e.Fragment,{children:[typeof window<"u"&&e.jsx(rr,{onMapRightClick:h}),e.jsx(Qa,{}),s.map((y,k)=>e.jsx(ar,{waypoint:y,index:k,onDelete:x,onUpdate:p,onInsertAfter:N,onDragEnd:M},y.id)),e.jsx(ls,{isOpen:o.isOpen,title:o.title,message:o.message,confirmLabel:"Clear All",confirmVariant:"danger",onConfirm:o.onConfirm,onCancel:()=>c(y=>({...y,isOpen:!1}))}),l.isOpen&&e.jsx("div",{className:"fixed z-[10000] bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[160px]",style:{left:l.position.x,top:l.position.y},onMouseLeave:()=>u(y=>({...y,isOpen:!1})),children:e.jsxs("button",{onClick:()=>{m(l.coordinates.lat,l.coordinates.lng),u(y=>({...y,isOpen:!1}))},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 flex items-center space-x-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Add Waypoint"})]})}),l.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[9999]",onClick:()=>u(y=>({...y,isOpen:!1}))})]})},Je=[{id:"openstreetmap",name:"OpenStreetMap",description:"Standard street map",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,subdomains:["a","b","c"],category:"standard",icon:"🗺️"},{id:"opentopomap",name:"OpenTopoMap",description:"Topographic map with contours",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attribution:'Map data: © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: © <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',maxZoom:15,subdomains:["a","b","c"],category:"topographic",icon:"🏔️"},{id:"cyclosm",name:"CyclOSM",description:"Cycling-focused map",url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors. Tiles style by <a href="https://www.cyclosm.org">CyclOSM</a> hosted by <a href="https://openstreetmap.fr">OpenStreetMap France</a>',maxZoom:19,subdomains:["a","b","c"],category:"outdoor",icon:"🚴"},{id:"humanitarian",name:"Humanitarian",description:"Clear, humanitarian mapping style",url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors. Tiles style by <a href="https://www.hotosm.org">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr">OpenStreetMap France</a>',maxZoom:19,subdomains:["a","b"],category:"standard",icon:"🏥"}],ir=({currentLayerId:s,onLayerChange:t,collapsed:r=!1,onToggleCollapse:a})=>{const{addNotification:i}=de(),[n,o]=d.useState(null),c=d.useCallback(async u=>{if(u!==s){o(u);try{const h=Je.find(p=>p.id===u);if(!h)throw new Error("Layer not found");const m=h.url.replace("{s}",h.subdomains?.[0]||"").replace("{z}","5").replace("{x}","16").replace("{y}","10"),x=new Image;await new Promise((p,N)=>{x.onload=p,x.onerror=N,x.src=m,setTimeout(()=>N(new Error("Tile load timeout")),5e3)}),t(u),i({type:"success",message:`Switched to ${h.name} map layer`})}catch{i({type:"error",message:`Failed to load ${Je.find(m=>m.id===u)?.name} layer`})}finally{o(null)}}},[s,t,i]),l=Je.find(u=>u.id===s);return r?e.jsxs(e.Fragment,{children:[l&&e.jsx(Rt,{url:l.url,attribution:l.attribution,subdomains:l.subdomains,maxZoom:l.maxZoom,detectRetina:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:4},l.id),e.jsx("div",{className:"absolute top-4 left-4 z-30 bg-white rounded-lg shadow-md",children:e.jsx("button",{onClick:a,className:"w-10 h-10 flex items-center justify-center hover:bg-gray-50 transition-colors rounded-lg",title:`Current: ${l?.name||"Unknown"}`,"aria-label":"Open layer control",children:e.jsx("span",{className:"text-lg",children:l?.icon||"🗺️"})})})]}):e.jsxs(e.Fragment,{children:[l&&e.jsx(Rt,{url:l.url,attribution:l.attribution,subdomains:l.subdomains,maxZoom:l.maxZoom,detectRetina:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:4},l.id),e.jsxs("div",{className:"absolute top-4 left-4 z-30 bg-white rounded-lg shadow-md overflow-hidden min-w-64",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm",children:"Map Layers"}),a&&e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors","aria-label":"Collapse layer control",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-2 space-y-1",children:Je.map(u=>{const h=u.id===s,m=n===u.id;return e.jsxs("button",{onClick:()=>c(u.id),disabled:m,className:L("w-full flex items-center space-x-3 p-2 rounded-lg text-left transition-all",h?"bg-blue-50 text-blue-900 border border-blue-200":"hover:bg-gray-50 text-gray-700",m&&"opacity-50 cursor-wait"),children:[e.jsx("div",{className:"flex-shrink-0",children:m?e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"})}):e.jsx("span",{className:"text-lg",children:u.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-sm",children:u.name}),h&&e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:u.description})]})]},u.id)})}),l&&e.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Current Layer"}),e.jsx("span",{className:"text-blue-600",children:l.name})]}),e.jsxs("div",{className:"text-gray-500",children:["Max Zoom: ",l.maxZoom,"x • Category: ",l.category]})]})})]})]})},or=s=>{if(s.length===0)return null;let t=s[0].lat,r=s[0].lat,a=s[0].lng,i=s[0].lng;return s.forEach(n=>{t=Math.max(t,n.lat),r=Math.min(r,n.lat),a=Math.max(a,n.lng),i=Math.min(i,n.lng)}),{north:t,south:r,east:a,west:i}},Tt=(s,t,r={})=>{if(t.length===0)return!1;const a=or(t);if(!a)return!1;const{padding:i=[50,50],maxZoom:n=15,minZoom:o=3,animate:c=!0,duration:l=1e3}=r;try{if(t.length===1){const u=t[0];s.setView([u.lat,u.lng],10,{animate:c,duration:l/1e3})}else{const h=Te.latLngBounds([a.south,a.west],[a.north,a.east]).pad(.1);s.fitBounds(h,{padding:i,maxZoom:n,animate:c,duration:l/1e3})}return!0}catch(u){return console.error("Error fitting bounds:",u),!1}},lr=(s,t,r,a)=>{const n=Ye(r-s),o=Ye(a-t),c=Math.sin(n/2)*Math.sin(n/2)+Math.cos(Ye(s))*Math.cos(Ye(r))*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},Ye=s=>s*(Math.PI/180),cr=s=>{if(s.length<2)return 0;let t=0;for(let r=0;r<s.length-1;r++){const a=s[r],i=s[r+1];t+=lr(a.lat,a.lng,i.lat,i.lng)}return t},dr=({map:s,onToggleFullscreen:t,onToggleLayerControl:r,onResetView:a})=>{const{waypoints:i}=re(),n=d.useCallback(()=>{s&&s.zoomIn()},[s]),o=d.useCallback(()=>{s&&s.zoomOut()},[s]),c=d.useCallback(()=>{if(s){const y=s.getCenter(),k=s.getZoom(),g=180/Math.pow(2,k)*.25;s.panTo([y.lat+g,y.lng])}},[s]),l=d.useCallback(()=>{if(s){const y=s.getCenter(),k=s.getZoom(),g=180/Math.pow(2,k)*.25;s.panTo([y.lat-g,y.lng])}},[s]),u=d.useCallback(()=>{if(s){const y=s.getCenter(),k=s.getZoom(),g=360/Math.pow(2,k)*.25;s.panTo([y.lat,y.lng-g])}},[s]),h=d.useCallback(()=>{if(s){const y=s.getCenter(),k=s.getZoom(),g=360/Math.pow(2,k)*.25;s.panTo([y.lat,y.lng+g])}},[s]),m=d.useCallback(()=>{s&&i.length>0&&Tt(s,i,{padding:[50,50],maxZoom:15,animate:!0,duration:1e3})},[s,i]),x=d.useCallback(()=>{a&&a()},[a]),p=d.useCallback(()=>{t&&t()},[t]),N=d.useCallback(()=>{r&&r()},[r]);return d.useEffect(()=>{const y=k=>{if(k.target instanceof HTMLInputElement||k.target instanceof HTMLTextAreaElement||k.target?.contentEditable==="true")return;const g=k.ctrlKey||k.metaKey,j=k.shiftKey,C=k.altKey;switch(k.key.toLowerCase()){case"+":case"=":g||(k.preventDefault(),n());break;case"-":case"_":g||(k.preventDefault(),o());break;case"arrowup":!g&&!j&&(k.preventDefault(),c());break;case"arrowdown":!g&&!j&&(k.preventDefault(),l());break;case"arrowleft":!g&&!j&&(k.preventDefault(),u());break;case"arrowright":!g&&!j&&(k.preventDefault(),h());break;case"w":g||(k.preventDefault(),c());break;case"s":g||(k.preventDefault(),l());break;case"a":g||(k.preventDefault(),u());break;case"d":g||(k.preventDefault(),h());break;case"f":g?(k.preventDefault(),m()):C&&(k.preventDefault(),p());break;case"r":g&&(k.preventDefault(),x());break;case"l":g&&(k.preventDefault(),N());break;case"0":g||(k.preventDefault(),x());break;case"home":k.preventDefault(),m();break;case"end":k.preventDefault(),x();break}};return document.addEventListener("keydown",y),()=>{document.removeEventListener("keydown",y)}},[n,o,c,l,u,h,m,x,p,N]),{shortcuts:[{key:"+/-",description:"Zoom in/out",action:n,available:!!s},{key:"↑↓←→",description:"Pan map",action:c,available:!!s},{key:"WASD",description:"Pan map (alternative)",action:c,available:!!s},{key:"Ctrl+F",description:"Zoom to fit waypoints",action:m,available:i.length>0},{key:"Ctrl+R",description:"Reset view",action:x,available:!!a},{key:"Alt+F",description:"Toggle fullscreen",action:p,available:!!t},{key:"Ctrl+L",description:"Toggle layer control",action:N,available:!!r},{key:"Home",description:"Zoom to fit waypoints",action:m,available:i.length>0},{key:"End",description:"Reset view",action:x,available:!!a},{key:"0",description:"Reset view",action:x,available:!!a}].filter(y=>y.available),actions:{zoomIn:n,zoomOut:o,panUp:c,panDown:l,panLeft:u,panRight:h,zoomToFit:m,resetView:x,toggleFullscreen:p,toggleLayerControl:N}}},mr=({map:s,isFullscreen:t,onToggleFullscreen:r,onResetView:a,onToggleLayerControl:i,layerControlCollapsed:n})=>{const{waypoints:o}=re(),{addNotification:c}=de(),[l,u]=d.useState(!1),{shortcuts:h,actions:m}=dr({map:s,onToggleFullscreen:r,onToggleLayerControl:i,onResetView:a}),x=d.useCallback(()=>{if(!s||o.length===0){c({type:"warning",message:"Add waypoints to use zoom to fit"});return}const M=Tt(s,o,{padding:[50,50],maxZoom:15,animate:!0,duration:1e3});c(M?{type:"success",message:"Zoomed to fit all waypoints"}:{type:"error",message:"Failed to zoom to waypoints"})},[s,o,c]),p=d.useCallback(()=>{s&&m.zoomIn()},[s,m]),N=d.useCallback(()=>{s&&m.zoomOut()},[s,m]);return cr(o),e.jsxs("div",{className:"absolute top-4 right-3 z-40 flex flex-col space-y-2 hidden sm:flex",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:p,className:"block w-10 h-10 flex items-center justify-center hover:bg-gray-50 border-b border-gray-200 transition-colors",title:"Zoom in (+)","aria-label":"Zoom in",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{onClick:N,className:"block w-10 h-10 flex items-center justify-center hover:bg-gray-50 transition-colors",title:"Zoom out (-)","aria-label":"Zoom out",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:x,disabled:o.length===0,className:L("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",o.length>0?"hover:bg-gray-50 text-gray-700":"text-gray-300 cursor-not-allowed"),title:`Zoom to fit waypoints (Ctrl+F)${o.length===0?" - Add waypoints first":""}`,"aria-label":"Zoom to fit all waypoints",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),e.jsx("button",{onClick:a,className:"block w-10 h-10 flex items-center justify-center hover:bg-gray-50 border-b border-gray-200 transition-colors",title:"Reset to Europe view (Ctrl+R)","aria-label":"Reset to Europe view",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a9 9 0 019 9 9 9 0 019-9M12 12V9"})})}),e.jsx("button",{onClick:i,className:L("block w-10 h-10 flex items-center justify-center hover:bg-gray-50 border-b border-gray-200 transition-colors",!n&&"bg-blue-50 text-blue-600"),title:"Toggle layer control (Ctrl+L)","aria-label":"Toggle map layer control",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),e.jsx("button",{onClick:r,className:L("block w-10 h-10 flex items-center justify-center hover:bg-gray-50 transition-colors",t&&"bg-blue-50 text-blue-600"),title:`${t?"Exit":"Enter"} fullscreen (Alt+F)`,"aria-label":`${t?"Exit":"Enter"} fullscreen mode`,children:t?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4.5M9 9H4.5M9 9L3.5 3.5M15 9h4.5M15 9V4.5M15 9l5.5-5.5M9 15v4.5M9 15H4.5M9 15l-5.5 5.5M15 15h4.5M15 15v4.5m0-4.5l5.5 5.5"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsx("button",{onClick:()=>u(!l),className:L("bg-white rounded-lg shadow-md p-2 hover:bg-gray-50 transition-colors",l&&"bg-blue-50 text-blue-600"),title:"Show keyboard shortcuts","aria-label":"Toggle keyboard shortcuts help",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})})}),l&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 min-w-64 max-w-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3 text-sm",children:"Keyboard Shortcuts"}),e.jsx("div",{className:"space-y-2",children:h.map((M,y)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:M.description}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded text-gray-900 font-mono",children:M.key})]},y))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Shortcuts work when not typing in input fields"})})]})]})},hr=({map:s,isFullscreen:t,onToggleFullscreen:r,onResetView:a,onToggleLayerControl:i,className:n})=>{const{waypoints:o}=re(),{addNotification:c}=de(),[l,u]=d.useState(!1),[h,m]=d.useState(!1);d.useEffect(()=>{const g=()=>{m(window.innerWidth<768||"ontouchstart"in window)};return g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]);const x=d.useCallback(()=>{s&&s.zoomIn()},[s]),p=d.useCallback(()=>{s&&s.zoomOut()},[s]),N=d.useCallback(()=>{if(!s||o.length===0){c({type:"warning",message:"Add waypoints to use zoom to fit"});return}Tt(s,o,{padding:[60,60],maxZoom:14,animate:!0,duration:800})&&c({type:"success",message:"Zoomed to fit waypoints"}),u(!1)},[s,o,c]),M=d.useCallback(()=>{r(),u(!1)},[r]),y=d.useCallback(()=>{a(),u(!1)},[a]),k=d.useCallback(()=>{i(),u(!1)},[i]);return h?e.jsxs("div",{className:L("fixed bottom-4 right-4 z-40 flex flex-col items-end space-y-2","sm:hidden",n),children:[l&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-2 grid grid-cols-2 gap-2 animate-fade-in",children:[e.jsxs("button",{onClick:N,disabled:o.length===0,className:L("flex flex-col items-center justify-center h-16 w-16 rounded-lg transition-colors",o.length>0?"bg-blue-50 hover:bg-blue-100 text-blue-600 active:bg-blue-200":"bg-gray-50 text-gray-300 cursor-not-allowed"),children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs font-medium",children:"Fit"})]}),e.jsxs("button",{onClick:y,className:"flex flex-col items-center justify-center h-16 w-16 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 active:bg-gray-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a9 9 0 019 9 9 9 0 019-9M12 12V9"})}),e.jsx("span",{className:"text-xs font-medium",children:"Reset"})]}),e.jsxs("button",{onClick:k,className:"flex flex-col items-center justify-center h-16 w-16 rounded-lg bg-purple-50 hover:bg-purple-100 text-purple-600 active:bg-purple-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),e.jsx("span",{className:"text-xs font-medium",children:"Layers"})]}),e.jsx("button",{onClick:M,className:L("flex flex-col items-center justify-center h-16 w-16 rounded-lg transition-colors",t?"bg-blue-100 text-blue-700 active:bg-blue-200":"bg-green-50 hover:bg-green-100 text-green-600 active:bg-green-200"),children:t?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4.5M9 9H4.5M9 9L3.5 3.5M15 9h4.5M15 9V4.5M15 9l5.5-5.5M9 15v4.5M9 15H4.5M9 15l-5.5 5.5M15 15h4.5M15 15v4.5m0-4.5l5.5 5.5"})}),e.jsx("span",{className:"text-xs font-medium",children:"Exit"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs font-medium",children:"Full"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:x,className:"w-12 h-12 flex items-center justify-center hover:bg-gray-50 active:bg-gray-100 border-r border-gray-200 transition-colors","aria-label":"Zoom in",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{onClick:p,className:"w-12 h-12 flex items-center justify-center hover:bg-gray-50 active:bg-gray-100 transition-colors","aria-label":"Zoom out",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})})]})}),e.jsx("button",{onClick:()=>u(!l),className:L("w-12 h-12 bg-blue-600 text-white rounded-lg shadow-lg flex items-center justify-center transition-all",l?"bg-gray-600 rotate-45":"hover:bg-blue-700 active:bg-blue-800"),"aria-label":l?"Close more options":"Open more options",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),o.length===0&&e.jsx("div",{className:"bg-blue-600 text-white rounded-lg shadow-lg p-3 max-w-48",children:e.jsx("p",{className:"text-xs text-center",children:"Tap map to add waypoints"})})]}):null},it=({content:s,children:t,position:r="auto",size:a="md",variant:i="default",delay:n=500,disabled:o=!1,className:c,maxWidth:l="300px",showArrow:u=!0,trigger:h="hover",interactive:m=!1})=>{const[x,p]=d.useState(!1),[N,M]=d.useState(r),[y,k]=d.useState({x:0,y:0}),g=d.useRef(null),j=d.useRef(null),C=d.useRef(),O={default:"bg-gray-900 text-white border-gray-700",info:"bg-blue-600 text-white border-blue-500",warning:"bg-yellow-600 text-white border-yellow-500",error:"bg-red-600 text-white border-red-500",success:"bg-green-600 text-white border-green-500"},R={sm:"text-xs px-2 py-1",md:"text-sm px-3 py-2",lg:"text-base px-4 py-3"},B=v=>{if(r!=="auto")return r;const{innerWidth:V,innerHeight:Z}=window,se=window.scrollX,D=window.scrollY,E=v.top-D,w=Z-(v.bottom-D),P=v.left-se,b=V-(v.right-se);return w>=60?"bottom":E>=60?"top":b>=150?"right":P>=150?"left":"bottom"},_=(v,V)=>{const Z=j.current;if(!Z)return{x:0,y:0};const se=Z.getBoundingClientRect(),D=window.scrollX,E=window.scrollY;let w=0,P=0;switch(V){case"top":w=v.left+D+v.width/2-se.width/2,P=v.top+E-se.height-8;break;case"bottom":w=v.left+D+v.width/2-se.width/2,P=v.bottom+E+8;break;case"left":w=v.left+D-se.width-8,P=v.top+E+v.height/2-se.height/2;break;case"right":w=v.right+D+8,P=v.top+E+v.height/2-se.height/2;break}const b=8;return w=Math.max(b,Math.min(w,window.innerWidth+D-se.width-b)),P=Math.max(b,Math.min(P,window.innerHeight+E-se.height-b)),{x:w,y:P}},G=()=>{o||!s||(C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{const v=g.current;if(!v)return;const V=v.getBoundingClientRect(),Z=B(V);M(Z),p(!0),requestAnimationFrame(()=>{const se=_(V,Z);k(se)})},n))},A=()=>{C.current&&clearTimeout(C.current),m?C.current=setTimeout(()=>{p(!1)},100):p(!1)},F=()=>{h==="hover"&&G()},T=()=>{h==="hover"&&A()},z=()=>{h==="click"&&(x?A():G())},X=()=>{h==="focus"&&G()},K=()=>{h==="focus"&&A()},J=()=>{m&&C.current&&clearTimeout(C.current)},ne=()=>{m&&A()};d.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]);const ae=({position:v})=>{if(!u)return null;const V={top:"border-l-transparent border-r-transparent border-b-0 border-t-8 border-t-gray-900 bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full",bottom:"border-l-transparent border-r-transparent border-t-0 border-b-8 border-b-gray-900 top-0 left-1/2 transform -translate-x-1/2 -translate-y-full",left:"border-t-transparent border-b-transparent border-r-0 border-l-8 border-l-gray-900 right-0 top-1/2 transform translate-x-full -translate-y-1/2",right:"border-t-transparent border-b-transparent border-l-0 border-r-8 border-r-gray-900 left-0 top-1/2 transform -translate-x-full -translate-y-1/2"};return e.jsx("div",{className:L("absolute w-0 h-0",V[v]||V.bottom),style:{borderColor:i==="default"?"rgb(17 24 39)":O[i].split(" ")[0].replace("bg-","rgb(")}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:g,onMouseEnter:F,onMouseLeave:T,onClick:z,onFocus:X,onBlur:K,className:"inline-block",children:t}),x&&e.jsxs("div",{ref:j,role:"tooltip",className:L("fixed z-50 rounded-lg border shadow-lg transition-opacity duration-200","pointer-events-auto select-text",O[i],R[a],c),style:{left:y.x,top:y.y,maxWidth:l,pointerEvents:m?"auto":"none"},onMouseEnter:J,onMouseLeave:ne,children:[s,e.jsx(ae,{position:N})]})]})},Qe={height:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},width:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},length:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},weight:{metric:{label:"t",factor:1},imperial:{label:"lbs",factor:2204.62}}},et={height:{min:1.5,max:4.5,step:.1},width:{min:1.5,max:3,step:.1},weight:{min:1,max:40,step:.1},length:{min:3,max:20,step:.1}},ur=({className:s,onClose:t,compact:r=!1})=>{const{profile:a,setProfile:i,clearProfile:n}=oe(),{addNotification:o}=de(),[c,l]=d.useState("vehicle"),[u,h]=d.useState(""),[m,x]=d.useState(""),[p,N]=d.useState(""),[M,y]=d.useState(""),[k,g]=d.useState(a||{height:2,width:1.9,weight:3,length:5}),[j,C]=d.useState({}),[O,R]=d.useState(!1),[B,_]=d.useState(()=>localStorage.getItem("camper-planner-unit-system")||"metric"),[G,A]=d.useState(!1),F=d.useMemo(()=>u?xs(u):[],[u]),T=d.useMemo(()=>u&&m?gs(u,m):[],[u,m]);d.useEffect(()=>{a&&(g(a),R(!1))},[a]),d.useEffect(()=>{localStorage.setItem("camper-planner-unit-system",B)},[B]);const z=d.useCallback((b,I)=>{const W=et[b];return isNaN(I)||I<=0?`${b} must be a positive number`:I<W.min?`${b} must be at least ${W.min}${Qe[b].metric.label}`:I>W.max?`${b} cannot exceed ${W.max}${Qe[b].metric.label}`:""},[]),X=d.useCallback(b=>{const I={};return["height","width","weight","length"].forEach(H=>{const q=z(H,b[H]);q&&(I[H]=q)}),I},[z]),K=d.useCallback((b,I,W,H)=>{if(W===H)return b;const q=Qe[I];return W==="metric"&&H==="imperial"?b*q.imperial.factor:W==="imperial"&&H==="metric"?b/q.imperial.factor:b},[]),J=d.useCallback(b=>K(k[b],b,"metric",B),[k,B,K]),ne=d.useCallback((b,I)=>{const W=K(I,b,B,"metric");g(q=>({...q,[b]:W})),R(!0);const H=z(b,W);C(q=>({...q,[b]:H}))},[B,K,z]),ae=d.useCallback(b=>{h(b),x(""),N("")},[]),v=d.useCallback(b=>{x(b),N("")},[]),V=d.useCallback(b=>{N(b);const I=T.find(W=>W.id===b);if(I){const W={height:I.height,width:I.width,weight:I.weight,length:I.length};g(W),R(!0),C({});const H=mt.find(te=>te.id===u),q=H?.models.find(te=>te.id===m);o({type:"info",message:`Applied ${H?.name} ${q?.name} ${I.name} dimensions`})}},[T,u,m,o]),Z=d.useCallback(b=>{y(b);const I=we.find(W=>W.id===b);if(I){const W={height:I.height,width:I.width,weight:I.weight,length:I.length};g(W),R(!0),C({}),o({type:"info",message:`Applied ${I.name} dimensions`})}},[o]),se=d.useCallback(async()=>{const b=X(k);if(C(b),Object.keys(b).length===0){A(!0);try{await new Promise(I=>setTimeout(I,300)),i(k),R(!1),o({type:"success",message:"Vehicle profile saved successfully"}),t&&t()}catch{o({type:"error",message:"Failed to save vehicle profile"})}finally{A(!1)}}else o({type:"error",message:"Please fix validation errors before saving"})},[k,X,i,o,t]),D=d.useCallback(()=>{g(a||{height:2,width:1.9,weight:3,length:5}),C({}),R(!1),h(""),x(""),N(""),y("")},[a]),E=d.useCallback(()=>{n(),g({height:2,width:1.9,weight:3,length:5}),C({}),R(!1),h(""),x(""),N(""),y(""),o({type:"info",message:"Vehicle profile cleared"})},[n,o]),w=d.useCallback(()=>{_(b=>b==="metric"?"imperial":"metric")},[]),P=({field:b,label:I,icon:W,helpText:H})=>{const q=J(b),te=!!j[b],le=Qe[b][B];return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-base",children:W}),e.jsx("label",{htmlFor:b,className:"text-sm font-medium text-gray-700",children:I}),H&&e.jsx(it,{content:H,size:"sm",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-gray-400 cursor-help",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:b,type:"number",value:q.toFixed(1),onChange:Y=>ne(b,parseFloat(Y.target.value)||0),step:et[b].step,min:K(et[b].min,b,"metric",B),max:K(et[b].max,b,"metric",B),className:L("w-full px-3 py-2 pr-12 border rounded-lg text-sm focus:outline-none focus:ring-2 transition-colors",te?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"),placeholder:`Enter ${I.toLowerCase()}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm",children:le.label})})]}),te&&e.jsx("p",{className:"text-red-600 text-xs",children:j[b]})]})};return e.jsxs("div",{className:L("bg-white rounded-lg",r?"":"shadow-lg border border-gray-200 p-6",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 flex items-center",children:"🚐 Vehicle Profile"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Set your vehicle dimensions for safe routing"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(it,{content:`Switch to ${B==="metric"?"imperial":"metric"} units`,children:e.jsx("button",{onClick:w,className:L("px-2 py-1 rounded text-xs font-medium transition-colors",B==="metric"?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"),children:B==="metric"?"Metric":"Imperial"})})})]}),e.jsxs("div",{className:"flex space-x-1 mb-4 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>l("vehicle"),className:L("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",c==="vehicle"?"bg-white text-blue-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"🚐 Base Vehicle"}),e.jsx("button",{onClick:()=>l("motorhome"),className:L("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",c==="motorhome"?"bg-white text-blue-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"🚌 Motorhome"}),e.jsx("button",{onClick:()=>l("custom"),className:L("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",c==="custom"?"bg-white text-blue-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"✏️ Custom"})]}),c==="vehicle"&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Select your base vehicle to auto-fill dimensions"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Make"}),e.jsxs("select",{value:u,onChange:b=>ae(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select make..."}),mt.map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.country,")"]},b.id))]})]}),u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Model"}),e.jsxs("select",{value:m,onChange:b=>v(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select model..."}),F.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})]}),m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Size / Variant"}),e.jsxs("select",{value:p,onChange:b=>V(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select variant..."}),T.map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.length,"m × ",b.height,"m)"]},b.id))]})]}),p&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Selected:"})," ",mt.find(b=>b.id===u)?.name," ",F.find(b=>b.id===m)?.name," ",T.find(b=>b.id===p)?.name]})})]}),c==="motorhome"&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Select a popular motorhome model"}),e.jsxs("select",{value:M,onChange:b=>Z(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select motorhome..."}),e.jsx("optgroup",{label:"Compact Campervans",children:we.filter(b=>b.length<5.5).map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.length,"m)"]},b.id))}),e.jsx("optgroup",{label:"Medium Motorhomes",children:we.filter(b=>b.length>=5.5&&b.length<7).map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.length,"m)"]},b.id))}),e.jsx("optgroup",{label:"Large Motorhomes",children:we.filter(b=>b.length>=7&&b.length<10).map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.length,"m)"]},b.id))}),e.jsx("optgroup",{label:"Car + Caravan",children:we.filter(b=>b.length>=10).map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.length,"m)"]},b.id))})]}),M&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(()=>{const b=we.find(I=>I.id===M);return b?e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:b.name}),e.jsxs("div",{className:"text-blue-600 mt-1",children:["Base: ",b.base," • ",b.make]})]}):null})()})]}),c==="custom"&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-gray-600",children:"Enter your vehicle dimensions manually below. Measure your vehicle including any roof equipment (AC, antenna, solar panels)."})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(P,{field:"height",label:"Height",icon:"📏",helpText:"Max height including roof equipment"}),e.jsx(P,{field:"width",label:"Width",icon:"↔️",helpText:"Max width including mirrors"}),e.jsx(P,{field:"length",label:"Length",icon:"📐",helpText:"Total length front to back"}),e.jsx(P,{field:"weight",label:"Weight",icon:"⚖️",helpText:"Gross vehicle weight when loaded"})]}),a&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h3",{className:"text-xs font-medium text-green-800 mb-1",children:"✅ Saved Profile"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs text-green-700",children:[e.jsxs("div",{children:["H: ",a.height,"m"]}),e.jsxs("div",{children:["W: ",a.width,"m"]}),e.jsxs("div",{children:["L: ",a.length,"m"]}),e.jsxs("div",{children:["Wt: ",a.weight,"t"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:se,disabled:!O||Object.keys(j).length>0||G,className:L("flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center",O&&Object.keys(j).length===0&&!G?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:[G&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:G?"Saving...":a?"Update":"Save"})]}),e.jsx("button",{onClick:D,disabled:!O,className:L("px-4 py-2 rounded-lg text-sm font-medium border transition-colors",O?"border-gray-300 text-gray-700 hover:bg-gray-50":"border-gray-200 text-gray-400 cursor-not-allowed"),children:"Reset"}),a&&e.jsx("button",{onClick:E,className:"px-4 py-2 rounded-lg text-sm font-medium border border-red-300 text-red-700 hover:bg-red-50 transition-colors",children:"Clear"})]}),e.jsx("div",{className:"mt-4 p-2 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Routes will avoid roads with height/weight restrictions your vehicle cannot handle."]})})]})},xr=({className:s})=>{const{profile:t}=oe(),[r,a]=d.useState(!1),i=()=>t?{type:n(t),dimensions:`${t.height}×${t.width}×${t.length}m`,weight:`${t.weight}t`}:null,n=c=>{if(!c)return"Unknown";const{length:l,height:u,weight:h}=c;return l<=6&&u<=2.5&&h<=3.5?"Compact Camper":l<=8&&u<=3.2&&h<=7.5?"Medium Motorhome":l>10?"Car + Caravan":"Large Motorhome"},o=i();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:L("fixed top-4 left-4 z-40",s),children:e.jsx(it,{content:t?"Edit vehicle profile":"Set up your vehicle profile",position:"right",size:"sm",children:e.jsx("button",{onClick:()=>a(!0),className:L("bg-white rounded-lg shadow-md border border-gray-200 p-3 transition-all duration-200","hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500",t?"text-green-700 border-green-200 bg-green-50":"text-blue-700 border-blue-200 bg-blue-50"),"aria-label":"Vehicle profile",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"🚐"}),e.jsx("div",{className:"text-left",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs font-medium",children:o?.type}),e.jsx("div",{className:"text-xs text-gray-600",children:o?.dimensions})]}):e.jsx("div",{className:"text-xs font-medium",children:"Setup Vehicle"})})]})})})}),r&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:()=>a(!1)}),e.jsx("div",{className:"absolute left-0 top-0 h-full w-full max-w-md bg-white shadow-xl transform transition-transform",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Vehicle Configuration"}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(ur,{onClose:()=>a(!1),compact:!0})})]})})]})]})},gr=({className:s,autoCalculate:t=!0})=>{const{waypoints:r,setCalculatedRoute:a,isValidForRouting:i}=re(),{profile:n}=oe(),{addNotification:o}=de(),[c,l]=d.useState(!1),[u,h]=d.useState(null),[m,x]=d.useState(null),[p,N]=d.useState(null),[M,y]=d.useState(null),[k,g]=d.useState([]),[j,C]=d.useState(!1);d.useEffect(()=>{if(t&&i()&&pe.BASIC_ROUTING){const R=setTimeout(()=>{O()},1e3);return()=>clearTimeout(R)}},[r,t]),d.useEffect(()=>{if(t&&i()&&pe.BASIC_ROUTING&&p){const R=setTimeout(()=>{o({type:"info",message:"Recalculating route with updated vehicle profile..."}),O()},500);return()=>clearTimeout(R)}},[n]);const O=d.useCallback(async()=>{if(!i()){o({type:"warning",message:"Need at least 2 waypoints to calculate route"});return}l(!0),x(null);try{const R={waypoints:r.map(_=>({lat:_.lat,lng:_.lng,name:_.name||`Waypoint ${_.id}`,id:_.id,type:_.type})),vehicleProfile:n||void 0,options:{profile:n?"driving-hgv":"driving-car",geometry:!0,instructions:!0,elevation:!1,units:"km"}},B=await Jt.calculateRoute(R);if(a(B),B.routes.length>0){const _=B.routes[0];N({distance:Math.round(_.summary.distance/1e3*10)/10,duration:Math.round(_.summary.duration/60),service:B.metadata.service})}y(B.restrictions||null),g(B.alternativeRoutes||[]),h(Date.now()),B.warnings&&B.warnings.length>0?o({type:"warning",message:`Route calculated with warnings: ${B.warnings[0]}`}):o({type:"success",message:`Route calculated successfully using ${B.metadata.service}`})}catch(R){console.error("Route calculation failed:",R);let B="Failed to calculate route";R instanceof ps&&(B=R.message,R.recoverable||(a(null),N(null))),x(B),o({type:"error",message:B})}finally{l(!1)}},[r,n,i,a,o]);return e.jsxs("div",{className:L("bg-white rounded-lg shadow-sm border border-gray-200 p-4",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Route Calculation"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"}),p&&e.jsxs("span",{className:"text-xs text-gray-500",children:[p.distance,"km • ",Math.floor(p.duration/60),"h",p.duration%60,"m"]})]})]}),M&&M.violatedDimensions.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-red-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium text-red-800",children:"Vehicle Restriction Violations"})]}),e.jsx("div",{className:"space-y-1",children:M.suggestedActions.map((R,B)=>e.jsxs("div",{className:"text-red-700",children:["• ",R]},B))}),M.cannotAccommodate&&e.jsx("div",{className:"mt-2 p-2 bg-red-100 rounded text-red-800 font-medium",children:"⚠️ Your vehicle cannot use European roads with these dimensions"})]}),p&&e.jsxs("div",{className:L("mb-3 p-2 rounded text-xs",M?.violatedDimensions.length?"bg-amber-50 border border-amber-200":"bg-green-50 border border-green-200"),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:L("font-medium",M?.violatedDimensions.length?"text-amber-800":"text-green-800"),children:[e.jsxs("strong",{children:[p.distance," km"]})," • ",Math.floor(p.duration/60),"h ",p.duration%60,"m"]}),e.jsx("span",{className:L("capitalize",M?.violatedDimensions.length?"text-amber-600":"text-green-600"),children:p.service==="openrouteservice"?"OpenRoute":p.service})]}),n&&e.jsxs("div",{className:L("mt-1",M?.violatedDimensions.length?"text-amber-700":"text-green-700"),children:["Vehicle: ",n.height,"m H × ",n.width,"m W × ",n.weight,"t × ",n.length,"m L"]}),M?.violatedDimensions.length?e.jsx("div",{className:"text-amber-700 mt-1 font-medium",children:"⚠️ Route may include restricted roads"}):null]}),k.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("button",{onClick:()=>C(!j),className:"w-full flex items-center justify-between p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800 hover:bg-blue-100 transition-colors",children:[e.jsxs("span",{className:"font-medium",children:[k.length," Alternative Route",k.length>1?"s":""," Available"]}),e.jsx("svg",{className:L("w-4 h-4 transform transition-transform",j&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),j&&e.jsx("div",{className:"mt-2 space-y-2",children:k.map((R,B)=>e.jsxs("div",{className:"p-2 bg-gray-50 border border-gray-200 rounded text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-gray-700",children:["Alternative ",B+1,": ",e.jsxs("strong",{children:[Math.round(R.summary.distance/1e3*10)/10," km"]})]}),e.jsxs("span",{className:"text-gray-600",children:[Math.floor(R.summary.duration/60),"h ",Math.round(R.summary.duration/60)%60,"m"]})]}),e.jsx("button",{onClick:()=>{const _={id:`alt_${Date.now()}`,status:"success",routes:[R],metadata:{service:"openrouteservice",profile:n?"driving-hgv":"driving-car",timestamp:Date.now(),query:{},attribution:"openrouteservice.org | Alternative route"}};a(_),N({distance:Math.round(R.summary.distance/1e3*10)/10,duration:Math.round(R.summary.duration/60),service:"openrouteservice"}),o({type:"info",message:`Switched to alternative route ${B+1}`})},className:"mt-1 text-blue-600 hover:text-blue-800 font-medium underline",children:"Use this route"})]},B))})]}),m&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-800 font-medium",children:m}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"The routing service may be temporarily unavailable. Please try again in a few seconds."})]})]})}),e.jsxs("button",{onClick:()=>{x(null),O()},disabled:c,className:"mt-2 w-full flex items-center justify-center space-x-2 px-3 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded text-xs font-medium transition-colors disabled:opacity-50",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Try again"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:O,disabled:!i()||c,className:L("flex items-center space-x-2 px-3 py-2 rounded text-sm font-medium transition-colors",i()&&!c?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Calculating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("span",{children:"Calculate Route"})]})}),e.jsxs("label",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:R=>{},className:"h-3 w-3 text-blue-600 rounded border-gray-300",disabled:!0}),e.jsx("span",{children:"Auto-calculate"})]})]}),u&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Last updated: ",new Date(u).toLocaleTimeString()]}),p&&e.jsx("div",{className:"mt-3 p-2 bg-gray-50 border border-gray-200 rounded text-xs",children:e.jsxs("div",{className:"flex items-center justify-between text-gray-600",children:[e.jsx("span",{children:"Route ready for export"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})]})}),!i()&&r.length<2&&e.jsx("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:"Add at least 2 waypoints to enable route calculation"})]})},pr=({restrictions:s,className:t})=>{const{waypoints:r}=re(),{profile:a}=oe();if(!s||s.violatedDimensions.length===0)return null;const i={height:4,width:2.55,weight:40,length:18.75},n=()=>s.cannotAccommodate?"critical":s.violatedDimensions.length>=2?"high":"medium",o=()=>{const m=[];return s.cannotAccommodate?m.push({type:"critical",title:"Vehicle Cannot Use European Roads",description:"Your vehicle dimensions exceed EU road limits. Consider reviewing vehicle specifications.",actions:["Double-check vehicle measurements","Consider a smaller vehicle for European travel","Contact authorities for special transport permits"]}):m.push({type:"warning",title:"Limited Route Options",description:"Your vehicle may face restrictions on some European roads.",actions:["Plan routes using major highways when possible","Avoid city centers and narrow rural roads","Check local restrictions before travel","Consider overnight parking at designated motorhome areas"]}),m},c=()=>{const m=[];return s.violatedDimensions.includes("height")&&m.push(`Height: Reduce to ${i.height}m or less`),s.violatedDimensions.includes("width")&&m.push(`Width: Reduce to ${i.width}m or less`),s.violatedDimensions.includes("weight")&&m.push(`Weight: Reduce to ${i.weight}t or less`),s.violatedDimensions.includes("length")&&m.push(`Length: Reduce to ${i.length}m or less`),m},l=n(),u=o(),h=c();return e.jsxs("div",{className:L("p-4 rounded-lg border",l==="critical"&&"bg-red-50 border-red-200",l==="high"&&"bg-amber-50 border-amber-200",l==="medium"&&"bg-yellow-50 border-yellow-200",t),children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx("div",{className:L("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center",l==="critical"&&"bg-red-100",l==="high"&&"bg-amber-100",l==="medium"&&"bg-yellow-100"),children:l==="critical"?e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:L("text-lg font-semibold",l==="critical"&&"text-red-900",l==="high"&&"text-amber-900",l==="medium"&&"text-yellow-900"),children:"Vehicle Restriction Issues"}),e.jsxs("p",{className:L("text-sm mt-1",l==="critical"&&"text-red-700",l==="high"&&"text-amber-700",l==="medium"&&"text-yellow-700"),children:[r.length," waypoints • ",s.violatedDimensions.length," dimension",s.violatedDimensions.length>1?"s":""," exceed EU limits"]})]})]}),a&&e.jsxs("div",{className:"mb-4 p-3 bg-white rounded border",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Current Vehicle Dimensions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("height")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Height:"}),e.jsxs("span",{children:[a.height,"m ",s.violatedDimensions.includes("height")&&"⚠️"]})]}),e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("width")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Width:"}),e.jsxs("span",{children:[a.width,"m ",s.violatedDimensions.includes("width")&&"⚠️"]})]}),e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("weight")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Weight:"}),e.jsxs("span",{children:[a.weight,"t ",s.violatedDimensions.includes("weight")&&"⚠️"]})]}),e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("length")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Length:"}),e.jsxs("span",{children:[a.length,"m ",s.violatedDimensions.includes("length")&&"⚠️"]})]})]})]}),u.map((m,x)=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:L("font-medium mb-2",m.type==="critical"&&"text-red-900",m.type==="warning"&&"text-amber-900"),children:m.title}),e.jsx("p",{className:L("text-sm mb-3",m.type==="critical"&&"text-red-700",m.type==="warning"&&"text-amber-700"),children:m.description}),e.jsx("ul",{className:"space-y-1",children:m.actions.map((p,N)=>e.jsxs("li",{className:L("text-sm flex items-start",m.type==="critical"&&"text-red-700",m.type==="warning"&&"text-amber-700"),children:[e.jsx("span",{className:"mr-2",children:"•"}),e.jsx("span",{children:p})]},N))})]},x)),h.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"💡 Suggested Dimension Adjustments"}),e.jsx("ul",{className:"space-y-1",children:h.map((m,x)=>e.jsxs("li",{className:"text-sm text-blue-700 flex items-start",children:[e.jsx("span",{className:"mr-2",children:"•"}),e.jsx("span",{children:m})]},x))})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"📋 EU Standard Road Limits"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Height:"}),e.jsxs("span",{children:[i.height,"m"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Width:"}),e.jsxs("span",{children:[i.width,"m"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Weight:"}),e.jsxs("span",{children:[i.weight,"t"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Length:"}),e.jsxs("span",{children:[i.length,"m"]})]})]})]})]})};function fr(s,t,r,a){const n=(r-s)*Math.PI/180,o=(a-t)*Math.PI/180,c=Math.sin(n/2)*Math.sin(n/2)+Math.cos(s*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}const br=({route:s,className:t})=>{const r=d.useMemo(()=>{if(!s.geometry?.coordinates)return null;const p=s.geometry.coordinates,N=[];let M=0;return p.forEach((y,k)=>{const[g,j,C]=y;if(C!==void 0){if(k>0){const O=p[k-1],R=fr(O[1],O[0],j,g);M+=R}N.push({distance:M,elevation:C,index:k})}}),N.length>0?N:null},[s.geometry]),a=d.useMemo(()=>{if(!r)return null;const p=r.map(j=>j.elevation),N=Math.min(...p),M=Math.max(...p),y=r[r.length-1].distance;let k=0,g=0;for(let j=1;j<r.length;j++){const C=r[j].elevation-r[j-1].elevation;C>0?k+=C:g+=Math.abs(C)}return{minElevation:Math.round(N),maxElevation:Math.round(M),totalGain:Math.round(k),totalLoss:Math.round(g),totalDistance:Math.round(y/1e3*10)/10}},[r]);if(!r||!a)return e.jsx("div",{className:L("bg-white rounded-lg border border-gray-200 p-6",t),children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Elevation Data"}),e.jsx("p",{children:"Elevation profile not available for this route"}),e.jsx("p",{className:"text-sm mt-1",children:"Enable elevation in route options to see the profile"})]})});const i=600,n=200,o={top:20,right:20,bottom:40,left:60},c=i-o.left-o.right,l=n-o.top-o.bottom,u=p=>p/a.totalDistance/1e3*c,h=p=>l-(p-a.minElevation)/(a.maxElevation-a.minElevation)*l,m=r.map((p,N)=>{const M=u(p.distance),y=h(p.elevation);return`${N===0?"M":"L"} ${M} ${y}`}).join(" "),x=m+` L ${u(r[r.length-1].distance)} ${l} L 0 ${l} Z`;return e.jsxs("div",{className:L("bg-white rounded-lg border border-gray-200",t),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Elevation Profile"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[a.totalDistance," km route"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-900",children:[a.maxElevation,"m"]}),e.jsx("div",{className:"text-sm text-blue-700",children:"Highest"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-green-900",children:[a.minElevation,"m"]}),e.jsx("div",{className:"text-sm text-green-700",children:"Lowest"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-orange-900",children:["+",a.totalGain,"m"]}),e.jsx("div",{className:"text-sm text-orange-700",children:"Total Gain"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-red-900",children:["-",a.totalLoss,"m"]}),e.jsx("div",{className:"text-sm text-red-700",children:"Total Loss"})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:e.jsxs("svg",{width:i,height:n,viewBox:`0 0 ${i} ${n}`,className:"w-full h-auto min-w-96",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"elevationGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsxs("g",{stroke:"#e5e7eb",strokeWidth:"1",children:[[0,.25,.5,.75,1].map(p=>{const N=o.top+p*l,M=a.maxElevation-p*(a.maxElevation-a.minElevation);return e.jsxs("g",{children:[e.jsx("line",{x1:o.left,y1:N,x2:o.left+c,y2:N}),e.jsxs("text",{x:o.left-10,y:N+4,textAnchor:"end",fontSize:"12",fill:"#6b7280",children:[Math.round(M),"m"]})]},p)}),[0,.25,.5,.75,1].map(p=>{const N=o.left+p*c,M=p*a.totalDistance;return e.jsxs("g",{children:[e.jsx("line",{x1:N,y1:o.top,x2:N,y2:o.top+l}),e.jsxs("text",{x:N,y:o.top+l+20,textAnchor:"middle",fontSize:"12",fill:"#6b7280",children:[M.toFixed(1),"km"]})]},p)})]}),e.jsx("path",{d:x,fill:"url(#elevationGradient)",transform:`translate(${o.left}, ${o.top})`}),e.jsx("path",{d:m,fill:"none",stroke:"#3b82f6",strokeWidth:"2",transform:`translate(${o.left}, ${o.top})`}),e.jsx("text",{x:o.left+c/2,y:n-10,textAnchor:"middle",fontSize:"14",fill:"#374151",fontWeight:"500",children:"Distance (km)"}),e.jsx("text",{x:20,y:o.top+l/2,textAnchor:"middle",fontSize:"14",fill:"#374151",fontWeight:"500",transform:`rotate(-90, 20, ${o.top+l/2})`,children:"Elevation (m)"})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"⛰️ Elevation Insights"}),e.jsxs("div",{className:"text-sm text-yellow-800 space-y-1",children:[a.totalGain>500&&e.jsx("div",{children:"• Significant climbing ahead - expect reduced fuel efficiency"}),a.totalLoss>500&&e.jsx("div",{children:"• Long descents - use engine braking and check brakes beforehand"}),a.maxElevation-a.minElevation>1e3&&e.jsx("div",{children:"• Large elevation changes - check weather conditions at altitude"}),a.maxElevation>1500&&e.jsx("div",{children:"• High altitude sections - consider altitude effects on engine performance"})]})]})]})]})},Gt=({route:s,compact:t})=>{const{profile:r}=oe();if(!s.routes.length)return null;const a=s.routes[0],{distance:i,duration:n}=a.summary,o=Math.round(i/1e3*10)/10,c=Math.floor(n/3600),l=Math.round(n%3600/60),h=s.restrictions?.cannotAccommodate?"incompatible":s.restrictions?.violatedDimensions?.length?"restricted":s.warnings?.length?"limited":"compatible";return t?e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium",children:[o," km"]}),e.jsxs("span",{className:"text-gray-600",children:[c,"h ",l,"m"]}),e.jsx("div",{className:L("w-2 h-2 rounded-full",h==="compatible"&&"bg-green-500",h==="limited"&&"bg-yellow-500",h==="restricted"&&"bg-orange-500",h==="incompatible"&&"bg-red-500")})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Route Summary"}),e.jsx("span",{className:"text-sm text-gray-500 capitalize",children:s.metadata.service})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:o}),e.jsx("div",{className:"text-sm text-blue-700",children:"kilometers"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[c,"h ",l,"m"]}),e.jsx("div",{className:"text-sm text-green-700",children:"travel time"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vehicle Compatibility"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:L("w-3 h-3 rounded-full",h==="compatible"&&"bg-green-500",h==="limited"&&"bg-yellow-500",h==="restricted"&&"bg-orange-500",h==="incompatible"&&"bg-red-500")}),e.jsx("span",{className:L("text-sm font-medium capitalize",h==="compatible"&&"text-green-700",h==="limited"&&"text-yellow-700",h==="restricted"&&"text-orange-700",h==="incompatible"&&"text-red-700"),children:h})]})]}),r&&e.jsxs("div",{className:"mt-3 text-xs text-gray-600",children:["Vehicle: ",r.height,"m H × ",r.width,"m W × ",r.weight,"t × ",r.length,"m L"]})]})},yr=({segments:s})=>s.length?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Route Segments"}),e.jsx("div",{className:"space-y-3",children:s.map((t,r)=>{const a=Math.round(t.distance/1e3*10)/10,i=Math.floor(t.duration/3600),n=Math.round(t.duration%3600/60);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-900",children:r+1})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["Segment ",r+1]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[a," km"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[i>0?`${i}h `:"",n,"m"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"travel time"})]})]},r)})})]}):null,vr=({segments:s})=>{const[t,r]=d.useState(0),a=d.useMemo(()=>s.flatMap((i,n)=>(i.steps||[]).map((o,c)=>({...o,segmentIndex:n,stepIndex:c,id:`${n}-${c}`}))),[s]);return a.length?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Turn-by-Turn Directions"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[a.length," instructions"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:a.map((i,n)=>{const o=i.distance>1e3?`${Math.round(i.distance/1e3*10)/10} km`:`${Math.round(i.distance)} m`;return e.jsxs("div",{className:L("flex items-start space-x-3 p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors",n===a.length-1&&"border-b-0"),children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-blue-900",children:n+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:i.instruction}),i.name&&e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:["on ",e.jsx("span",{className:"font-medium",children:i.name})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Continue for ",o]})]})]},i.id)})})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Turn-by-Turn Directions"}),e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("p",{children:"Detailed turn-by-turn directions not available"}),e.jsx("p",{className:"text-sm",children:"Try recalculating with OpenRouteService for detailed instructions"})]})]})},jr=({className:s,compact:t=!1})=>{const{calculatedRoute:r}=re(),[a,i]=d.useState("summary");if(!r||!r.routes.length)return e.jsx("div",{className:L("bg-white rounded-lg border border-gray-200 p-6",s),children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Route Information"}),e.jsx("p",{children:"Calculate a route to see detailed information"})]})});if(t)return e.jsx("div",{className:L("bg-white rounded-lg border border-gray-200 p-3",s),children:e.jsx(Gt,{route:r,compact:!0})});const n=r.routes[0];return e.jsxs("div",{className:L("bg-white rounded-lg border border-gray-200",s),children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-4",children:[{id:"summary",label:"Summary",icon:"📊"},{id:"segments",label:"Segments",icon:"🛣️"},{id:"directions",label:"Directions",icon:"🧭"},{id:"elevation",label:"Elevation",icon:"⛰️"}].map(o=>e.jsxs("button",{onClick:()=>i(o.id),className:L("flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors",a===o.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx("span",{children:o.icon}),e.jsx("span",{children:o.label})]},o.id))})}),e.jsxs("div",{className:"p-4",children:[a==="summary"&&e.jsx(Gt,{route:r}),a==="segments"&&e.jsx(yr,{segments:n.segments}),a==="directions"&&e.jsx(vr,{segments:n.segments}),a==="elevation"&&e.jsx(br,{route:n})]})]})},Nr=({className:s})=>{const{calculatedRoute:t,setCalculatedRoute:r}=re(),{profile:a}=oe(),{addNotification:i}=de(),[n,o]=d.useState("main");if(!t)return null;const c=[{id:"main",route:t.routes[0],label:"Main Route",isCurrent:!0},...(t.alternativeRoutes||[]).map((x,p)=>({id:`alt-${p}`,route:x,label:`Alternative ${p+1}`,isAlternative:!0,isCurrent:!1}))];if(c.length<=1)return null;const l=x=>{const p=c.find(M=>M.id===x);if(!p||x==="main")return;const N={...t,routes:[p.route],id:`selected_${x}_${Date.now()}`};r(N),o(x),i({type:"info",message:`Switched to ${p.label.toLowerCase()}`})},u=(x,p)=>{const N=x.summary.distance-p.summary.distance,M=x.summary.duration-p.summary.duration;return{distanceDiff:Math.round(N/1e3*10)/10,timeDiff:Math.round(M/60),distancePercent:Math.round(N/p.summary.distance*100),timePercent:Math.round(M/p.summary.duration*100)}},h=(x,p,N=!1)=>{const M=x>0?"+":"",y=N?"%":` ${p}`;return`${M}${x}${y}`},m=c[0].route;return e.jsxs("div",{className:L("bg-white rounded-lg border border-gray-200",s),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Route Comparison"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[c.length," route options available"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"space-y-3",children:c.map((x,p)=>{const N=n===x.id,M=p>0?u(x.route,m):null,y=Math.round(x.route.summary.distance/1e3*10)/10,k=Math.floor(x.route.summary.duration/3600),g=Math.round(x.route.summary.duration%3600/60);return e.jsxs("div",{className:L("relative p-4 rounded-lg border cursor-pointer transition-all",N?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),onClick:()=>l(x.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:L("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",N?"bg-blue-500 text-white":"bg-gray-100 text-gray-700"),children:[p===0?"1":String.fromCharCode(65+p)," "]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:x.label}),x.isAlternative&&e.jsx("div",{className:"text-xs text-gray-500",children:"Alternative route option"})]})]}),N&&e.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-medium",children:"Current"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Distance"}),e.jsxs("div",{className:"font-medium",children:[y," km"]}),M&&e.jsx("div",{className:L("text-xs",M.distanceDiff>0?"text-red-600":"text-green-600"),children:h(M.distanceDiff,"km")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Time"}),e.jsxs("div",{className:"font-medium",children:[k,"h ",g,"m"]}),M&&e.jsx("div",{className:L("text-xs",M.timeDiff>0?"text-red-600":"text-green-600"),children:h(M.timeDiff,"min")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Type"}),e.jsx("div",{className:"font-medium",children:p===0?"Fastest":M?M.distanceDiff<0?"Shorter":"Scenic":"Alternative"}),a&&e.jsx("div",{className:"text-xs text-gray-500",children:"Vehicle safe"})]})]}),M&&e.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-xs text-gray-600",children:[Math.abs(M.distancePercent)>10&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:L("w-2 h-2 rounded-full",M.distancePercent>0?"bg-red-400":"bg-green-400")}),e.jsx("span",{children:M.distancePercent>0?"Longer route":"Shorter route"})]}),Math.abs(M.timePercent)>15&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:L("w-2 h-2 rounded-full",M.timePercent>0?"bg-orange-400":"bg-blue-400")}),e.jsx("span",{children:M.timePercent>0?"Slower":"Faster"})]})]})]},x.id)})}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Route Selection Guide"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["• ",e.jsx("strong",{children:"Main Route:"})," Fastest route optimized for your vehicle"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"Alternatives:"})," Different paths that may avoid restrictions or offer scenic routes"]}),a&&e.jsxs("div",{children:["• All routes respect your vehicle dimensions (",a.height,"m H × ",a.width,"m W × ",a.weight,"t)"]})]})]})]})]})},wr={objective:"balanced",enableTimeConstraints:!1,maxDrivingTime:8,preferredStartTime:9,avoidNightDriving:!0,enableCampsitePreferences:!1,maxDistanceBetweenStops:300,requireCampsiteOvernight:!1,autoOptimizeOnChange:!1},kr=({className:s,onOptimizationComplete:t,onWaypointInsert:r,isVisible:a=!0})=>{const{waypoints:i,reorderWaypoints:n}=re(),{profile:o}=oe(),{addNotification:c}=de(),[l,u]=d.useState(wr),[h,m]=d.useState(!1),[x,p]=d.useState(null),[N,M]=d.useState(new Set),[y,k]=d.useState(!1),[g,j]=d.useState(!1),[C,O]=d.useState(null),[R,B]=d.useState(null),_=d.useMemo(()=>i.length>=3&&!h,[i.length,h]),G=d.useCallback(async()=>{if(_){m(!0);try{const T={objective:l.objective,vehicleProfile:o||void 0,lockedWaypoints:Array.from(N)};l.enableTimeConstraints&&(T.timeConstraints={maxDrivingTime:l.maxDrivingTime,preferredStartTime:l.preferredStartTime,avoidNightDriving:l.avoidNightDriving}),l.enableCampsitePreferences&&(T.campsitePreferences={maxDistanceBetweenStops:l.maxDistanceBetweenStops,preferredStopDuration:8,requireCampsiteOvernight:l.requireCampsiteOvernight});const z=await It.optimizeRoute(i,T);p(z),z.improvements.percentageImprovement>1?c({type:"success",message:`Route optimized! Saved ${z.improvements.distanceSaved.toFixed(1)}km and ${Math.round(z.improvements.timeSaved)} minutes`}):c({type:"info",message:"Route is already well optimized"}),t?.(z)}catch(T){console.error("Optimization failed:",T),c({type:"error",message:`Optimization failed: ${T instanceof Error?T.message:"Unknown error"}`})}finally{m(!1)}}},[i,l,o,N,_,c,t]),A=d.useCallback(()=>{x&&(n(x.optimizedRoute.waypoints),p(null),c({type:"success",message:"Route optimization applied successfully"}))},[x,n,c]),F=d.useCallback(T=>{M(z=>{const X=new Set(z);return X.has(T)?X.delete(T):X.add(T),X})},[]);return d.useCallback((T,z)=>{if(!g)return;const X={id:`temp_${Date.now()}`,lat:T,lng:z,name:"New Waypoint",type:"waypoint"};B({lat:T,lng:z}),It.findOptimalInsertion(i,X,{objective:l.objective,vehicleProfile:o||void 0}).then(K=>{O(K)}).catch(K=>{console.error("Insertion analysis failed:",K),c({type:"error",message:"Failed to analyze waypoint insertion"})})},[g,i,l.objective,o,c]),d.useEffect(()=>{if(l.autoOptimizeOnChange&&i.length>=3&&!h){const T=setTimeout(()=>{G()},2e3);return()=>clearTimeout(T)}},[i,l.autoOptimizeOnChange,G,h]),a?e.jsxs("div",{className:L("bg-white rounded-lg shadow-lg border border-gray-200",s),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),"Route Optimizer"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>k(!y),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded",title:"Advanced Settings",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})})]}),i.length<3&&e.jsxs("p",{className:"text-sm text-amber-600 mt-2 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),"Add at least 3 waypoints to enable route optimization"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Optimization Goal"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"shortest",label:"Shortest",icon:"📏",desc:"Minimize distance"},{value:"fastest",label:"Fastest",icon:"⚡",desc:"Minimize time"},{value:"balanced",label:"Balanced",icon:"⚖️",desc:"Balance time & distance"}].map(T=>e.jsxs("button",{onClick:()=>u(z=>({...z,objective:T.value})),className:L("p-3 rounded-lg border text-center transition-colors text-sm",l.objective===T.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 text-gray-700"),children:[e.jsx("div",{className:"text-lg mb-1",children:T.icon}),e.jsx("div",{className:"font-medium",children:T.label}),e.jsx("div",{className:"text-xs text-gray-500",children:T.desc})]},T.value))})]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("button",{onClick:G,disabled:!_,className:L("flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-lg font-medium transition-colors",_?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:h?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Optimizing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{children:"Optimize Route"})]})}),e.jsx("button",{onClick:()=>j(!g),className:L("px-4 py-3 rounded-lg font-medium transition-colors",g?"bg-green-600 text-white hover:bg-green-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Smart waypoint insertion",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:l.autoOptimizeOnChange,onChange:T=>u(z=>({...z,autoOptimizeOnChange:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Auto-optimize when route changes"})]})}),y&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Advanced Settings"}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm mb-2",children:[e.jsx("input",{type:"checkbox",checked:l.enableTimeConstraints,onChange:T=>u(z=>({...z,enableTimeConstraints:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable time constraints"})]}),l.enableTimeConstraints&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 ml-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max driving time (hours)"}),e.jsx("input",{type:"number",min:"4",max:"12",value:l.maxDrivingTime,onChange:T=>u(z=>({...z,maxDrivingTime:parseInt(T.target.value)})),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Preferred start time"}),e.jsx("input",{type:"number",min:"6",max:"12",value:l.preferredStartTime,onChange:T=>u(z=>({...z,preferredStartTime:parseInt(T.target.value)})),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm mb-2",children:[e.jsx("input",{type:"checkbox",checked:l.enableCampsitePreferences,onChange:T=>u(z=>({...z,enableCampsitePreferences:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable campsite preferences"})]}),l.enableCampsitePreferences&&e.jsxs("div",{className:"ml-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"block text-xs text-gray-600 mb-1",children:["Max distance between stops: ",l.maxDistanceBetweenStops,"km"]}),e.jsx("input",{type:"range",min:"100",max:"500",step:"50",value:l.maxDistanceBetweenStops,onChange:T=>u(z=>({...z,maxDistanceBetweenStops:parseInt(T.target.value)})),className:"w-full"})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:l.requireCampsiteOvernight,onChange:T=>u(z=>({...z,requireCampsiteOvernight:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Require campsite for overnight stops"})]})]})]})]})]}),i.length>0&&e.jsx("div",{className:"border-t border-gray-200",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Waypoint Order (",i.length," stops)"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:i.map((T,z)=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:z+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:T.name}),e.jsx("div",{className:"text-xs text-gray-500",children:T.type==="campsite"?"🏕️ Campsite":"📍 Waypoint"})]}),e.jsx("button",{onClick:()=>F(T.id),className:L("p-1 rounded text-xs",N.has(T.id)?"text-red-600 hover:bg-red-50":"text-gray-400 hover:bg-gray-100"),title:N.has(T.id)?"Unlock waypoint":"Lock waypoint order",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:N.has(T.id)?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})})})]},T.id))}),N.size>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex items-center",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),N.size," waypoint(s) locked in position"]})]})}),x&&e.jsx("div",{className:"border-t border-gray-200 bg-green-50",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-green-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Optimization Complete"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Distance Saved"}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[x.improvements.distanceSaved.toFixed(1),"km"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[x.improvements.percentageImprovement.toFixed(1),"% improvement"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Time Saved"}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[Math.round(x.improvements.timeSaved)," min"]}),e.jsx("div",{className:"text-xs text-gray-500",children:x.optimizationMetadata.algorithm})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:A,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"Apply Optimization"}),e.jsx("button",{onClick:()=>p(null),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Dismiss"})]})]})}),g&&e.jsx("div",{className:"border-t border-gray-200 bg-blue-50",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-blue-800 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Click on the map to find the optimal position for a new waypoint"})]})})}),C&&R&&e.jsx("div",{className:"border-t border-gray-200 bg-yellow-50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Waypoint Insertion Analysis"}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-3",children:["Best position: After waypoint ",C.suggestedPosition+1,e.jsx("br",{}),"Impact: +",C.routeImpact.distanceAdded.toFixed(1),"km, +",Math.round(C.routeImpact.timeAdded)," min",e.jsx("br",{}),"Efficiency: ",(C.routeImpact.efficiency*100).toFixed(0),"%"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{r?.(C.suggestedPosition),O(null),B(null),j(!1)},className:"bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:"Insert Here"}),e.jsx("button",{onClick:()=>{O(null),B(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Cancel"})]})]})})]}):null},Cr=({className:s="",onCostUpdate:t,isVisible:r=!0})=>{const{waypoints:a}=re(),{profile:i}=oe(),{fuelConsumptionSettings:n,fuelPriceSettings:o,preferences:c,lastCalculation:l,setFuelConsumptionSettings:u,setFuelPriceSettings:h,setLastCalculation:m}=Yt(),[x,p]=d.useState(!1),[N,M]=d.useState(null),[y,k]=d.useState(null),[g,j]=d.useState(!1),[C,O]=d.useState(null),R=d.useMemo(()=>fs(a,i),[a,i]);d.useEffect(()=>{if(a.length<2){M(null),k(null);return}if(l.routeHash===R&&l.breakdown&&bs(l.timestamp)){M(l.breakdown);return}B()},[a,i,n,o]),d.useEffect(()=>{N&&t&&t(N)},[N,t]);const B=async()=>{if(!(a.length<2)){p(!0),O(null);try{const A=await nt.calculateRouteCosts(a,i||void 0,n,o);if(M(A),m({routeHash:R,breakdown:A,timestamp:Date.now()}),c.showOptimizationSuggestions){const F=await nt.calculateCostOptimizations(A,i||void 0);k(F)}}catch(A){console.error("Cost calculation failed:",A),O("Failed to calculate trip costs. Please try again.")}finally{p(!1)}}},_=(A,F="EUR")=>new Intl.NumberFormat("en-EU",{style:"currency",currency:F,minimumFractionDigits:2,maximumFractionDigits:2}).format(A),G=A=>{switch(A.consumptionType){case"l_per_100km":return`${A.consumption.toFixed(1)} L/100km`;case"mpg_imperial":return`${A.consumption.toFixed(1)} MPG (UK)`;case"mpg_us":return`${A.consumption.toFixed(1)} MPG (US)`}};return r?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Trip Cost Calculator"})]}),e.jsx("button",{onClick:()=>j(!g),className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(rs,{className:"w-4 h-4 text-gray-600"})})]}),g&&e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Consumption"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("select",{value:n.consumptionType,onChange:A=>u({...n,consumptionType:A.target.value}),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"l_per_100km",children:"L/100km"}),e.jsx("option",{value:"mpg_imperial",children:"MPG (UK)"}),e.jsx("option",{value:"mpg_us",children:"MPG (US)"})]}),e.jsx("input",{type:"number",value:n.consumption,onChange:A=>u({...n,consumption:parseFloat(A.target.value)||0}),className:"px-3 py-2 border rounded-lg text-sm",placeholder:"Consumption",step:"0.1"}),e.jsxs("select",{value:n.fuelType,onChange:A=>u({...n,fuelType:A.target.value}),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"diesel",children:"Diesel"}),e.jsx("option",{value:"petrol",children:"Petrol"}),e.jsx("option",{value:"lpg",children:"LPG"}),e.jsx("option",{value:"electric",children:"Electric"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Prices"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:o.priceType==="default_european",onChange:()=>h({...o,priceType:"default_european"}),className:"mr-2"}),"European Averages"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:o.priceType==="manual",onChange:()=>h({...o,priceType:"manual",manualPrices:o.manualPrices||{petrol:1.65,diesel:1.55,lpg:.85,electricity:.35}}),className:"mr-2"}),"Manual Entry"]})]}),o.priceType==="manual"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsx("input",{type:"number",placeholder:"Petrol",value:o.manualPrices?.petrol||"",onChange:A=>h({...o,manualPrices:{...o.manualPrices,petrol:parseFloat(A.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"Diesel",value:o.manualPrices?.diesel||"",onChange:A=>h({...o,manualPrices:{...o.manualPrices,diesel:parseFloat(A.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"LPG",value:o.manualPrices?.lpg||"",onChange:A=>h({...o,manualPrices:{...o.manualPrices,lpg:parseFloat(A.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"Electric",value:o.manualPrices?.electricity||"",onChange:A=>h({...o,manualPrices:{...o.manualPrices,electricity:parseFloat(A.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"})]})]})]})]})}),e.jsxs("div",{className:"p-4",children:[C&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:C})]})}),x?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Calculating costs..."})]}):N?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-800 mb-1",children:_(N.totalCost,N.currency)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Trip Cost"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(ss,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Fuel"})]}),e.jsx("div",{className:"font-semibold",children:_(N.fuelCost,N.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(ve,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Accommodation"})]}),e.jsx("div",{className:"font-semibold",children:_(N.accommodationCost,N.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(vt,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Tolls"})]}),e.jsx("div",{className:"font-semibold",children:_(N.tollCost,N.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(ht,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Other"})]}),e.jsx("div",{className:"font-semibold",children:_(N.otherCosts,N.currency)})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Current Settings:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Consumption: "}),G(n)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fuel Type: "}),n.fuelType.charAt(0).toUpperCase()+n.fuelType.slice(1)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Price Source: "}),o.priceType==="default_european"?"EU Averages":"Manual"]})]})]}),c.showDailyEstimates&&N.dailyBreakdown.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(De,{className:"w-4 h-4 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-800",children:"Daily Cost Breakdown"})]}),e.jsx("div",{className:"space-y-2",children:N.dailyBreakdown.map((A,F)=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-800",children:["Day ",F+1," - ",A.date.toLocaleDateString()]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[A.distance.toFixed(0),"km driving"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold",children:_(A.totalDailyCost,N.currency)}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Fuel: ",_(A.fuelCost,N.currency)]})]})]})},F))})]}),c.showCostBreakdown&&N.segments.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"w-4 h-4 text-green-600"}),e.jsx("h4",{className:"font-medium text-gray-800",children:"Route Segments"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:N.segments.map((A,F)=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-800 truncate",children:[A.startWaypoint.name," → ",A.endWaypoint.name]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[A.distance.toFixed(0),"km • ",Math.round(A.duration),"min",A.segmentType==="overnight"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs",children:"Overnight"})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"font-semibold",children:_(A.fuelCost+(A.accommodationCost||0),N.currency)}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Fuel: ",_(A.fuelCost,N.currency)]})]})]})},F))})]}),c.showOptimizationSuggestions&&y&&y.suggestions.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(La,{className:"w-4 h-4 text-orange-600"}),e.jsx("h4",{className:"font-medium text-gray-800",children:"Cost Optimization"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsxs("div",{className:"text-lg font-semibold text-orange-800",children:["Potential Savings: ",_(y.savings,N.currency)]}),e.jsxs("div",{className:"text-sm text-orange-600",children:["Optimized total: ",_(y.optimizedCost,N.currency)]})]}),e.jsx("div",{className:"space-y-2",children:y.suggestions.slice(0,3).map((A,F)=>e.jsx("div",{className:"bg-white rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:A.description}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:A.actionRequired})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:"font-semibold text-green-600",children:["-",_(A.potentialSaving,N.currency)]})})]})},F))})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ht,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Add waypoints to your route to calculate trip costs"})]})]})]}):null},Mt=()=>({visibleTypes:["campsite","caravan_site","aire"],amenities:{electricity:!1,wifi:!1,shower:!1,toilets:!1,drinking_water:!1,waste_disposal:!1,laundry:!1,restaurant:!1,shop:!1,playground:!1,swimming_pool:!1,pet_allowed:!1},vehicleCompatibleOnly:!1,routeOnlyMode:!1,maxDistanceFromRoute:20,openNow:!1,freeOnly:!1,acceptsReservations:!1,searchQuery:"",searchLocation:"",maxResults:100,sortBy:"distance"}),Me=[{type:"campsite",label:"Campsites",icon:"⛺",description:"Traditional camping with tents/caravans"},{type:"caravan_site",label:"Caravan Sites",icon:"🚐",description:"Sites specifically for caravans/motorhomes"},{type:"aire",label:"Aires de Service",icon:"🅿️",description:"Motorhome service areas with facilities"}],Mr=[{key:"electricity",label:"Electricity",icon:"⚡"},{key:"wifi",label:"WiFi",icon:"📶"},{key:"shower",label:"Showers",icon:"🚿"},{key:"toilets",label:"Toilets",icon:"🚻"},{key:"drinking_water",label:"Drinking Water",icon:"🚰"},{key:"waste_disposal",label:"Waste Disposal",icon:"🗑️"},{key:"laundry",label:"Laundry",icon:"👕"},{key:"restaurant",label:"Restaurant",icon:"🍽️"},{key:"shop",label:"Shop",icon:"🛒"},{key:"playground",label:"Playground",icon:"🎠"},{key:"swimming_pool",label:"Swimming Pool",icon:"🏊"},{key:"pet_allowed",label:"Pets Allowed",icon:"🐕"}],Sr=[{value:"distance",label:"Distance from route"},{value:"name",label:"Name A-Z"},{value:"rating",label:"Rating"},{value:"relevance",label:"Search relevance"}],Lr=[25,50,100,200,500],Dr=[5,10,20,50,100],Tr=({className:s,filterState:t,onFilterChange:r,onSearchChange:a,campsiteCount:i=0,isLoading:n=!1})=>{const[o,c]=d.useState(!1),[l,u]=d.useState("types"),{calculatedRoute:h}=re(),m=d.useCallback(g=>{try{localStorage.setItem("camper-planner-campsite-filters",JSON.stringify(g))}catch(j){console.warn("Failed to persist campsite filters:",j)}},[]);d.useEffect(()=>{try{const g=localStorage.getItem("camper-planner-campsite-filters");if(g){const j=JSON.parse(g),C={...Mt(),...j};r(C)}}catch(g){console.warn("Failed to load persisted filters:",g)}},[r]);const x=d.useCallback((g,j)=>{const C={...t,[g]:j};r(C),m(C)},[t,r,m]),p=d.useCallback(g=>{const j=t.visibleTypes.includes(g)?t.visibleTypes.filter(C=>C!==g):[...t.visibleTypes,g];x("visibleTypes",j)},[t.visibleTypes,x]),N=d.useCallback(g=>{const j={...t.amenities,[g]:!t.amenities[g]};x("amenities",j)},[t.amenities,x]),M=d.useCallback(()=>{const g=Mt();r(g),m(g)},[r,m]),y=d.useMemo(()=>{let g=0;return t.visibleTypes.length!==Me.length&&g++,g+=Object.values(t.amenities).filter(Boolean).length,t.vehicleCompatibleOnly&&g++,t.routeOnlyMode&&g++,t.openNow&&g++,t.freeOnly&&g++,t.acceptsReservations&&g++,t.searchQuery.trim()&&g++,t.searchLocation.trim()&&g++,g},[t]),k=h?.routes?.[0]?.geometry;return e.jsxs("div",{className:L("bg-white rounded-lg shadow-sm border border-gray-200",s),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"text-lg",children:"🔍"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Campsite Filters"}),y>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium",children:[y," active"]}),i>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i," results)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[y>0&&e.jsx("button",{onClick:M,className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),n&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"}),e.jsx("button",{onClick:()=>c(!o),className:"p-1.5 rounded text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:L("w-4 h-4 transform transition-transform",o&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),!o&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[Me.map(({type:g,icon:j,label:C})=>e.jsx("button",{onClick:()=>p(g),className:L("flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all",t.visibleTypes.includes(g)?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-gray-50 text-gray-400 hover:border-gray-400"),title:C,children:e.jsx("span",{className:"text-sm",children:j})},g)),k&&e.jsx("button",{onClick:()=>x("routeOnlyMode",!t.routeOnlyMode),className:L("px-2 py-1 text-xs font-medium rounded transition-colors",t.routeOnlyMode?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"📍 Route only"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Max: ",t.maxResults]})]})}),o&&e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsx("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[{id:"types",label:"Types",icon:"🏕️"},{id:"amenities",label:"Amenities",icon:"⚡"},{id:"advanced",label:"Advanced",icon:"⚙️"},{id:"search",label:"Search",icon:"🔍"}].map(g=>e.jsxs("button",{onClick:()=>u(g.id),className:L("flex-1 flex items-center justify-center space-x-1 py-3 px-2 text-sm font-medium transition-colors",l===g.id?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"),children:[e.jsx("span",{className:"text-sm",children:g.icon}),e.jsx("span",{children:g.label})]},g.id))}),e.jsxs("div",{className:"p-4 space-y-4",children:[l==="types"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Campsite Types"}),e.jsx("button",{onClick:()=>{const g=t.visibleTypes.length===Me.length;x("visibleTypes",g?[]:Me.map(j=>j.type))},className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:t.visibleTypes.length===Me.length?"None":"All"})]}),Me.map(({type:g,label:j,icon:C,description:O})=>e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.visibleTypes.includes(g),onChange:()=>p(g),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:C}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:j})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:O})]})]},g))]}),l==="amenities"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Required Amenities"}),e.jsx("button",{onClick:()=>{const g=Object.values(t.amenities).every(Boolean),j=Object.keys(t.amenities).reduce((C,O)=>({...C,[O]:!g}),{});x("amenities",j)},className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:Object.values(t.amenities).every(Boolean)?"None":"All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Mr.map(({key:g,label:j,icon:C})=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.amenities[g],onChange:()=>N(g),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm",children:C}),e.jsx("span",{className:"text-sm text-gray-900",children:j})]},g))}),e.jsx("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:"💡 Only campsites with ALL selected amenities will be shown"})]}),l==="advanced"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.vehicleCompatibleOnly,onChange:g=>x("vehicleCompatibleOnly",g.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Vehicle Compatible Only"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Show only campsites that can accommodate your vehicle dimensions"})]})]}),k&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.routeOnlyMode,onChange:g=>x("routeOnlyMode",g.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Show Along Route Only"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Filter campsites within distance of your planned route"})]})]}),t.routeOnlyMode&&e.jsxs("div",{className:"ml-7",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Max Distance from Route: ",t.maxDistanceFromRoute,"km"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:5,max:100,step:5,value:t.maxDistanceFromRoute,onChange:g=>x("maxDistanceFromRoute",parseInt(g.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),e.jsx("select",{value:t.maxDistanceFromRoute,onChange:g=>x("maxDistanceFromRoute",parseInt(g.target.value)),className:"text-xs border border-gray-300 rounded px-2 py-1 bg-white",children:Dr.map(g=>e.jsxs("option",{value:g,children:[g,"km"]},g))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.openNow,onChange:g=>x("openNow",g.target.checked),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Open Now"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.freeOnly,onChange:g=>x("freeOnly",g.target.checked),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Free Only"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.acceptsReservations,onChange:g=>x("acceptsReservations",g.target.checked),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Accepts Reservations"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Max Results"}),e.jsx("select",{value:t.maxResults,onChange:g=>x("maxResults",parseInt(g.target.value)),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 bg-white",children:Lr.map(g=>e.jsx("option",{value:g,children:g},g))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsx("select",{value:t.sortBy,onChange:g=>x("sortBy",g.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 bg-white",children:Sr.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded mt-4",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Map Legend"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Campsite (tent/caravan)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#3b82f6",stroke:"#2563eb",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Caravan/Motorhome site"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#8b5cf6",stroke:"#7c3aed",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Aire de Service"})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#ef4444",stroke:"#dc2626",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"May not fit your vehicle"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 text-white text-[8px] font-bold flex items-center justify-center border-2 border-white shadow",children:"3"})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Clustered markers (zoom in)"})]})]})]})]})]}),l==="search"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search by Name"}),e.jsx("input",{type:"text",value:t.searchQuery,onChange:g=>{x("searchQuery",g.target.value),a?.(g.target.value)},placeholder:"Search campsite names...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search by Location"}),e.jsx("input",{type:"text",value:t.searchLocation,onChange:g=>x("searchLocation",g.target.value),placeholder:"City, region, or address...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:"Search Tips:"}),e.jsxs("ul",{className:"space-y-0.5 text-gray-700",children:[e.jsx("li",{children:"• Use partial names for broader results"}),e.jsx("li",{children:"• Search by city or region names"}),e.jsx("li",{children:"• Combine with other filters for precise results"}),e.jsx("li",{children:"• Clear search to see all campsites in area"})]})]})]})]})]})]})},$e={campsite:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 12h3v8h14v-8h3L12 2zm-1 15h-2v-3h2v3zm4 0h-2v-3h2v3z"/></svg>',caravan_site:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 7h-3V6a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v6h2a3 3 0 0 0 6 0h6a3 3 0 0 0 6 0h2V10a3 3 0 0 0-3-3zM6 14a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm12 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></svg>',aire:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 15c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 2.5c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5zm12-2.5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 2.5c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5zm-4.5-12H11V3H9v2.5H6.5l1.38 1.38C8.51 7.45 9.2 8 10 8h4c.8 0 1.49-.55 1.88-1.38L17.26 5.5H15V3h-2v2.5z"/></svg>',parking:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.5 2h11A1.5 1.5 0 0 1 19 3.5v17a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 5 20.5v-17A1.5 1.5 0 0 1 6.5 2zM8 8v8h2v-3h2.5a2.5 2.5 0 0 0 0-5H8zm2 2h2.5a.5.5 0 0 1 0 1H10v-1z"/></svg>',unknown:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"/></svg>'},qt={campsite:{icon:$e.campsite,color:"#ffffff",backgroundColor:"#22c55e",borderColor:"#16a34a",size:32,description:"Traditional campsite with tent/caravan pitches"},caravan_site:{icon:$e.caravan_site,color:"#ffffff",backgroundColor:"#3b82f6",borderColor:"#2563eb",size:32,description:"Caravan and motorhome specific site"},aire:{icon:$e.aire,color:"#ffffff",backgroundColor:"#8b5cf6",borderColor:"#7c3aed",size:32,description:"Aire de service for motorhomes"},parking:{icon:$e.parking,color:"#ffffff",backgroundColor:"#f59e0b",borderColor:"#d97706",size:32,description:"Parking area with overnight stays allowed"},unknown:{icon:$e.unknown,color:"#ffffff",backgroundColor:"#6b7280",borderColor:"#4b5563",size:28,description:"Unknown campsite type"}},Zt={electricity:{borderColor:"#fbbf24",backgroundColor:"#f59e0b"},wifi:{borderColor:"#06b6d4",backgroundColor:"#0891b2"},shower:{borderColor:"#2dd4bf",backgroundColor:"#14b8a6"},toilets:{borderColor:"#a78bfa",backgroundColor:"#8b5cf6"},drinking_water:{borderColor:"#60a5fa",backgroundColor:"#3b82f6"}},Er={small:24,medium:32,large:40};function Ir(s){const{campsite:t,vehicleCompatible:r=!0,isSelected:a=!1,isHighlighted:i=!1,isInRoute:n=!1,isMobile:o=!1,size:c="medium",showTooltip:l=!1}=s,u=qt[t.type]||qt.unknown;let h=o?Er[c]:u.size;(a||i)&&(h=Math.floor(h*1.2));let m=u.backgroundColor,x=u.borderColor;if(r||(m="#ef4444",x="#dc2626"),a&&(x="#f59e0b"),i&&(x="#3b82f6"),r&&t.amenities){for(const[O,R]of Object.entries(t.amenities))if(R&&Zt[O]){const B=Zt[O];B.backgroundColor&&(m=B.backgroundColor),B.borderColor&&(x=B.borderColor);break}}const p=a?`
    animation: campsite-pulse 1.5s ease-in-out infinite;
  `:i?`
    animation: campsite-glow 1s ease-in-out infinite;
  `:"",N=Math.floor(h*.6),M=l&&t.name?`
    <div class="campsite-tooltip" style="
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      white-space: nowrap;
      font-size: 11px;
      font-weight: 500;
      color: #374151;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      margin-bottom: 4px;
      z-index: 1000;
    ">${t.name.substring(0,30)}${t.name.length>30?"...":""}</div>
  `:"",y=n?`
    <div style="
      position: absolute;
      top: -4px;
      right: -4px;
      width: 14px;
      height: 14px;
      background: #22c55e;
      border: 2px solid white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    ">
      <svg viewBox="0 0 20 20" fill="white" style="width: 8px; height: 8px;">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
      </svg>
    </div>
  `:"",k=!r&&!n?`
    <div style="
      position: absolute;
      top: -2px;
      right: -2px;
      width: 12px;
      height: 12px;
      background: #fef2f2;
      border: 2px solid #dc2626;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      font-weight: bold;
      color: #dc2626;
    ">!</div>
  `:"",g=h,j=Math.floor(h*1.4),C=`
    <div class="campsite-marker-wrapper" style="
      position: relative;
      width: ${g}px;
      height: ${j}px;
      ${p}
    ">
      ${M}
      <div style="
        position: relative;
        width: ${g}px;
        height: ${j}px;
        cursor: pointer;
        filter: drop-shadow(0 3px 4px rgba(0,0,0,0.3));
      ">
        <!-- Pin/teardrop SVG shape -->
        <svg viewBox="0 0 32 44" style="width: 100%; height: 100%;">
          <!-- Main pin shape -->
          <path d="M16 0C7.163 0 0 7.163 0 16c0 12 16 28 16 28s16-16 16-28C32 7.163 24.837 0 16 0z"
                fill="${m}"
                stroke="${x}"
                stroke-width="2"/>
          <!-- Inner circle for icon -->
          <circle cx="16" cy="14" r="10" fill="${x}" opacity="0.2"/>
        </svg>
        <!-- Icon container centered in top portion -->
        <div style="
          position: absolute;
          top: ${Math.floor(j*.12)}px;
          left: 50%;
          transform: translateX(-50%);
          width: ${N}px;
          height: ${N}px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: ${u.color};
        ">
          ${u.icon}
        </div>
        ${y}
        ${k}
      </div>
    </div>
  `;return Te.divIcon({className:`campsite-marker-icon ${a?"selected":""} ${i?"highlighted":""} ${n?"in-route":""}`,html:C,iconSize:[g,j],iconAnchor:[g/2,j],popupAnchor:[0,-j+10]})}function Rr(s){const t=s.getChildCount(),r=t<10?30:t<100?40:50;return Te.divIcon({html:`
      <div style="
        width: ${r}px;
        height: ${r}px;
        background: linear-gradient(135deg, #22c55e, #16a34a);
        border: 3px solid #ffffff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: ${Math.floor(r*.3)}px;
        font-weight: bold;
        color: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        cursor: pointer;
      ">
        ${t}
      </div>
    `,className:"campsite-cluster-icon",iconSize:[r,r],iconAnchor:[r/2,r/2]})}function Ar(s,t,r=!1){const a=r?t>12?15:t>10?25:40:t>12?20:t>10?30:50,i=[],n=new Set;for(const o of s){if(n.has(o.id))continue;const c=[o];n.add(o.id);for(const l of s){if(n.has(l.id)||l.id===o.id)continue;zr(o.lat,o.lng,l.lat,l.lng,t)<a&&(c.push(l),n.add(l.id))}if(c.length>1){const l=c.reduce((h,m)=>h+m.lat,0)/c.length,u=c.reduce((h,m)=>h+m.lng,0)/c.length;i.push({...o,id:Date.now()+i.length,location:{lat:l,lng:u},name:`${c.length} campsites`,isCluster:!0,clusterCount:c.length,clusterCampsites:c})}else i.push(o)}return i}function zr(s,t,r,a,i){const o=s*Math.PI/180,c=r*Math.PI/180,l=(r-s)*Math.PI/180,u=(a-t)*Math.PI/180,h=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o)*Math.cos(c)*Math.sin(u/2)*Math.sin(u/2),x=6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))),p=156543.03392*Math.cos(o)/Math.pow(2,i);return x/p}const Pr=({visibleTypes:s,maxResults:t,vehicleCompatibleOnly:r,searchQuery:a="",isVisible:i,onCampsiteClick:n,onCampsitesLoaded:o,isMobile:c=!1,filterState:l,highlightedCampsiteId:u,selectedCampsiteId:h})=>{const m=lt(),{calculatedRoute:x,waypoints:p,addWaypoint:N}=re(),{profile:M}=oe(),{addNotification:y}=de(),k=d.useCallback(D=>p.some(E=>Math.abs(E.lat-D.lat)<1e-4&&Math.abs(E.lng-D.lng)<1e-4),[p]),g=d.useCallback((D,E)=>{if(E.stopPropagation(),k(D)){y({type:"warning",message:`${D.name||"This campsite"} is already in your route`});return}const w={id:`campsite-${D.id}-${Date.now()}`,lat:D.lat,lng:D.lng,type:"campsite",name:D.name||`${D.type.replace("_"," ")} #${D.id}`,notes:D.address||""};N(w),y({type:"success",message:`Added "${w.name}" to your route`})},[N,y,k]),[j,C]=d.useState([]),[O,R]=d.useState(!1),[B,_]=d.useState(null),[G,A]=d.useState(m.getZoom()),F=d.useRef(null),T=d.useRef(null);d.useEffect(()=>{const D=()=>A(m.getZoom());return m.on("zoomend",D),()=>{m.off("zoomend",D)}},[m]);const z=d.useCallback(D=>{if(!(D instanceof Error))return{message:"Failed to load campsites",suggestion:"Please try again or zoom to a different area.",retryable:!0};const E=D.message.toLowerCase();return E.includes("timeout")?{message:"Request timed out while loading campsites",suggestion:"The area may be too large. Try zooming in to search a smaller area.",retryable:!0}:E.includes("failed to fetch")||E.includes("network")?{message:"Network connection failed",suggestion:"Please check your internet connection and try again.",retryable:!0}:E.includes("rate limit")||E.includes("too many requests")?{message:"Too many requests",suggestion:"Please wait a moment before searching again.",retryable:!0}:E.includes("bounding box too large")?{message:"Search area too large",suggestion:"Please zoom in to search a smaller area.",retryable:!1}:E.includes("no data")||E.includes("404")?{message:"No campsites found in this area",suggestion:"Try zooming out or searching a different location.",retryable:!1}:E.includes("http 5")?{message:"Campsite service temporarily unavailable",suggestion:"Please try again in a few moments.",retryable:!0}:{message:D.message||"Failed to load campsites",suggestion:"Please try again. If the problem persists, try zooming to a different area.",retryable:!0}},[]),X=d.useCallback(D=>M?!(M.height&&D.access?.max_height&&M.height>D.access.max_height||M.length&&D.access?.max_length&&M.length>D.access.max_length||M.weight&&D.access?.max_weight&&M.weight>D.access.max_weight):!0,[M]),K=d.useMemo(()=>{const D=[...new Set(j.map(E=>E.type))];console.log("SimpleCampsiteLayer: Filtering campsites",{campsitesCount:j.length,uniqueTypes:D,visibleTypes:s,filterState:!!l,vehicleCompatibleOnly:r,hasProfile:!!M,typeMatches:D.map(E=>({type:E,visible:s.includes(E)}))});{let E=j.map(P=>({...P,vehicleCompatible:X(P)}));if(console.log("SimpleCampsiteLayer: Before filtering",{count:E.length,compatibleCount:E.filter(P=>P.vehicleCompatible).length,incompatibleCount:E.filter(P=>!P.vehicleCompatible).length}),r){const P=E.length;E=E.filter(b=>b.vehicleCompatible),console.log("SimpleCampsiteLayer: After vehicle filter",{before:P,after:E.length,removed:P-E.length})}if(a.trim()){const P=E.length,b=a.toLowerCase();E=E.filter(I=>I.name?.toLowerCase().includes(b)||I.address?.toLowerCase().includes(b)||I.type.toLowerCase().includes(b)||Object.keys(I.amenities||{}).some(W=>W.toLowerCase().includes(b))),console.log("SimpleCampsiteLayer: After search filter",{before:P,after:E.length,removed:P-E.length,query:b})}const w=E.length;return E=E.filter(P=>s.includes(P.type)),console.log("SimpleCampsiteLayer: After type filter",{before:w,after:E.length,removed:w-E.length}),E}},[j,r,a,s,l,x,m,X,M]),J=d.useMemo(()=>{if(console.log("SimpleCampsiteLayer: Clustering campsites",{filteredCount:K.length,zoom:G,isVisible:i,willCluster:G<15}),!i||G>=15)return K;const D=Ar(K,G,c);return console.log("SimpleCampsiteLayer: Clustering result",{inputCount:K.length,outputCount:D.length}),D},[K,G,i,c]),ne=d.useCallback(async()=>{if(console.log("SimpleCampsiteLayer: loadCampsites called",{hasMap:!!m,featureEnabled:pe.CAMPSITE_DISPLAY,isVisible:i,visibleTypes:s,maxResults:t}),!m||!i)return;const D=m.getZoom();if(D<7){console.log("SimpleCampsiteLayer: Zoom level too low for campsite loading",{currentZoom:D,minRequired:7});return}R(!0),_(null);try{const E=m.getBounds();if(!E){console.warn("SimpleCampsiteLayer: No bounds available from map"),R(!1);return}const w=E.getNorth(),P=E.getSouth(),b=E.getEast(),I=E.getWest();if(typeof w>"u"||typeof P>"u"||typeof b>"u"||typeof I>"u"||isNaN(w)||isNaN(P)||isNaN(b)||isNaN(I)){console.warn("SimpleCampsiteLayer: Invalid bounds values",{north:w,south:P,east:b,west:I}),R(!1);return}const W={bounds:{north:w,south:P,east:b,west:I},types:s,maxResults:t,includeDetails:!0,vehicleFilter:M||void 0},H=await We.searchCampsites(W);if(console.log("SimpleCampsiteLayer: Search response",{status:H.status,campsiteCount:H.campsites?.length||0,bounds:W.bounds}),H.status==="success")C(H.campsites),o?.(H.campsites.length,H.campsites);else throw new Error(H.error||"Failed to load campsites")}catch(E){console.error("Error loading campsites:",E);const w=z(E);_(w),C([]),o?.(0,[])}finally{R(!1)}},[m,s,t,M,i,o,z]),ae=d.useCallback(async()=>{if(!x?.routes?.[0]?.geometry||!i)return;const D=x.routes[0].geometry;let E=1/0,w=-1/0,P=1/0,b=-1/0;D.coordinates.forEach(W=>{const[H,q]=W;E=Math.min(E,q),w=Math.max(w,q),P=Math.min(P,H),b=Math.max(b,H)});const I=.1;R(!0),_(null);try{const W={bounds:{north:w+I,south:E-I,east:b+I,west:P-I},types:s,maxResults:t,includeDetails:!0,vehicleFilter:M||void 0},H=await We.searchCampsites(W);if(H.status==="success")C(H.campsites),o?.(H.campsites.length,H.campsites);else throw new Error(H.error||"Failed to load campsites")}catch(W){console.error("Error loading route campsites:",W);const H=z(W);_(H),C([]),o?.(0,[])}finally{R(!1)}},[x,s,t,M,i,o]);d.useEffect(()=>{F.current=ne},[ne]),d.useEffect(()=>{T.current=ae},[ae]);const[v,V]=d.useState(null),[Z,se]=d.useState(0);return d.useEffect(()=>{if(!i||!m)return;const D=()=>{clearTimeout(window.campsiteDebounceTimer),window.campsiteDebounceTimer=setTimeout(()=>{const E=m.getBounds(),w=m.getZoom();if(v&&Math.abs(w-Z)<1){const b=E.getSouth(),I=E.getNorth(),W=E.getWest(),H=E.getEast(),q=v.getSouth(),te=v.getNorth(),le=v.getWest(),Y=v.getEast(),ee=Math.abs(b-q)+Math.abs(I-te),ie=Math.abs(W-le)+Math.abs(H-Y),ce=te-q,me=Y-le;if(ee<ce*.1&&ie<me*.1){console.log("SimpleCampsiteLayer: Skipping load - minor map movement");return}}V(E),se(w),F.current?.()},250)};return m.on("moveend",D),F.current?.(),()=>{m.off("moveend",D),clearTimeout(window.campsiteDebounceTimer)}},[m,i]),d.useEffect(()=>{x&&i&&T.current?.()},[x,i]),i?(console.log("SimpleCampsiteLayer: Rendering markers",{totalCampsites:J.length,isLoading:O,isVisible:i,zoom:G}),e.jsxs(e.Fragment,{children:[O&&e.jsxs("div",{className:"fixed top-24 right-4 z-50 bg-white shadow-lg rounded-lg px-4 py-2 flex items-center space-x-2 animate-fade-in",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Loading campsites..."})]}),B&&!O&&e.jsx("div",{className:"fixed top-24 right-4 z-50 max-w-sm bg-red-50 shadow-lg rounded-lg p-4 border border-red-200 animate-slide-in-right",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-red-900",children:B.message}),B.suggestion&&e.jsx("p",{className:"text-xs text-red-700 mt-1",children:B.suggestion}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[B.retryable&&e.jsxs("button",{onClick:()=>{_(null),ne()},className:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 bg-white border border-red-300 rounded hover:bg-red-50 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Retry"]}),e.jsx("button",{onClick:()=>_(null),className:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 hover:text-red-900",children:"Dismiss"})]})]}),e.jsx("button",{onClick:()=>_(null),className:"flex-shrink-0 text-red-400 hover:text-red-600 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),J.map(D=>{const E=u===D.id.toString(),w=h===D.id.toString(),P=D.isCluster,b=k(D),I=P?Rr({getChildCount:()=>D.clusterCount||0}):Ir({campsite:D,vehicleCompatible:D.vehicleCompatible,isSelected:w,isHighlighted:E,isInRoute:b,isMobile:c,showTooltip:!0});return e.jsx(Le,{position:P&&D.location?[D.location.lat,D.location.lng]:[D.lat,D.lng],icon:I,eventHandlers:{click:()=>{if(P){if(D.clusterCampsites){const W=Te.latLngBounds(D.clusterCampsites.map(H=>[H.lat,H.lng]));m.fitBounds(W,{padding:[20,20]})}}else n?.(D)}},children:e.jsx(_e,{children:P?e.jsxs("div",{className:"p-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900 text-sm mb-2",children:[D.clusterCount," Campsites"]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Click to zoom in and see individual campsites"}),e.jsxs("div",{className:"space-y-1",children:[D.clusterCampsites?.slice(0,3).map((W,H)=>e.jsxs("div",{className:"text-xs text-gray-700",children:["• ",W.name||W.type.replace("_"," ")]},H)),D.clusterCampsites&&D.clusterCampsites.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["and ",D.clusterCampsites.length-3," more..."]})]})]}):e.jsxs("div",{className:"campsite-popup-content p-3 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm leading-tight pr-2",children:D.name||`${D.type.replace("_"," ")} #${D.id}`}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${D.vehicleCompatible?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:D.vehicleCompatible?"✓ Compatible":"⚠ Check Size"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs text-gray-600 capitalize mb-1",children:D.type.replace("_"," ")}),D.address&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["📍 ",D.address]}),D.phone&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["📞 ",D.phone]}),D.website&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["🌐 ",e.jsx("a",{href:D.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"Website"})]}),D.opening_hours&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["🕒 ",D.opening_hours]})]}),D.amenities&&Object.keys(D.amenities).length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 mb-1",children:"Amenities:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(D.amenities).filter(([W,H])=>H).map(([W])=>e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded",children:W.replace(/_/g," ")},W))})]}),!D.vehicleCompatible&&D.restrictions&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:[e.jsx("div",{className:"text-xs font-medium text-red-800 mb-1",children:"⚠️ Vehicle Restrictions:"}),e.jsx("div",{className:"text-xs text-red-700",children:D.restrictions})]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:k(D)?e.jsxs("div",{className:"flex items-center justify-center py-2 px-3 bg-green-50 text-green-700 rounded-md text-xs font-medium",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Already in route"]}):e.jsxs("button",{onClick:W=>g(D,W),className:"w-full flex items-center justify-center py-2 px-3 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add to Route"]})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Data from ",D.source," • ID: ",D.osmId||D.id]})]})})},D.id)})]})):null},be=[{type:"campsite",label:"Campsites",icon:"⛺",description:"Traditional camping with tents/caravans"},{type:"caravan_site",label:"Caravan Sites",icon:"🚐",description:"Sites specifically for caravans/motorhomes"},{type:"aire",label:"Aires de Service",icon:"🅿️",description:"Motorhome service areas with facilities"}],$r=[25,50,100,200,500],Fr=({className:s,visibleTypes:t,onTypesChange:r,maxResults:a,onMaxResultsChange:i,vehicleCompatibleOnly:n,onVehicleCompatibleChange:o,isVisible:c=!0,onVisibilityChange:l,onRefresh:u,isLoading:h=!1,campsiteCount:m=0})=>{const[x,p]=d.useState(!1),N=y=>{t.includes(y)?r(t.filter(k=>k!==y)):r([...t,y])},M=()=>{t.length===be.length?r([]):r(be.map(y=>y.type))};return e.jsxs("div",{className:L("bg-white rounded-lg shadow-sm border border-gray-200",s),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>l?.(!c),className:L("flex items-center space-x-2 px-2 py-1 rounded text-sm font-medium transition-colors",c?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e.jsx("div",{className:"text-base",children:"🏕️"}),e.jsx("span",{children:"Campsites"}),c&&m>0&&e.jsx("span",{className:"bg-green-200 text-green-800 px-1.5 py-0.5 rounded-full text-xs font-medium",children:m})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.length,"/",be.length," types)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[u&&e.jsx("button",{onClick:u,disabled:h,className:L("p-1.5 rounded text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors",h&&"cursor-not-allowed opacity-50"),title:"Refresh campsite data",children:e.jsx("svg",{className:L("w-4 h-4",h&&"animate-spin"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("button",{onClick:()=>p(!x),className:"p-1.5 rounded text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:L("w-4 h-4 transform transition-transform",x&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),!x&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:be.map(({type:y,icon:k})=>e.jsx("button",{onClick:()=>N(y),className:L("flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all",t.includes(y)?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-gray-50 text-gray-400 hover:border-gray-400"),title:be.find(g=>g.type===y)?.label,children:e.jsx("span",{className:"text-sm",children:k})},y))}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Max: ",a," • ",n?"Compatible only":"All sites"]})]})}),x&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Campsite Types"}),e.jsx("button",{onClick:M,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:t.length===be.length?"None":"All"})]}),e.jsx("div",{className:"space-y-2",children:be.map(({type:y,label:k,icon:g,description:j})=>e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.includes(y),onChange:()=>N(y),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:g}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:k})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:j})]})]},y))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:y=>o(y.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Vehicle Compatible Only"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Show only campsites that can accommodate your vehicle dimensions"})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Maximum Results: ",a]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:25,max:500,step:25,value:a,onChange:y=>i(parseInt(y.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),e.jsx("select",{value:a,onChange:y=>i(parseInt(y.target.value)),className:"text-xs border border-gray-300 rounded px-2 py-1 bg-white",children:$r.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"25"}),e.jsx("span",{children:"500"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Map Legend"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Campsite (tent/caravan)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#3b82f6",stroke:"#2563eb",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Caravan/Motorhome site"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#8b5cf6",stroke:"#7c3aed",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Aire de Service"})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#ef4444",stroke:"#dc2626",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"May not fit your vehicle"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 text-white text-[8px] font-bold flex items-center justify-center border-2 border-white shadow",children:"3"})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Clustered markers (zoom in)"})]})]})]})]})]})]})},Kt={booking:{provider:"Booking.com",baseUrl:"https://www.booking.com",trackingParams:{aid:"camper-planner",label:"camping-search"},enabled:!1},pitchup:{provider:"Pitchup",baseUrl:"https://www.pitchup.com",trackingParams:{utm_source:"camper-planner",utm_medium:"referral"},enabled:!1},coolcamping:{provider:"Cool Camping",baseUrl:"https://www.coolcamping.com",trackingParams:{ref:"camper-planner"},enabled:!1}},Xt={electricity:{icon:"⚡",label:"Power"},wifi:{icon:"📶",label:"WiFi"},showers:{icon:"🚿",label:"Showers"},toilets:{icon:"🚻",label:"Toilets"},drinking_water:{icon:"🚰",label:"Water"},waste_disposal:{icon:"🗑️",label:"Waste"},laundry:{icon:"👕",label:"Laundry"},restaurant:{icon:"🍽️",label:"Food"},shop:{icon:"🛒",label:"Shop"},playground:{icon:"🎠",label:"Kids"},swimming_pool:{icon:"🏊",label:"Pool"},pet_allowed:{icon:"🐕",label:"Pets OK"}},Br=["electricity","showers","wifi","toilets","drinking_water","waste_disposal","shop","restaurant"],Or=({campsite:s,onClose:t,onAddAsWaypoint:r,onExportData:a,className:i})=>{const[n,o]=d.useState(!1),[c,l]=d.useState(!1),u=d.useRef(null),{addWaypoint:h,waypoints:m}=re(),{profile:x}=oe(),{addNotification:p}=de(),N=m.some(F=>Math.abs(F.lat-s.lat)<1e-4&&Math.abs(F.lng-s.lng)<1e-4),M=d.useCallback(()=>{if(N){p({type:"warning",message:"This campsite is already in your route"});return}const F={id:`campsite_${s.id}`,lat:s.lat,lng:s.lng,name:s.name||`${s.type} #${s.id}`,type:"waypoint"};h(F),r?.(s),p({type:"success",message:`Added ${F.name} to your route`})},[s,N,h,r,p]),y=d.useCallback(()=>{s.contact?.website?window.open(s.contact.website,"_blank"):u.current&&u.current.scrollIntoView({behavior:"smooth"})},[s.contact?.website]),k=d.useCallback(()=>{const F=`${s.lat.toFixed(6)}, ${s.lng.toFixed(6)}`;navigator.clipboard.writeText(F),p({type:"success",message:"Coordinates copied to clipboard"})},[s.lat,s.lng,p]),g=d.useCallback(()=>{const F={campsite:{id:s.id,name:s.name,type:s.type,location:{lat:s.lat,lng:s.lng},address:s.address,phone:s.contact?.phone,website:s.contact?.website,email:s.contact?.email,openingHours:s.opening_hours,amenities:s.amenities,access:s.access,source:s.source},exportedAt:new Date().toISOString(),exportedBy:"European Camper Trip Planner"},T=new Blob([JSON.stringify(F,null,2)],{type:"application/json"}),z=URL.createObjectURL(T),X=document.createElement("a");X.href=z,X.download=`campsite_${s.id}_${s.name?.replace(/[^a-zA-Z0-9]/g,"_")||"unnamed"}.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(z),a?.(s),p({type:"success",message:"Campsite data exported successfully"})},[s,a,p]),j=d.useCallback(F=>{const T=Kt[F];if(!T||!T.enabled)return null;const z=new URLSearchParams(T.trackingParams);return s.name&&z.append("ss",s.name),s.address&&z.append("dest_id",s.address),`${T.baseUrl}/search?${z.toString()}`},[s]),C=()=>`https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}`,O=s.access&&(s.access.max_height||s.access.max_length||s.access.max_weight),R=x&&O&&(s.access?.max_height&&x.height>s.access.max_height||s.access?.max_length&&x.length>s.access.max_length||s.access?.max_weight&&x.weight>s.access.max_weight),B=s.amenities?Object.entries(s.amenities):[],_=B.filter(([F,T])=>T).map(([F])=>F),G=Br.filter(F=>s.amenities&&s.amenities[F]),A=typeof window<"u"&&window.innerWidth<640;return e.jsxs("div",{className:L("bg-white shadow-lg border border-gray-200 overflow-hidden flex flex-col",A?"rounded-t-2xl":"rounded-lg",i),children:[A&&e.jsx("div",{className:"flex justify-center py-2 bg-gray-50",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-semibold truncate",children:s.name||`${s.type.replace("_"," ")} #${s.id}`}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1 text-sm text-green-100",children:[e.jsx("span",{className:"capitalize",children:s.type.replace("_"," ")}),e.jsx("span",{className:L("px-2 py-0.5 rounded-full text-xs font-medium",s.access?.motorhome?"bg-green-700 text-green-100":"bg-orange-500 text-white"),children:s.access?.motorhome?"✓ Vehicle OK":"⚠ Check Size"})]})]}),t&&e.jsx("button",{onClick:t,className:"p-1 hover:bg-green-700 rounded transition-colors ml-2","aria-label":"Close details",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:L("flex items-center gap-2 mt-3",A&&"flex-col w-full"),children:[e.jsx("button",{onClick:M,disabled:N,className:L("flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-colors",A?"w-full":"flex-1",N?"bg-green-700 text-green-300 cursor-default":"bg-white text-green-600 hover:bg-green-50 active:bg-green-100"),children:N?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"In Route"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add to Route"})]})}),e.jsxs("button",{onClick:y,className:L("flex items-center justify-center gap-2 px-4 py-2.5 bg-green-700 text-white rounded-lg font-medium hover:bg-green-800 transition-colors",A?"w-full":"flex-1"),children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Book Now"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[G.length>0&&e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:G.slice(0,8).map(F=>{const T=Xt[F];return e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-green-50 text-green-800 rounded-lg text-sm",title:T?.label||F,children:[e.jsx("span",{className:"text-base",children:T?.icon||"•"}),e.jsx("span",{className:"font-medium",children:T?.label||F.replace(/_/g," ")})]},F)})})}),e.jsxs("div",{className:"p-4 space-y-3 border-b border-gray-100",children:[s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("svg",{className:"w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"text-sm text-gray-700",children:s.address})]}),s.opening_hours&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-gray-700",children:s.opening_hours})]}),!s.address&&!s.opening_hours&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("span",{className:"text-sm text-gray-500 italic",children:s.type==="aire"?"Motorhome service area with facilities":s.type==="caravan_site"?"Caravan and motorhome site":"Camping site"})]})]}),O&&e.jsx("div",{className:L("p-4 border-b",R?"bg-red-50 border-red-100":"bg-orange-50 border-orange-100"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:L("w-5 h-5 mt-0.5 flex-shrink-0",R?"text-red-600":"text-orange-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{children:[e.jsx("div",{className:L("text-sm font-medium",R?"text-red-800":"text-orange-800"),children:R?"Vehicle may not fit!":"Size restrictions"}),e.jsxs("div",{className:L("text-sm mt-1 space-y-0.5",R?"text-red-700":"text-orange-700"),children:[s.access?.max_height&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max height: ",s.access.max_height,"m"]}),x&&e.jsxs("span",{className:L("text-xs px-1.5 py-0.5 rounded",x.height>s.access.max_height?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",x.height,"m"]})]}),s.access?.max_length&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max length: ",s.access.max_length,"m"]}),x&&e.jsxs("span",{className:L("text-xs px-1.5 py-0.5 rounded",x.length>s.access.max_length?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",x.length,"m"]})]}),s.access?.max_weight&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max weight: ",s.access.max_weight,"t"]}),x&&e.jsxs("span",{className:L("text-xs px-1.5 py-0.5 rounded",x.weight>s.access.max_weight?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",x.weight,"t"]})]})]})]})]})}),s.access?.motorhome&&x&&!O&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("span",{className:"font-medium",children:"Compatible"}),e.jsxs("span",{className:"text-green-700",children:[" with your ",x.height,"m × ",x.length,"m vehicle"]})]})]})}),B.length>0&&e.jsxs("div",{className:"border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>o(!n),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["All Amenities (",_.length,"/",B.length," available)"]})]}),e.jsx("svg",{className:L("w-5 h-5 text-gray-400 transition-transform",n&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&e.jsxs("div",{className:"px-4 pb-4",children:[_.length===0&&e.jsx("div",{className:"mb-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-700",children:"ℹ️ Amenity data not available from OpenStreetMap. Check the campsite website for details."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:B.map(([F,T])=>{const z=Xt[F],X=T===!0;return e.jsxs("div",{className:L("flex items-center gap-2 p-2 rounded text-sm",X?"bg-green-50 text-green-800 border border-green-200":"bg-gray-50 text-gray-500 border border-gray-200"),children:[e.jsx("span",{className:"text-base",children:z?.icon||"•"}),e.jsx("span",{className:"flex-1 capitalize",children:z?.label||F.replace(/_/g," ")}),X?e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("span",{className:"w-4 h-4 flex items-center justify-center text-gray-400 font-medium text-xs",children:"?"})]},F)})})]})]}),(s.contact?.phone||s.contact?.website||s.contact?.email)&&e.jsxs("div",{className:"border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>l(!c),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Contact Details"})]}),e.jsx("svg",{className:L("w-5 h-5 text-gray-400 transition-transform",c&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[s.contact?.phone&&e.jsxs("a",{href:`tel:${s.contact.phone.replace(/[^\d+]/g,"")}`,className:"flex items-center gap-3 text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx("span",{children:"📞"}),e.jsx("span",{children:s.contact.phone})]}),s.contact?.email&&e.jsxs("a",{href:`mailto:${s.contact.email}`,className:"flex items-center gap-3 text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx("span",{children:"✉️"}),e.jsx("span",{children:s.contact.email})]}),s.contact?.website&&e.jsxs("a",{href:s.contact.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx("span",{children:"🌐"}),e.jsx("span",{className:"truncate",children:s.contact.website.replace(/^https?:\/\//,"")})]})]})]}),e.jsxs("div",{ref:u,className:"p-4 border-b border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Book This Campsite"]}),s.contact?.website&&e.jsxs("a",{href:s.contact.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium mb-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),e.jsx("span",{children:"Visit Official Website"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"Search on booking platforms:"}),Object.entries(Kt).map(([F,T])=>e.jsxs("button",{disabled:!T.enabled,className:L("w-full flex items-center justify-between p-3 border rounded-lg text-sm transition-colors",T.enabled?"border-blue-200 bg-blue-50 text-blue-800 hover:bg-blue-100":"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed"),onClick:()=>{if(T.enabled){const z=j(F);z&&window.open(z,"_blank")}},children:[e.jsx("span",{children:T.provider}),T.enabled?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}):e.jsx("span",{className:"text-xs",children:"Coming Soon"})]},F))]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-xs text-blue-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"💡 Booking Tips:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"• Check availability directly with the campsite"}),e.jsx("li",{children:"• Book in advance during peak season"}),e.jsx("li",{children:"• Confirm vehicle size restrictions"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("a",{href:C(),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),e.jsx("span",{children:"Get Directions in Google Maps"})]})}),e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Data from ",s.source||"OpenStreetMap"]})}),e.jsxs("button",{onClick:k,className:"flex items-center gap-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy coordinates",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),e.jsx("span",{children:"Copy coords"})]})]}),e.jsxs("button",{onClick:g,className:"w-full flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-600 hover:bg-gray-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"Export Campsite Data"})]})]})]})]})},Wr=[{id:"welcome",title:"Welcome to Camper Planner! 🚐",content:"Plan your perfect European camping trip by clicking on the map to add waypoints.",action:"Click anywhere on the map to start",icon:"🗺️",dismissible:!0},{id:"first-waypoint",title:"Great start! 🎯",content:"You've added your first waypoint. Add more points to create your route.",action:"Click another location to continue",icon:"📍"},{id:"route-ready",title:"Route ready! 🛣️",content:"Perfect! You now have a route. Use the controls to zoom, add layers, or go fullscreen.",action:"Try the map controls on the right",icon:"✨"}],_r={mapInteraction:{title:"Map Interaction Tips",items:["Click anywhere to add a waypoint","Drag waypoints to reposition them","Right-click for context menu options","Use mouse wheel to zoom in/out","Hold Shift and drag to pan quickly"]},waypointManagement:{title:"Waypoint Management",items:["First point becomes your start location","Last point becomes your destination","Numbers show the route sequence","Edit names and add notes in popups","Use Ctrl+Z to undo actions"]},vehicleProfile:{title:"Vehicle Configuration",items:["Click the vehicle button (top-left) to set up your camper","Choose from presets or enter custom dimensions","Accurate dimensions ensure safe routing","Toggle between metric and imperial units","Profile is saved automatically"]},keyboardShortcuts:{title:"Keyboard Shortcuts",items:["+/- to zoom in/out","Arrow keys to pan the map","Ctrl+F to zoom to fit all waypoints","Ctrl+R to reset map view","Alt+F for fullscreen mode"]}},Vr=({className:s})=>{const{waypoints:t}=re(),{profile:r}=oe(),{addNotification:a}=de(),[i,n]=d.useState(null),[o,c]=d.useState(new Set),[l,u]=d.useState(!1),[h,m]=d.useState(!1);d.useEffect(()=>{localStorage.getItem("camper-planner-visited")||(m(!0),n("welcome"),localStorage.setItem("camper-planner-visited","true"));const y=localStorage.getItem("camper-planner-dismissed-steps");y&&c(new Set(JSON.parse(y)))},[]),d.useEffect(()=>{o.has("welcome")||!h||(t.length===1&&i==="welcome"?n("first-waypoint"):t.length>=2&&i==="first-waypoint"&&(n("route-ready"),setTimeout(()=>{x("route-ready")},3e3)))},[t.length,i,o,h]);const x=M=>{const y=new Set([...o,M]);c(y),localStorage.setItem("camper-planner-dismissed-steps",JSON.stringify([...y])),i===M&&n(null)},p=Wr.find(M=>M.id===i),N=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"💡 Quick Tips"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(_r).map(([M,y])=>e.jsxs("div",{className:"border-b border-gray-100 last:border-0 pb-3 last:pb-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:y.title}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:y.items.map((k,g)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-500 mr-2",children:"•"}),k]},g))})]},M))}),!1]});return e.jsxs("div",{className:L("relative",s),children:[p&&!o.has(p.id)&&e.jsx("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-blue-600 text-white rounded-lg shadow-lg p-4 border border-blue-500 animate-fade-in",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[p.icon&&e.jsx("span",{className:"text-xl mr-2",children:p.icon}),e.jsx("h3",{className:"font-semibold",children:p.title})]}),p.dismissible&&e.jsx("button",{onClick:()=>x(p.id),className:"text-blue-200 hover:text-white p-1 rounded transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-blue-100 mb-3",children:p.content}),p.action&&e.jsxs("div",{className:"text-sm text-blue-200 bg-blue-700 bg-opacity-50 rounded px-3 py-2",children:["💡 ",p.action]}),!p.dismissible&&e.jsx("button",{onClick:()=>x(p.id),className:"mt-3 w-full bg-blue-500 hover:bg-blue-400 text-white py-2 px-4 rounded text-sm font-medium transition-colors",children:"Got it!"})]})}),e.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:e.jsx(it,{content:"Get help and tips",position:"left",size:"sm",children:e.jsx("button",{onClick:()=>u(!l),className:L("w-12 h-12 bg-white rounded-full shadow-lg border border-gray-200","flex items-center justify-center transition-all duration-200","hover:bg-blue-50 hover:border-blue-300 hover:scale-105",l&&"bg-blue-50 border-blue-300 scale-105"),"aria-label":"Toggle help panel",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})})}),l&&e.jsx("div",{className:"fixed bottom-20 right-4 z-50 animate-fade-in",children:e.jsx(N,{})})]})};class Fe extends d.Component{constructor(r){super(r);Pe(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){console.error("Component Error Boundary caught an error:",{component:this.props.componentName||"Unknown",error:r.message,stack:r.stack,componentStack:a.componentStack}),this.setState({error:r,errorInfo:a}),this.props.onError&&this.props.onError(r,a)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 m-2",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Component Error"}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsxs("p",{children:[this.props.componentName?`The ${this.props.componentName} component`:"A component"," encountered an error and couldn't render properly."]}),!1]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:this.handleRetry,className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors",children:"Try Again"})})]})]})}):this.props.children}}const Hr=({map:s,visibleTypes:t,onCampsiteSelect:r,onCampsiteHover:a,onLocationSelect:i,className:n})=>{const{addWaypoint:o,waypoints:c}=re(),{profile:l}=oe(),{addNotification:u}=de(),{setCenter:h,setZoom:m}=ot(),[x,p]=d.useState(""),[N,M]=d.useState(!1),[y,k]=d.useState([]),[g,j]=d.useState(!1),[C,O]=d.useState(-1),[R,B]=d.useState([]),[_,G]=d.useState(null),A=d.useRef(null),F=d.useRef(null),T=d.useRef("");d.useEffect(()=>{const w=localStorage.getItem("camper-planner-unified-search-history");if(w)try{B(JSON.parse(w))}catch{}},[]);const z=d.useCallback(w=>{if(w.trim().length<2)return;const P=[w,...R.filter(b=>b!==w)].slice(0,10);B(P),localStorage.setItem("camper-planner-unified-search-history",JSON.stringify(P))},[R]),X=d.useCallback((w,P,b,I)=>{const H=(b-w)*Math.PI/180,q=(I-P)*Math.PI/180,te=Math.sin(H/2)*Math.sin(H/2)+Math.cos(w*Math.PI/180)*Math.cos(b*Math.PI/180)*Math.sin(q/2)*Math.sin(q/2);return 6371*(2*Math.atan2(Math.sqrt(te),Math.sqrt(1-te)))},[]),K=d.useCallback(w=>c.some(P=>Math.abs(P.lat-w.lat)<1e-4&&Math.abs(P.lng-w.lng)<1e-4),[c]),J=d.useCallback(async w=>{if(w.trim().length<2){k([]);return}if(N&&T.current===w.trim())return;T.current=w.trim(),M(!0),G(null);const P=[];let b=s?.getCenter(),I=null;try{let W=[];try{W=await We.geocodeLocationMultiple(w,5)}catch(le){console.error("Geocoding failed:",le),G("Unable to search locations. Please try again.")}if(W.length>0){const le=(ee,ie)=>ee>=34&&ee<=72&&ie>=-25&&ie<=45,Y=[...W].sort((ee,ie)=>{const ce=le(ee.lat,ee.lng),me=le(ie.lat,ie.lng);return ce&&!me?-1:!ce&&me?1:(ie.importance||0)-(ee.importance||0)});Y.forEach(ee=>{P.push({type:"location",id:`location-${ee.lat}-${ee.lng}`,name:ee.name||ee.display_name.split(",")[0],description:ee.display_name,lat:ee.lat,lng:ee.lng})}),I=Te.latLng(Y[0].lat,Y[0].lng),b=I}const q={bounds:b?{north:b.lat+1,south:b.lat-1,east:b.lng+1.5,west:b.lng-1.5}:{north:72,south:34,east:45,west:-25},types:t,maxResults:20,includeDetails:!0,vehicleFilter:l||void 0},te=await We.searchCampsites(q);if(te.status==="success"){const le=te.campsites.map(Y=>{const ee=b?X(b.lat,b.lng,Y.lat,Y.lng):void 0;return{type:"campsite",id:Y.id.toString(),name:Y.name||`${Y.type.replace("_"," ")} #${Y.id}`,description:Y.address||Y.type.replace("_"," "),lat:Y.lat,lng:Y.lng,distance:ee,campsite:Y,vehicleCompatible:Y.vehicleCompatible}}).filter(Y=>{const ee=Y.name.toLowerCase().includes(w.toLowerCase())||Y.description?.toLowerCase().includes(w.toLowerCase()),ie=Y.distance!==void 0&&Y.distance<=100;return ee||ie}).sort((Y,ee)=>{const ie=Y.name.toLowerCase().includes(w.toLowerCase())?1:0,ce=ee.name.toLowerCase().includes(w.toLowerCase())?1:0;return ce!==ie?ce-ie:(Y.distance??1/0)-(ee.distance??1/0)}).slice(0,10);P.push(...le)}k(P),j(!0)}catch(W){console.error("Search error:",W),k([])}finally{M(!1)}},[s,t,l,X,N]);d.useEffect(()=>{const w=setTimeout(()=>{x.trim()?J(x):(k([]),T.current="")},300);return()=>clearTimeout(w)},[x]);const ne=d.useCallback(w=>{p(w.target.value),O(-1),j(w.target.value.trim().length>=2)},[]),ae=d.useCallback(w=>{if(z(x),j(!1),w.type==="location")h([w.lat,w.lng]),m(10),s&&s.setView([w.lat,w.lng],10,{animate:!0}),i?.({lat:w.lat,lng:w.lng,name:w.name}),u({type:"success",message:`Navigated to ${w.name}`});else if(w.campsite){const P=s?Math.max(s.getZoom(),14):14;h([w.lat,w.lng]),m(P),s&&s.setView([w.lat,w.lng],P,{animate:!0}),r?.(w.campsite)}},[s,x,z,i,r,u,h,m]),v=d.useCallback((w,P)=>{if(P.stopPropagation(),c.some(W=>Math.abs(W.lat-w.lat)<1e-4&&Math.abs(W.lng-w.lng)<1e-4)){u({type:"warning",message:`${w.name} is already in your route`});return}const I={id:`location-${Date.now()}`,lat:w.lat,lng:w.lng,type:"waypoint",name:w.name,notes:w.description||""};o(I),u({type:"success",message:`Added "${w.name}" to your route`}),h([w.lat,w.lng]),m(10),s&&s.setView([w.lat,w.lng],10),j(!1)},[o,u,c,s,h,m]),V=d.useCallback((w,P)=>{if(P.stopPropagation(),!w.campsite)return;if(K(w.campsite)){u({type:"warning",message:`${w.name} is already in your route`});return}const b={id:`campsite-${w.id}-${Date.now()}`,lat:w.lat,lng:w.lng,type:"campsite",name:w.name,notes:w.description||""};o(b),u({type:"success",message:`Added "${w.name}" to your route`}),j(!1)},[o,u,K]),Z=d.useCallback(w=>{if(!(!g||y.length===0))switch(w.key){case"ArrowDown":w.preventDefault(),O(P=>Math.min(P+1,y.length-1));break;case"ArrowUp":w.preventDefault(),O(P=>Math.max(P-1,-1));break;case"Enter":if(w.preventDefault(),N)return;C>=0&&C<y.length?ae(y[C]):y.length>0&&ae(y[0]);break;case"Escape":j(!1),O(-1),A.current?.blur();break}},[g,y,C,ae,N]),se=d.useCallback(()=>{p(""),k([]),j(!1),O(-1)},[]),D=y.filter(w=>w.type==="location"),E=y.filter(w=>w.type==="campsite");return e.jsxs("div",{className:L("relative",n),children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"pl-4 pr-2 py-3",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{ref:A,type:"text",value:x,onChange:ne,onKeyDown:Z,onFocus:()=>j(x.trim().length>=2||R.length>0),onBlur:()=>setTimeout(()=>j(!1),200),placeholder:"Search for a location or campsite...",className:"flex-1 py-3 pr-4 text-sm bg-transparent border-0 focus:ring-0 focus:outline-none placeholder-gray-500"}),x&&e.jsx("button",{onClick:se,className:"px-3 py-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),N&&e.jsx("div",{className:"px-3",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 border-t-transparent rounded-full"})})]})}),g&&(y.length>0||R.length>0||_)&&e.jsxs("div",{ref:F,className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-96 overflow-y-auto",onMouseDown:w=>w.preventDefault(),children:[_&&e.jsxs("div",{className:"px-4 py-3 bg-amber-50 border-b border-amber-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm text-amber-700",children:_})]}),e.jsx("button",{onClick:()=>{G(null),J(x)},className:"text-xs text-amber-700 hover:text-amber-900 underline font-medium",children:"Retry"})]}),D.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 border-b border-gray-100 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),"LOCATIONS"]}),D.map((w,P)=>{const b=c.some(I=>Math.abs(I.lat-w.lat)<1e-4&&Math.abs(I.lng-w.lng)<1e-4);return e.jsxs("div",{className:L("w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-50",C===P&&"bg-blue-50"),children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0 cursor-pointer",onClick:()=>ae(w),role:"button",tabIndex:0,onKeyDown:I=>I.key==="Enter"&&ae(w),children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:w.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",title:w.description,children:w.description||"Go to this location"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2 flex-shrink-0",children:[e.jsx("button",{onClick:I=>{I.stopPropagation(),I.preventDefault(),ae(w)},onMouseDown:I=>I.stopPropagation(),className:"px-2 py-1 text-xs text-blue-600 hover:bg-blue-50 rounded font-medium transition-colors",children:"Go"}),b?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded font-medium",children:"In Route"}):e.jsx("button",{onClick:I=>v(w,I),className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded font-medium hover:bg-blue-200 transition-colors",children:"+ Add"})]})]},w.id)})]}),E.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 border-b border-gray-100 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"CAMPSITES (",E.length,")"]}),E.map((w,P)=>{const b=D.length+P,I=w.campsite&&K(w.campsite);return e.jsxs("div",{onMouseEnter:()=>a?.(w.id),onMouseLeave:()=>a?.(null),className:L("w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-50",C===b&&"bg-green-50"),children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0 cursor-pointer",onClick:()=>ae(w),role:"button",tabIndex:0,onKeyDown:W=>W.key==="Enter"&&ae(w),children:[e.jsx("div",{className:L("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",w.vehicleCompatible?"bg-green-100":"bg-red-100"),children:e.jsx("svg",{className:L("w-4 h-4",w.vehicleCompatible?"text-green-600":"text-red-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:w.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center space-x-2",children:[e.jsx("span",{className:"truncate",children:w.description}),w.distance!==void 0&&e.jsxs("span",{className:"flex-shrink-0",children:["• ",w.distance<1?`${Math.round(w.distance*1e3)}m`:`${w.distance.toFixed(1)}km`]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2 flex-shrink-0",children:[w.vehicleCompatible?e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"✓"}):e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"⚠"}),I?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded font-medium",children:"In Route"}):e.jsx("button",{onClick:W=>V(w,W),className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded font-medium hover:bg-blue-200 transition-colors",children:"+ Add"})]})]},w.id)})]}),y.length===0&&x.trim().length>=2&&!N&&e.jsxs("div",{className:"px-4 py-6 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("p",{className:"text-sm text-gray-500",children:['No results found for "',x,'"']}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Try a different search term"})]}),x.trim().length<2&&R.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 border-b border-gray-100 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"RECENT SEARCHES"]}),R.slice(0,5).map(w=>e.jsxs("button",{onClick:()=>p(w),className:"w-full px-4 py-3 text-left flex items-center space-x-3 hover:bg-gray-50 transition-colors border-b border-gray-50",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-gray-700",children:w})]},w))]})]})]})},Ur="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",Gr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",qr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg==";Te.Icon.Default.mergeOptions({iconUrl:Ur,iconRetinaUrl:qr,shadowUrl:Gr});const Be={defaultCenter:[54.526,15.2551],defaultZoom:5,minZoom:3,maxZoom:19,maxBounds:[[34,-25],[72,45]]},Zr=({onMapMove:s})=>{const t=lt();return Qt({moveend:()=>{const r=t.getCenter(),a=t.getZoom();s([r.lat,r.lng],a)},zoomend:()=>{const r=t.getCenter(),a=t.getZoom();s([r.lat,r.lng],a)}}),null},Kr=({onMapReady:s})=>{const t=lt();return d.useEffect(()=>{s(t)},[t,s]),null},Xr=()=>{const s=lt(),{center:t,zoom:r}=ot(),a=d.useRef(t),i=d.useRef(r);return d.useEffect(()=>{(t[0]!==a.current[0]||t[1]!==a.current[1])&&(s.setView(t,r),a.current=t)},[t,s,r]),d.useEffect(()=>{r!==i.current&&(s.setZoom(r),i.current=r)},[r,s]),null},Jr=()=>{const{center:s,zoom:t,setCenter:r,setZoom:a}=ot(),{waypoints:i,clearRoute:n,undo:o,redo:c,canUndo:l,canRedo:u,isValidForRouting:h,calculatedRoute:m}=re(),{addNotification:x}=de(),[p,N]=d.useState(!1),[M,y]=d.useState(!1),[k,g]=d.useState("openstreetmap"),[j,C]=d.useState(!1),[O,R]=d.useState(!0),[B,_]=d.useState(!1),[G,A]=d.useState("info"),F=d.useRef(null),[T,z]=d.useState(null),X=S=>{z(S),F.current=S},[K,J]=d.useState(null),[ne,ae]=d.useState(null),[v,V]=d.useState(pe.CAMPSITE_DISPLAY),[Z,se]=d.useState(!1),[D,E]=d.useState(!1),[w,P]=d.useState(!1),[b,I]=d.useState(pe.CAMPSITE_DISPLAY),[W,H]=d.useState(0),[q,te]=d.useState(Mt),[le,Y]=d.useState([]),[ee,ie]=d.useState(!1),[ce,me]=d.useState(!1),[Ee,je]=d.useState(!1),[Ie,qe]=d.useState(!1),[ct,dt]=d.useState(!1);d.useEffect(()=>{const S=bt.getMapState();S&&(r(S.center),a(S.zoom),S.layerId&&g(S.layerId),S.isFullscreen!==void 0&&C(S.isFullscreen),S.layerControlCollapsed!==void 0&&R(S.layerControlCollapsed))},[r,a]),d.useEffect(()=>{const S=()=>{const Q=document.fullscreenElement!==null;Q!==j&&C(Q)};return document.addEventListener("fullscreenchange",S),()=>document.removeEventListener("fullscreenchange",S)},[j]),d.useEffect(()=>{const S=()=>dt(window.innerWidth<768);return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]),d.useEffect(()=>{const S=setTimeout(()=>{p||(console.warn("Map ready timeout - forcing map to be visible"),N(!0))},2e3);return()=>clearTimeout(S)},[p]);const Re=(S,Q)=>{r(S),a(Q),bt.saveMapState({center:S,zoom:Q,timestamp:Date.now(),layerId:k,isFullscreen:j,layerControlCollapsed:O})},fe=async()=>{try{j?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(S){console.warn("Fullscreen not supported or denied:",S),x({type:"warning",message:"Fullscreen mode not supported in this browser"})}},Ze=()=>{r(Be.defaultCenter),a(Be.defaultZoom),x({type:"info",message:"Map view reset to Europe"})},Ae=()=>{R(!O)},he=S=>{g(S),bt.saveMapState({center:s,zoom:t,timestamp:Date.now(),layerId:S,isFullscreen:j,layerControlCollapsed:O})},ge=()=>{N(!0)},ze=S=>{J(S),E(!0),P(!1),x({type:"info",message:`Selected ${S.name||S.type}`})},f=(S,Q)=>{H(S),Q&&Y(Q)},$=()=>{E(!1),J(null)};return e.jsxs("div",{className:L("h-full relative transition-all duration-300",j&&"fixed inset-0 z-50 bg-black"),children:[!p&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading European map..."})]})}),e.jsxs(ys,{ref:F,center:s,zoom:t,minZoom:Be.minZoom,maxZoom:Be.maxZoom,maxBounds:Be.maxBounds,maxBoundsViscosity:1,className:"h-full w-full z-map",zoomControl:!1,whenReady:ge,style:{height:"100%",width:"100%"},children:[e.jsx(ir,{currentLayerId:k,onLayerChange:he,collapsed:O,onToggleCollapse:Ae}),e.jsx(Zr,{onMapMove:Re}),e.jsx(Xr,{}),e.jsx(Kr,{onMapReady:X}),e.jsx(nr,{}),e.jsx(Pr,{visibleTypes:q.visibleTypes,maxResults:q.maxResults,vehicleCompatibleOnly:q.vehicleCompatibleOnly,searchQuery:"",isVisible:b,onCampsiteClick:ze,onCampsitesLoaded:f,isMobile:ct,filterState:Z?q:void 0,highlightedCampsiteId:ne,selectedCampsiteId:K?.id?.toString()||null})]}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-30 w-full max-w-md px-4 hidden md:block",children:e.jsx(Fe,{componentName:"UnifiedSearch",children:e.jsx(Hr,{map:T,visibleTypes:q.visibleTypes,onCampsiteSelect:ze,onCampsiteHover:ae,onLocationSelect:S=>{x({type:"info",message:`Navigated to ${S.name}`})}})})}),i.length===0&&p&&e.jsx("div",{className:"absolute bottom-24 left-1/2 transform -translate-x-1/2 z-20 pointer-events-none hidden sm:block animate-fade-in",children:e.jsx("div",{className:"bg-white/95 backdrop-blur-sm px-5 py-3 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Start your trip"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Right-click on the map to add waypoints, or search for a location above"})]})]})})}),e.jsx(Fe,{componentName:"VehicleProfileSidebar",children:e.jsx(xr,{})}),e.jsx("div",{className:"absolute top-4 right-14 z-20 w-64 hidden lg:block",children:e.jsx(Fe,{componentName:"RouteCalculator",children:e.jsx(gr,{})})}),v&&!Z&&e.jsx("div",{className:"absolute top-4 left-16 z-20 w-72 hidden md:block",children:e.jsx(Fe,{componentName:"CampsiteControls",children:e.jsx(Fr,{visibleTypes:q.visibleTypes,onTypesChange:S=>te({...q,visibleTypes:S}),maxResults:q.maxResults,onMaxResultsChange:S=>te({...q,maxResults:S}),vehicleCompatibleOnly:q.vehicleCompatibleOnly,onVehicleCompatibleChange:S=>te({...q,vehicleCompatibleOnly:S}),isVisible:b,onVisibilityChange:I,campsiteCount:W})})}),Z&&e.jsx("div",{className:"absolute top-4 left-16 z-20 w-80 hidden md:block",children:e.jsx(Fe,{componentName:"CampsiteFilter",children:e.jsx(Tr,{filterState:q,onFilterChange:te,onSearchChange:S=>te({...q,searchQuery:S}),onCampsiteSelect:ze,campsiteCount:W})})}),m?.restrictions?.violatedDimensions?.length&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 w-96 max-w-full",children:e.jsx(pr,{restrictions:m.restrictions,className:"shadow-xl"})}),e.jsx(mr,{map:F.current,isFullscreen:j,onToggleFullscreen:fe,onResetView:Ze,onToggleLayerControl:Ae,layerControlCollapsed:O}),e.jsx(hr,{map:F.current,isFullscreen:j,onToggleFullscreen:fe,onResetView:Ze,onToggleLayerControl:Ae}),e.jsxs("div",{className:"absolute top-4 left-4 z-30 flex flex-col space-y-2 hidden sm:flex",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:o,disabled:!l(),className:L("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",l()?"hover:bg-gray-50 text-gray-700":"text-gray-300 cursor-not-allowed"),title:"Undo (Ctrl+Z)","aria-label":"Undo last action",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),e.jsx("button",{onClick:c,disabled:!u(),className:L("block w-10 h-10 flex items-center justify-center transition-colors",u()?"hover:bg-gray-50 text-gray-700":"text-gray-300 cursor-not-allowed"),title:"Redo (Ctrl+Y)","aria-label":"Redo last action",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:()=>je(!Ee),className:L("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",Ee?"bg-indigo-50 text-indigo-600":"hover:bg-gray-50 text-gray-700"),title:"Trip manager","aria-label":"Toggle trip manager",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),i.length>=2&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>qe(!Ie),className:L("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",Ie?"bg-violet-50 text-violet-600":"hover:bg-gray-50 text-gray-700"),title:"Trip planning tools","aria-label":"Toggle planning tools",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("button",{onClick:()=>me(!ce),className:L("block w-10 h-10 flex items-center justify-center transition-colors",ce?"bg-emerald-50 text-emerald-600":"hover:bg-gray-50 text-gray-700"),title:"Trip cost calculator","aria-label":"Toggle cost calculator",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]}),m&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:()=>_(!B),className:L("block w-10 h-10 flex items-center justify-center transition-colors",B?"bg-blue-50 text-blue-600":"hover:bg-gray-50 text-gray-700",i.length>=3&&"border-b border-gray-200"),title:"Route information","aria-label":"Toggle route information",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),i.length>=3&&e.jsx("button",{onClick:()=>ie(!ee),className:L("block w-10 h-10 flex items-center justify-center transition-colors",ee?"bg-orange-50 text-orange-600":"hover:bg-gray-50 text-gray-700"),title:"Optimize route order","aria-label":"Toggle route optimizer",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})})]}),e.jsx("button",{onClick:()=>{!v&&!Z?V(!0):v?(V(!1),se(!0)):se(!1)},className:L("w-10 h-10 flex items-center justify-center rounded-lg shadow-md transition-colors",v||Z?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-700 hover:bg-gray-50"),title:Z?"Hide filters":v?"Advanced filters":"Show campsites","aria-label":"Toggle campsite controls",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),i.length>0&&e.jsx("button",{onClick:()=>y(!0),className:"w-10 h-10 flex items-center justify-center bg-white text-red-600 rounded-lg shadow-md hover:bg-red-50 transition-colors",title:"Clear all waypoints","aria-label":"Clear all waypoints",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"absolute bottom-4 left-4 z-30 hidden sm:block",children:e.jsxs("div",{className:"bg-white bg-opacity-95 rounded-lg shadow-md px-3 py-2 text-xs text-gray-600 animate-fade-in",children:[e.jsxs("div",{className:"sm:block hidden",children:["Zoom: ",t," | Center: ",s[0].toFixed(4),", ",s[1].toFixed(4)]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("span",{className:"text-blue-600 font-medium",children:["Waypoints: ",i.length]}),i.length===0?e.jsx("span",{className:"text-green-600 text-xs",children:"Right-click map to add"}):i.length===1?e.jsx("span",{className:"text-orange-600 text-xs",children:"Add 1 more for routing"}):e.jsx("span",{className:"text-green-600 text-xs",children:"✓ Ready for routing"})]}),h()&&e.jsx("div",{className:"mt-1 text-xs text-green-600 font-medium",children:"Ready for Phase 3: Routing"})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-30 sm:hidden",children:e.jsx("div",{className:"bg-white bg-opacity-95 border-t border-gray-200 px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:[i.length," waypoint",i.length!==1?"s":""]}),i.length===0?e.jsx("span",{className:"text-green-600 text-sm font-medium",children:"Long-press map to add waypoint"}):i.length===1?e.jsx("span",{className:"text-orange-600 text-sm font-medium",children:"Add another point"}):e.jsx("span",{className:"text-green-600 text-sm font-medium",children:"✓ Route ready"})]})})}),B&&pe.BASIC_ROUTING&&m&&!D&&!w&&e.jsxs("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Route Details"}),m.alternativeRoutes&&m.alternativeRoutes.length>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:["+",m.alternativeRoutes.length," alternatives"]})]}),e.jsx("button",{onClick:()=>_(!1),className:"p-1 hover:bg-gray-200 rounded transition-colors","aria-label":"Close route information",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.alternativeRoutes&&m.alternativeRoutes.length>0&&e.jsxs("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:()=>A("info"),className:L("flex-1 py-3 px-4 text-sm font-medium transition-colors",G==="info"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"),children:"Route Info"}),e.jsx("button",{onClick:()=>A("comparison"),className:L("flex-1 py-3 px-4 text-sm font-medium transition-colors",G==="comparison"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"),children:"Compare Routes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[G==="info"&&e.jsx(jr,{className:"border-0 rounded-none"}),G==="comparison"&&e.jsx(Nr,{className:"border-0 rounded-none"})]})]}),D&&K&&pe.CAMPSITE_DISPLAY&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsx(Or,{campsite:K,onClose:$,className:"h-full border-0 rounded-none"})}),ee&&pe.ROUTE_OPTIMIZATION&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-orange-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Route Optimizer"}),e.jsx("button",{onClick:()=>ie(!1),className:"p-1 hover:bg-orange-200 rounded transition-colors","aria-label":"Close optimizer",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(kr,{className:"h-full border-0 rounded-none",onOptimizationComplete:S=>{console.log("Optimization complete:",S)},onWaypointInsert:S=>{console.log("Insert waypoint at position:",S)}})})]})}),ce&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-emerald-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Trip Cost Calculator"}),e.jsx("button",{onClick:()=>me(!1),className:"p-1 hover:bg-emerald-200 rounded transition-colors","aria-label":"Close cost calculator",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Cr,{className:"h-full border-0 rounded-none",onCostUpdate:S=>{console.log("Cost breakdown updated:",S)}})})]})}),Ee&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-indigo-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Trip Manager"}),e.jsx("button",{onClick:()=>je(!1),className:"p-1 hover:bg-indigo-200 rounded transition-colors","aria-label":"Close trip manager",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(_a,{className:"h-full border-0 rounded-none",onTripLoad:S=>{console.log("Loading trip:",S),je(!1)},onClose:()=>je(!1)})})]})}),Ie&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-violet-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Planning Tools"}),e.jsx("button",{onClick:()=>qe(!1),className:"p-1 hover:bg-violet-200 rounded transition-colors","aria-label":"Close planning tools",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Va,{className:"h-full border-0 rounded-none",onPlanUpdate:S=>{console.log("Trip plan updated:",S)}})})]})}),e.jsx(Vr,{}),e.jsx(ls,{isOpen:M,title:"Clear All Waypoints",message:`Are you sure you want to remove all ${i.length} waypoints? This action can be undone with Ctrl+Z.`,confirmLabel:"Clear All",confirmVariant:"danger",onConfirm:()=>{n(),x({type:"success",message:"All waypoints cleared"}),y(!1)},onCancel:()=>y(!1)})]})},Yr=[{id:"start-end",label:"Route",icon:ve},{id:"dates",label:"Dates",icon:De},{id:"driving",label:"Driving",icon:Ge},{id:"crossing",label:"Crossing",icon:Dt},{id:"itinerary",label:"Itinerary",icon:Oe}],Qr=()=>{const s=xe(),{profile:t}=oe(),r=re(),a=s.start&&s.end?ns(s.start.lat,s.start.lng,s.end.lat,s.end.lng):!1,i=Yr.filter(m=>m.id!=="crossing"||a),n=i[s.wizardStep]?.id||"start-end",o=s.wizardStep===i.length-1,c=s.wizardStep===0,l=(()=>{switch(n){case"start-end":return!!(s.start&&s.end);case"dates":return!!s.startDate;case"driving":return!0;case"crossing":return a?!!s.crossing:!0;case"itinerary":return!!s.itinerary;default:return!1}})(),u=d.useCallback(async()=>{if(o)return;const m=s.wizardStep+1;if(i[m]?.id==="itinerary"&&s.start&&s.end&&s.startDate){s.setStep(m),s.setIsGenerating(!0),s.setGenerationError(null);try{const p=await os.generateItinerary({start:s.start,end:s.end,startDate:s.startDate,endDate:s.endDate||void 0,drivingStyle:s.drivingStyle,crossing:s.crossing||void 0,restDayFrequency:s.restDayFrequency,vehicleProfile:t||void 0});s.setItinerary(p)}catch(p){s.setGenerationError(p.message||"Failed to generate itinerary")}finally{s.setIsGenerating(!1)}}else s.setStep(m)},[s,i,o,t]),h=d.useCallback(()=>{if(!s.itinerary)return;r.clearRoute();const m=[];s.itinerary.days.forEach((x,p)=>{p===0&&m.push({id:`trip-${Date.now()}-start`,lat:x.start.lat,lng:x.start.lng,type:"start",name:x.start.name}),x.selectedOvernight&&p<s.itinerary.days.length-1&&m.push({id:`trip-${Date.now()}-camp-${p}`,lat:x.selectedOvernight.campsite.lat,lng:x.selectedOvernight.campsite.lng,type:"campsite",name:x.selectedOvernight.campsite.name}),p===s.itinerary.days.length-1&&m.push({id:`trip-${Date.now()}-end`,lat:x.end.lat,lng:x.end.lng,type:"end",name:x.end.name})}),m.forEach(x=>r.addWaypoint(x)),s.closeWizard(),s.resetWizard()},[s,r]);return s.wizardOpen?e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Plan Your Trip"}),e.jsx("button",{onClick:()=>{s.closeWizard(),s.resetWizard()},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(tt,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"px-6 py-3 border-b border-gray-100",children:e.jsx("div",{className:"flex items-center gap-2",children:i.map((m,x)=>{const p=m.icon,N=x===s.wizardStep,M=x<s.wizardStep;return e.jsxs(St.Fragment,{children:[x>0&&e.jsx("div",{className:`flex-1 h-0.5 ${M?"bg-blue-500":"bg-gray-200"}`}),e.jsxs("button",{onClick:()=>x<s.wizardStep&&s.setStep(x),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${N?"bg-blue-100 text-blue-700":M?"bg-blue-50 text-blue-600 hover:bg-blue-100 cursor-pointer":"text-gray-400"}`,disabled:x>s.wizardStep,children:[M?e.jsx(Ve,{className:"w-4 h-4"}):e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:m.label})]})]},m.id)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[n==="start-end"&&e.jsx(en,{}),n==="dates"&&e.jsx(tn,{}),n==="driving"&&e.jsx(sn,{}),n==="crossing"&&e.jsx(an,{}),n==="itinerary"&&e.jsx(rn,{onCreateTrip:h})]}),n!=="itinerary"&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>s.prevStep(),disabled:c,className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:[e.jsx(zs,{className:"w-4 h-4"}),"Back"]}),e.jsxs("button",{onClick:u,disabled:!l,className:"flex items-center gap-2 px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:[i[s.wizardStep+1]?.id==="itinerary"?"Generate Itinerary":"Next",e.jsx(ts,{className:"w-4 h-4"})]})]})]})}):null},en=()=>{const{start:s,end:t,setStart:r,setEnd:a}=xe(),[i,n]=d.useState(s?.name||""),[o,c]=d.useState(t?.name||""),[l,u]=d.useState([]),[h,m]=d.useState([]),[x,p]=d.useState(!1),[N,M]=d.useState(!1),y=d.useCallback(async C=>{if(C.length<2)return[];const O=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(C)}&format=json&limit=5&countrycodes=gb,ie,fr,de,es,pt,it,nl,be,at,ch,dk,no,se,fi,pl,cz,hr,si,gr,hu,sk,ro,bg,ee,lv,lt,lu,mt,cy&accept-language=en`,R=await fetch(O,{headers:{"User-Agent":"EuropeanCamperPlanner/1.0"}});return R.ok?R.json():[]},[]),k=d.useCallback(async C=>{if(n(C),C.length>=2){p(!0);const O=await y(C);u(O),p(!1)}else u([])},[y]),g=d.useCallback(async C=>{if(c(C),C.length>=2){M(!0);const O=await y(C);m(O),M(!1)}else m([])},[y]),j=d.useCallback(()=>{const C=s;r(t),a(C),n(t?.name||""),c(s?.name||"")},[s,t,r,a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Where are you going?"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enter your start and end locations for the trip."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ve,{className:"w-4 h-4 inline mr-1 text-green-600"}),"Starting from"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:C=>k(C.target.value),placeholder:"e.g. Edinburgh, Scotland",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"}),x&&e.jsx(jt,{className:"absolute right-3 top-3.5 w-5 h-5 text-gray-400 animate-spin"}),s&&e.jsx(Ve,{className:"absolute right-3 top-3.5 w-5 h-5 text-green-500"})]}),l.length>0&&!s&&e.jsx("div",{className:"mt-1 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden",children:l.map(C=>e.jsx("button",{onClick:()=>{r({name:C.display_name.split(",").slice(0,2).join(",").trim(),lat:parseFloat(C.lat),lng:parseFloat(C.lon)}),n(C.display_name.split(",").slice(0,2).join(",").trim()),u([])},className:"w-full text-left px-4 py-2.5 hover:bg-blue-50 border-b border-gray-100 last:border-b-0 text-sm",children:C.display_name},C.place_id))}),s&&e.jsx("button",{onClick:()=>{r(null),n("")},className:"text-xs text-blue-600 hover:text-blue-700 mt-1",children:"Change"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Swap start and end",children:e.jsx(js,{className:"w-5 h-5 text-gray-400"})})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ve,{className:"w-4 h-4 inline mr-1 text-red-500"}),"Going to"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o,onChange:C=>g(C.target.value),placeholder:"e.g. Elba, Italy",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"}),N&&e.jsx(jt,{className:"absolute right-3 top-3.5 w-5 h-5 text-gray-400 animate-spin"}),t&&e.jsx(Ve,{className:"absolute right-3 top-3.5 w-5 h-5 text-green-500"})]}),h.length>0&&!t&&e.jsx("div",{className:"mt-1 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden",children:h.map(C=>e.jsx("button",{onClick:()=>{a({name:C.display_name.split(",").slice(0,2).join(",").trim(),lat:parseFloat(C.lat),lng:parseFloat(C.lon)}),c(C.display_name.split(",").slice(0,2).join(",").trim()),m([])},className:"w-full text-left px-4 py-2.5 hover:bg-blue-50 border-b border-gray-100 last:border-b-0 text-sm",children:C.display_name},C.place_id))}),t&&e.jsx("button",{onClick:()=>{a(null),c("")},className:"text-xs text-blue-600 hover:text-blue-700 mt-1",children:"Change"})]})]}),s&&t&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-sm text-blue-800",children:[e.jsx("strong",{children:s.name})," → ",e.jsx("strong",{children:t.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-blue-600",children:["Approx. ",Math.round(6371*2*Math.atan2(Math.sqrt(Math.sin((t.lat-s.lat)*Math.PI/180/2)**2+Math.cos(s.lat*Math.PI/180)*Math.cos(t.lat*Math.PI/180)*Math.sin((t.lng-s.lng)*Math.PI/180/2)**2),Math.sqrt(1-Math.sin((t.lat-s.lat)*Math.PI/180/2)**2-Math.cos(s.lat*Math.PI/180)*Math.cos(t.lat*Math.PI/180)*Math.sin((t.lng-s.lng)*Math.PI/180/2)**2)))," km as the crow flies"]})]})]})},tn=()=>{const{startDate:s,endDate:t,setStartDate:r,setEndDate:a}=xe(),n=s?(o=>{const c=o.getMonth();return c>=2&&c<=4?{name:"Spring",icon:e.jsx(ia,{className:"w-5 h-5 text-green-500"}),tip:"Great time for southern Europe. Some mountain passes may still be closed."}:c>=5&&c<=7?{name:"Summer",icon:e.jsx(ja,{className:"w-5 h-5 text-yellow-500"}),tip:"Peak season — book campsites early! Great weather but busy roads."}:c>=8&&c<=10?{name:"Autumn",icon:e.jsx(_s,{className:"w-5 h-5 text-orange-500"}),tip:"Beautiful colours, fewer crowds. Watch for early darkness and rain."}:{name:"Winter",icon:e.jsx(ba,{className:"w-5 h-5 text-blue-400"}),tip:"Many campsites closed. Mountain passes may require snow chains."}})(s):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"When are you going?"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Set your departure date. End date is optional."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departure Date"}),e.jsx("input",{type:"date",value:s?s.toISOString().split("T")[0]:"",onChange:o=>r(o.target.value?new Date(o.target.value+"T00:00:00"):null),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Return Date ",e.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),e.jsx("input",{type:"date",value:t?t.toISOString().split("T")[0]:"",onChange:o=>a(o.target.value?new Date(o.target.value+"T00:00:00"):null),min:s?s.toISOString().split("T")[0]:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"})]})]}),n&&e.jsxs("div",{className:"flex items-start gap-3 bg-amber-50 rounded-lg p-4",children:[n.icon,e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-amber-900",children:[n.name," Trip"]}),e.jsx("p",{className:"text-sm text-amber-700 mt-0.5",children:n.tip})]})]})]})},sn=()=>{const{drivingStyle:s,setDrivingStyle:t,restDayFrequency:r,setRestDayFrequency:a}=xe(),{profile:i}=oe(),n=[{id:"relaxed",emoji:"🌅",title:"Relaxed"},{id:"moderate",emoji:"⚖️",title:"Moderate"},{id:"intensive",emoji:"🚀",title:"Intensive"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"How do you like to drive?"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose your daily driving preference. This determines how the trip is broken into daily stages."})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:n.map(o=>{const c=is[o.id],l=s===o.id;return e.jsxs("button",{onClick:()=>t(o.id),className:`text-left p-4 rounded-xl border-2 transition-all ${l?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:o.emoji}),e.jsx("h4",{className:"font-semibold text-gray-900",children:o.title}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:c.shortDescription}),e.jsx("p",{className:"text-xs text-gray-400 mt-2 leading-relaxed",children:c.description})]},o.id)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rest Days"}),e.jsx("div",{className:"flex gap-2",children:[{value:0,label:"No rest days"},{value:3,label:"Every 3 days"},{value:5,label:"Every 5 days"}].map(o=>e.jsx("button",{onClick:()=>a(o.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${r===o.value?"bg-blue-100 text-blue-700 border-2 border-blue-300":"bg-gray-100 text-gray-600 border-2 border-transparent hover:bg-gray-200"}`,children:o.label},o.value))})]}),i&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-sm text-gray-600",children:[e.jsx(Ge,{className:"w-4 h-4 inline mr-1"}),"Your vehicle: ",e.jsx("strong",{children:i.name||i.type||"Custom"}),i.type==="motorhome"&&s==="intensive"&&e.jsx("span",{className:"text-amber-600 ml-2",children:"— Intensive may be tiring in a motorhome. Moderate is recommended."})]})]})},an=()=>{const{start:s,end:t,crossing:r,setCrossing:a}=xe(),i={short:st.filter(l=>l.region==="short"),western:st.filter(l=>l.region==="western"),northern:st.filter(l=>l.region==="northern")},o=(s&&t?os.getRecommendedCrossings(s.lat,s.lng,t.lat,t.lng):[])[0]?.id,c={short:{title:"Short Crossings",desc:"Dover & Folkestone — quickest to cross"},western:{title:"Western Crossings",desc:"Portsmouth, Plymouth & Poole — arrive further south/west"},northern:{title:"Northern Crossings",desc:"Harwich, Hull & Newcastle — best for northern routes"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Getting to Europe"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose how you want to cross the Channel. We'll route via the terminals."})]}),Object.entries(i).map(([l,u])=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-1",children:c[l].title}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:c[l].desc}),e.jsx("div",{className:"space-y-2",children:u.map(h=>{const m=r?.id===h.id,x=h.id===o;return e.jsxs("button",{onClick:()=>a(m?null:h),className:`w-full text-left p-3 rounded-lg border-2 transition-all ${m?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h.type==="tunnel"?e.jsx(Ge,{className:"w-4 h-4 text-gray-500"}):e.jsx(Dt,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-900",children:h.name}),x&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full",children:"Recommended"})]}),m&&e.jsx(Ve,{className:"w-5 h-5 text-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1.5 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),h.duration<60?`${h.duration} min`:`${Math.floor(h.duration/60)}h ${h.duration%60>0?`${h.duration%60}m`:""}`]}),e.jsx("span",{children:h.operators.join(", ")}),e.jsxs("span",{children:["£",h.estimatedCost.low,"–£",h.estimatedCost.high]}),h.overnightCrossing&&e.jsx("span",{className:"text-purple-600",children:"Overnight"})]}),m&&h.notes&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:h.notes}),m&&e.jsx("div",{className:"flex gap-2 mt-2",children:h.bookingUrls.map((p,N)=>e.jsxs("a",{href:p,target:"_blank",rel:"noopener noreferrer",onClick:M=>M.stopPropagation(),className:"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 bg-blue-50 px-2 py-1 rounded",children:["Book with ",h.operators[N]||h.operators[0],e.jsx(Lt,{className:"w-3 h-3"})]},N))})]},h.id)})})]},l))]})},rn=({onCreateTrip:s})=>{const{itinerary:t,isGenerating:r,generationError:a}=xe();return r?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(jt,{className:"w-10 h-10 text-blue-500 animate-spin mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Generating your trip plan..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Calculating route, finding campsites, and building your itinerary."})]}):a?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(ye,{className:"w-10 h-10 text-red-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Failed to generate itinerary"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a}),e.jsx("button",{onClick:()=>xe.getState().prevStep(),className:"mt-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Go back and try again"})]}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Your Trip Itinerary"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.totalDays," days · ",t.totalDistance," km · ",t.totalDrivingTime," hours driving"]})]})}),t.warnings.length>0&&e.jsx("div",{className:"bg-amber-50 rounded-lg p-3 space-y-1",children:t.warnings.map((i,n)=>e.jsxs("p",{className:"text-sm text-amber-700 flex items-start gap-2",children:[e.jsx(ye,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),i]},n))}),e.jsx("div",{className:"space-y-3",children:t.days.map(i=>e.jsx(nn,{day:i},i.dayNumber))}),e.jsx("div",{className:"sticky bottom-0 bg-white pt-4 pb-2 border-t border-gray-200 -mx-6 px-6",children:e.jsx("button",{onClick:s,className:"w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold text-base transition-colors",children:"✓ Looks Good — Create This Trip"})})]}):null},nn=({day:s})=>{const[t,r]=d.useState(!1),{selectCampsite:a}=xe(),i=s.type==="driving"||s.type==="crossing",n=s.type==="rest",o=s.date instanceof Date?s.date.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"";return e.jsxs("div",{className:`border rounded-xl overflow-hidden ${s.type==="crossing"?"border-blue-300 bg-blue-50/50":n?"border-green-300 bg-green-50/50":"border-gray-200"}`,children:[e.jsxs("button",{onClick:()=>r(!t),className:"w-full text-left p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${s.type==="crossing"?"bg-blue-200 text-blue-800":n?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800"}`,children:s.dayNumber}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:n?`Rest Day — ${s.start.name}`:`${s.start.name} → ${s.end.name}`}),s.type==="crossing"&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full",children:[e.jsx(Dt,{className:"w-3 h-3 inline mr-0.5"}),"Crossing"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[o,i&&` · ${s.distance} km · ${s.drivingTime} hrs driving`]})]})]}),e.jsx(ts,{className:`w-5 h-5 text-gray-400 transition-transform ${t?"rotate-90":""}`})]}),s.selectedOvernight&&!t&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 ml-11 text-xs text-gray-500",children:[e.jsx($t,{className:"w-3.5 h-3.5 text-green-600"}),e.jsxs("span",{children:["Staying at ",e.jsx("strong",{children:s.selectedOvernight.campsite.name})]}),e.jsxs("span",{className:"text-green-600",children:["(",s.selectedOvernight.suitabilityScore,"/100)"]})]})]}),t&&e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[s.notes.length>0&&e.jsx("div",{className:"text-xs text-gray-500 space-y-0.5 ml-11",children:s.notes.map((c,l)=>e.jsxs("p",{children:["💡 ",c]},l))}),s.crossing&&e.jsxs("div",{className:"ml-11 bg-blue-50 rounded-lg p-3 text-sm",children:[e.jsxs("p",{className:"font-medium text-blue-900",children:[s.crossing.type==="tunnel"?"🚂":"⛴️"," ",s.crossing.name]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:[s.crossing.operators.join(", ")," · ",s.crossing.duration<60?`${s.crossing.duration} min`:`${Math.floor(s.crossing.duration/60)}h ${s.crossing.duration%60>0?`${s.crossing.duration%60}m`:""}`," crossing · £",s.crossing.estimatedCost.low,"–£",s.crossing.estimatedCost.high]}),e.jsx("div",{className:"flex gap-2 mt-2",children:s.crossing.bookingUrls.map((c,l)=>e.jsxs("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 bg-white px-2 py-1 rounded border border-blue-200",children:["Book ",s.crossing.operators[l]||"Now",e.jsx(Lt,{className:"w-3 h-3"})]},l))})]}),s.overnightOptions.length>0&&e.jsxs("div",{className:"ml-11",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-2",children:[e.jsx($t,{className:"w-3.5 h-3.5 inline mr-1"}),"Overnight Options (",s.overnightOptions.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.overnightOptions.map((c,l)=>{const u=s.selectedOvernight?.campsite.id===c.campsite.id;return e.jsxs("button",{onClick:()=>a(s.dayNumber,c),className:`w-full text-left p-3 rounded-lg border transition-all ${u?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-sm text-gray-900",children:[l===0&&"⭐ ",c.campsite.name]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[c.distanceFromRoute," km from route"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:`text-xs font-bold ${c.suitabilityScore>=80?"text-green-600":c.suitabilityScore>=60?"text-yellow-600":"text-gray-500"}`,children:[c.suitabilityScore,"/100"]}),u&&e.jsx(Ve,{className:"w-4 h-4 text-green-600"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1.5",children:c.amenitySummary.slice(0,5).map(h=>e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded",children:h},h))})]},c.campsite.id)})})]})]})]})},un=()=>{const{openWizard:s,wizardOpen:t}=xe(),{waypoints:r}=re(),a=r.length>0;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Jr,{}),!t&&e.jsxs("button",{onClick:s,className:`absolute z-[1000] flex items-center gap-2 shadow-lg transition-all font-semibold ${a?"bottom-4 right-4 px-4 py-2.5 bg-white text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50 text-sm":"bottom-6 left-1/2 -translate-x-1/2 px-6 py-3.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 text-base shadow-xl"}`,children:[e.jsx(Oe,{className:a?"w-4 h-4":"w-5 h-5"}),"Plan a Trip"]})]}),e.jsx(Qr,{})]})};export{un as default};
