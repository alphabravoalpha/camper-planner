const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TripWizard-4lcsCykp.js","assets/index-Awy_9YCo.js","assets/react-vendor-BKsxK57A.js","assets/state-vendor-E9RzGJqF.js","assets/index-Cek5BwED.css","assets/triangle-alert-DkxohKeE.js","assets/chevron-left--G3RHYnE.js","assets/chevron-right-CkRKsg1M.js","assets/clock-CnNxYCuy.js","assets/lightbulb-ci4rYrvy.js","assets/map-vendor-F4U-KZbU.js","assets/file-text-BiZ_VILY.js","assets/trash-2-CM2XJ1uJ.js","assets/zap-Txs0IY6E.js","assets/fuel-BmutCY8Z.js","assets/star-B-dhXldJ.js","assets/download-DTOE3Qtv.js","assets/globe-OQa5dQOO.js","assets/chevron-down-jsVzxxrD.js","assets/SEOHead-CHCsLDEO.js"])))=>i.map(i=>d[i]);
var Gs=Object.defineProperty;var Zs=(s,t,a)=>t in s?Gs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var Ae=(s,t,a)=>Zs(s,typeof t!="symbol"?t+"":t,a);import{c as te,a as L,j as e,b as Qe,X as Je,u as ce,d as he,e as Fe,N as gt,S as ft,E as xs,M as ye,B as Ks,H as Xs,g as ps,C as Ke,R as ut,f as me,h as yt,T as jt,W as gs,i as zt,F as $e,r as Js,k as Ys,l as _t,m as Ie,p as Qs,n as Vt,o as Ut,q as en,s as $t,t as tn,v as sn,_ as nn}from"./index-Awy_9YCo.js";import{R as Ft,a as c,L as an}from"./react-vendor-BKsxK57A.js";import{P as Et,M as Be,a as et,L as tt,u as fs,T as qt,l as He,b as wt,c as rn}from"./map-vendor-F4U-KZbU.js";import{T as Se,C as Oe}from"./triangle-alert-DkxohKeE.js";import{F as bs}from"./file-text-BiZ_VILY.js";import{C as vs,T as st}from"./trash-2-CM2XJ1uJ.js";import{C as ln,Z as nt}from"./zap-Txs0IY6E.js";import{c as on}from"./state-vendor-E9RzGJqF.js";import{F as ys}from"./fuel-BmutCY8Z.js";import{S as Gt}from"./star-B-dhXldJ.js";import{C as Ye}from"./clock-CnNxYCuy.js";import{D as Wt}from"./download-DTOE3Qtv.js";import{G as js}from"./globe-OQa5dQOO.js";import{C as ws}from"./chevron-down-jsVzxxrD.js";import{L as cn}from"./lightbulb-ci4rYrvy.js";import{S as dn}from"./SEOHead-CHCsLDEO.js";const mn=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],Ns=te("baby",mn);const hn=[["path",{d:"M10 4 8 6",key:"1rru8s"}],["path",{d:"M17 19v2",key:"ts1sot"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M7 19v2",key:"12npes"}],["path",{d:"M9 5 7.621 3.621A2.121 2.121 0 0 0 4 5v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"14ym8i"}]],ks=te("bath",hn);const un=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],Zt=te("bed",un);const xn=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],pn=te("bike",xn);const gn=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],fn=te("camera",gn);const bn=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],vn=te("car",bn);const yn=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Cs=te("chevron-up",yn);const jn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9 17V7h4a3 3 0 0 1 0 6H9",key:"1dfk2c"}]],Ss=te("circle-parking",jn);const wn=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Nn=te("cloud",wn);const kn=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Cn=te("copy",kn);const Sn=[["path",{d:"M4 9a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h4a1 1 0 0 1 1 1v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-4a1 1 0 0 1 1-1h4a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2h-4a1 1 0 0 1-1-1V4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4a1 1 0 0 1-1 1z",key:"1xbrqy"}]],Mn=te("cross",Sn);const Ln=[["path",{d:"M11.25 16.25h1.5L12 17z",key:"w7jh35"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M4.42 11.247A13.152 13.152 0 0 0 4 14.556C4 18.728 7.582 21 12 21s8-2.272 8-6.444a11.702 11.702 0 0 0-.493-3.309",key:"u7s9ue"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M8.5 8.5c-.384 1.05-1.083 2.028-2.344 2.5-1.931.722-3.576-.297-3.656-1-.113-.994 1.177-6.53 4-7 1.923-.321 3.651.845 3.651 2.235A7.497 7.497 0 0 1 14 5.277c0-1.39 1.844-2.598 3.767-2.277 2.823.47 4.113 6.006 4 7-.08.703-1.725 1.722-3.656 1-1.261-.472-1.855-1.45-2.239-2.5",key:"v8hric"}]],Ms=te("dog",Ln);const Tn=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Dn=te("dollar-sign",Tn);const En=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],Ls=te("droplets",En);const In=[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]],It=te("euro",In);const Rn=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],An=te("folder-open",Rn);const Pn=[["path",{d:"M5.116 4.104A1 1 0 0 1 6.11 3h11.78a1 1 0 0 1 .994 1.105L17.19 20.21A2 2 0 0 1 15.2 22H8.8a2 2 0 0 1-2-1.79z",key:"p55z4y"}],["path",{d:"M6 12a5 5 0 0 1 6 0 5 5 0 0 0 6 0",key:"mjntcy"}]],Ts=te("glass-water",Pn);const zn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Bt=te("info",zn);const $n=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Fn=te("mail",$n);const Wn=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Ds=te("map",Wn);const Bn=[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]],Es=te("mountain",Bn);const On=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Hn=te("phone",On);const _n=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],Vn=te("ruler",_n);const Un=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Kt=te("save",Un);const qn=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],Gn=te("scale",qn);const Zn=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Is=te("settings",Zn);const Kn=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Rs=te("settings-2",Kn);const Xn=[["path",{d:"M12 10.189V14",key:"1p8cqu"}],["path",{d:"M12 2v3",key:"qbqxhf"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 2.81 7.76",key:"7tigtc"}],["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1s1.2 1 2.5 1c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"1924j5"}]],Jn=te("ship",Xn);const Yn=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],As=te("shirt",Yn);const Qn=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],Ps=te("shopping-cart",Qn);const ea=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],kt=te("target",ea);const ta=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],Xt=te("thermometer",ta);const sa=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],na=te("trending-down",sa);const aa=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Ct=te("trending-up",aa);const ra=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ia=te("upload",ra);const la=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Rt=te("users",la);const oa=[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]],Ot=te("utensils-crossed",oa);const ca=[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]],zs=te("waves",ca);const da=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],$s=te("wifi",da),ma=[{id:"dover-calais",name:"Dover â†’ Calais",type:"ferry",departure:{name:"Dover",lat:51.1279,lng:1.3134,country:"GB"},arrival:{name:"Calais",lat:50.9513,lng:1.8587,country:"FR"},duration:90,frequency:"Up to 30 sailings per day",operators:["P&O Ferries","DFDS"],bookingUrls:["https://www.poferries.com/en/dover-calais","https://www.dfds.com/en-gb/passenger-ferries/dover-calais"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Most popular crossing. Frequent sailings, short crossing time.",estimatedCost:{low:100,high:300,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"dover-dunkirk",name:"Dover â†’ Dunkirk",type:"ferry",departure:{name:"Dover",lat:51.1279,lng:1.3134,country:"GB"},arrival:{name:"Dunkirk",lat:51.0486,lng:2.3767,country:"FR"},duration:120,frequency:"Up to 12 sailings per day",operators:["DFDS"],bookingUrls:["https://www.dfds.com/en-gb/passenger-ferries/dover-dunkirk"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Good alternative to Calais. Often cheaper, slightly longer crossing.",estimatedCost:{low:80,high:250,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"eurotunnel",name:"Folkestone â†’ Calais",type:"tunnel",departure:{name:"Folkestone",lat:51.0947,lng:1.1354,country:"GB"},arrival:{name:"Calais (Coquelles)",lat:50.9268,lng:1.8134,country:"FR"},duration:35,frequency:"Up to 4 departures per hour",operators:["Eurotunnel Le Shuttle"],bookingUrls:["https://www.eurotunnel.com/uk/travelling-with-us/motorhomes-caravans/"],vehicleTypes:["motorhome","campervan"],maxVehicleLength:18,notes:"Fastest crossing. Drive on, drive off. Caravans accepted on some services â€” check height restrictions (max 2.85m for standard, 3.95m for high-loader).",estimatedCost:{low:120,high:400,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"portsmouth-caen",name:"Portsmouth â†’ Caen (Ouistreham)",type:"ferry",departure:{name:"Portsmouth",lat:50.7989,lng:-1.0872,country:"GB"},arrival:{name:"Caen (Ouistreham)",lat:49.283,lng:-.2488,country:"FR"},duration:360,frequency:"Up to 3 sailings per day",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/portsmouth-caen"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Arrives in Normandy. Good for western France, Spain, and Portugal routes. Day and overnight sailings available.",estimatedCost:{low:150,high:450,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"portsmouth-lehavre",name:"Portsmouth â†’ Le Havre",type:"ferry",departure:{name:"Portsmouth",lat:50.7989,lng:-1.0872,country:"GB"},arrival:{name:"Le Havre",lat:49.4872,lng:.1063,country:"FR"},duration:330,frequency:"1-2 sailings per day",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/portsmouth-le-havre"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing. Arrives early morning, good for heading south through France.",estimatedCost:{low:150,high:400,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"portsmouth-stmalo",name:"Portsmouth â†’ St Malo",type:"ferry",departure:{name:"Portsmouth",lat:50.7989,lng:-1.0872,country:"GB"},arrival:{name:"St Malo",lat:48.6493,lng:-2.007,country:"FR"},duration:540,frequency:"1 sailing per day (seasonal)",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/portsmouth-st-malo"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing to Brittany. Longer but arrives further west. Seasonal service.",estimatedCost:{low:180,high:500,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"plymouth-roscoff",name:"Plymouth â†’ Roscoff",type:"ferry",departure:{name:"Plymouth",lat:50.366,lng:-4.1422,country:"GB"},arrival:{name:"Roscoff",lat:48.7267,lng:-3.981,country:"FR"},duration:360,frequency:"1-2 sailings per day (seasonal)",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/plymouth-roscoff"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Best for travelers from the West Country. Arrives in Brittany. Seasonal service (March-November).",estimatedCost:{low:150,high:450,currency:"GBP"},region:"western",overnightCrossing:!0},{id:"poole-cherbourg",name:"Poole â†’ Cherbourg",type:"ferry",departure:{name:"Poole",lat:50.7076,lng:-1.987,country:"GB"},arrival:{name:"Cherbourg",lat:49.6386,lng:-1.6163,country:"FR"},duration:270,frequency:"1-2 sailings per day",operators:["Brittany Ferries"],bookingUrls:["https://www.brittany-ferries.co.uk/routes/poole-cherbourg"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Shorter western crossing. Good for Normandy and heading south.",estimatedCost:{low:130,high:380,currency:"GBP"},region:"western",overnightCrossing:!1},{id:"newhaven-dieppe",name:"Newhaven â†’ Dieppe",type:"ferry",departure:{name:"Newhaven",lat:50.7924,lng:.0613,country:"GB"},arrival:{name:"Dieppe",lat:49.9266,lng:1.077,country:"FR"},duration:240,frequency:"Up to 3 sailings per day",operators:["DFDS"],bookingUrls:["https://www.dfds.com/en-gb/passenger-ferries/newhaven-dieppe"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Arrives in upper Normandy. Good alternative to Dover for London/South East travelers.",estimatedCost:{low:90,high:280,currency:"GBP"},region:"short",overnightCrossing:!1},{id:"harwich-hookofholland",name:"Harwich â†’ Hook of Holland",type:"ferry",departure:{name:"Harwich",lat:51.9461,lng:1.2474,country:"GB"},arrival:{name:"Hook of Holland",lat:51.9811,lng:4.123,country:"NL"},duration:420,frequency:"2 sailings per day",operators:["Stena Line"],bookingUrls:["https://www.stenaline.co.uk/routes/harwich-hook-of-holland"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing to the Netherlands. Best for Germany, Benelux, and Scandinavia routes.",estimatedCost:{low:120,high:350,currency:"GBP"},region:"northern",overnightCrossing:!0},{id:"hull-rotterdam",name:"Hull â†’ Rotterdam (Europoort)",type:"ferry",departure:{name:"Hull",lat:53.7383,lng:-.2903,country:"GB"},arrival:{name:"Rotterdam (Europoort)",lat:51.9546,lng:4.1452,country:"NL"},duration:660,frequency:"1 sailing per day (overnight)",operators:["P&O Ferries"],bookingUrls:["https://www.poferries.com/en/hull-rotterdam"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing. Best for travelers from the North of England. Arrives early morning.",estimatedCost:{low:130,high:380,currency:"GBP"},region:"northern",overnightCrossing:!0},{id:"newcastle-amsterdam",name:"Newcastle â†’ Amsterdam (IJmuiden)",type:"ferry",departure:{name:"Newcastle",lat:54.996,lng:-1.4402,country:"GB"},arrival:{name:"Amsterdam (IJmuiden)",lat:52.4614,lng:4.602,country:"NL"},duration:960,frequency:"1 sailing per day (overnight)",operators:["DFDS"],bookingUrls:["https://www.dfds.com/en-gb/passenger-ferries/newcastle-amsterdam"],vehicleTypes:["motorhome","caravan","campervan"],notes:"Overnight crossing from the North East. Mini-cruise experience. Best for Netherlands, Germany, and beyond.",estimatedCost:{low:150,high:400,currency:"GBP"},region:"northern",overnightCrossing:!0}];function bt(s,t){const a=s>=49.9&&s<=60.9&&t>=-8.2&&t<=1.8,n=s>=51.4&&s<=55.4&&t>=-10.5&&t<=-5.9;return a||n}function Jt(s,t){return s>=35&&s<=72&&t>=-10&&t<=40&&!bt(s,t)}function ha(s,t,a,n){const r=bt(s,t),l=bt(a,n),i=Jt(s,t),d=Jt(a,n);return r&&d||i&&l}function mi(s,t,a,n){const r=(i,d,o,g)=>{const m=(o-i)*Math.PI/180,u=(g-d)*Math.PI/180,v=Math.sin(m/2)**2+Math.cos(i*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(u/2)**2;return 12742*Math.atan2(Math.sqrt(v),Math.sqrt(1-v))},l=bt(s,t);return[...ma].map(i=>{const d=l?i.departure:i.arrival,o=l?i.arrival:i.departure,g=r(s,t,d.lat,d.lng),h=r(o.lat,o.lng,a,n),m=(g+h)/80+i.duration/60;return{crossing:i,totalTime:m}}).sort((i,d)=>i.totalTime-d.totalTime).map(({crossing:i})=>i)}const Fs=({isOpen:s,title:t,message:a,confirmLabel:n="Confirm",cancelLabel:r="Cancel",confirmVariant:l="primary",onConfirm:i,onCancel:d})=>{if(Ft.useEffect(()=>{if(!s)return;const g=h=>{h.key==="Escape"?d():h.key==="Enter"&&i()};return document.addEventListener("keydown",g),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",g),document.body.style.overflow="auto"}},[s,d,i]),!s)return null;const o=L("px-4 py-2 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",{"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500":l==="danger","bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500":l==="primary","bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500":l==="warning"});return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:d,onKeyDown:g=>g.key==="Escape"&&d(),role:"button",tabIndex:0,"aria-label":"Close dialog"}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:t}),e.jsx("button",{onClick:d,className:"text-neutral-400 hover:text-neutral-600 p-1 rounded transition-colors","aria-label":"Close dialog",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-neutral-600 text-sm leading-relaxed",children:a})}),e.jsxs("div",{className:"flex space-x-3 justify-end",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 border border-neutral-300 rounded-lg text-neutral-700 hover:bg-neutral-50 transition-colors focus:outline-none focus:ring-2 focus:ring-neutral-500 focus:ring-offset-2",children:r}),e.jsx("button",{onClick:i,className:o,children:n})]})]})})]})},ua=({isOpen:s,position:t,items:a,onClose:n})=>{const r=c.useRef(null);return c.useEffect(()=>{if(!s)return;const l=d=>{r.current&&!r.current.contains(d.target)&&n()},i=d=>{d.key==="Escape"&&n()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",i)}},[s,n]),c.useEffect(()=>{if(!s||!r.current)return;const l=r.current,i=l.getBoundingClientRect(),d={width:window.innerWidth,height:window.innerHeight};let{x:o,y:g}=t;o+i.width>d.width&&(o=d.width-i.width-10),g+i.height>d.height&&(g=d.height-i.height-10),l.style.left=`${Math.max(10,o)}px`,l.style.top=`${Math.max(10,g)}px`},[s,t]),s?e.jsx("div",{ref:r,className:"fixed z-50 min-w-48 bg-white border border-neutral-200 rounded-lg shadow-lg py-2 animate-fade-in",style:{left:t.x,top:t.y},children:a.map(l=>{const i=L("flex items-center justify-between px-4 py-2 text-sm cursor-pointer transition-colors",{"text-neutral-700 hover:bg-neutral-50":l.variant==="default"||!l.variant,"text-red-600 hover:bg-red-50":l.variant==="danger","text-primary-600 hover:bg-primary-50":l.variant==="primary","text-neutral-400 cursor-not-allowed":l.disabled});return e.jsxs("button",{className:i,onClick:()=>{l.disabled||(l.onClick(),n())},disabled:l.disabled,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[l.icon&&e.jsx("span",{className:"flex-shrink-0",children:l.icon}),e.jsx("span",{children:l.label})]}),l.shortcut&&e.jsx("span",{className:"text-xs text-neutral-400 ml-4",children:l.shortcut})]},l.id)})}):null},Ws=({onLocationSelect:s,placeholder:t="Search for a location...",className:a})=>{const[n,r]=c.useState(""),[l,i]=c.useState([]),[d,o]=c.useState(!1),[g,h]=c.useState(null),[m,u]=c.useState(!1),[v,N]=c.useState(-1),S=c.useRef(null),k=c.useRef("");c.useEffect(()=>{if(n.trim().length<2){i([]),u(!1),h(null);return}const f=setTimeout(async()=>{const E=n.trim();k.current=E,o(!0),h(null);try{const W=await Qe.geocodeLocationMultiple(E,5);k.current===E&&(i(W),u(!0),N(-1))}catch{k.current===E&&(h("Search failed. Try again."),i([]))}finally{k.current===E&&o(!1)}},300);return()=>clearTimeout(f)},[n]);const C=c.useCallback(f=>{s(f),r(""),i([]),u(!1),N(-1)},[s]),x=c.useCallback(f=>{if(f.stopPropagation(),!(!m||l.length===0))switch(f.key){case"ArrowDown":f.preventDefault(),N(E=>Math.min(E+1,l.length-1));break;case"ArrowUp":f.preventDefault(),N(E=>Math.max(E-1,-1));break;case"Enter":f.preventDefault(),v>=0&&v<l.length&&C(l[v]);break;case"Escape":f.preventDefault(),u(!1),N(-1);break}},[m,l,v,C]),w=f=>{const E=f.name||f.display_name.split(",")[0].trim(),W=f.display_name.split(","),D=W.length>1?W.slice(1,3).join(",").trim():"";return{primary:E,secondary:D}};return e.jsxs("div",{className:L("relative",a),onClick:f=>f.stopPropagation(),onKeyDown:f=>f.stopPropagation(),role:"presentation",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:S,type:"text",value:n,onChange:f=>r(f.target.value),onClick:f=>f.stopPropagation(),onFocus:f=>{f.stopPropagation(),l.length>0&&u(!0)},onKeyDown:x,className:"w-full px-2 py-1 pl-7 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:t}),e.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2",children:d?e.jsxs("svg",{className:"w-3.5 h-3.5 text-primary-500 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):e.jsx("svg",{className:"w-3.5 h-3.5 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),n&&e.jsx("button",{onClick:f=>{f.stopPropagation(),f.preventDefault(),r(""),i([]),u(!1),S.current?.focus()},className:"absolute right-1.5 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center text-neutral-400 hover:text-neutral-600",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m&&e.jsx("div",{className:"absolute left-0 right-0 mt-1 bg-white border border-neutral-200 rounded-lg shadow-lg z-50 max-h-[150px] overflow-y-auto",onMouseDown:f=>f.preventDefault(),role:"listbox",tabIndex:-1,children:l.length>0?l.map((f,E)=>{const{primary:W,secondary:D}=w(f);return e.jsxs("button",{onClick:O=>{O.stopPropagation(),O.preventDefault(),C(f)},className:L("w-full text-left px-2.5 py-2 text-xs hover:bg-primary-50 transition-colors flex items-start gap-1.5",E===v&&"bg-primary-50",E<l.length-1&&"border-b border-neutral-100"),children:[e.jsx("span",{className:"text-neutral-400 mt-0.5 flex-shrink-0",children:"ðŸ“"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-neutral-900 truncate",children:W}),D&&e.jsx("div",{className:"text-neutral-500 truncate",children:D})]})]},`${f.lat}-${f.lng}-${E}`)}):e.jsx("div",{className:"px-3 py-2 text-xs text-neutral-500 text-center",children:"No locations found"})}),g&&e.jsxs("div",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{children:g}),e.jsx("button",{onClick:f=>{f.stopPropagation(),f.preventDefault(),h(null),r(n)},className:"text-primary-600 hover:text-primary-700 underline ml-1",children:"Retry"})]})]})};function Bs(s){return`nudge-dismissed-${s}`}function Yt(s){try{return!!localStorage.getItem(Bs(s))}catch{return!1}}function xa(s){try{localStorage.setItem(Bs(s),"1")}catch{}}function St({nudgeId:s,message:t,show:a,autoDismissMs:n=8e3}){const[r,l]=c.useState(!1),[i,d]=c.useState(()=>Yt(s)),o=c.useRef(null),g=c.useRef(null);c.useEffect(()=>{d(Yt(s))},[s]),c.useEffect(()=>(o.current&&(clearTimeout(o.current),o.current=null),a&&!i?o.current=setTimeout(()=>{l(!0)},500):l(!1),()=>{o.current&&clearTimeout(o.current)}),[a,i]),c.useEffect(()=>(g.current&&(clearTimeout(g.current),g.current=null),r&&(g.current=setTimeout(()=>{h()},n)),()=>{g.current&&clearTimeout(g.current)}),[r,n]);function h(){xa(s),d(!0),l(!1)}return!r||i?null:e.jsxs("div",{role:"status","aria-live":"polite",className:"fixed bottom-[4.5rem] sm:bottom-24 left-4 right-16 sm:right-auto sm:left-1/2 sm:-translate-x-1/2 z-30 bg-white/95 backdrop-blur-sm rounded-lg shadow-lg border border-neutral-200 px-4 py-3 sm:max-w-md flex items-center gap-3 animate-slide-up motion-reduce:animate-none",children:[e.jsx("span",{className:"text-sm text-neutral-700",children:t}),e.jsx("button",{type:"button",onClick:h,"aria-label":"Dismiss",className:"ml-3 flex-shrink-0 text-neutral-400 hover:text-neutral-600 cursor-pointer",children:e.jsx(Je,{size:16})})]})}const pa={petrol:1.65,diesel:1.55,lpg:.85,electricity:.35},Qt={motorhome:{small:{petrol:12,diesel:10,lpg:14},medium:{petrol:15,diesel:12,lpg:17},large:{petrol:18,diesel:15,lpg:20}},caravan:{small:{petrol:10,diesel:8,lpg:12},medium:{petrol:13,diesel:10,lpg:15},large:{petrol:16,diesel:13,lpg:18}},campervan:{small:{petrol:9,diesel:7,lpg:11},medium:{petrol:11,diesel:9,lpg:13},large:{petrol:14,diesel:11,lpg:16}}};class vt{static initializeSettings(t,a){this.fuelConsumptionSettings=t,this.fuelPriceSettings=a}static getDefaultConsumption(t){const a=t.type,n=this.determineVehicleSize(t);return{consumptionType:"l_per_100km",consumption:Qt[a]?.[n]?.diesel||12,fuelType:"diesel",tankCapacity:80}}static getCurrentFuelPrices(){return this.fuelPriceSettings?.priceType==="manual"&&this.fuelPriceSettings.manualPrices?this.fuelPriceSettings.manualPrices:pa}static async calculateRouteCosts(t,a,n,r){if(t.length<2)return this.createEmptyCostBreakdown();const l=n||this.fuelConsumptionSettings||(a?this.getDefaultConsumption(a):{consumptionType:"l_per_100km",consumption:12,fuelType:"diesel"}),i=r||this.fuelPriceSettings||{priceType:"default_european",currency:"EUR"},d=await this.calculateRouteSegments(t,l,i),o=this.calculateDailyBreakdown(d),g=d.reduce((u,v)=>u+v.fuelCost,0),h=d.reduce((u,v)=>u+(v.tollCost||0),0),m=d.reduce((u,v)=>u+(v.accommodationCost||0),0);return{totalCost:g+h+m,fuelCost:g,tollCost:h,accommodationCost:m,foodCost:0,ferryCost:0,otherCosts:0,currency:i.currency,segments:d,dailyBreakdown:o}}static async calculateCostOptimizations(t,a){const n=[];if(a){const i=this.fuelConsumptionSettings?.consumption||12,d=this.getOptimalConsumption(a);if(i>d*1.1){const o=this.calculateFuelEfficiencySaving(t.fuelCost,i,d);n.push({type:"fuel_efficiency",description:"Improve fuel efficiency through eco-driving techniques",potentialSaving:o,actionRequired:"Maintain steady speeds, avoid rapid acceleration, plan efficient routes"})}}const r=t.fuelCost*.05;n.push({type:"route_alternative",description:"Consider alternative routes to reduce fuel consumption",potentialSaving:r,actionRequired:"Use route optimization with fuel efficiency priority"}),t.segments.length>3&&n.push({type:"fuel_stop",description:"Optimize fuel stops at cheaper stations",potentialSaving:t.fuelCost*.03,actionRequired:"Plan fuel stops at hypermarkets or discount stations"});const l=n.reduce((i,d)=>i+d.potentialSaving,0);return{currentCost:t.totalCost,optimizedCost:t.totalCost-l,savings:l,suggestions:n.sort((i,d)=>d.potentialSaving-i.potentialSaving)}}static convertConsumption(t,a,n){let r;switch(a){case"l_per_100km":r=t;break;case"mpg_imperial":r=282.481/t;break;case"mpg_us":r=235.215/t;break}switch(n){case"l_per_100km":return r;case"mpg_imperial":return 282.481/r;case"mpg_us":return 235.215/r}}static calculateFuelCost(t,a,n){const r=this.convertConsumption(a.consumption,a.consumptionType,"l_per_100km"),l=t/100*r,d=this.getCurrentFuelPrices()[a.fuelType];return l*d}static async calculateRouteSegments(t,a,n){const r=[];for(let l=0;l<t.length-1;l++){const i=t[l],d=t[l+1],o=this.calculateDistance(i,d),g=this.estimateDrivingTime(o),h=this.calculateFuelCost(o,a,n);let m="driving",u=0;d.type==="campsite"||d.type==="accommodation"?(m="overnight",u=this.estimateAccommodationCost(d)):l>0&&o<50&&(m="stop"),r.push({startWaypoint:i,endWaypoint:d,distance:o,duration:g,fuelCost:h,accommodationCost:u,segmentType:m,tollCost:0})}return r}static calculateDailyBreakdown(t){const a=[];let n=new Date,r=0,l=0,i=0;return t.forEach((d,o)=>{r+=d.distance,l+=d.fuelCost,(d.segmentType==="overnight"||o===t.length-1)&&(i+=d.accommodationCost||0,a.push({date:new Date(n),distance:r,fuelCost:l,accommodationCost:i,foodCost:0,totalDailyCost:l+i}),n=new Date(n.getTime()+1440*60*1e3),r=0,l=0,i=0)}),a}static createEmptyCostBreakdown(){return{totalCost:0,fuelCost:0,tollCost:0,accommodationCost:0,foodCost:0,ferryCost:0,otherCosts:0,currency:"EUR",segments:[],dailyBreakdown:[]}}static determineVehicleSize(t){const a=t.length||6;return a<6?"small":a<8?"medium":"large"}static getOptimalConsumption(t){const a=t.type,n=this.determineVehicleSize(t);return Qt[a]?.[n]?.diesel||12}static calculateFuelEfficiencySaving(t,a,n){const r=(a-n)/a;return t*r}static calculateDistance(t,a){const r=(a.lat-t.lat)*Math.PI/180,l=(a.lng-t.lng)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}static estimateDrivingTime(t){return t/70*60}static estimateAccommodationCost(t){switch(t.type){case"campsite":return 25;case"accommodation":return 80;default:return 0}}}Ae(vt,"fuelConsumptionSettings",null),Ae(vt,"fuelPriceSettings",null);const Mt="camper-planner-trips",Lt="camper-planner-trip-history",Tt="1.0.0",ga=50;class ke{static async saveTrip(t){const a=new Date,n=await this.getAllTrips(),r=n.find(d=>d.metadata.id===t.metadata.id),l={...t,timestamps:{created:r?.timestamps.created||a,modified:a,lastOpened:r?.timestamps.lastOpened||a,version:Tt}},i=n.findIndex(d=>d.metadata.id===t.metadata.id);return i>=0?n[i]=l:n.push(l),localStorage.setItem(Mt,JSON.stringify(n)),await this.addToHistory(l),l}static async loadTrip(t){const n=(await this.getAllTrips()).find(r=>r.metadata.id===t);return n&&(n.timestamps.lastOpened=new Date,await this.saveTrip(n)),n||null}static async getAllTrips(){try{const t=localStorage.getItem(Mt);return t?JSON.parse(t).map(n=>({...n,timestamps:{...n.timestamps,created:new Date(n.timestamps.created),modified:new Date(n.timestamps.modified),lastOpened:new Date(n.timestamps.lastOpened)},data:{...n.data,costCalculations:n.data.costCalculations?{...n.data.costCalculations,lastCalculated:new Date(n.data.costCalculations.lastCalculated)}:void 0,optimization:n.data.optimization?{...n.data.optimization,appliedAt:new Date(n.data.optimization.appliedAt)}:void 0}})):[]}catch(t){return console.error("Failed to load trips:",t),[]}}static async getTripSummaries(t){let n=await this.getAllTrips();return t?.excludeTemplates&&(n=n.filter(r=>!r.metadata.isTemplate)),t?.category&&(n=n.filter(r=>r.metadata.category===t.category)),t?.tags&&t.tags.length>0&&(n=n.filter(r=>t.tags.some(l=>r.metadata.tags.includes(l)))),n.map(r=>({id:r.metadata.id,name:r.metadata.name,category:r.metadata.category,tags:r.metadata.tags,duration:r.metadata.duration,estimatedCost:r.metadata.estimatedCost,currency:r.metadata.currency,waypointCount:r.data.waypoints.length,countries:r.metadata.countries,lastModified:r.timestamps.modified,lastOpened:r.timestamps.lastOpened,isTemplate:r.metadata.isTemplate})).sort((r,l)=>l.lastModified.getTime()-r.lastModified.getTime())}static async deleteTrip(t){try{const a=await this.getAllTrips(),n=a.length,r=a.filter(l=>l.metadata.id!==t);return r.length===n?!1:(localStorage.setItem(Mt,JSON.stringify(r)),!0)}catch(a){return console.error("Failed to delete trip:",a),!1}}static async duplicateTrip(t,a){const n=await this.loadTrip(t);if(!n)return null;const r=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l={...n,metadata:{...n.metadata,id:r,name:a||`${n.metadata.name} (Copy)`,isTemplate:!1,isPublic:!1}};return await this.saveTrip(l)}static async exportTrip(t){const a=await this.loadTrip(t);if(!a)return null;const n={...a,exportInfo:{exportedAt:new Date,exportedBy:"camper-planner",version:Tt,exportId:`export_${Date.now()}`}};return JSON.stringify(n,null,2)}static async importTrip(t,a){try{const n=JSON.parse(t);if(!n.metadata||!n.data)throw new Error("Invalid trip data structure");const r=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l={metadata:{...n.metadata,id:r,name:a||`${n.metadata.name} (Imported)`,isTemplate:!1,isPublic:!1},data:n.data,timestamps:{created:new Date,modified:new Date,lastOpened:new Date,version:Tt},sharing:{originalTripId:n.metadata.id,sharedBy:n.exportInfo?.exportedBy||"unknown",sharedAt:n.exportInfo?.exportedAt?new Date(n.exportInfo.exportedAt):new Date,exportId:n.exportInfo?.exportId}};return await this.saveTrip(l)}catch(n){return console.error("Failed to import trip:",n),null}}static async getRecentTrips(t=10){return(await this.getTripSummaries({excludeTemplates:!0})).sort((n,r)=>r.lastOpened.getTime()-n.lastOpened.getTime()).slice(0,t)}static async addToHistory(t){try{const a=localStorage.getItem(Lt);let n=[];a&&(n=JSON.parse(a).map(r=>({...r,accessedAt:new Date(r.accessedAt)}))),n=n.filter(r=>r.tripId!==t.metadata.id),n.unshift({tripId:t.metadata.id,accessedAt:new Date,tripName:t.metadata.name}),n=n.slice(0,ga),localStorage.setItem(Lt,JSON.stringify(n))}catch(a){console.error("Failed to update trip history:",a)}}static async getTripHistory(){try{const t=localStorage.getItem(Lt);return t?JSON.parse(t).map(a=>({...a,accessedAt:new Date(a.accessedAt)})):[]}catch(t){return console.error("Failed to load trip history:",t),[]}}static async compareTrips(t){try{const n=(await Promise.all(t.map(o=>this.loadTrip(o)))).filter(o=>o!==null);if(n.length<2)return null;const r={trips:n,comparison:{costs:{},routes:{},analysis:{cheapest:"",shortest:"",fastest:"",mostScenic:"",recommendations:[]}}};let l=1/0,i=1/0,d=1/0;return n.forEach(o=>{const g=o.metadata.id,h=o.data.costCalculations?.breakdown;h&&(r.comparison.costs[g]={total:h.totalCost,fuel:h.fuelCost,accommodation:h.accommodationCost,tolls:h.tollCost},h.totalCost<l&&(l=h.totalCost,r.comparison.analysis.cheapest=g));const m=this.calculateTotalDistance(o.data.waypoints),u=m/70;r.comparison.routes[g]={distance:m,duration:u,waypointCount:o.data.waypoints.length,countries:o.metadata.countries},m<i&&(i=m,r.comparison.analysis.shortest=g),u<d&&(d=u,r.comparison.analysis.fastest=g)}),n.forEach(o=>{const g=o.metadata.id,h=[];g===r.comparison.analysis.cheapest&&h.push({tripId:g,reason:"Most cost-effective option",advantage:`Lowest total cost: â‚¬${r.comparison.costs[g]?.total.toFixed(2)||"N/A"}`}),g===r.comparison.analysis.shortest&&h.push({tripId:g,reason:"Shortest distance",advantage:`Least driving: ${i.toFixed(0)}km`}),(o.metadata.tags.includes("scenic")||o.metadata.tags.includes("nature"))&&(r.comparison.analysis.mostScenic=g,h.push({tripId:g,reason:"Most scenic route",advantage:"Best for sightseeing and photography"})),r.comparison.analysis.recommendations.push(...h)}),r}catch(a){return console.error("Failed to compare trips:",a),null}}static async getTripCategories(){const t=await this.getAllTrips(),a=new Map;return t.forEach(n=>{if(!n.metadata.isTemplate){const r=a.get(n.metadata.category)||0;a.set(n.metadata.category,r+1)}}),Array.from(a.entries()).map(([n,r])=>({category:n,count:r})).sort((n,r)=>r.count-n.count)}static async getAllTags(){const t=await this.getAllTrips(),a=new Map;return t.forEach(n=>{n.metadata.isTemplate||n.metadata.tags.forEach(r=>{const l=a.get(r)||0;a.set(r,l+1)})}),Array.from(a.entries()).map(([n,r])=>({tag:n,count:r})).sort((n,r)=>r.count-n.count)}static async searchTrips(t){const a=await this.getTripSummaries(),n=t.toLowerCase();return a.filter(r=>r.name.toLowerCase().includes(n)||r.tags.some(l=>l.toLowerCase().includes(n))||r.countries.some(l=>l.toLowerCase().includes(n)))}static calculateTotalDistance(t){if(t.length<2)return 0;let a=0;for(let n=0;n<t.length-1;n++)a+=this.calculateDistance(t[n],t[n+1]);return a}static calculateDistance(t,a){const r=(a.lat-t.lat)*Math.PI/180,l=(a.lng-t.lng)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}}function xt(s,t,a){if(!s.routes.length)throw new Error("No routes available for export");const n=s.routes[0],r=new Date().toISOString(),l=t.map((m,u)=>({id:m.id,name:m.name||`Waypoint ${u+1}`,description:void 0,lat:m.lat,lng:m.lng,elevation:void 0,type:m.type,order:u})),i=n.geometry.coordinates,d={north:Math.max(...i.map(m=>m[1])),south:Math.min(...i.map(m=>m[1])),east:Math.max(...i.map(m=>m[0])),west:Math.min(...i.map(m=>m[0]))},o=n.segments.map((m,u)=>{const v=[],N=Math.floor(i.length/n.segments.length),S=u*N,k=u===n.segments.length-1?i.length:(u+1)*N;let C=0;for(let w=S;w<k;w++){const f=i[w];if(w>S){const E=i[w-1];C+=fa(E[1],E[0],f[1],f[0])}v.push({lat:f[1],lng:f[0],elevation:f[2],distance:C})}const x=(m.steps||[]).map(w=>({distance:w.distance,duration:w.duration,instruction:w.instruction,streetName:w.name,coordinates:w.wayPoints}));return{points:v,distance:m.distance,duration:m.duration,instructions:x.length>0?x:void 0}}),g={name:a||`Route ${s.id}`,segments:o,totalDistance:n.summary.distance,totalDuration:n.summary.duration,bounds:d},h={creator:"European Camper Trip Planner",version:"1.0.0",timestamp:r,service:s.metadata.service,profile:s.metadata.profile,vehicleProfile:s.metadata.query.vehicleProfile,restrictions:s.restrictions?{violatedDimensions:s.restrictions.violatedDimensions,warnings:s.warnings||[]}:void 0};return{id:s.id,name:a||`European Camper Route - ${new Date().toLocaleDateString()}`,description:`Generated route with ${t.length} waypoints. Distance: ${Math.round(n.summary.distance/1e3)} km, Duration: ${Math.round(n.summary.duration/3600)}h ${Math.round(n.summary.duration%3600/60)}m`,waypoints:l,track:g,metadata:h}}function fa(s,t,a,n){const l=(a-s)*Math.PI/180,i=(n-t)*Math.PI/180,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}function pt(s){if(!s.id||!s.waypoints.length||!s.track.segments.length)return!1;for(const t of s.waypoints)if(!t.id||!t.name||!es(t.lat,t.lng))return!1;for(const t of s.track.segments){if(!t.points.length)return!1;for(const a of t.points)if(!es(a.lat,a.lng))return!1}return!0}function es(s,t){return s>=-90&&s<=90&&t>=-180&&t<=180}const ts={gpx:{format:"gpx",mimeType:"application/gpx+xml",extension:".gpx",supportsElevation:!0,supportsInstructions:!0},kml:{format:"kml",mimeType:"application/vnd.google-earth.kml+xml",extension:".kml",supportsElevation:!0,supportsInstructions:!1},json:{format:"json",mimeType:"application/json",extension:".json",supportsElevation:!0,supportsInstructions:!0},csv:{format:"csv",mimeType:"text/csv",extension:".csv",supportsElevation:!0,supportsInstructions:!1}};class Os{static async exportToGPX(t,a,n,r={}){try{const l={...this.DEFAULT_OPTIONS,...r},i=xt(t,a,n);if(!pt(i))return{success:!1,error:"Invalid route data for export",format:"gpx"};const d=this.generateGPXContent(i,l),o=this.generateFilename(i.name,"gpx");return{success:!0,data:d,filename:o,format:"gpx",size:new Blob([d]).size}}catch(l){return console.error("GPX export error:",l),{success:!1,error:l instanceof Error?l.message:"Unknown export error",format:"gpx"}}}static generateGPXContent(t,a){const n=this.escapeXML(t.name),r=this.escapeXML(t.description);let l=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="${this.escapeXML(a.creator||"Camper Planner")}"
     xmlns="http://www.topografix.com/GPX/1/1"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
`;return a.includeMetadata&&(l+=`  <metadata>
    <name>${n}</name>
    <desc>${r}</desc>
    <author>
      <name>${this.escapeXML(t.metadata.creator)}</name>
    </author>
    <time>${t.metadata.timestamp}</time>
    <bounds minlat="${t.track.bounds.south}" minlon="${t.track.bounds.west}"
            maxlat="${t.track.bounds.north}" maxlon="${t.track.bounds.east}"/>
`,t.metadata.vehicleProfile&&(l+=`    <extensions>
      <vehicle_profile>
        <height>${t.metadata.vehicleProfile.height}</height>
        <width>${t.metadata.vehicleProfile.width}</width>
        <length>${t.metadata.vehicleProfile.length}</length>
        <weight>${t.metadata.vehicleProfile.weight}</weight>
      </vehicle_profile>
`,t.metadata.restrictions&&(l+=`      <restrictions>
        <violated_dimensions>${t.metadata.restrictions.violatedDimensions.join(", ")}</violated_dimensions>
        <warnings>${t.metadata.restrictions.warnings.join("; ")}</warnings>
      </restrictions>
`),l+=`    </extensions>
`),l+=`  </metadata>
`),a.includeWaypoints&&t.waypoints.forEach(i=>{l+=`  <wpt lat="${i.lat}" lon="${i.lng}">
    <name>${this.escapeXML(i.name)}</name>
    <type>${i.type}</type>
`,i.description&&(l+=`    <desc>${this.escapeXML(i.description)}</desc>
`),i.elevation&&a.includeElevation&&(l+=`    <ele>${i.elevation}</ele>
`),l+=`    <extensions>
      <order>${i.order}</order>
      <waypoint_type>${i.type}</waypoint_type>
    </extensions>
`,l+=`  </wpt>
`}),a.includeTrackPoints&&(l+=`  <trk>
    <name>${n} Track</name>
    <desc>Route track with ${t.track.segments.length} segments</desc>
    <extensions>
      <total_distance>${t.track.totalDistance}</total_distance>
      <total_duration>${t.track.totalDuration}</total_duration>
      <service>${this.escapeXML(t.metadata.service)}</service>
      <profile>${this.escapeXML(t.metadata.profile)}</profile>
    </extensions>
`,t.track.segments.forEach((i,d)=>{l+=`    <trkseg>
`,i.points.forEach(o=>{l+=`      <trkpt lat="${o.lat}" lon="${o.lng}">
`,o.elevation&&a.includeElevation&&(l+=`        <ele>${o.elevation}</ele>
`),o.time&&(l+=`        <time>${o.time}</time>
`),o.distance!==void 0&&(l+=`        <extensions>
          <distance>${o.distance}</distance>
        </extensions>
`),l+=`      </trkpt>
`}),a.includeInstructions&&i.instructions&&i.instructions.forEach((o,g)=>{l+=`      <!-- Instruction ${g+1}: ${this.escapeXML(o.instruction)} -->
      <trkpt lat="${o.coordinates[1]}" lon="${o.coordinates[0]}">
        <name>Instruction ${g+1}</name>
        <desc>${this.escapeXML(o.instruction)}</desc>
        <extensions>
          <instruction>
            <text>${this.escapeXML(o.instruction)}</text>
            <distance>${o.distance}</distance>
            <duration>${o.duration}</duration>
            ${o.direction?`<direction>${this.escapeXML(o.direction)}</direction>`:""}
            ${o.streetName?`<street>${this.escapeXML(o.streetName)}</street>`:""}
          </instruction>
        </extensions>
      </trkpt>
`}),l+=`    </trkseg>
`}),l+=`  </trk>
`),l+=`  <rte>
    <name>${n} Route</name>
    <desc>Waypoint-based route</desc>
`,t.waypoints.forEach(i=>{l+=`    <rtept lat="${i.lat}" lon="${i.lng}">
      <name>${this.escapeXML(i.name)}</name>
      <desc>${i.type}</desc>
    </rtept>
`}),l+=`  </rte>
`,l+="</gpx>",l}static async downloadGPX(t,a,n,r){try{const l=await this.exportToGPX(t,a,n,r);if(!l.success||!l.data||!l.filename)throw new Error(l.error||"Export failed");const i=new Blob([l.data],{type:"application/gpx+xml"}),d=URL.createObjectURL(i),o=document.createElement("a");return o.href=d,o.download=l.filename,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d),!0}catch(l){return console.error("GPX download error:",l),!1}}static validateGPX(t){const a=[];t.includes("<?xml")||a.push("Missing XML declaration"),t.includes("<gpx")||a.push("Missing GPX root element"),t.includes("</gpx>")||a.push("Missing closing GPX tag"),t.includes("<metadata>")||a.push("Missing metadata section");const n=/lat="(-?\d+\.?\d*)" lon="(-?\d+\.?\d*)"/g,r=[...t.matchAll(n)];for(const l of r){const i=parseFloat(l[1]),d=parseFloat(l[2]);(i<-90||i>90)&&a.push(`Invalid latitude: ${i}`),(d<-180||d>180)&&a.push(`Invalid longitude: ${d}`)}return{valid:a.length===0,errors:a}}static getExportStats(t){const a=t.track.segments.reduce((l,i)=>l+i.points.length,0),n=t.track.segments.some(l=>l.points.some(i=>i.elevation!==void 0)),r=t.track.segments.some(l=>l.instructions&&l.instructions.length>0);return{waypoints:t.waypoints.length,trackPoints:a,segments:t.track.segments.length,distance:`${(t.track.totalDistance/1e3).toFixed(1)} km`,duration:this.formatDuration(t.track.totalDuration),hasElevation:n,hasInstructions:r}}static escapeXML(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}static generateFilename(t,a){const n=t.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"_").toLowerCase(),r=new Date().toISOString().split("T")[0];return`${n}_${r}.${a}`}static formatDuration(t){const a=Math.floor(t/3600),n=Math.floor(t%3600/60);return a>0?`${a}h ${n}m`:`${n}m`}}Ae(Os,"DEFAULT_OPTIONS",{includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner"});class ba{static async exportRoute(t,a,n,r,l={}){const i={includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner",format:n,...l};try{switch(n){case"gpx":return await Os.exportToGPX(t,a,r,i);case"kml":return await this.exportToKML(t,a,r,i);case"json":return await this.exportToJSON(t,a,r,i);case"csv":return await this.exportToCSV(t,a,r,i);default:return{success:!1,error:`Unsupported format: ${n}`,format:n}}}catch(d){return console.error(`${n.toUpperCase()} export error:`,d),{success:!1,error:d instanceof Error?d.message:"Unknown export error",format:n}}}static async exportToKML(t,a,n,r={}){const l=xt(t,a,n);if(!pt(l))return{success:!1,error:"Invalid route data for KML export",format:"kml"};const i=this.generateKMLContent(l,r),d=this.generateFilename(l.name,"kml");return{success:!0,data:i,filename:d,format:"kml",size:new Blob([i]).size}}static generateKMLContent(t,a){const n=this.escapeXML(t.name),r=this.escapeXML(t.description);let l=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <name>${n}</name>
    <description>${r}</description>
`;return l+=`    <!-- Styles -->
    <Style id="start-point">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/grn-circle.png</href></Icon>
        <scale>1.2</scale>
      </IconStyle>
    </Style>
    <Style id="end-point">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/red-circle.png</href></Icon>
        <scale>1.2</scale>
      </IconStyle>
    </Style>
    <Style id="waypoint">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/blu-circle.png</href></Icon>
      </IconStyle>
    </Style>
    <Style id="campsite">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/ylw-stars.png</href></Icon>
      </IconStyle>
    </Style>
    <Style id="route-line">
      <LineStyle>
        <color>ff0000ff</color>
        <width>4</width>
      </LineStyle>
    </Style>
`,a.includeWaypoints&&(l+=`    <!-- Waypoints -->
    <Folder>
      <name>Waypoints</name>
`,t.waypoints.forEach((i,d)=>{let o="waypoint";i.type==="start"?o="start-point":i.type==="end"?o="end-point":i.type==="campsite"&&(o="campsite"),l+=`      <Placemark>
        <name>${this.escapeXML(i.name)}</name>
        <description>
          <![CDATA[
            <strong>Type:</strong> ${i.type}<br/>
            <strong>Position:</strong> ${d+1} of ${t.waypoints.length}<br/>
            <strong>Coordinates:</strong> ${i.lat.toFixed(4)}, ${i.lng.toFixed(4)}
            ${i.description?`<br/><strong>Description:</strong> ${i.description}`:""}
          ]]>
        </description>
        <styleUrl>#${o}</styleUrl>
        <Point>
          <coordinates>${i.lng},${i.lat}${i.elevation?`,${i.elevation}`:""}</coordinates>
        </Point>
      </Placemark>
`}),l+=`    </Folder>
`),a.includeTrackPoints&&(l+=`    <!-- Route Track -->
    <Placemark>
      <name>${n} Track</name>
      <description>
        <![CDATA[
          <strong>Distance:</strong> ${(t.track.totalDistance/1e3).toFixed(1)} km<br/>
          <strong>Duration:</strong> ${this.formatDuration(t.track.totalDuration)}<br/>
          <strong>Service:</strong> ${t.metadata.service}<br/>
          <strong>Profile:</strong> ${t.metadata.profile}
        ]]>
      </description>
      <styleUrl>#route-line</styleUrl>
      <LineString>
        <tessellate>1</tessellate>
        <coordinates>
`,t.track.segments.forEach(i=>{i.points.forEach(d=>{l+=`          ${d.lng},${d.lat}${d.elevation?`,${d.elevation}`:",0"}
`})}),l+=`        </coordinates>
      </LineString>
    </Placemark>
`),a.includeInstructions&&(l+=`    <!-- Instructions -->
    <Folder>
      <name>Turn Instructions</name>
`,t.track.segments.forEach((i,d)=>{i.instructions&&i.instructions.forEach((o,g)=>{l+=`      <Placemark>
        <name>Instruction ${d+1}.${g+1}</name>
        <description>
          <![CDATA[
            ${this.escapeXML(o.instruction)}<br/>
            <strong>Distance:</strong> ${(o.distance/1e3).toFixed(1)} km<br/>
            <strong>Duration:</strong> ${this.formatDuration(o.duration)}
            ${o.streetName?`<br/><strong>Street:</strong> ${this.escapeXML(o.streetName)}`:""}
            ${o.direction?`<br/><strong>Direction:</strong> ${this.escapeXML(o.direction)}`:""}
          ]]>
        </description>
        <Point>
          <coordinates>${o.coordinates[0]},${o.coordinates[1]},0</coordinates>
        </Point>
      </Placemark>
`})}),l+=`    </Folder>
`),l+=`  </Document>
</kml>`,l}static async exportToJSON(t,a,n,r={}){const l=xt(t,a,n);if(!pt(l))return{success:!1,error:"Invalid route data for JSON export",format:"json"};const i={...l,exportInfo:{format:"json",version:"1.0",exportedAt:new Date().toISOString(),exportedBy:r.creator||"European Camper Trip Planner",options:{includeWaypoints:r.includeWaypoints,includeTrackPoints:r.includeTrackPoints,includeInstructions:r.includeInstructions,includeElevation:r.includeElevation,includeMetadata:r.includeMetadata}},statistics:{totalWaypoints:l.waypoints.length,totalTrackPoints:l.track.segments.reduce((g,h)=>g+h.points.length,0),totalSegments:l.track.segments.length,totalInstructions:l.track.segments.reduce((g,h)=>g+(h.instructions?.length||0),0),hasElevation:l.track.segments.some(g=>g.points.some(h=>h.elevation!==void 0)),bounds:l.track.bounds}},d=JSON.stringify(i,null,2),o=this.generateFilename(l.name,"json");return{success:!0,data:d,filename:o,format:"json",size:new Blob([d]).size}}static async exportToCSV(t,a,n,r={}){const l=xt(t,a,n);if(!pt(l))return{success:!1,error:"Invalid route data for CSV export",format:"csv"};let i="";r.includeWaypoints&&(i+=`# Waypoints
`,i+=`ID,Name,Type,Latitude,Longitude,Elevation,Order,Description
`,l.waypoints.forEach(o=>{i+=`"${o.id}","${this.escapeCSV(o.name)}","${o.type}",${o.lat},${o.lng},${o.elevation||""},${o.order},"${this.escapeCSV(o.description||"")}"
`}),i+=`
`),r.includeTrackPoints&&(i+=`# Track Points
`,i+=`Segment,Point_Index,Latitude,Longitude,Elevation,Distance,Time
`,l.track.segments.forEach((o,g)=>{o.points.forEach((h,m)=>{i+=`${g+1},${m+1},${h.lat},${h.lng},${h.elevation||""},${h.distance||""},${h.time||""}
`})}),i+=`
`),r.includeInstructions&&(i+=`# Instructions
`,i+=`Segment,Instruction_Index,Instruction,Distance,Duration,Direction,Street_Name,Latitude,Longitude
`,l.track.segments.forEach((o,g)=>{o.instructions&&o.instructions.forEach((h,m)=>{i+=`${g+1},${m+1},"${this.escapeCSV(h.instruction)}",${h.distance},${h.duration},"${this.escapeCSV(h.direction||"")}","${this.escapeCSV(h.streetName||"")}",${h.coordinates[1]},${h.coordinates[0]}
`})}),i+=`
`),i+=`# Route Summary
`,i+=`Property,Value
`,i+=`"Route Name","${this.escapeCSV(l.name)}"
`,i+=`"Description","${this.escapeCSV(l.description)}"
`,i+=`"Total Distance (km)","${(l.track.totalDistance/1e3).toFixed(2)}"
`,i+=`"Total Duration","${this.formatDuration(l.track.totalDuration)}"
`,i+=`"Total Waypoints","${l.waypoints.length}"
`,i+=`"Total Segments","${l.track.segments.length}"
`,i+=`"Service","${l.metadata.service}"
`,i+=`"Profile","${l.metadata.profile}"
`,i+=`"Created","${l.metadata.timestamp}"
`;const d=this.generateFilename(l.name,"csv");return{success:!0,data:i,filename:d,format:"csv",size:new Blob([i]).size}}static async downloadRoute(t,a,n,r,l){try{const i=await this.exportRoute(t,a,n,r,l);if(!i.success||!i.data||!i.filename)throw new Error(i.error||"Export failed");const d=ts[n],o=new Blob([i.data],{type:d.mimeType}),g=URL.createObjectURL(o),h=document.createElement("a");return h.href=g,h.download=i.filename,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(g),!0}catch(i){return console.error(`${n.toUpperCase()} download error:`,i),!1}}static getAvailableFormats(){return Object.values(ts).map(t=>({...t,capabilities:["Waypoints",...t.supportsElevation?["Elevation"]:[],...t.supportsInstructions?["Turn Instructions"]:[],"Track Points","Metadata"]}))}static escapeXML(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}static escapeCSV(t){return t?t.replace(/"/g,'""'):""}static generateFilename(t,a){const n=t.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"_").toLowerCase(),r=new Date().toISOString().split("T")[0];return`${n}_${r}.${a}`}static formatDuration(t){const a=Math.floor(t/3600),n=Math.floor(t%3600/60);return a>0?`${a}h ${n}m`:`${n}m`}}const va=({className:s="",onTripLoad:t,onClose:a,isVisible:n=!0})=>{const{waypoints:r}=ce(),{profile:l}=he(),{settings:i}=Fe(),d={consumptionType:i.fuelConsumption.unit==="l_per_100km"?"l_per_100km":i.fuelConsumption.unit==="mpg_imperial"?"mpg_imperial":"mpg_us",consumption:i.fuelConsumption.value,fuelType:i.fuelConsumption.fuelType==="electric"?"electricity":i.fuelConsumption.fuelType,tankCapacity:i.fuelConsumption.tankCapacity},o={priceType:"manual",currency:i.currency},[g,h]=c.useState("my_trips"),[m,u]=c.useState([]),[v,N]=c.useState([]),[S,k]=c.useState([]),[C,x]=c.useState([]),[w,f]=c.useState(null),[E,W]=c.useState(""),[D,O]=c.useState("all"),[G,K]=c.useState("all"),[B,p]=c.useState(!1),[I,F]=c.useState(null),[Z,Y]=c.useState(!1),[se,R]=c.useState({name:"",description:"",category:"leisure",tags:[],isPublic:!1}),[$,J]=c.useState(!1),[M,z]=c.useState(""),[q,T]=c.useState(!1),[j,H]=c.useState(null),[y,P]=c.useState("gpx"),[U,ae]=c.useState({includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner"});c.useEffect(()=>{ee(),X(),le()},[]);const re=m.filter(b=>{const A=b.name.toLowerCase().includes(E.toLowerCase())||b.tags.some(ie=>ie.toLowerCase().includes(E.toLowerCase())),V=D==="all"||b.category===D;return A&&V}),Q=v.filter(b=>{const A=b.metadata.name.toLowerCase().includes(E.toLowerCase())||b.metadata.tags.some(Ne=>Ne.toLowerCase().includes(E.toLowerCase())),V=D==="all"||b.metadata.category===D,ie=G==="all"||b.metadata.difficulty===G;return A&&V&&ie}),ee=async()=>{try{const b=await ke.getTripSummaries({excludeTemplates:!0});u(b)}catch{F("Failed to load trips")}},X=async()=>{try{N([])}catch{F("Failed to load templates")}},le=async()=>{try{const b=await ke.getRecentTrips(10);k(b)}catch{}},ne=async()=>{if(r.length<2){F("Add at least 2 waypoints to save a trip");return}Y(!0)},oe=async()=>{if(!se.name.trim()){F("Trip name is required");return}p(!0);try{const b=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,A=rt(r),V=Math.ceil(r.length/2),ie=100*r.length,Ne={metadata:{id:b,name:se.name,description:se.description,category:se.category,tags:se.tags,duration:V,difficulty:"moderate",season:"year_round",countries:A,estimatedCost:ie,currency:"EUR",isTemplate:!1,isPublic:se.isPublic},data:{waypoints:r,vehicleProfile:l||void 0,routePreferences:{avoidTolls:!1,avoidFerries:!1,preferScenic:!1,fuelEfficient:!0},campsiteSelections:[],costCalculations:{breakdown:{totalCost:ie,fuelCost:ie*.6,tollCost:0,accommodationCost:ie*.4,foodCost:0,ferryCost:0,otherCosts:0,currency:"EUR",segments:[],dailyBreakdown:[]},fuelSettings:d,priceSettings:o,lastCalculated:new Date},settings:Fe.getState().settings}};await ke.saveTrip(Ne),await ee(),Y(!1),R({name:"",description:"",category:"leisure",tags:[],isPublic:!1})}catch{F("Failed to save trip")}finally{p(!1)}},pe=async b=>{p(!0);try{const A=await ke.loadTrip(b);A&&t&&(t(A),A.data.settings&&Fe.getState().loadSettings(A.data.settings),await le())}catch{F("Failed to load trip")}finally{p(!1)}},ge=async b=>{p(!0);try{await ke.duplicateTrip(b),await ee()}catch{F("Failed to duplicate trip")}finally{p(!1)}},xe=async b=>{if(confirm("Are you sure you want to delete this trip?")){p(!0);try{await ke.deleteTrip(b),await ee()}catch{F("Failed to delete trip")}finally{p(!1)}}},fe=b=>{H(b),T(!0)},je=async()=>{if(j)try{p(!0);const b=await ke.loadTrip(j);if(!b)throw new Error("Trip not found");const A=at(b),V={format:y,includeWaypoints:U.includeWaypoints??!0,includeTrackPoints:U.includeTrackPoints??!0,includeInstructions:U.includeInstructions??!0,includeElevation:U.includeElevation??!0,includeMetadata:U.includeMetadata??!0,creator:U.creator||"European Camper Trip Planner",description:`${b.metadata.name} - ${b.metadata.description||"Exported from Trip Manager"}`};if(await ba.downloadRoute(A,b.data.waypoints,y,b.metadata.name,V))T(!1),H(null);else throw new Error("Export download failed")}catch{F("Failed to export trip")}finally{p(!1)}},be=async()=>{if(!M.trim()){F("Please paste trip data to import");return}p(!0);try{await ke.importTrip(M)?(await ee(),J(!1),z("")):F("Invalid trip data format")}catch{F("Failed to import trip")}finally{p(!1)}},we=async b=>{p(!0);try{F("Templates not available in MVP version")}catch{F("Failed to create trip from template")}finally{p(!1)}},Re=async()=>{if(C.length<2){F("Select at least 2 trips to compare");return}p(!0);try{const b=await ke.compareTrips(C);f(b),h("comparison")}catch{F("Failed to compare trips")}finally{p(!1)}},_e=(b,A)=>{const ie=(A.lat-b.lat)*Math.PI/180,Ne=(A.lng-b.lng)*Math.PI/180,Ve=Math.sin(ie/2)*Math.sin(ie/2)+Math.cos(b.lat*Math.PI/180)*Math.cos(A.lat*Math.PI/180)*Math.sin(Ne/2)*Math.sin(Ne/2);return 6371*(2*Math.atan2(Math.sqrt(Ve),Math.sqrt(1-Ve)))},de=b=>{if(b.length<2)return 0;let A=0;for(let V=0;V<b.length-1;V++)A+=_e(b[V],b[V+1]);return A},at=b=>{const A=b.data.waypoints;return{id:`trip_${b.metadata.id}`,status:"success",routes:[{geometry:{coordinates:A.map(V=>[V.lng,V.lat]),type:"LineString"},summary:{distance:A.length>1?de(A)*1e3:0,duration:A.length>1?de(A)/70*3600:0},waypoints:A.map((V,ie)=>ie),segments:[{distance:A.length>1?de(A)*1e3:0,duration:A.length>1?de(A)/70*3600:0,steps:A.map((V,ie)=>({instruction:ie===0?`Start at ${V.name}`:`Continue to ${V.name}`,name:V.name,distance:ie>0?_e(A[ie-1],V)*1e3:0,duration:ie>0?_e(A[ie-1],V)/70*3600:0,geometry:{coordinates:[V.lng,V.lat]},maneuver:{location:[V.lng,V.lat]},wayPoints:[0,1]}))}]}],metadata:{service:"openrouteservice",profile:b.data.vehicleProfile?.type||"driving-hgv",timestamp:Date.now(),query:{waypoints:A,vehicleProfile:b.data.vehicleProfile},attribution:"OpenRouteService"}}},rt=b=>{const A=new Set;return b.forEach(V=>{V.lat>=46&&V.lat<=51&&V.lng>=-5&&V.lng<=10&&A.add("France"),V.lat>=47&&V.lat<=55&&V.lng>=5&&V.lng<=15&&A.add("Germany"),V.lat>=36&&V.lat<=47&&V.lng>=6&&V.lng<=19&&A.add("Italy"),V.lat>=36&&V.lat<=44&&V.lng>=-10&&V.lng<=5&&A.add("Spain")}),Array.from(A)},ve=(b,A="EUR")=>new Intl.NumberFormat("en-EU",{style:"currency",currency:A,minimumFractionDigits:0,maximumFractionDigits:0}).format(b),Me=b=>{switch(b){case"adventure":return e.jsx(Es,{className:"w-4 h-4"});case"romantic":return e.jsx(Xs,{className:"w-4 h-4"});case"business":return e.jsx(Ks,{className:"w-4 h-4"});case"family":return e.jsx(Rt,{className:"w-4 h-4"});default:return e.jsx(vn,{className:"w-4 h-4"})}},Nt=b=>{switch(b){case"easy":return"text-green-600 bg-green-100";case"moderate":return"text-yellow-600 bg-yellow-100";case"challenging":return"text-red-600 bg-red-100";default:return"text-neutral-600 bg-neutral-100"}};return n?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-primary-50 to-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gt,{className:"w-6 h-6 text-primary-600"}),e.jsx("h2",{className:"text-xl font-display font-semibold text-neutral-800",children:"Trip Manager"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ne,disabled:r.length<2,className:"flex items-center gap-2 px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Save Current"]}),a&&e.jsx("button",{onClick:a,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(Je,{className:"w-4 h-4 text-neutral-600"})})]})]}),e.jsx("div",{className:"flex border-b bg-neutral-50",children:[{id:"my_trips",label:"My Trips",icon:e.jsx(Kt,{className:"w-4 h-4"})},{id:"templates",label:"Templates",icon:e.jsx(Gt,{className:"w-4 h-4"})},{id:"recent",label:"Recent",icon:e.jsx(Ye,{className:"w-4 h-4"})}].map(b=>e.jsxs("button",{onClick:()=>h(b.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors ${g===b.id?"text-primary-600 border-b-2 border-primary-600 bg-white":"text-neutral-500 hover:text-neutral-700"}`,children:[b.icon,b.label]},b.id))}),I&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:I}),e.jsx("button",{onClick:()=>F(null),className:"ml-auto p-1 hover:bg-red-100 rounded",children:e.jsx(Je,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"p-4 border-b bg-neutral-50",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-neutral-400"}),e.jsx("input",{type:"text",placeholder:"Search trips, tags, or countries...",value:E,onChange:b=>W(b.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:D,onChange:b=>O(b.target.value),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"leisure",children:"Leisure"}),e.jsx("option",{value:"adventure",children:"Adventure"}),e.jsx("option",{value:"romantic",children:"Romantic"}),e.jsx("option",{value:"family",children:"Family"}),e.jsx("option",{value:"business",children:"Business"})]}),g==="templates"&&e.jsxs("select",{value:G,onChange:b=>K(b.target.value),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"challenging",children:"Challenging"})]})]})]})}),e.jsxs("div",{className:"p-4",children:[g==="my_trips"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-display font-medium text-neutral-800",children:["My Trips (",re.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>J(!0),className:"flex items-center gap-2 px-3 py-2 border rounded-lg hover:bg-neutral-50 text-sm",children:[e.jsx(ia,{className:"w-4 h-4"}),"Import"]}),C.length>=2&&e.jsxs("button",{onClick:Re,className:"flex items-center gap-2 px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm",children:[e.jsx(vs,{className:"w-4 h-4"}),"Compare (",C.length,")"]})]})]}),re.length===0?e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(gt,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:"No trips found. Start by saving your current route or using a template."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:re.map(b=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C.includes(b.id),onChange:A=>{A.target.checked?x([...C,b.id]):x(C.filter(V=>V!==b.id))},className:"rounded"}),e.jsxs("div",{className:"flex items-center gap-2",children:[Me(b.category),e.jsx("h4",{className:"font-semibold text-neutral-800",children:b.name})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>pe(b.id),className:"p-1 hover:bg-primary-100 rounded text-primary-600",title:"Load trip",children:e.jsx(xs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ge(b.id),className:"p-1 hover:bg-green-100 rounded text-green-600",title:"Duplicate trip",children:e.jsx(Cn,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>fe(b.id),className:"p-1 hover:bg-purple-100 rounded text-purple-600",title:"Export trip",children:e.jsx(Wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>xe(b.id),className:"p-1 hover:bg-red-100 rounded text-red-600",title:"Delete trip",children:e.jsx(st,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-neutral-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-4 h-4"}),b.duration," days"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(It,{className:"w-4 h-4"}),ve(b.estimatedCost)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),b.waypointCount," stops"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(js,{className:"w-4 h-4"}),b.countries.length," countries"]})]}),b.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[b.tags.slice(0,3).map(A=>e.jsx("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs",children:A},A)),b.tags.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-neutral-100 text-neutral-600 rounded-full text-xs",children:["+",b.tags.length-3," more"]})]}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Last modified: ",b.lastModified.toLocaleDateString()]})]},b.id))})]}),g==="templates"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-display font-medium text-neutral-800",children:["Trip Templates (",Q.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Q.map(b=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Me(b.metadata.category),e.jsx("h4",{className:"font-semibold text-neutral-800",children:b.metadata.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${Nt(b.metadata.difficulty)}`,children:b.metadata.difficulty}),e.jsx("button",{onClick:()=>we(),className:"px-3 py-1 bg-primary-600 text-white rounded text-sm hover:bg-primary-700",children:"Use Template"})]})]}),e.jsx("p",{className:"text-sm text-neutral-600 mb-3",children:b.metadata.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-neutral-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-4 h-4"}),b.metadata.duration," days"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(It,{className:"w-4 h-4"}),ve(b.metadata.estimatedCost)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),b.data.waypoints.length," stops"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Gt,{className:"w-4 h-4"}),b.templateInfo.popularity,"% popularity"]})]}),e.jsxs("div",{className:"text-sm mb-3",children:[e.jsx("strong",{children:"Countries: "}),b.metadata.countries.join(", ")]}),e.jsxs("div",{className:"text-sm mb-3",children:[e.jsx("strong",{children:"Best months: "}),b.templateInfo.recommendedMonths.map(A=>new Date(2024,A-1,1).toLocaleDateString("en",{month:"short"})).join(", ")]}),b.templateInfo.highlights.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Highlights:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[b.templateInfo.highlights.slice(0,2).map((A,V)=>e.jsxs("li",{className:"text-neutral-600",children:["â€¢ ",A]},V)),b.templateInfo.highlights.length>2&&e.jsxs("li",{className:"text-neutral-500",children:["â€¢ +",b.templateInfo.highlights.length-2," more highlights"]})]})]})]},b.metadata.id))})]}),g==="recent"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-display font-medium text-neutral-800",children:["Recent Trips (",S.length,")"]})}),S.length===0?e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(Ye,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:"No recent trips. Start planning your next adventure!"})]}):e.jsx("div",{className:"space-y-3",children:S.map(b=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-neutral-50 cursor-pointer",role:"button",tabIndex:0,onClick:()=>pe(b.id),onKeyDown:A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),pe(b.id))},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Me(b.category),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-neutral-800",children:b.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-600",children:[e.jsxs("span",{children:[b.duration," days"]}),e.jsx("span",{children:ve(b.estimatedCost)}),e.jsxs("span",{children:[b.waypointCount," stops"]})]})]})]}),e.jsx("div",{className:"text-sm text-neutral-500",children:b.lastOpened.toLocaleDateString()})]},b.id))})]}),g==="comparison"&&w&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-display font-medium text-neutral-800",children:"Trip Comparison"}),e.jsx("button",{onClick:()=>h("my_trips"),className:"text-primary-600 hover:text-primary-700",children:"Back to My Trips"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-neutral-800 mb-3",children:"Cost Comparison"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.trips.map(b=>{const A=w.comparison.costs[b.metadata.id],V=w.comparison.analysis.cheapest===b.metadata.id;return e.jsxs("div",{className:`p-4 rounded-lg border ${V?"border-green-500 bg-green-50":"border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Me(b.metadata.category),e.jsx("h5",{className:"font-medium",children:b.metadata.name}),V&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs",children:"Cheapest"})]}),A&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"font-medium",children:ve(A.total)})]}),e.jsxs("div",{className:"flex justify-between text-neutral-600",children:[e.jsx("span",{children:"Fuel:"}),e.jsx("span",{children:ve(A.fuel)})]}),e.jsxs("div",{className:"flex justify-between text-neutral-600",children:[e.jsx("span",{children:"Accommodation:"}),e.jsx("span",{children:ve(A.accommodation)})]}),e.jsxs("div",{className:"flex justify-between text-neutral-600",children:[e.jsx("span",{children:"Tolls:"}),e.jsx("span",{children:ve(A.tolls)})]})]})]},b.metadata.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-neutral-800 mb-3",children:"Route Comparison"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-neutral-200 rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-neutral-50",children:[e.jsx("th",{className:"border border-neutral-200 px-4 py-2 text-left",children:"Trip"}),e.jsx("th",{className:"border border-neutral-200 px-4 py-2 text-left",children:"Distance"}),e.jsx("th",{className:"border border-neutral-200 px-4 py-2 text-left",children:"Duration"}),e.jsx("th",{className:"border border-neutral-200 px-4 py-2 text-left",children:"Waypoints"}),e.jsx("th",{className:"border border-neutral-200 px-4 py-2 text-left",children:"Countries"})]})}),e.jsx("tbody",{children:w.trips.map(b=>{const A=w.comparison.routes[b.metadata.id],V=w.comparison.analysis.shortest===b.metadata.id,ie=w.comparison.analysis.fastest===b.metadata.id;return e.jsxs("tr",{className:"hover:bg-neutral-50",children:[e.jsx("td",{className:"border border-neutral-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Me(b.metadata.category),b.metadata.name]})}),e.jsxs("td",{className:"border border-neutral-200 px-4 py-2",children:[e.jsxs("span",{className:V?"font-semibold text-green-600":"",children:[A.distance.toFixed(0),"km"]}),V&&e.jsx("span",{className:"ml-1 text-xs text-green-600",children:"(shortest)"})]}),e.jsxs("td",{className:"border border-neutral-200 px-4 py-2",children:[e.jsxs("span",{className:ie?"font-semibold text-primary-600":"",children:[A.duration.toFixed(1),"h"]}),ie&&e.jsx("span",{className:"ml-1 text-xs text-primary-600",children:"(fastest)"})]}),e.jsx("td",{className:"border border-neutral-200 px-4 py-2",children:A.waypointCount}),e.jsx("td",{className:"border border-neutral-200 px-4 py-2",children:A.countries.join(", ")})]},b.metadata.id)})})]})})]}),w.comparison.analysis.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-neutral-800 mb-3",children:"Recommendations"}),e.jsx("div",{className:"space-y-3",children:w.comparison.analysis.recommendations.map((b,A)=>{const V=w.trips.find(ie=>ie.metadata.id===b.tripId);return e.jsxs("div",{className:"p-4 bg-primary-50 rounded-lg border border-primary-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[V&&Me(V.metadata.category),e.jsx("span",{className:"font-medium text-primary-800",children:V?.metadata.name})]}),e.jsxs("div",{className:"text-primary-700",children:[e.jsx("div",{className:"font-medium",children:b.reason}),e.jsx("div",{className:"text-sm",children:b.advantage})]})]},A)})})]})]})]})]}),B&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-display font-semibold",children:"Save Current Trip"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-save-name",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Trip Name *"}),e.jsx("input",{id:"trip-save-name",type:"text",value:se.name,onChange:b=>R({...se,name:b.target.value}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"My European Adventure"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-save-description",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Description"}),e.jsx("textarea",{id:"trip-save-description",value:se.description,onChange:b=>R({...se,description:b.target.value}),className:"w-full px-3 py-2 border rounded-lg resize-none",rows:3,placeholder:"Describe your trip..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-save-category",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Category"}),e.jsxs("select",{id:"trip-save-category",value:se.category,onChange:b=>R({...se,category:b.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"leisure",children:"Leisure"}),e.jsx("option",{value:"adventure",children:"Adventure"}),e.jsx("option",{value:"romantic",children:"Romantic"}),e.jsx("option",{value:"family",children:"Family"}),e.jsx("option",{value:"business",children:"Business"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-save-tags",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Tags (comma-separated)"}),e.jsx("input",{id:"trip-save-tags",type:"text",value:se.tags.join(", "),onChange:b=>R({...se,tags:b.target.value.split(",").map(A=>A.trim()).filter(Boolean)}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"scenic, historic, wine-tasting"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isPublic",checked:se.isPublic,onChange:b=>R({...se,isPublic:b.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"isPublic",className:"ml-2 text-sm text-neutral-700",children:"Make trip public (for future sharing features)"})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Y(!1),className:"px-4 py-2 border rounded-lg hover:bg-neutral-50",children:"Cancel"}),e.jsx("button",{onClick:oe,disabled:!se.name.trim(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:"Save Trip"})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-display font-semibold",children:"Import Trip"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("label",{htmlFor:"trip-import-data",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Paste trip data (JSON format):"}),e.jsx("textarea",{id:"trip-import-data",value:M,onChange:b=>z(b.target.value),className:"w-full px-3 py-2 border rounded-lg resize-none font-mono text-sm",rows:8,placeholder:"Paste the exported trip JSON data here..."})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>J(!1),className:"px-4 py-2 border rounded-lg hover:bg-neutral-50",children:"Cancel"}),e.jsx("button",{onClick:be,disabled:!M.trim(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:"Import Trip"})]})]})}),q&&j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-display font-semibold",children:"Export Trip"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Export Format"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"gpx",label:"GPX",desc:"For GPS devices"},{id:"kml",label:"KML",desc:"For Google Earth"},{id:"json",label:"JSON",desc:"Complete trip data"},{id:"csv",label:"CSV",desc:"For spreadsheets"}].map(b=>e.jsxs("label",{htmlFor:`export-format-${b.id}`,className:"relative",children:[e.jsx("span",{className:"sr-only",children:b.label}),e.jsx("input",{id:`export-format-${b.id}`,type:"radio",name:"exportFormat",value:b.id,checked:y===b.id,onChange:A=>P(A.target.value),className:"sr-only"}),e.jsxs("div",{className:`p-2 border-2 rounded-lg cursor-pointer transition-all text-center ${y===b.id?"border-primary-500 bg-primary-50":"border-neutral-200 hover:border-neutral-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:b.label}),e.jsx("div",{className:"text-xs text-neutral-500",children:b.desc})]})]},b.id))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Include Data"}),e.jsx("div",{className:"space-y-2",children:[{key:"includeWaypoints",label:"Route Waypoints"},{key:"includeTrackPoints",label:"Track Points"},{key:"includeInstructions",label:"Turn Instructions"},{key:"includeElevation",label:"Elevation Data"},{key:"includeMetadata",label:"Trip Metadata"}].map(b=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:U[b.key],onChange:A=>ae(V=>({...V,[b.key]:A.target.checked})),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-neutral-300 rounded"}),e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:b.label})]},b.key))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-export-creator",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Creator"}),e.jsx("input",{id:"trip-export-creator",type:"text",value:U.creator||"",onChange:b=>ae(A=>({...A,creator:b.target.value})),placeholder:"European Camper Trip Planner",className:"w-full px-3 py-2 border rounded-lg text-sm"})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{T(!1),H(null)},className:"px-4 py-2 border rounded-lg hover:bg-neutral-50",children:"Cancel"}),e.jsx("button",{onClick:je,disabled:B,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:B?"Exporting...":"Export Trip"})]})]})})]}):null},ss={motorhome:{maxDailyDistance:300,maxDailyDrivingTime:6,recommendedBreakInterval:2,breakDuration:20,averageSpeed:65},caravan:{maxDailyDistance:350,maxDailyDrivingTime:7,recommendedBreakInterval:2.5,breakDuration:15,averageSpeed:70},campervan:{maxDailyDistance:400,maxDailyDrivingTime:8,recommendedBreakInterval:3,breakDuration:15,averageSpeed:75},default:{maxDailyDistance:350,maxDailyDrivingTime:7,recommendedBreakInterval:2.5,breakDuration:15,averageSpeed:70}},ns={winter:{speedMultiplier:.8,distanceMultiplier:.7,difficultyIncrease:30},spring:{speedMultiplier:.95,distanceMultiplier:.9,difficultyIncrease:0},summer:{speedMultiplier:1,distanceMultiplier:1,difficultyIncrease:0},autumn:{speedMultiplier:.9,distanceMultiplier:.85,difficultyIncrease:10}};class Pe{static createTripPlan(t,a,n,r="summer"){if(t.length<2)throw new Error("At least 2 waypoints required for trip planning");const l=this.getDrivingLimits(a,r),i=this.calculateRouteSegments(t),d=this.planDailyStages(i,l,n,r),o=this.analyzeFeasibility(d,l),g=i.reduce((u,v)=>u+v.distance,0),h=i.reduce((u,v)=>u+v.drivingTime,0),m=this.calculateRestDays(d);return{totalDays:d.length+m,totalDistance:g,totalDrivingTime:h,startDate:n,endDate:n?new Date(n.getTime()+(d.length+m-1)*24*60*60*1e3):void 0,dailyStages:d,restDays:m,feasibilityScore:o.score,overallFeasibility:o.overall,warnings:o.warnings,recommendations:o.recommendations}}static getDrivingLimits(t,a="summer"){const n=t?.type||"default",r=ss[n]||ss.default,l=ns[a]||ns.summer;let i=1;if(t){const d=t.length||6,o=t.weight||3e3;d>8||o>4e3?i=.8:(d>7||o>3500)&&(i=.9)}return{maxDailyDistance:Math.round(r.maxDailyDistance*l.distanceMultiplier*i),maxDailyDrivingTime:Math.round(r.maxDailyDrivingTime*l.speedMultiplier*i*10)/10,recommendedBreakInterval:r.recommendedBreakInterval,breakDuration:r.breakDuration,averageSpeed:Math.round(r.averageSpeed*l.speedMultiplier)}}static calculateRouteSegments(t){const a=[];for(let n=0;n<t.length-1;n++){const r=t[n],l=t[n+1],i=this.calculateDistance(r,l),d=i/70;a.push({startWaypoint:r,endWaypoint:l,distance:i,drivingTime:d})}return a}static planDailyStages(t,a,n,r="summer"){const l=[];let i=1,d=n||new Date,o=0,g=0,h=[];return t.forEach((m,u)=>{(o+m.distance>a.maxDailyDistance||g+m.drivingTime>a.maxDailyDrivingTime)&&h.length>0&&(l.push(this.createDailyStage(i,d,h,o,g,a,r)),i++,d=new Date(d.getTime()+1440*60*1e3),o=0,g=0,h=[]),h.push(m),o+=m.distance,g+=m.drivingTime,u===t.length-1&&h.length>0&&l.push(this.createDailyStage(i,d,h,o,g,a,r))}),l}static createDailyStage(t,a,n,r,l,i,d){const o=n[0].startWaypoint,g=n[n.length-1].endWaypoint,h=this.planStopsForDay(n,l,i),m=this.determineAccommodationType(g,d),u=this.assessDayFeasibility(r,l,i),v=this.generateDayWarnings(r,l,i,d),N=this.generateDayRecommendations(r,l,i,d);return{day:t,date:a,startWaypoint:o,endWaypoint:g,distance:r,drivingTime:l,stops:h,accommodationType:m,feasibility:u,warnings:v,recommendations:N}}static planStopsForDay(t,a,n){const r=[],l=Math.floor(a/n.recommendedBreakInterval);for(let i=0;i<l;i++)r.push({waypointId:`break_${i}`,type:"rest",minDuration:n.breakDuration/60,recommendedDuration:n.breakDuration/60,maxDuration:1,reasoning:`Mandatory rest break after ${n.recommendedBreakInterval} hours of driving`});return t.forEach(i=>{this.isPointOfInterest(i.endWaypoint)&&r.push({waypointId:i.endWaypoint.id,type:"sightseeing",minDuration:1,recommendedDuration:2,maxDuration:4,reasoning:"Recommended sightseeing stop at point of interest"})}),a>4&&r.push({waypointId:"lunch",type:"lunch",minDuration:.5,recommendedDuration:1,maxDuration:2,reasoning:"Lunch break for long driving day"}),r}static determineAccommodationType(t,a){return!t||t.type==="campsite"?"campsite":t.type==="accommodation"||a==="winter"?"hotel":"campsite"}static assessDayFeasibility(t,a,n){const r=t/n.maxDailyDistance,l=a/n.maxDailyDrivingTime,i=Math.max(r,l);return i<=.7?"excellent":i<=.9?"good":i<=1.1?"challenging":"unrealistic"}static generateDayWarnings(t,a,n,r){const l=[];return t>n.maxDailyDistance&&l.push(`Daily distance of ${t.toFixed(0)}km exceeds recommended limit of ${n.maxDailyDistance}km`),a>n.maxDailyDrivingTime&&l.push(`Driving time of ${a.toFixed(1)}h exceeds recommended limit of ${n.maxDailyDrivingTime}h`),t>n.maxDailyDistance*1.2&&l.push("This is a very long driving day - consider splitting into multiple days"),r==="winter"&&t>n.maxDailyDistance*.8&&l.push("Winter driving conditions - allow extra time and reduce daily distance"),l}static generateDayRecommendations(t,a,n,r){const l=[];return a>4&&l.push("Plan multiple rest stops for this long driving day"),t<n.maxDailyDistance*.5&&l.push("Light driving day - perfect opportunity for sightseeing"),r==="summer"&&t>n.maxDailyDistance*.8&&l.push("Start early to avoid afternoon heat and traffic"),r==="winter"&&l.push("Check weather conditions and road status before departure"),l}static analyzeFeasibility(t,a){let n=0;const r=[],l=[];t.forEach((h,m)=>{let u=100;h.feasibility==="excellent"?u=100:h.feasibility==="good"?u=80:h.feasibility==="challenging"?u=60:h.feasibility==="unrealistic"&&(u=30),n+=u,h.feasibility==="unrealistic"&&r.push(`Day ${h.day}: Unrealistic driving distance/time`)});const i=t.reduce((h,m)=>h+m.distance,0)/t.length,d=this.findConsecutiveIntensiveDays(t);i>a.maxDailyDistance*.9&&(r.push("Overall trip intensity is very high - consider adding rest days"),n*=.9),d>=3&&(r.push("Multiple consecutive intensive driving days detected"),l.push("Consider adding rest days between intensive driving periods"),n*=.85),t.length>14&&l.push("Long trip - ensure adequate rest and recovery time");const o=n/t.length*(t.length<=21?1:.9);let g;return o>=85?g="excellent":o>=70?g="good":o>=50?g="challenging":g="unrealistic",{score:Math.round(o),overall:g,warnings:r,recommendations:l}}static getSeasonalFactors(t,a){const r={spring:{season:"spring",temperature:{min:8,max:18},precipitation:"medium",touristDensity:"medium",campsiteAvailability:"good",drivingConditions:"good",recommendations:["Perfect weather for touring, but pack layers","Some mountain passes may still be closed","Booking campsite in advance recommended"],warnings:["Variable weather conditions possible","Some seasonal businesses may not be open yet"]},summer:{season:"summer",temperature:{min:15,max:28},precipitation:"low",touristDensity:"high",campsiteAvailability:"limited",drivingConditions:"excellent",recommendations:["Book accommodations well in advance","Start driving early to avoid heat and traffic","Stay hydrated and use sun protection"],warnings:["Peak tourist season - expect crowds and higher prices","Extreme heat possible in southern regions"]},autumn:{season:"autumn",temperature:{min:5,max:15},precipitation:"medium",touristDensity:"low",campsiteAvailability:"good",drivingConditions:"good",recommendations:["Beautiful fall colors and fewer crowds","Pack warm clothing for cooler evenings","Great time for wine regions"],warnings:["Some campsites may close for winter","Daylight hours are decreasing"]},winter:{season:"winter",temperature:{min:-5,max:8},precipitation:"high",touristDensity:"low",campsiteAvailability:"poor",drivingConditions:"challenging",recommendations:["Focus on southern routes and cities","Book heated accommodations","Carry winter driving equipment"],warnings:["Many campsites closed in northern regions","Snow and ice possible - check road conditions","Shorter daylight hours limit driving time"]}}[t];return a.some(l=>["Norway","Sweden","Finland"].includes(l))&&t==="winter"?{...r,temperature:{min:-15,max:0},drivingConditions:"challenging",warnings:[...r.warnings,"Arctic conditions possible","Winter tires mandatory"]}:a.some(l=>["Spain","Portugal","Italy","Greece"].includes(l))&&t==="summer"?{...r,temperature:{min:20,max:40},warnings:[...r.warnings,"Extreme heat in inland areas","Air conditioning essential"]}:r}static calculateTripMetrics(t,a){const n=t.totalDistance/t.totalDays,r=t.restDays/t.totalDays,l=new Set(t.dailyStages.map(m=>this.getCountryFromWaypoint(m.endWaypoint))),i=new Set(t.dailyStages.map(m=>m.endWaypoint.type)),d=Math.min(100,l.size*20+i.size*10),o=t.dailyStages.filter(m=>m.feasibility==="challenging"||m.feasibility==="unrealistic").length,g=Math.min(100,o/t.dailyStages.length*100+n/500*50);let h;return n<200&&t.feasibilityScore>80?h="relaxed":n<300&&t.feasibilityScore>60?h="moderate":n<400&&t.feasibilityScore>40?h="intensive":h="extreme",{drivingIntensity:Math.round(n),restRatio:Math.round(r*100)/100,varietyScore:Math.round(d),difficultyScore:Math.round(g),comfortLevel:h,suitability:{beginners:h==="relaxed"&&g<30,families:h!=="extreme"&&g<50,experienced:!0,seniors:h==="relaxed"&&t.feasibilityScore>70}}}static generatePlanningRecommendations(t,a,n,r){const l=[];return a.difficultyScore>70&&l.push({type:"safety",priority:"high",title:"High Difficulty Trip",description:"This trip has challenging daily stages that may be tiring",action:"Add rest days between intensive driving periods",impact:"Improved safety and enjoyment"}),(a.comfortLevel==="intensive"||a.comfortLevel==="extreme")&&l.push({type:"comfort",priority:"medium",title:"Intensive Driving Schedule",description:"Multiple long driving days may be exhausting",action:"Consider reducing daily distances or adding overnight stops",impact:"More relaxed and enjoyable travel experience"}),n==="winter"&&l.push({type:"season",priority:"high",title:"Winter Travel Considerations",description:"Winter conditions require special preparation",action:"Pack winter gear, check road conditions, reduce daily distances",impact:"Safe winter travel"}),r&&r.type==="motorhome"&&r.length&&r.length>8&&l.push({type:"route",priority:"medium",title:"Large Vehicle Considerations",description:"Your large motorhome may face restrictions on some routes",action:"Check height and length restrictions, avoid narrow mountain roads",impact:"Avoid routing problems and damage"}),t.dailyStages.some(i=>i.accommodationType==="hotel")&&l.push({type:"cost",priority:"low",title:"Accommodation Cost Optimization",description:"Hotel stays increase trip costs significantly",action:"Consider campsites or wild camping where legal",impact:"Reduced accommodation costs"}),t.dailyStages.length>14&&l.push({type:"timing",priority:"medium",title:"Extended Trip Duration",description:"Long trips require careful planning and preparation",action:"Plan for vehicle maintenance, ensure adequate supplies",impact:"Smooth extended travel experience"}),l.sort((i,d)=>{const o={high:3,medium:2,low:1};return o[d.priority]-o[i.priority]})}static calculateRestDays(t){const a=t.filter(n=>n.distance>300||n.drivingTime>6).length;return Math.floor(a/3)}static findConsecutiveIntensiveDays(t){let a=0,n=0;return t.forEach(r=>{r.distance>300||r.drivingTime>6?(n++,a=Math.max(a,n)):n=0}),a}static isPointOfInterest(t){return!t||!t.name?!1:["castle","museum","cathedral","palace","historic","scenic"].some(n=>t.name.toLowerCase().includes(n))}static getCountryFromWaypoint(t){return t.lat>=46&&t.lat<=51&&t.lng>=-5&&t.lng<=10?"France":t.lat>=47&&t.lat<=55&&t.lng>=5&&t.lng<=15?"Germany":t.lat>=36&&t.lat<=47&&t.lng>=6&&t.lng<=19?"Italy":t.lat>=36&&t.lat<=44&&t.lng>=-10&&t.lng<=5?"Spain":"Europe"}static calculateDistance(t,a){const r=(a.lat-t.lat)*Math.PI/180,l=(a.lng-t.lng)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}}const ya=({className:s="",onPlanUpdate:t,isVisible:a=!0})=>{const{waypoints:n}=ce(),{profile:r}=he(),{settings:l}=Fe(),i=ps(l.startDate),d=l.startDate||"",[o,g]=c.useState("calendar"),[h,m]=c.useState(null),[u,v]=c.useState(null),[N,S]=c.useState([]),[k,C]=c.useState(null),[x,w]=c.useState(null),[f,E]=c.useState(!1),[W,D]=c.useState(null),[O,G]=c.useState(new Set);c.useEffect(()=>{n.length>=2?K():(m(null),v(null),S([]))},[n,r,l.startDate,l.drivingStyle,l.maxDrivingHoursPerDay]);const K=async()=>{E(!0),D(null);try{const R=d?new Date(d+"T00:00:00"):void 0,$=Pe.createTripPlan(n,r||void 0,R,i),J=Pe.calculateTripMetrics($,r||void 0),M=Pe.getDrivingLimits(r||void 0,i),z=Pe.generatePlanningRecommendations($,J,i,r||void 0),q=[...new Set($.dailyStages.map(j=>Pe.getCountryFromWaypoint(j.endWaypoint)))],T=Pe.getSeasonalFactors(i,q);m($),v(J),S(z),C(T),w(M),t&&t($)}catch{D("Failed to calculate trip plan. Please check your route.")}finally{E(!1)}},B=R=>R.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),p=R=>{const $=Math.floor(R),J=Math.round((R-$)*60);return`${$}h ${J}m`},I=R=>{switch(R){case"excellent":return"text-green-600 bg-green-100";case"good":return"text-primary-600 bg-primary-100";case"challenging":return"text-yellow-600 bg-yellow-100";case"unrealistic":return"text-red-600 bg-red-100"}},F=R=>{switch(R){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-primary-600 bg-primary-100"}},Z=R=>{switch(R){case"safety":return e.jsx(Se,{className:"w-4 h-4"});case"comfort":return e.jsx(Rt,{className:"w-4 h-4"});case"cost":return e.jsx(Ct,{className:"w-4 h-4"});case"timing":return e.jsx(Ye,{className:"w-4 h-4"});case"season":return e.jsx(Xt,{className:"w-4 h-4"});case"route":return e.jsx(ut,{className:"w-4 h-4"})}},Y=R=>{switch(R){case"overnight":return e.jsx(Zt,{className:"w-4 h-4"});case"sightseeing":return e.jsx(fn,{className:"w-4 h-4"});case"lunch":return e.jsx(ln,{className:"w-4 h-4"});case"fuel":return e.jsx(ys,{className:"w-4 h-4"});case"rest":return e.jsx(Ye,{className:"w-4 h-4"})}},se=R=>{const $=new Set(O);$.has(R)?$.delete(R):$.add(R),G($)};return a?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-purple-50 to-primary-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold text-neutral-800",children:"Trip Plan"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Is,{className:"w-4 h-4 text-neutral-400"})})]}),e.jsx("div",{className:"flex border-b bg-neutral-50",children:[{id:"overview",label:"Overview",icon:e.jsx(vs,{className:"w-4 h-4"})},{id:"calendar",label:"Daily Plan",icon:e.jsx(Oe,{className:"w-4 h-4"})},{id:"recommendations",label:"Tips",icon:e.jsx(Ke,{className:"w-4 h-4"})},{id:"metrics",label:"Analysis",icon:e.jsx(Ct,{className:"w-4 h-4"})}].map(R=>e.jsxs("button",{onClick:()=>g(R.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors ${o===R.id?"text-purple-600 border-b-2 border-purple-600 bg-white":"text-neutral-500 hover:text-neutral-700"}`,children:[R.icon,R.label]},R.id))}),W&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:W})]})}),e.jsx("div",{className:"p-4",children:f?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{className:"ml-2 text-neutral-600",children:"Calculating trip plan..."})]}):n.length<2?e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(gt,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:"Add at least 2 waypoints to your route to start planning."})]}):h?e.jsxs(e.Fragment,{children:[o==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm text-primary-600 font-medium",children:"Duration"})]}),e.jsx("div",{className:"text-2xl font-bold text-primary-800",children:h.totalDays}),e.jsx("div",{className:"text-sm text-primary-600",children:"days total"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ut,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Distance"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:Math.round(h.totalDistance)}),e.jsx("div",{className:"text-sm text-green-600",children:"km total"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-purple-600 font-medium",children:"Driving"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:Math.round(h.totalDrivingTime)}),e.jsx("div",{className:"text-sm text-purple-600",children:"hours total"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm text-orange-600 font-medium",children:"Feasibility"})]}),e.jsx("div",{className:"text-xl font-bold text-orange-800 capitalize",children:h.overallFeasibility}),e.jsxs("div",{className:"text-sm text-orange-600",children:[h.feasibilityScore,"% score"]})]})]}),x&&e.jsxs("div",{className:"bg-neutral-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-neutral-800 mb-3",children:"Daily Driving Limits (Based on Vehicle & Season)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-neutral-600",children:"Max Distance:"}),e.jsxs("div",{className:"font-semibold",children:[x.maxDailyDistance,"km"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-neutral-600",children:"Max Time:"}),e.jsxs("div",{className:"font-semibold",children:[x.maxDailyDrivingTime,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-neutral-600",children:"Break Every:"}),e.jsxs("div",{className:"font-semibold",children:[x.recommendedBreakInterval,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-neutral-600",children:"Average Speed:"}),e.jsxs("div",{className:"font-semibold",children:[x.averageSpeed,"km/h"]})]})]})]}),k&&e.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-primary-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Xt,{className:"w-4 h-4 text-primary-600"}),e.jsxs("h4",{className:"font-medium text-neutral-800 capitalize",children:[i," Travel Conditions"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-600 mb-2",children:"Expected Conditions:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Temperature: ",k.temperature.min,"Â°C -"," ",k.temperature.max,"Â°C"]}),e.jsxs("div",{children:["Tourist Density:"," ",e.jsx("span",{className:"capitalize",children:k.touristDensity})]}),e.jsxs("div",{children:["Campsite Availability:"," ",e.jsx("span",{className:"capitalize",children:k.campsiteAvailability})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-600 mb-2",children:"Top Recommendations:"}),e.jsx("ul",{className:"space-y-1 text-sm",children:k.recommendations.slice(0,3).map((R,$)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx(Ke,{className:"w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:R})]},$))})]})]})]}),h.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"w-4 h-4 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800",children:"Important Warnings"})]}),e.jsx("ul",{className:"space-y-1",children:h.warnings.slice(0,3).map((R,$)=>e.jsxs("li",{className:"text-sm text-yellow-700",children:["â€¢ ",R]},$))})]})]}),o==="calendar"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-neutral-800",children:"Daily Itinerary"}),e.jsxs("div",{className:"text-sm text-neutral-600",children:[h.dailyStages.length," driving days + ",h.restDays," rest days"]})]}),h.dailyStages.map(R=>e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-neutral-50",role:"button",tabIndex:0,onClick:()=>se(R.day),onKeyDown:$=>{($.key==="Enter"||$.key===" ")&&($.preventDefault(),se(R.day))},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-semibold",children:R.day}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-neutral-800",children:[R.startWaypoint.name," â†’ ",R.endWaypoint.name]}),e.jsxs("div",{className:"text-sm text-neutral-600",children:[R.date&&B(R.date)," â€¢ ",Math.round(R.distance),"km â€¢ ",p(R.drivingTime)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${I(R.feasibility)}`,children:R.feasibility}),O.has(R.day)?e.jsx(Cs,{className:"w-4 h-4 text-neutral-400"}):e.jsx(ws,{className:"w-4 h-4 text-neutral-400"})]})]})}),O.has(R.day)&&e.jsxs("div",{className:"px-4 pb-4 border-t bg-neutral-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-600 mb-1",children:"Accommodation"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Zt,{className:"w-4 h-4 text-neutral-400"}),e.jsx("span",{className:"capitalize",children:R.accommodationType.replace("_"," ")})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-600 mb-1",children:"Average Speed"}),e.jsxs("div",{className:"text-sm",children:[Math.round(R.distance/R.drivingTime),"km/h"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-600 mb-1",children:"Stops Planned"}),e.jsxs("div",{className:"text-sm",children:[R.stops.length," stops"]})]})]}),R.stops.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-neutral-600 mb-2",children:"Planned Stops:"}),e.jsx("div",{className:"space-y-2",children:R.stops.map(($,J)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[Y($.type),e.jsx("span",{className:"capitalize",children:$.type.replace("_"," ")}),e.jsxs("span",{className:"text-neutral-600",children:["(",p($.recommendedDuration),")"]}),e.jsxs("span",{className:"text-neutral-500",children:["- ",$.reasoning]})]},J))})]}),R.warnings.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium mb-1",children:"Warnings:"}),e.jsx("ul",{className:"space-y-1",children:R.warnings.map(($,J)=>e.jsxs("li",{className:"text-sm text-red-700 flex items-start gap-1",children:[e.jsx(Se,{className:"w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"}),$]},J))})]}),R.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-primary-600 font-medium mb-1",children:"Recommendations:"}),e.jsx("ul",{className:"space-y-1",children:R.recommendations.map(($,J)=>e.jsxs("li",{className:"text-sm text-primary-700 flex items-start gap-1",children:[e.jsx(Bt,{className:"w-3 h-3 text-primary-500 mt-0.5 flex-shrink-0"}),$]},J))})]})]})]},R.day))]}),o==="recommendations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-neutral-800 mb-4",children:["Planning Recommendations (",N.length,")"]}),N.length===0?e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(Ke,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:"No specific recommendations - your trip plan looks great!"})]}):e.jsx("div",{className:"space-y-3",children:N.map((R,$)=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${F(R.priority)}`,children:Z(R.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h5",{className:"font-medium text-neutral-800",children:R.title}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${F(R.priority)}`,children:[R.priority," priority"]})]}),e.jsx("p",{className:"text-sm text-neutral-600 mb-2",children:R.description}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-neutral-700",children:"Action: "}),e.jsx("span",{className:"text-neutral-600",children:R.action})]}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"font-medium text-neutral-700",children:"Impact: "}),e.jsx("span",{className:"text-neutral-600",children:R.impact})]})]})]})},$))}),k&&k.warnings.length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Nn,{className:"w-4 h-4 text-orange-600"}),e.jsx("h5",{className:"font-medium text-orange-800",children:"Seasonal Considerations"})]}),e.jsx("ul",{className:"space-y-1",children:k.warnings.map((R,$)=>e.jsxs("li",{className:"text-sm text-orange-700 flex items-start gap-1",children:[e.jsx(Se,{className:"w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"}),R]},$))})]})]}),o==="metrics"&&u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-neutral-800 mb-4",children:"Trip Analysis & Metrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-primary-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ut,{className:"w-4 h-4 text-primary-600"}),e.jsx("h5",{className:"font-medium text-primary-800",children:"Driving Intensity"})]}),e.jsxs("div",{className:"text-2xl font-bold text-primary-800 mb-1",children:[u.drivingIntensity,"km"]}),e.jsx("div",{className:"text-sm text-primary-600",children:"average per day"}),e.jsxs("div",{className:"text-sm text-neutral-600 mt-2",children:["Comfort Level:"," ",e.jsx("span",{className:"font-medium capitalize",children:u.comfortLevel})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ct,{className:"w-4 h-4 text-green-600"}),e.jsx("h5",{className:"font-medium text-green-800",children:"Trip Variety"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800 mb-1",children:u.varietyScore}),e.jsx("div",{className:"text-sm text-green-600",children:"variety score"}),e.jsxs("div",{className:"text-sm text-neutral-600 mt-2",children:["Rest Ratio: ",(u.restRatio*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(kt,{className:"w-4 h-4 text-purple-600"}),e.jsx("h5",{className:"font-medium text-purple-800",children:"Difficulty Score"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800 mb-1",children:u.difficultyScore}),e.jsx("div",{className:"text-sm text-purple-600",children:"out of 100"}),e.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min(100,u.difficultyScore)}%`}})})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Rt,{className:"w-4 h-4 text-orange-600"}),e.jsx("h5",{className:"font-medium text-orange-800",children:"Trip Suitability"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beginners:"}),e.jsx("span",{className:u.suitability.beginners?"text-green-600":"text-red-600",children:u.suitability.beginners?"âœ“ Suitable":"âœ— Not recommended"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Families:"}),e.jsx("span",{className:u.suitability.families?"text-green-600":"text-red-600",children:u.suitability.families?"âœ“ Suitable":"âœ— Not recommended"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Seniors:"}),e.jsx("span",{className:u.suitability.seniors?"text-green-600":"text-red-600",children:u.suitability.seniors?"âœ“ Suitable":"âœ— Not recommended"})]})]})]})]}),e.jsxs("div",{className:"bg-neutral-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-neutral-800 mb-3",children:"Detailed Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-600 mb-2",children:"Trip Characteristics:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ Total driving days: ",h.dailyStages.length]}),e.jsxs("li",{children:["â€¢ Recommended rest days: ",h.restDays]}),e.jsxs("li",{children:["â€¢ Average daily distance: ",u.drivingIntensity,"km"]}),e.jsxs("li",{children:["â€¢ Total driving time: ",Math.round(h.totalDrivingTime),"h"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-600 mb-2",children:"Planning Insights:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ Comfort level: ",u.comfortLevel]}),e.jsxs("li",{children:["â€¢ Difficulty: ",u.difficultyScore,"/100"]}),e.jsxs("li",{children:["â€¢ Route variety: ",u.varietyScore,"/100"]}),e.jsxs("li",{children:["â€¢ Feasibility: ",h.feasibilityScore,"%"]})]})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(kt,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:"Unable to create trip plan. Please check your route."})]})})]}):null},ot="camper-planner-map-state",as="1.0",ja=10080*60*1e3;class wa{getMapState(){try{const t=localStorage.getItem(ot);if(!t)return null;const a=JSON.parse(t);return a.version!==as?(this.clearMapState(),null):a.mapState&&a.mapState.timestamp&&Date.now()-a.mapState.timestamp>ja?(this.clearMapState(),null):a.mapState||null}catch(t){return console.error("Error reading map state from storage:",t),this.clearMapState(),null}}saveMapState(t){try{if(!this.validateCoordinates(t.center[0],t.center[1])||t.zoom<1||t.zoom>20)return;const a={mapState:{center:[Number(t.center[0].toFixed(6)),Number(t.center[1].toFixed(6))],zoom:Math.round(t.zoom),timestamp:Date.now()},version:as};localStorage.setItem(ot,JSON.stringify(a))}catch(a){console.error("Error saving map state to storage:",a)}}clearMapState(){try{localStorage.removeItem(ot)}catch(t){console.error("Error clearing map state from storage:",t)}}getStorageInfo(){try{const t=localStorage.getItem(ot);if(!t)return{size:0,lastUpdated:null};const a=JSON.parse(t);return{size:new Blob([t]).size,lastUpdated:a.mapState?.timestamp||null}}catch(t){return console.error("Error getting storage info:",t),{size:0,lastUpdated:null}}}validateCoordinates(t,a){return typeof t=="number"&&typeof a=="number"&&t>=-90&&t<=90&&a>=-180&&a<=180&&!isNaN(t)&&!isNaN(a)}isStorageAvailable(){try{const t="__storage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}}const Dt=new wa,Ce=(s,t=14)=>`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${t}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;vertical-align:middle">${s}</svg>`,Na=s=>tt.divIcon({html:`
      <div class="relative w-6 h-6 flex items-center justify-center">
        <div
          class="w-4 h-4 bg-primary-500 text-white flex items-center justify-center rounded-full shadow-md transform transition-transform"
          style="transform: rotate(${s}deg)"
        >
          <svg class="w-2 h-2" fill="currentColor" viewBox="0 0 12 12">
            <path d="M6 1l5 4-5 4V6H1V4h5V1z"/>
          </svg>
        </div>
      </div>
    `,className:"direction-arrow",iconSize:[24,24],iconAnchor:[12,12]}),ka=(s,t,a,n)=>{const r=n-t,l=a-s;return(Math.atan2(r,l)*(180/Math.PI)+360)%360},Xe=(s,t,a,n)=>[(s+a)/2,(t+n)/2],Hs=s=>s<1e3?`${Math.round(s)}m`:`${(s/1e3).toFixed(1)}km`,_s=s=>{const t=Math.floor(s/3600),a=Math.floor(s%3600/60);return t>0?`${t}h ${a}m`:`${a}m`},Ca=(s,t,a=!1)=>{const n=Hs(s),r=_s(t);return tt.divIcon({html:`
      <div class="route-info-label ${a?"highlighted":""}">
        <div class="bg-white border-2 border-primary-500 rounded-lg px-2 py-1 shadow-lg text-xs font-medium text-neutral-800">
          <div class="text-primary-600 font-semibold">${n}</div>
          <div class="text-neutral-600">${r}</div>
        </div>
      </div>
    `,className:"route-info-marker",iconSize:[60,30],iconAnchor:[30,15]})},Sa=s=>{const t=l=>l==="error"?"#d32535":"#e9a100",a=l=>{switch(l){case"height":return Ce('<path d="M12 2v20"/><path d="m5 5 7-3 7 3"/><path d="m5 19 7 3 7-3"/>',14);case"width":return Ce('<path d="M2 12h20"/><path d="m5 9-3 3 3 3"/><path d="m19 9 3 3-3 3"/>',14);case"weight":return Ce('<path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/>',14);case"length":return Ce('<path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"/><path d="m14.5 12.5 2-2"/><path d="m11.5 9.5 2-2"/><path d="m8.5 6.5 2-2"/><path d="m17.5 15.5 2-2"/>',14);default:return Ce('<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/>',14)}},n=t(s.severity),r=a(s.restriction);return tt.divIcon({html:`
      <div class="relative">
        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center shadow-lg animate-pulse"
             style="background-color: ${n}; border-color: ${n}">
          <span class="text-white text-xs font-bold">${r}</span>
        </div>
        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2">
          <div class="w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent"
               style="border-top-color: ${n}"></div>
        </div>
      </div>
    `,className:"restriction-warning-icon",iconSize:[32,36],iconAnchor:[16,36],popupAnchor:[0,-36]})},Ma=({waypoint:s,index:t,total:a})=>{const{updateWaypoint:n,removeWaypoint:r,insertWaypoint:l,insertBeforeWaypoint:i,waypoints:d}=ce(),{addNotification:o}=me(),[g,h]=c.useState(!1),[m,u]=c.useState(s.name||""),[v,N]=c.useState(s.notes||""),[S,k]=c.useState(null),[C,x]=c.useState(!1),w=()=>s.type==="start"?"bg-green-500 border-green-600":s.type==="end"?"bg-red-500 border-red-600":"bg-primary-500 border-primary-600",f=c.useCallback(()=>{const p={};S&&(p.lat=S.lat,p.lng=S.lng),m.trim()!==(s.name||"")&&(p.name=m.trim()),v!==(s.notes||"")&&(p.notes=v),Object.keys(p).length>0&&(n(s.id,p),o({type:"success",message:S?"Waypoint location updated":"Waypoint updated successfully"})),h(!1),k(null),x(!1)},[s.id,s.name,s.notes,m,v,S,n,o]),E=c.useCallback(()=>{u(s.name||""),N(s.notes||""),k(null),x(!1),h(!1)},[s.name,s.notes]),W=c.useCallback(()=>{r(s.id),o({type:"success",message:`Removed ${s.name||"waypoint"} from route`})},[s.id,s.name,r,o]),D=c.useCallback(()=>{const p=d.findIndex(Y=>Y.id===s.id);let I,F;if(p>0){const Y=d[p-1];I=(Y.lat+s.lat)/2,F=(Y.lng+s.lng)/2}else I=s.lat-.5,F=s.lng-.5;const Z={id:`waypoint-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,lat:Number(I.toFixed(6)),lng:Number(F.toFixed(6)),type:"waypoint",name:`Waypoint ${p+1}`};i(Z,s.id),o({type:"success",message:`Inserted ${Z.name} before ${s.name||"waypoint"}`})},[s,d,i,o]),O=c.useCallback(()=>{const p=d.findIndex(Y=>Y.id===s.id);let I,F;if(p<d.length-1){const Y=d[p+1];I=(s.lat+Y.lat)/2,F=(s.lng+Y.lng)/2}else I=s.lat+.5,F=s.lng+.5;const Z={id:`waypoint-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,lat:Number(I.toFixed(6)),lng:Number(F.toFixed(6)),type:"waypoint",name:`Waypoint ${p+2}`};l(Z,s.id),o({type:"success",message:`Inserted ${Z.name} after ${s.name||"waypoint"}`})},[s,d,l,o]),G=()=>s.type==="start"?"S":s.type==="end"?"E":(t+1).toString(),K=()=>{const p=Ce('<path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/>'),I=Ce('<path d="M3 20 12 4l9 16Z"/><path d="M12 4v16"/>'),F=Ce('<path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/>'),Z=Ce('<path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>');return s.type==="start"||s.type==="end"?p:s.type==="campsite"?I:s.type==="accommodation"?F:Z},B=tt.divIcon({html:`
      <div class="relative waypoint-marker">
        <!-- Main waypoint container -->
        <div class="${L("relative w-10 h-10 rounded-full border-3 text-white font-bold text-sm","flex items-center justify-center shadow-lg","transform hover:scale-110 transition-all duration-300","cursor-pointer",w())}">
          <!-- Icon background -->
          <div class="absolute inset-1 rounded-full bg-white bg-opacity-20"></div>

          <!-- Main content -->
          <div class="relative z-10 flex flex-col items-center">
            <div class="text-xs">${K()}</div>
            <div class="text-xs font-bold -mt-1">${G()}</div>
          </div>
        </div>

        <!-- Pulse animation for important waypoints -->
        <div class="${L("absolute inset-0 rounded-full border-2 animate-pulse opacity-20",w())}"></div>

        <!-- Route progress indicator -->
        ${a>1?`
          <div class="absolute -bottom-3 left-1/2 transform -translate-x-1/2">
            <div class="w-2 h-4 bg-neutral-300 rounded-full border border-neutral-400">
              <div
                class="w-full bg-gradient-to-t from-green-500 to-primary-500 rounded-full transition-all duration-500"
                style="height: ${(t+1)/a*100}%"
              ></div>
            </div>
          </div>
        `:""}

        <!-- Waypoint name label -->
        <div class="absolute top-12 left-1/2 transform -translate-x-1/2 whitespace-nowrap">
          <div class="bg-white bg-opacity-90 text-neutral-800 text-xs font-medium px-2 py-1 rounded shadow-md border">
            ${s.name||`Stop ${t+1}`}
          </div>
        </div>
      </div>
    `,className:"enhanced-waypoint-marker",iconSize:[40,60],iconAnchor:[20,30],popupAnchor:[0,-30]});return e.jsx(Be,{position:[s.lat,s.lng],icon:B,zIndexOffset:2e3,children:e.jsx(et,{eventHandlers:{click:p=>p.originalEvent?.stopPropagation()},children:e.jsxs("div",{className:"p-3 min-w-[250px]",onClick:p=>p.stopPropagation(),onKeyDown:p=>p.stopPropagation(),role:"presentation",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",dangerouslySetInnerHTML:{__html:K()}}),e.jsx("h3",{className:"font-semibold text-sm",children:s.name||`Waypoint ${t+1}`})]}),!g&&e.jsx("button",{onClick:p=>{p.stopPropagation(),p.preventDefault(),h(!0)},className:"bg-primary-600 text-white hover:bg-primary-700 px-2 py-1 rounded text-xs font-medium transition-colors",title:"Edit waypoint",children:"Edit"})]}),g?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`rv-waypoint-name-${s.id}`,className:"block text-xs font-medium text-neutral-700 mb-1",children:"Name"}),e.jsx("input",{id:`rv-waypoint-name-${s.id}`,type:"text",value:m,onChange:p=>u(p.target.value),onClick:p=>p.stopPropagation(),onFocus:p=>p.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter waypoint name",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`rv-waypoint-notes-${s.id}`,className:"block text-xs font-medium text-neutral-700 mb-1",children:"Notes"}),e.jsx("textarea",{id:`rv-waypoint-notes-${s.id}`,value:v,onChange:p=>N(p.target.value),onClick:p=>p.stopPropagation(),onFocus:p=>p.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none",rows:3,placeholder:"Add notes about this waypoint..."})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:p=>{p.stopPropagation(),p.preventDefault(),x(!C)},className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:C?"Hide location search":"Change location"})]}),C&&e.jsx("div",{className:"mt-2",children:e.jsx(Ws,{onLocationSelect:p=>{const I=p.name||p.display_name.split(",")[0].trim();k({lat:p.lat,lng:p.lng,name:I}),u(I),x(!1)},placeholder:"Search new location..."})}),S&&e.jsxs("div",{className:"mt-1.5 text-xs text-green-600 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsxs("span",{children:["New location: ",S.name]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-neutral-200",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),p.preventDefault(),f()},className:"flex-1 px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:p=>{p.stopPropagation(),p.preventDefault(),E()},className:"flex-1 px-3 py-1 text-xs bg-neutral-600 text-white rounded hover:bg-neutral-700 transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:s.type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Position:"}),e.jsxs("span",{className:"font-medium",children:[t+1," of ",a]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Coordinates:"}),e.jsxs("span",{className:"font-mono text-xs",children:[s.lat.toFixed(4),", ",s.lng.toFixed(4)]})]}),s.visitDate&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Visit Date:"}),e.jsx("span",{className:"font-medium",children:s.visitDate})]}),s.duration&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Stay Duration:"}),e.jsxs("span",{className:"font-medium",children:[s.duration,"h"]})]}),s.notes&&e.jsxs("div",{className:"mt-2 p-2 bg-neutral-50 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-neutral-700 mb-1",children:"Notes:"}),e.jsx("div",{className:"text-neutral-600",children:s.notes})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-neutral-200",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),p.preventDefault(),D()},className:"flex-1 px-3 py-1 text-xs bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors",title:"Insert a new waypoint before this one",children:"+ Before"}),e.jsx("button",{onClick:p=>{p.stopPropagation(),p.preventDefault(),O()},className:"flex-1 px-3 py-1 text-xs bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors",title:"Insert a new waypoint after this one",children:"+ After"}),e.jsx("button",{onClick:p=>{p.stopPropagation(),p.preventDefault(),W()},className:"flex-1 px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Delete"})]})]})]})})})},La=({route:s,waypoints:t})=>{const a=s?.routes?.[0],n=c.useMemo(()=>a?.geometry?.coordinates?a.geometry.coordinates.map(([i,d])=>[d,i]):[],[a]);if(!s||!s.routes||s.routes.length===0)return null;const r=()=>s.restrictions?.cannotAccommodate?"#d32535":s.restrictions?.violatedDimensions.length||s.warnings&&s.warnings.length>0?"#e9a100":s.metadata.service==="openrouteservice"?"#27ae60":"#2794a8",l=()=>{if(s.restrictions?.cannotAccommodate)return"5, 10";if(s.restrictions?.violatedDimensions.length)return"10, 5";if(s.warnings&&s.warnings.length>0)return"15, 5"};return n.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(Et,{positions:n,color:"#ffffff",weight:8,opacity:.6,className:"calculated-route-outline",interactive:!1}),e.jsx(Et,{positions:n,color:r(),weight:6,opacity:.8,className:"calculated-route",dashArray:l()}),a.segments?.map((i,d)=>{let o=null;if(t&&t.length>=2&&d<t.length-1)o=Xe(t[d].lat,t[d].lng,t[d+1].lat,t[d+1].lng);else if(a.waypoints&&a.waypoints.length>=2&&d<a.waypoints.length-1){const g=a.waypoints[d],h=a.waypoints[d+1],m=n[g],u=n[Math.min(h,n.length-1)];m&&u&&(o=Xe(m[0],m[1],u[0],u[1]))}else{const g=Math.floor(d*n.length/a.segments.length),h=Math.min(Math.floor((d+1)*n.length/a.segments.length),n.length-1),m=n[g],u=n[h];m&&u&&(o=Xe(m[0],m[1],u[0],u[1]))}if(o){const g=Ca(i.distance,i.duration);return e.jsx(Be,{position:o,icon:g,zIndexOffset:1500,children:e.jsx(et,{children:e.jsxs("div",{className:"p-2",children:[e.jsxs("h3",{className:"font-semibold text-sm mb-2",children:["Route Segment ",d+1]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Distance:"}),e.jsx("span",{className:"font-medium",children:Hs(i.distance)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duration:"}),e.jsx("span",{className:"font-medium",children:_s(i.duration)})]})]})]})})},`segment-info-${d}`)}return null}),s.restrictions?.restrictedSegments?.map((i,d)=>{if(i.coordinates.length>=2){const o=i.coordinates[0],g=i.coordinates[i.coordinates.length-1],h=Xe(o[1],o[0],g[1],g[0]),m=Sa(i);return e.jsx(Be,{position:h,icon:m,zIndexOffset:3e3,children:e.jsx(et,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2 text-red-600",children:"Route Restriction"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:i.restriction})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Severity:"}),e.jsx("span",{className:`font-medium capitalize ${i.severity==="error"?"text-red-600":"text-amber-600"}`,children:i.severity})]}),e.jsx("div",{className:"mt-2 text-neutral-600",children:i.severity==="error"?"Vehicle cannot pass this section":"Caution: Check vehicle dimensions"})]})]})})},`restriction-${d}`)}return null})]})},Ta=({waypoints:s})=>{const t=c.useMemo(()=>{if(s.length<2)return[];const n=[];for(let r=0;r<s.length-1;r++)n.push({start:s[r],end:s[r+1],segmentIndex:r,totalSegments:s.length-1});return n},[s]),a=(n,r)=>{if(r===1)return"#94a3b8";const l=n/(r-1),i={r:34,g:197,b:94},d={r:239,g:68,b:68},o=Math.round(i.r+(d.r-i.r)*l),g=Math.round(i.g+(d.g-i.g)*l),h=Math.round(i.b+(d.b-i.b)*l);return`rgb(${o}, ${g}, ${h})`};return e.jsx(e.Fragment,{children:t.map((n,r)=>{const l=ka(n.start.lat,n.start.lng,n.end.lat,n.end.lng),i=Xe(n.start.lat,n.start.lng,n.end.lat,n.end.lng),d=Na(l),o=a(n.segmentIndex,n.totalSegments);return e.jsxs(Ft.Fragment,{children:[e.jsx(Et,{positions:[[n.start.lat,n.start.lng],[n.end.lat,n.end.lng]],color:o,weight:4,opacity:.6,className:"straight-line-route",dashArray:"8, 4"}),e.jsx(Be,{position:i,icon:d,zIndexOffset:1e3})]},`segment-${n.start.id}-${n.end.id}`)})})},Da=()=>{const{waypoints:s,calculatedRoute:t}=ce();return s.length===0?null:e.jsxs(e.Fragment,{children:[t?e.jsx(La,{route:t,waypoints:s}):s.length>=2?e.jsx(Ta,{waypoints:s}):null,s.map((a,n)=>e.jsx(Ma,{waypoint:a,index:n,total:s.length},`number-${a.id}`))]})},Ea=()=>{const{undo:s,redo:t,canUndo:a,canRedo:n,clearRoute:r,waypoints:l,isValidForRouting:i}=ce();return c.useEffect(()=>{const d=o=>{if(o.target instanceof HTMLInputElement||o.target instanceof HTMLTextAreaElement||o.target?.contentEditable==="true")return;const g={"ctrl+z":()=>{a()&&(o.preventDefault(),s())},"ctrl+y":()=>{n()&&(o.preventDefault(),t())},"ctrl+shift+z":()=>{n()&&(o.preventDefault(),t())},delete:()=>{},backspace:()=>{},escape:()=>{},"ctrl+a":()=>{o.preventDefault()},"ctrl+shift+c":()=>{l.length>0&&o.preventDefault()}},m=(v=>{const N=[];return(v.ctrlKey||v.metaKey)&&N.push("ctrl"),v.shiftKey&&N.push("shift"),v.altKey&&N.push("alt"),N.push(v.key.toLowerCase()),N.join("+")})(o),u=g[m];u&&u()};return document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}},[s,t,a,n,r,l,i]),{shortcuts:[{key:"Ctrl+Z",description:"Undo last action",available:a()},{key:"Ctrl+Y",description:"Redo last action",available:n()},{key:"Ctrl+Shift+Z",description:"Redo last action",available:n()},{key:"Delete",description:"Delete selected waypoint",available:l.length>0},{key:"Ctrl+Shift+C",description:"Clear all waypoints",available:l.length>0},{key:"Escape",description:"Close dialogs/deselect",available:!0}],isValidForRouting:i()}},Ia=(s,t,a=!1,n=!1,r=!1)=>{const l={start:"bg-green-500 border-green-600 text-white shadow-green-200",waypoint:"bg-primary-500 border-primary-600 text-white shadow-primary-200",end:"bg-red-500 border-red-600 text-white shadow-red-200"},i='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>',d={start:i,waypoint:t.toString(),end:i},o=r?56:48,m=L("flex items-center justify-center rounded-full border-3 font-bold cursor-pointer relative touch-manipulation",r?"w-14 h-14":"w-12 h-12",r?"text-lg":"text-base","transform transition-all duration-200",l[s]),u=L(a&&"scale-125 ring-4 ring-white ring-opacity-60",n&&"scale-110 shadow-2xl z-50",!n&&!a&&"hover:scale-105 active:scale-95 hover:shadow-lg shadow-md"),v=r?`
    <div class="absolute -inset-2 rounded-full" style="touch-action: none;"></div>
  `:"";return tt.divIcon({html:`
      <div class="${m} ${u}">
        ${v}
        <!-- Main icon content -->
        <span class="relative z-10">${d[s]}</span>

        <!-- Pulse effect for start/end points -->
        ${s==="start"||s==="end"?`
          <div class="absolute inset-0 rounded-full ${l[s].split(" ")[0]} opacity-20 animate-ping"></div>
        `:""}

        <!-- Selection indicator -->
        ${a?`
          <div class="absolute -inset-1 rounded-full border-2 border-white animate-pulse"></div>
        `:""}

        <!-- Drag drop zone indicator -->
        ${n?`
          <div class="absolute -inset-3 rounded-full border-2 border-dashed border-yellow-400 bg-yellow-100 bg-opacity-20"></div>
        `:""}
      </div>
    `,className:L("waypoint-marker",n&&"dragging",r&&"touch-target"),iconSize:[o,o],iconAnchor:[o/2,o/2],popupAnchor:[0,-o/2]})},Ra=(s,t)=>{switch(s){case"start":return"Start Point";case"end":return"Destination";case"waypoint":return`Waypoint ${t}`;default:return`Point ${t+1}`}},At=(s,t,a,n)=>({id:`waypoint-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,lat:Number(s.toFixed(6)),lng:Number(t.toFixed(6)),type:a,name:Ra(a,n)}),Aa=({waypoint:s,index:t,onDelete:a,onUpdate:n,onInsertAfter:r,onInsertBefore:l,onDragEnd:i})=>{const{selectedWaypoint:d,setSelectedWaypoint:o}=yt(),[g,h]=c.useState(null),[m,u]=c.useState(!1),[v,N]=c.useState(s.name),[S,k]=c.useState(s.notes||""),[C,x]=c.useState(!1),[,w]=c.useState(!1),[f,E]=c.useState(null),[W,D]=c.useState(!1),O="ontouchstart"in window||navigator.maxTouchPoints>0,G=d===s.id,K=c.useCallback(()=>{o(s.id)},[s.id,o]),B=c.useCallback(T=>{T?.stopPropagation(),a(s.id)},[s.id,a]),p=c.useCallback(()=>{x(!0),"vibrate"in navigator&&navigator.vibrate(50)},[]),I=c.useCallback(T=>{x(!1);const j=T.target.getLatLng().lat,H=T.target.getLatLng().lng;i(s.id,j,H),"vibrate"in navigator&&navigator.vibrate([50,100,50])},[s.id,i]),F=c.useCallback(()=>{w(!0)},[]),Z=c.useCallback(()=>{w(!1)},[]),Y=c.useCallback(T=>{T.originalEvent.preventDefault();const{clientX:j,clientY:H}=T.originalEvent;h({x:j,y:H})},[]),se=c.useCallback(()=>{const T={};f&&(T.lat=f.lat,T.lng=f.lng),v.trim()!==s.name&&(T.name=v.trim()),S!==(s.notes||"")&&(T.notes=S),Object.keys(T).length>0&&n(s.id,T),u(!1),E(null),D(!1)},[s.id,s.name,s.notes,v,S,f,n]),R=c.useCallback(()=>{N(s.name),k(s.notes||""),E(null),D(!1),u(!1)},[s.name,s.notes]),$=c.useCallback(()=>{const T=At(s.lat-.01,s.lng-.01,"waypoint",t);l(T,s.id)},[s,t,l]),J=c.useCallback(()=>{const T=At(s.lat+.01,s.lng+.01,"waypoint",t+1);r(T,s.id)},[s,t,r]),M=[{id:"edit",label:"Edit Waypoint",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),onClick:()=>u(!0),shortcut:"E"},{id:"insert-before",label:"Insert Before",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),onClick:$,shortcut:"Shift+â†‘"},{id:"insert-after",label:"Insert After",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),onClick:J,shortcut:"Shift+â†“"},{id:"delete",label:"Delete Waypoint",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:B,variant:"danger",shortcut:"Del"}],z=s.type==="campsite"||s.type==="accommodation"?"waypoint":s.type,q=Ia(z,t+1,G,C,O);return e.jsxs(e.Fragment,{children:[e.jsx(Be,{position:[s.lat,s.lng],icon:q,draggable:!0,eventHandlers:{click:K,contextmenu:Y,dragstart:p,dragend:I,mouseover:F,mouseout:Z},children:e.jsx(et,{eventHandlers:{click:T=>T.originalEvent?.stopPropagation()},children:e.jsxs("div",{className:"min-w-72 p-2",onClick:T=>T.stopPropagation(),onKeyDown:T=>T.stopPropagation(),role:"presentation",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:L("px-2 py-1 rounded text-xs font-semibold",s.type==="start"&&"bg-green-100 text-green-800",s.type==="waypoint"&&"bg-primary-100 text-primary-800",s.type==="end"&&"bg-red-100 text-red-800"),children:s.type==="start"?"START":s.type==="end"?"END":`WAYPOINT ${t+1}`}),e.jsx("span",{className:"text-xs text-neutral-500",children:"Drag to move"})]}),e.jsxs("button",{onClick:T=>{T.stopPropagation(),T.preventDefault(),u(!m)},className:"bg-primary-600 text-white hover:bg-primary-700 px-3 py-2 rounded text-sm font-bold transition-colors flex items-center space-x-2 border-2 border-primary-800 shadow-lg",title:"Edit waypoint","aria-label":"Edit waypoint",style:{minWidth:"80px",zIndex:1e3},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{children:"EDIT"})]})]}),m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:`waypoint-name-${s.id}`,className:"block text-xs font-medium text-neutral-700 mb-1",children:"Name"}),e.jsx("input",{id:`waypoint-name-${s.id}`,type:"text",value:v,onChange:T=>N(T.target.value),onClick:T=>T.stopPropagation(),onFocus:T=>T.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter waypoint name",autoFocus:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:`waypoint-notes-${s.id}`,className:"block text-xs font-medium text-neutral-700 mb-1",children:"Notes"}),e.jsx("textarea",{id:`waypoint-notes-${s.id}`,value:S,onChange:T=>k(T.target.value),onClick:T=>T.stopPropagation(),onFocus:T=>T.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none",rows:3,placeholder:"Add notes about this waypoint..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("button",{onClick:T=>{T.stopPropagation(),T.preventDefault(),D(!W)},className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:W?"Hide location search":"Change location"})]}),W&&e.jsx("div",{className:"mt-2",children:e.jsx(Ws,{onLocationSelect:T=>{const j=T.name||T.display_name.split(",")[0].trim();E({lat:T.lat,lng:T.lng,name:j}),N(j),D(!1)},placeholder:"Search new location..."})}),f&&e.jsxs("div",{className:"mt-1.5 text-xs text-green-600 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsxs("span",{children:["New location: ",f.name]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-neutral-200",children:[e.jsx("button",{onClick:T=>{T.stopPropagation(),T.preventDefault(),se()},className:"flex-1 px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:T=>{T.stopPropagation(),T.preventDefault(),R()},className:"flex-1 px-3 py-1 text-xs bg-neutral-600 text-white rounded hover:bg-neutral-700 transition-colors",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 mb-1",children:s.name}),s.notes&&e.jsx("div",{className:"text-xs text-neutral-600 bg-neutral-50 rounded p-2",children:s.notes})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"block text-xs font-medium text-neutral-700 mb-1",children:"Coordinates"}),e.jsxs("div",{className:"text-xs text-neutral-600 font-mono",children:[e.jsxs("div",{children:["Lat: ",s.lat.toFixed(6)]}),e.jsxs("div",{children:["Lng: ",s.lng.toFixed(6)]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-neutral-200",children:[e.jsx("button",{onClick:T=>{T.stopPropagation(),T.preventDefault(),$()},className:"flex-1 px-3 py-1 text-xs bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors",title:"Insert a new waypoint before this one",children:"+ Before"}),e.jsx("button",{onClick:T=>{T.stopPropagation(),T.preventDefault(),J()},className:"flex-1 px-3 py-1 text-xs bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors",title:"Insert a new waypoint after this one",children:"+ After"}),e.jsx("button",{onClick:T=>{T.stopPropagation(),T.preventDefault(),B()},className:"flex-1 px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Delete"})]})]})]})})}),e.jsx(ua,{isOpen:!!g,position:g||{x:0,y:0},items:M,onClose:()=>h(null)})]})},Pa=({onMapRightClick:s})=>(fs({contextmenu:t=>{t.originalEvent.preventDefault();const{lat:a,lng:n}=t.latlng,{clientX:r,clientY:l}=t.originalEvent;s(a,n,r,l)},dblclick:t=>{const{lat:a,lng:n}=t.latlng,{clientX:r,clientY:l}=t.originalEvent;s(a,n,r,l)}}),null),za=()=>{const{waypoints:s,addWaypoint:t,removeWaypoint:a,updateWaypoint:n,insertWaypoint:r,insertBeforeWaypoint:l}=ce(),{addNotification:i}=me(),[d,o]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[g,h]=c.useState({isOpen:!1,position:{x:0,y:0},coordinates:{lat:0,lng:0}});Ea();const m=c.useCallback((x,w,f,E)=>{h({isOpen:!0,position:{x:f,y:E},coordinates:{lat:x,lng:w}})},[]),u=c.useCallback((x,w)=>{const f=At(x,w,"waypoint",s.length);try{t(f),i({type:"success",message:`Added ${f.name} to route`})}catch{i({type:"error",message:"Failed to add waypoint"})}},[s.length,t,i]),v=c.useCallback(x=>{const w=s.find(f=>f.id===x);try{a(x),i({type:"success",message:`Removed ${w?.name||"waypoint"} from route`})}catch{i({type:"error",message:"Failed to remove waypoint"})}},[s,a,i]),N=c.useCallback((x,w)=>{try{n(x,w),(w.name||w.notes)&&i({type:"success",message:"Waypoint updated successfully"})}catch{i({type:"error",message:"Failed to update waypoint"})}},[n,i]),S=c.useCallback((x,w)=>{try{r(x,w),i({type:"success",message:`Inserted ${x.name} into route`})}catch{i({type:"error",message:"Failed to insert waypoint"})}},[r,i]),k=c.useCallback((x,w)=>{try{l(x,w),i({type:"success",message:`Inserted ${x.name} into route`})}catch{i({type:"error",message:"Failed to insert waypoint"})}},[l,i]),C=c.useCallback((x,w,f)=>{try{n(x,{lat:Number(w.toFixed(6)),lng:Number(f.toFixed(6))}),i({type:"success",message:"Waypoint position updated"})}catch{i({type:"error",message:"Failed to update waypoint position"})}},[n,i]);return e.jsxs(e.Fragment,{children:[typeof window<"u"&&e.jsx(Pa,{onMapRightClick:m}),e.jsx(Da,{}),s.map((x,w)=>e.jsx(Aa,{waypoint:x,index:w,onDelete:v,onUpdate:N,onInsertAfter:S,onInsertBefore:k,onDragEnd:C},x.id)),e.jsx(Fs,{isOpen:d.isOpen,title:d.title,message:d.message,confirmLabel:"Clear All",confirmVariant:"danger",onConfirm:d.onConfirm,onCancel:()=>o(x=>({...x,isOpen:!1}))}),g.isOpen&&e.jsx("div",{className:"fixed z-[10000] bg-white rounded-lg shadow-lg border border-neutral-200 py-1 min-w-[160px]",style:{left:g.position.x,top:g.position.y},onMouseLeave:()=>h(x=>({...x,isOpen:!1})),role:"menu",tabIndex:-1,children:e.jsxs("button",{onClick:()=>{u(g.coordinates.lat,g.coordinates.lng),h(x=>({...x,isOpen:!1}))},className:"w-full px-3 py-2 text-left text-sm hover:bg-neutral-100 flex items-center space-x-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Add Waypoint"})]})}),g.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[9999]",onClick:()=>h(x=>({...x,isOpen:!1})),onKeyDown:x=>{x.key==="Escape"&&h(w=>({...w,isOpen:!1}))},role:"presentation"})]})},ct=[{id:"openstreetmap",name:"OpenStreetMap",description:"Standard street map",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,subdomains:["a","b","c"],category:"standard",icon:Ds},{id:"opentopomap",name:"OpenTopoMap",description:"Topographic map with contours",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attribution:'Map data: Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: Â© <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',maxZoom:15,subdomains:["a","b","c"],category:"topographic",icon:Es},{id:"cyclosm",name:"CyclOSM",description:"Cycling-focused map",url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors. Tiles style by <a href="https://www.cyclosm.org">CyclOSM</a> hosted by <a href="https://openstreetmap.fr">OpenStreetMap France</a>',maxZoom:19,subdomains:["a","b","c"],category:"outdoor",icon:pn},{id:"humanitarian",name:"Humanitarian",description:"Clear, humanitarian mapping style",url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors. Tiles style by <a href="https://www.hotosm.org">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr">OpenStreetMap France</a>',maxZoom:19,subdomains:["a","b"],category:"standard",icon:Mn}],$a=({currentLayerId:s,onLayerChange:t,collapsed:a=!1,onToggleCollapse:n})=>{const{addNotification:r}=me(),[l,i]=c.useState(null),d=c.useCallback(async g=>{if(g!==s){i(g);try{const h=ct.find(v=>v.id===g);if(!h)throw new Error("Layer not found");const m=h.url.replace("{s}",h.subdomains?.[0]||"").replace("{z}","5").replace("{x}","16").replace("{y}","10"),u=new Image;await new Promise((v,N)=>{u.onload=v,u.onerror=N,u.src=m,setTimeout(()=>N(new Error("Tile load timeout")),5e3)}),t(g),r({type:"success",message:`Switched to ${h.name} map layer`})}catch{r({type:"error",message:`Failed to load ${ct.find(h=>h.id===g)?.name} layer`})}finally{i(null)}}},[s,t,r]),o=ct.find(g=>g.id===s);return a?e.jsxs(e.Fragment,{children:[o&&e.jsx(qt,{url:o.url,attribution:o.attribution,subdomains:o.subdomains,maxZoom:o.maxZoom,detectRetina:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:4},o.id),e.jsx("div",{className:"absolute top-4 left-4 z-30 bg-white rounded-lg shadow-md",children:e.jsx("button",{onClick:n,className:"w-10 h-10 flex items-center justify-center hover:bg-neutral-50 transition-colors rounded-lg",title:`Current: ${o?.name||"Unknown"}`,"aria-label":"Open layer control",children:o?e.jsx(o.icon,{className:"w-5 h-5"}):e.jsx(Ds,{className:"w-5 h-5"})})})]}):e.jsxs(e.Fragment,{children:[o&&e.jsx(qt,{url:o.url,attribution:o.attribution,subdomains:o.subdomains,maxZoom:o.maxZoom,detectRetina:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:4},o.id),e.jsxs("div",{className:"absolute top-4 left-4 z-30 bg-white rounded-lg shadow-md overflow-hidden min-w-64",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-neutral-200",children:[e.jsx("h3",{className:"font-medium text-neutral-900 text-sm",children:"Map Layers"}),n&&e.jsx("button",{onClick:n,className:"text-neutral-400 hover:text-neutral-600 p-1 rounded transition-colors","aria-label":"Collapse layer control",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-2 space-y-1",children:ct.map(g=>{const h=g.id===s,m=l===g.id;return e.jsxs("button",{onClick:()=>d(g.id),disabled:m,className:L("w-full flex items-center space-x-3 p-2 rounded-lg text-left transition-all",h?"bg-primary-50 text-primary-900 border border-primary-200":"hover:bg-neutral-50 text-neutral-700",m&&"opacity-50 cursor-wait"),children:[e.jsx("div",{className:"flex-shrink-0",children:m?e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary-600 border-t-transparent"})}):e.jsx(g.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-sm",children:g.name}),h&&e.jsx("svg",{className:"w-4 h-4 text-primary-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),e.jsx("p",{className:"text-xs text-neutral-500 truncate",children:g.description})]})]},g.id)})}),o&&e.jsx("div",{className:"p-3 border-t border-neutral-200 bg-neutral-50",children:e.jsxs("div",{className:"text-xs text-neutral-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Current Layer"}),e.jsx("span",{className:"text-primary-600",children:o.name})]}),e.jsxs("div",{className:"text-neutral-500",children:["Max Zoom: ",o.maxZoom,"x â€¢ Category: ",o.category]})]})})]})]})},Fa=s=>{if(s.length===0)return null;let t=s[0].lat,a=s[0].lat,n=s[0].lng,r=s[0].lng;return s.forEach(l=>{t=Math.max(t,l.lat),a=Math.min(a,l.lat),n=Math.max(n,l.lng),r=Math.min(r,l.lng)}),{north:t,south:a,east:n,west:r}},Ht=(s,t,a={})=>{if(t.length===0)return!1;const n=Fa(t);if(!n)return!1;const{padding:r=[50,50],maxZoom:l=15,_minZoom:i=3,animate:d=!0,duration:o=1e3}=a;try{if(t.length===1){const g=t[0];s.setView([g.lat,g.lng],10,{animate:d,duration:o/1e3})}else{const h=He.latLngBounds([n.south,n.west],[n.north,n.east]).pad(.1);s.fitBounds(h,{padding:r,maxZoom:l,animate:d,duration:o/1e3})}return!0}catch(g){return console.error("Error fitting bounds:",g),!1}},Wa=({map:s,onToggleFullscreen:t,onToggleLayerControl:a,onResetView:n})=>{const{waypoints:r}=ce(),l=c.useCallback(()=>{s&&s.zoomIn()},[s]),i=c.useCallback(()=>{s&&s.zoomOut()},[s]),d=c.useCallback(()=>{if(s){const k=s.getCenter(),C=s.getZoom(),x=180/Math.pow(2,C)*.25;s.panTo([k.lat+x,k.lng])}},[s]),o=c.useCallback(()=>{if(s){const k=s.getCenter(),C=s.getZoom(),x=180/Math.pow(2,C)*.25;s.panTo([k.lat-x,k.lng])}},[s]),g=c.useCallback(()=>{if(s){const k=s.getCenter(),C=s.getZoom(),x=360/Math.pow(2,C)*.25;s.panTo([k.lat,k.lng-x])}},[s]),h=c.useCallback(()=>{if(s){const k=s.getCenter(),C=s.getZoom(),x=360/Math.pow(2,C)*.25;s.panTo([k.lat,k.lng+x])}},[s]),m=c.useCallback(()=>{s&&r.length>0&&Ht(s,r,{padding:[50,50],maxZoom:15,animate:!0,duration:1e3})},[s,r]),u=c.useCallback(()=>{n&&n()},[n]),v=c.useCallback(()=>{t&&t()},[t]),N=c.useCallback(()=>{a&&a()},[a]);return c.useEffect(()=>{const k=C=>{if(C.target instanceof HTMLInputElement||C.target instanceof HTMLTextAreaElement||C.target?.contentEditable==="true")return;const x=C.ctrlKey||C.metaKey,w=C.shiftKey,f=C.altKey;switch(C.key.toLowerCase()){case"+":case"=":x||(C.preventDefault(),l());break;case"-":case"_":x||(C.preventDefault(),i());break;case"arrowup":!x&&!w&&(C.preventDefault(),d());break;case"arrowdown":!x&&!w&&(C.preventDefault(),o());break;case"arrowleft":!x&&!w&&(C.preventDefault(),g());break;case"arrowright":!x&&!w&&(C.preventDefault(),h());break;case"w":x||(C.preventDefault(),d());break;case"s":x||(C.preventDefault(),o());break;case"a":x||(C.preventDefault(),g());break;case"d":x||(C.preventDefault(),h());break;case"f":x?(C.preventDefault(),m()):f&&(C.preventDefault(),v());break;case"r":x&&(C.preventDefault(),u());break;case"l":x&&(C.preventDefault(),N());break;case"0":x||(C.preventDefault(),u());break;case"home":C.preventDefault(),m();break;case"end":C.preventDefault(),u();break}};return document.addEventListener("keydown",k),()=>{document.removeEventListener("keydown",k)}},[l,i,d,o,g,h,m,u,v,N]),{shortcuts:[{key:"+/-",description:"Zoom in/out",action:l,available:!!s},{key:"â†‘â†“â†â†’",description:"Pan map",action:d,available:!!s},{key:"WASD",description:"Pan map (alternative)",action:d,available:!!s},{key:"Ctrl+F",description:"Zoom to fit waypoints",action:m,available:r.length>0},{key:"Ctrl+R",description:"Reset view",action:u,available:!!n},{key:"Alt+F",description:"Toggle fullscreen",action:v,available:!!t},{key:"Ctrl+L",description:"Toggle layer control",action:N,available:!!a},{key:"Home",description:"Zoom to fit waypoints",action:m,available:r.length>0},{key:"End",description:"Reset view",action:u,available:!!n},{key:"0",description:"Reset view",action:u,available:!!n}].filter(k=>k.available),actions:{zoomIn:l,zoomOut:i,panUp:d,panDown:o,panLeft:g,panRight:h,zoomToFit:m,resetView:u,toggleFullscreen:v,toggleLayerControl:N}}},Ba=({map:s,isFullscreen:t,onToggleFullscreen:a,onResetView:n,onToggleLayerControl:r,layerControlCollapsed:l})=>{const{waypoints:i}=ce(),{addNotification:d}=me(),[o,g]=c.useState(!1),[h,m]=c.useState(!1),u=c.useRef(null);c.useEffect(()=>{if(!h)return;const x=w=>{u.current&&!u.current.contains(w.target)&&m(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[h]);const{shortcuts:v,actions:N}=Wa({map:s,onToggleFullscreen:a,onToggleLayerControl:r,onResetView:n}),S=c.useCallback(()=>{if(!s||i.length===0){d({type:"warning",message:"Add waypoints to use zoom to fit"});return}const x=Ht(s,i,{padding:[50,50],maxZoom:15,animate:!0,duration:1e3});d(x?{type:"success",message:"Zoomed to fit all waypoints"}:{type:"error",message:"Failed to zoom to waypoints"})},[s,i,d]),k=c.useCallback(()=>{s&&N.zoomIn()},[s,N]),C=c.useCallback(()=>{s&&N.zoomOut()},[s,N]);return e.jsxs("div",{className:"absolute top-4 right-3 z-40 flex flex-col space-y-2 hidden sm:flex",children:[e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg shadow-medium overflow-hidden",children:[e.jsx("button",{onClick:k,className:"block w-10 h-10 flex items-center justify-center hover:bg-neutral-50 border-b border-neutral-200 transition-colors",title:"Zoom in (+)","aria-label":"Zoom in",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{onClick:C,className:"block w-10 h-10 flex items-center justify-center hover:bg-neutral-50 transition-colors",title:"Zoom out (-)","aria-label":"Zoom out",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg shadow-medium overflow-hidden",children:[e.jsx("button",{onClick:S,disabled:i.length===0,className:L("block w-10 h-10 flex items-center justify-center border-b border-neutral-200 transition-colors",i.length>0?"hover:bg-neutral-50 text-neutral-700":"text-neutral-300 cursor-not-allowed"),title:`Zoom to fit waypoints (Ctrl+F)${i.length===0?" - Add waypoints first":""}`,"aria-label":"Zoom to fit all waypoints",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),e.jsxs("div",{className:"relative",ref:u,children:[e.jsx("button",{onClick:()=>m(!h),className:L("block w-10 h-10 flex items-center justify-center hover:bg-neutral-50 transition-colors",h&&"bg-neutral-100"),title:"More options","aria-label":"More map options","aria-expanded":h,"aria-haspopup":"menu",children:e.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"5",r:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"}),e.jsx("circle",{cx:"12",cy:"19",r:"2"})]})}),h&&e.jsxs("div",{className:"absolute right-12 top-0 bg-white rounded-lg shadow-lg border border-neutral-200 py-1 min-w-[180px] z-50",role:"menu",children:[e.jsx("button",{onClick:()=>{n(),m(!1)},className:"flex items-center gap-3 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50 w-full",role:"menuitem",children:"Reset to Europe view"}),e.jsx("button",{onClick:()=>{r(),m(!1)},className:L("flex items-center gap-3 px-3 py-2 text-sm hover:bg-neutral-50 w-full",l?"text-neutral-700":"text-primary-600"),role:"menuitem",children:"Toggle layers"}),e.jsx("button",{onClick:()=>{a(),m(!1)},className:L("flex items-center gap-3 px-3 py-2 text-sm hover:bg-neutral-50 w-full",t?"text-primary-600":"text-neutral-700"),role:"menuitem",children:t?"Exit fullscreen":"Fullscreen"}),e.jsx("div",{className:"border-t border-neutral-100 my-1",role:"separator"}),e.jsx("button",{onClick:()=>{g(!o),m(!1)},className:"flex items-center gap-3 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50 w-full",role:"menuitem",children:"Keyboard shortcuts"})]})]})]}),o&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 min-w-64 max-w-sm",children:[e.jsx("h3",{className:"font-display font-semibold text-neutral-900 mb-3 text-sm",children:"Keyboard Shortcuts"}),e.jsx("div",{className:"space-y-2",children:v.map((x,w)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-neutral-600",children:x.description}),e.jsx("kbd",{className:"px-2 py-1 bg-neutral-100 rounded text-neutral-900 font-mono",children:x.key})]},w))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-neutral-200",children:e.jsx("p",{className:"text-xs text-neutral-500",children:"Shortcuts work when not typing in input fields"})})]})]})},Oa=({map:s,isFullscreen:t,onToggleFullscreen:a,onResetView:n,onToggleLayerControl:r,className:l})=>{const{waypoints:i}=ce(),{addNotification:d}=me(),[o,g]=c.useState(!1),[h,m]=c.useState(!1);c.useEffect(()=>{const x=()=>{m(window.innerWidth<768||"ontouchstart"in window)};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const u=c.useCallback(()=>{s&&s.zoomIn()},[s]),v=c.useCallback(()=>{s&&s.zoomOut()},[s]),N=c.useCallback(()=>{if(!s||i.length===0){d({type:"warning",message:"Add waypoints to use zoom to fit"});return}Ht(s,i,{padding:[60,60],maxZoom:14,animate:!0,duration:800})&&d({type:"success",message:"Zoomed to fit waypoints"}),g(!1)},[s,i,d]),S=c.useCallback(()=>{a(),g(!1)},[a]),k=c.useCallback(()=>{n(),g(!1)},[n]),C=c.useCallback(()=>{r(),g(!1)},[r]);return h?e.jsxs("div",{className:L("fixed bottom-16 right-4 z-40 flex flex-col items-end space-y-2","sm:hidden",l),children:[o&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-2 grid grid-cols-2 gap-2 animate-fade-in",children:[e.jsxs("button",{onClick:N,disabled:i.length===0,className:L("flex flex-col items-center justify-center h-16 w-16 rounded-lg transition-colors",i.length>0?"bg-primary-50 hover:bg-primary-100 text-primary-600 active:bg-primary-200":"bg-neutral-50 text-neutral-300 cursor-not-allowed"),children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs font-medium",children:"Fit"})]}),e.jsxs("button",{onClick:k,className:"flex flex-col items-center justify-center h-16 w-16 rounded-lg bg-neutral-50 hover:bg-neutral-100 text-neutral-600 active:bg-neutral-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a9 9 0 019 9 9 9 0 019-9M12 12V9"})}),e.jsx("span",{className:"text-xs font-medium",children:"Reset"})]}),e.jsxs("button",{onClick:C,className:"flex flex-col items-center justify-center h-16 w-16 rounded-lg bg-purple-50 hover:bg-purple-100 text-purple-600 active:bg-purple-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),e.jsx("span",{className:"text-xs font-medium",children:"Layers"})]}),e.jsx("button",{onClick:S,className:L("flex flex-col items-center justify-center h-16 w-16 rounded-lg transition-colors",t?"bg-primary-100 text-primary-700 active:bg-primary-200":"bg-green-50 hover:bg-green-100 text-green-600 active:bg-green-200"),children:t?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4.5M9 9H4.5M9 9L3.5 3.5M15 9h4.5M15 9V4.5M15 9l5.5-5.5M9 15v4.5M9 15H4.5M9 15l-5.5 5.5M15 15h4.5M15 15v4.5m0-4.5l5.5 5.5"})}),e.jsx("span",{className:"text-xs font-medium",children:"Exit"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs font-medium",children:"Full"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:u,className:"w-12 h-12 flex items-center justify-center hover:bg-neutral-50 active:bg-neutral-100 border-r border-neutral-200 transition-colors","aria-label":"Zoom in",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{onClick:v,className:"w-12 h-12 flex items-center justify-center hover:bg-neutral-50 active:bg-neutral-100 transition-colors","aria-label":"Zoom out",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})})]})}),e.jsx("button",{onClick:()=>g(!o),className:L("w-12 h-12 bg-primary-600 text-white rounded-lg shadow-lg flex items-center justify-center transition-all",o?"bg-neutral-600 rotate-45":"hover:bg-primary-700 active:bg-primary-800"),"aria-label":o?"Close more options":"Open more options",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}):null};function Ha(s){return s>=1e3?`${(s/1e3).toFixed(0)}km`:`${s.toFixed(0)}m`}function _a(s){const t=Math.floor(s/3600),a=Math.floor(s%3600/60);return t>0?`${t}h${a>0?` ${a}m`:""}`:`${a}m`}const Va=({waypointCount:s,calculatedRoute:t,showCampsiteControls:a,showCampsiteFilter:n,showRouteInfo:r,showTripManager:l,showPlanningTools:i,showCostCalculator:d,showTripSettings:o,onToggleTripSettings:g,onToggleCampsiteControls:h,onToggleRouteInfo:m,onToggleTripManager:u,onTogglePlanningTools:v,onToggleCostCalculator:N,onOpenVehicleSidebar:S,onClearWaypoints:k})=>{const[C,x]=c.useState(!1),w=t?.routes?.[0],f=!!w,E=a||n;return e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-30 sm:hidden",children:[C&&e.jsxs("div",{className:"bg-white border-t border-neutral-200 px-3 py-2 flex gap-2 animate-fade-in",children:[e.jsxs("button",{onClick:()=>{g(),x(!1)},className:L("flex-1 flex items-center justify-center gap-1.5 py-2 px-3 rounded-lg text-xs font-medium transition-colors",o?"bg-sky-100 text-sky-700":"bg-neutral-100 text-neutral-700 active:bg-neutral-200"),children:[e.jsx(Rs,{className:"w-4 h-4"}),"Settings"]}),e.jsxs("button",{onClick:()=>{u(),x(!1)},className:L("flex-1 flex items-center justify-center gap-1.5 py-2 px-3 rounded-lg text-xs font-medium transition-colors",l?"bg-indigo-100 text-indigo-700":"bg-neutral-100 text-neutral-700 active:bg-neutral-200"),children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),"Trips"]}),e.jsxs("button",{onClick:()=>{v(),x(!1)},className:L("flex-1 flex items-center justify-center gap-1.5 py-2 px-3 rounded-lg text-xs font-medium transition-colors",i?"bg-violet-100 text-violet-700":"bg-neutral-100 text-neutral-700 active:bg-neutral-200"),disabled:s<2,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Planning"]}),e.jsxs("button",{onClick:()=>{N(),x(!1)},className:L("flex-1 flex items-center justify-center gap-1.5 py-2 px-3 rounded-lg text-xs font-medium transition-colors",d?"bg-emerald-100 text-emerald-700":"bg-neutral-100 text-neutral-700 active:bg-neutral-200"),disabled:s<2,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Costs"]})]}),e.jsx("div",{className:"bg-white/95 backdrop-blur-sm border-t border-neutral-200 px-2 py-1.5 pb-[max(0.375rem,env(safe-area-inset-bottom))]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-1 min-w-0 px-1.5",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(gt,{className:"w-3.5 h-3.5 text-primary-600 flex-shrink-0"}),e.jsx("span",{className:"text-neutral-700 font-medium truncate",children:s===0?"Tap map to start":f?e.jsxs(e.Fragment,{children:[Ha(w.summary.distance)," Â·"," ",_a(w.summary.duration)]}):s===1?"Add another point":`${s} points`})]})}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{onClick:S,className:"w-10 h-10 flex items-center justify-center rounded-lg text-neutral-600 active:bg-neutral-100 transition-colors","aria-label":"Vehicle settings",children:e.jsx(jt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:h,className:L("w-10 h-10 flex items-center justify-center rounded-lg transition-colors",E?"bg-green-100 text-green-700":"text-neutral-600 active:bg-neutral-100"),"aria-label":"Campsite controls",children:e.jsx(ye,{className:"w-5 h-5"})}),f&&e.jsx("button",{onClick:m,className:L("w-10 h-10 flex items-center justify-center rounded-lg transition-colors",r?"bg-primary-100 text-primary-700":"text-neutral-600 active:bg-neutral-100"),"aria-label":"Route information",children:e.jsx(bs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>x(!C),className:L("w-10 h-10 flex items-center justify-center rounded-lg transition-colors",C||o||l||i||d?"bg-violet-100 text-violet-700":"text-neutral-600 active:bg-neutral-100"),"aria-label":"Trip plan",children:e.jsx(gs,{className:"w-5 h-5"})}),s>0&&e.jsx("button",{onClick:k,className:"w-10 h-10 flex items-center justify-center rounded-lg text-red-500 active:bg-red-50 transition-colors","aria-label":"Clear waypoints",children:e.jsx(st,{className:"w-5 h-5"})})]})]})})]})},rs=({content:s,children:t,position:a="auto",size:n="md",variant:r="default",delay:l=500,disabled:i=!1,className:d,maxWidth:o="300px",showArrow:g=!0,trigger:h="hover",interactive:m=!1})=>{const[u,v]=c.useState(!1),[N,S]=c.useState(a),[k,C]=c.useState({x:0,y:0}),x=c.useRef(null),w=c.useRef(null),f=c.useRef(),E={default:"bg-neutral-900 text-white border-neutral-700",info:"bg-primary-600 text-white border-primary-500",warning:"bg-yellow-600 text-white border-yellow-500",error:"bg-red-600 text-white border-red-500",success:"bg-green-600 text-white border-green-500"},W={sm:"text-xs px-2 py-1",md:"text-sm px-3 py-2",lg:"text-base px-4 py-3"},D=$=>{if(a!=="auto")return a;const{innerWidth:J,innerHeight:M}=window,z=window.scrollX,q=window.scrollY,T=$.top-q,j=M-($.bottom-q),H=$.left-z,y=J-($.right-z);return j>=60?"bottom":T>=60?"top":y>=150?"right":H>=150?"left":"bottom"},O=($,J)=>{const M=w.current;if(!M)return{x:0,y:0};const z=M.getBoundingClientRect(),q=window.scrollX,T=window.scrollY;let j=0,H=0;switch(J){case"top":j=$.left+q+$.width/2-z.width/2,H=$.top+T-z.height-8;break;case"bottom":j=$.left+q+$.width/2-z.width/2,H=$.bottom+T+8;break;case"left":j=$.left+q-z.width-8,H=$.top+T+$.height/2-z.height/2;break;case"right":j=$.right+q+8,H=$.top+T+$.height/2-z.height/2;break}const y=8;return j=Math.max(y,Math.min(j,window.innerWidth+q-z.width-y)),H=Math.max(y,Math.min(H,window.innerHeight+T-z.height-y)),{x:j,y:H}},G=()=>{i||!s||(f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{const $=x.current;if(!$)return;const J=$.getBoundingClientRect(),M=D(J);S(M),v(!0),requestAnimationFrame(()=>{const z=O(J,M);C(z)})},l))},K=()=>{f.current&&clearTimeout(f.current),m?f.current=setTimeout(()=>{v(!1)},100):v(!1)},B=()=>{h==="hover"&&G()},p=()=>{h==="hover"&&K()},I=()=>{h==="click"&&(u?K():G())},F=()=>{h==="focus"&&G()},Z=()=>{h==="focus"&&K()},Y=()=>{m&&f.current&&clearTimeout(f.current)},se=()=>{m&&K()};c.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const R=({position:$})=>{if(!g)return null;const J={top:"border-l-transparent border-r-transparent border-b-0 border-t-8 border-t-neutral-900 bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full",bottom:"border-l-transparent border-r-transparent border-t-0 border-b-8 border-b-neutral-900 top-0 left-1/2 transform -translate-x-1/2 -translate-y-full",left:"border-t-transparent border-b-transparent border-r-0 border-l-8 border-l-neutral-900 right-0 top-1/2 transform translate-x-full -translate-y-1/2",right:"border-t-transparent border-b-transparent border-l-0 border-r-8 border-r-neutral-900 left-0 top-1/2 transform -translate-x-full -translate-y-1/2"};return e.jsx("div",{className:L("absolute w-0 h-0",J[$]||J.bottom),style:{borderColor:r==="default"?"rgb(17 24 39)":E[r].split(" ")[0].replace("bg-","rgb(")}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:x,onMouseEnter:B,onMouseLeave:p,onClick:I,onKeyDown:$=>{($.key==="Enter"||$.key===" ")&&I()},onFocus:F,onBlur:Z,className:"inline-block",role:"button",tabIndex:0,children:t}),u&&e.jsxs("div",{ref:w,role:"tooltip",className:L("fixed z-50 rounded-lg border shadow-lg transition-opacity duration-200","pointer-events-auto select-text",E[r],W[n],d),style:{left:k.x,top:k.y,maxWidth:o,pointerEvents:m?"auto":"none"},onMouseEnter:Y,onMouseLeave:se,children:[s,e.jsx(R,{position:N})]})]})},We=[{id:"fiat",name:"Fiat",country:"Italy",models:[{id:"ducato",name:"Ducato",variants:[{id:"l1h1",name:"L1H1 (Short/Low)",height:2.25,width:2.05,length:4.96,weight:3.3,fuelConsumption:9.5,internalHeight:1.66,internalWidth:1.87,internalLength:2.67},{id:"l1h2",name:"L1H2 (Short/Medium)",height:2.52,width:2.05,length:4.96,weight:3.5,fuelConsumption:10,internalHeight:1.93,internalWidth:1.87,internalLength:2.67},{id:"l2h1",name:"L2H1 (Medium/Low)",height:2.25,width:2.05,length:5.41,weight:3.3,fuelConsumption:10,internalHeight:1.66,internalWidth:1.87,internalLength:3.12},{id:"l2h2",name:"L2H2 (Medium/Medium)",height:2.52,width:2.05,length:5.41,weight:3.5,fuelConsumption:10.5,internalHeight:1.93,internalWidth:1.87,internalLength:3.12},{id:"l3h2",name:"L3H2 (Long/Medium)",height:2.52,width:2.05,length:6,weight:3.5,fuelConsumption:11.5,internalHeight:1.93,internalWidth:1.87,internalLength:3.71},{id:"l3h3",name:"L3H3 (Long/High)",height:2.76,width:2.05,length:6,weight:4,fuelConsumption:12,internalHeight:2.17,internalWidth:1.87,internalLength:3.71},{id:"l4h2",name:"L4H2 (XLong/Medium)",height:2.52,width:2.05,length:6.36,weight:4,fuelConsumption:12.5,internalHeight:1.93,internalWidth:1.87,internalLength:4.07},{id:"l4h3",name:"L4H3 (XLong/High)",height:2.76,width:2.05,length:6.36,weight:4.25,fuelConsumption:13,internalHeight:2.17,internalWidth:1.87,internalLength:4.07}]}]},{id:"peugeot",name:"Peugeot",country:"France",models:[{id:"boxer",name:"Boxer",variants:[{id:"l1h1",name:"L1H1 (Short/Low)",height:2.25,width:2.05,length:4.96,weight:3.3,fuelConsumption:9.5,internalHeight:1.66,internalWidth:1.87,internalLength:2.67},{id:"l1h2",name:"L1H2 (Short/Medium)",height:2.52,width:2.05,length:4.96,weight:3.5,fuelConsumption:10,internalHeight:1.93,internalWidth:1.87,internalLength:2.67},{id:"l2h2",name:"L2H2 (Medium/Medium)",height:2.52,width:2.05,length:5.41,weight:3.5,fuelConsumption:10.5,internalHeight:1.93,internalWidth:1.87,internalLength:3.12},{id:"l3h2",name:"L3H2 (Long/Medium)",height:2.52,width:2.05,length:6,weight:3.5,fuelConsumption:11.5,internalHeight:1.93,internalWidth:1.87,internalLength:3.71},{id:"l3h3",name:"L3H3 (Long/High)",height:2.76,width:2.05,length:6,weight:4,fuelConsumption:12,internalHeight:2.17,internalWidth:1.87,internalLength:3.71},{id:"l4h2",name:"L4H2 (XLong/Medium)",height:2.52,width:2.05,length:6.36,weight:4,fuelConsumption:12.5,internalHeight:1.93,internalWidth:1.87,internalLength:4.07},{id:"l4h3",name:"L4H3 (XLong/High)",height:2.76,width:2.05,length:6.36,weight:4.25,fuelConsumption:13,internalHeight:2.17,internalWidth:1.87,internalLength:4.07}]}]},{id:"citroen",name:"CitroÃ«n",country:"France",models:[{id:"relay",name:"Relay / Jumper",variants:[{id:"l1h1",name:"L1H1 (Short/Low)",height:2.25,width:2.05,length:4.96,weight:3.3,fuelConsumption:9.5,internalHeight:1.66,internalWidth:1.87,internalLength:2.67},{id:"l1h2",name:"L1H2 (Short/Medium)",height:2.52,width:2.05,length:4.96,weight:3.5,fuelConsumption:10,internalHeight:1.93,internalWidth:1.87,internalLength:2.67},{id:"l2h2",name:"L2H2 (Medium/Medium)",height:2.52,width:2.05,length:5.41,weight:3.5,fuelConsumption:10.5,internalHeight:1.93,internalWidth:1.87,internalLength:3.12},{id:"l3h2",name:"L3H2 (Long/Medium)",height:2.52,width:2.05,length:6,weight:3.5,fuelConsumption:11.5,internalHeight:1.93,internalWidth:1.87,internalLength:3.71},{id:"l3h3",name:"L3H3 (Long/High)",height:2.76,width:2.05,length:6,weight:4,fuelConsumption:12,internalHeight:2.17,internalWidth:1.87,internalLength:3.71},{id:"l4h3",name:"L4H3 (XLong/High)",height:2.76,width:2.05,length:6.36,weight:4.25,fuelConsumption:13,internalHeight:2.17,internalWidth:1.87,internalLength:4.07}]}]},{id:"mercedes",name:"Mercedes-Benz",country:"Germany",models:[{id:"sprinter",name:"Sprinter",variants:[{id:"a0-standard",name:"Compact Standard Roof",height:2.37,width:1.99,length:5.27,weight:3.5,fuelConsumption:10,internalHeight:1.56,internalWidth:1.79,internalLength:2.6},{id:"a0-high",name:"Compact High Roof",height:2.69,width:1.99,length:5.27,weight:3.5,fuelConsumption:10.5,internalHeight:1.88,internalWidth:1.79,internalLength:2.6},{id:"a1-standard",name:"Standard Roof (Medium)",height:2.37,width:1.99,length:5.93,weight:3.5,fuelConsumption:10.5,internalHeight:1.56,internalWidth:1.79,internalLength:3.27},{id:"a1-high",name:"High Roof (Medium)",height:2.69,width:1.99,length:5.93,weight:3.5,fuelConsumption:11,internalHeight:1.88,internalWidth:1.79,internalLength:3.27},{id:"a1-superhigh",name:"Super High Roof (Medium)",height:2.97,width:1.99,length:5.93,weight:3.5,fuelConsumption:11.5,internalHeight:2.14,internalWidth:1.79,internalLength:3.27},{id:"a2-high",name:"High Roof (Long)",height:2.69,width:1.99,length:6.97,weight:3.5,fuelConsumption:12,internalHeight:1.88,internalWidth:1.79,internalLength:4.31},{id:"a2-superhigh",name:"Super High Roof (Long)",height:2.97,width:1.99,length:6.97,weight:4,fuelConsumption:12.5,internalHeight:2.14,internalWidth:1.79,internalLength:4.31},{id:"a3-high",name:"High Roof (XLong)",height:2.69,width:1.99,length:7.37,weight:4,fuelConsumption:13,internalHeight:1.88,internalWidth:1.79,internalLength:4.71},{id:"a3-superhigh",name:"Super High Roof (XLong)",height:2.97,width:1.99,length:7.37,weight:4.5,fuelConsumption:13.5,internalHeight:2.14,internalWidth:1.79,internalLength:4.71}]}]},{id:"volkswagen",name:"Volkswagen",country:"Germany",models:[{id:"crafter",name:"Crafter",variants:[{id:"short-normal",name:"Short Normal Roof",height:2.35,width:2.04,length:5.99,weight:3.5,fuelConsumption:10,internalHeight:1.63,internalWidth:1.83,internalLength:3.45},{id:"short-high",name:"Short High Roof",height:2.59,width:2.04,length:5.99,weight:3.5,fuelConsumption:10.5,internalHeight:1.86,internalWidth:1.83,internalLength:3.45},{id:"medium-normal",name:"Medium Normal Roof",height:2.35,width:2.04,length:6.84,weight:3.5,fuelConsumption:11,internalHeight:1.63,internalWidth:1.83,internalLength:4.3},{id:"medium-high",name:"Medium High Roof",height:2.59,width:2.04,length:6.84,weight:3.5,fuelConsumption:11.5,internalHeight:1.86,internalWidth:1.83,internalLength:4.3},{id:"long-normal",name:"Long Normal Roof",height:2.35,width:2.04,length:7.39,weight:4,fuelConsumption:12,internalHeight:1.63,internalWidth:1.83,internalLength:4.85},{id:"long-high",name:"Long High Roof",height:2.59,width:2.04,length:7.39,weight:4,fuelConsumption:12.5,internalHeight:1.86,internalWidth:1.83,internalLength:4.85}]},{id:"transporter",name:"Transporter (T6.1)",variants:[{id:"swb",name:"Short Wheelbase",height:1.99,width:1.9,length:4.9,weight:2.8,fuelConsumption:8.5,internalHeight:1.41,internalWidth:1.7,internalLength:2.57},{id:"lwb",name:"Long Wheelbase",height:1.99,width:1.9,length:5.3,weight:3,fuelConsumption:9,internalHeight:1.41,internalWidth:1.7,internalLength:2.97},{id:"lwb-high",name:"Long High Roof",height:2.48,width:1.9,length:5.3,weight:3,fuelConsumption:9.5,internalHeight:1.94,internalWidth:1.7,internalLength:2.97}]},{id:"california",name:"California",variants:[{id:"beach",name:"Beach",height:1.99,width:1.9,length:4.9,weight:3,fuelConsumption:9},{id:"coast",name:"Coast",height:1.99,width:1.9,length:4.9,weight:3.1,fuelConsumption:9.5},{id:"ocean",name:"Ocean",height:1.99,width:1.9,length:4.9,weight:3.1,fuelConsumption:9.5}]}]},{id:"ford",name:"Ford",country:"USA/Europe",models:[{id:"transit",name:"Transit",variants:[{id:"l2h2",name:"L2H2 (Short/Medium)",height:2.35,width:2.06,length:5.53,weight:3.3,fuelConsumption:10,internalHeight:1.78,internalWidth:1.79,internalLength:2.9},{id:"l2h3",name:"L2H3 (Short/High)",height:2.55,width:2.06,length:5.53,weight:3.5,fuelConsumption:10.5,internalHeight:1.98,internalWidth:1.79,internalLength:2.9},{id:"l3h2",name:"L3H2 (Medium/Medium)",height:2.35,width:2.06,length:5.98,weight:3.5,fuelConsumption:10.5,internalHeight:1.78,internalWidth:1.79,internalLength:3.34},{id:"l3h3",name:"L3H3 (Medium/High)",height:2.55,width:2.06,length:5.98,weight:3.5,fuelConsumption:11,internalHeight:1.98,internalWidth:1.79,internalLength:3.34},{id:"l4h2",name:"L4H2 (Long/Medium)",height:2.35,width:2.06,length:6.7,weight:4,fuelConsumption:11.5,internalHeight:1.78,internalWidth:1.79,internalLength:4.22},{id:"l4h3",name:"L4H3 (Long/High)",height:2.55,width:2.06,length:6.7,weight:4,fuelConsumption:12,internalHeight:1.98,internalWidth:1.79,internalLength:4.22}]},{id:"transit-custom",name:"Transit Custom",variants:[{id:"l1h1",name:"L1H1 (Short/Low)",height:1.98,width:1.99,length:4.97,weight:2.8,fuelConsumption:7.5,internalHeight:1.41,internalWidth:1.54,internalLength:2.56},{id:"l1h2",name:"L1H2 (Short/High)",height:2.34,width:1.99,length:4.97,weight:2.9,fuelConsumption:8,internalHeight:1.78,internalWidth:1.54,internalLength:2.56},{id:"l2h1",name:"L2H1 (Long/Low)",height:1.98,width:1.99,length:5.34,weight:3,fuelConsumption:8,internalHeight:1.41,internalWidth:1.54,internalLength:2.93},{id:"l2h2",name:"L2H2 (Long/High)",height:2.34,width:1.99,length:5.34,weight:3.1,fuelConsumption:8.5,internalHeight:1.78,internalWidth:1.54,internalLength:2.93}]},{id:"nugget",name:"Transit Custom Nugget",variants:[{id:"standard",name:"Nugget",height:2.09,width:1.99,length:4.97,weight:3.1,fuelConsumption:8},{id:"plus",name:"Nugget Plus",height:2.09,width:1.99,length:5.34,weight:3.2,fuelConsumption:8.5}]}]},{id:"renault",name:"Renault",country:"France",models:[{id:"master",name:"Master",variants:[{id:"l1h1",name:"L1H1 (Short/Low)",height:2.31,width:2.07,length:5.08,weight:3.3,fuelConsumption:10,internalHeight:1.66,internalWidth:1.77,internalLength:2.58},{id:"l1h2",name:"L1H2 (Short/Medium)",height:2.5,width:2.07,length:5.08,weight:3.5,fuelConsumption:10.5,internalHeight:1.85,internalWidth:1.77,internalLength:2.58},{id:"l2h2",name:"L2H2 (Medium/Medium)",height:2.5,width:2.07,length:5.55,weight:3.5,fuelConsumption:11,internalHeight:1.85,internalWidth:1.77,internalLength:3.08},{id:"l3h2",name:"L3H2 (Long/Medium)",height:2.5,width:2.07,length:6.2,weight:3.5,fuelConsumption:11.5,internalHeight:1.85,internalWidth:1.77,internalLength:3.73},{id:"l3h3",name:"L3H3 (Long/High)",height:2.75,width:2.07,length:6.2,weight:4,fuelConsumption:12,internalHeight:2.1,internalWidth:1.77,internalLength:3.73},{id:"l4h2",name:"L4H2 (XLong/Medium)",height:2.5,width:2.07,length:6.85,weight:4,fuelConsumption:12,internalHeight:1.85,internalWidth:1.77,internalLength:4.38},{id:"l4h3",name:"L4H3 (XLong/High)",height:2.75,width:2.07,length:6.85,weight:4.5,fuelConsumption:12.5,internalHeight:2.1,internalWidth:1.77,internalLength:4.38}]},{id:"trafic",name:"Trafic",variants:[{id:"l1h1",name:"L1H1 (Short/Standard)",height:1.97,width:1.96,length:4.99,weight:2.7,fuelConsumption:7.5,internalHeight:1.39,internalWidth:1.66,internalLength:2.54},{id:"l1h2",name:"L1H2 (Short/High)",height:2.5,width:1.96,length:4.99,weight:2.8,fuelConsumption:8,internalHeight:1.9,internalWidth:1.66,internalLength:2.54},{id:"l2h1",name:"L2H1 (Long/Standard)",height:1.97,width:1.96,length:5.4,weight:2.9,fuelConsumption:8,internalHeight:1.39,internalWidth:1.66,internalLength:2.94},{id:"l2h2",name:"L2H2 (Long/High)",height:2.5,width:1.96,length:5.4,weight:3,fuelConsumption:8.5,internalHeight:1.9,internalWidth:1.66,internalLength:2.94}]}]},{id:"man",name:"MAN",country:"Germany",models:[{id:"tge",name:"TGE",variants:[{id:"short-normal",name:"Short Normal Roof",height:2.35,width:2.04,length:5.99,weight:3.5,fuelConsumption:10,internalHeight:1.63,internalWidth:1.83,internalLength:3.45},{id:"short-high",name:"Short High Roof",height:2.59,width:2.04,length:5.99,weight:3.5,fuelConsumption:10.5,internalHeight:1.86,internalWidth:1.83,internalLength:3.45},{id:"medium-high",name:"Medium High Roof",height:2.59,width:2.04,length:6.84,weight:3.5,fuelConsumption:11.5,internalHeight:1.86,internalWidth:1.83,internalLength:4.3},{id:"long-high",name:"Long High Roof",height:2.59,width:2.04,length:7.39,weight:4,fuelConsumption:12.5,internalHeight:1.86,internalWidth:1.83,internalLength:4.85}]}]},{id:"opel",name:"Opel / Vauxhall",country:"Germany/UK",models:[{id:"movano",name:"Movano",variants:[{id:"l1h1",name:"L1H1 (Short/Low)",height:2.31,width:2.07,length:5.08,weight:3.3,fuelConsumption:10,internalHeight:1.66,internalWidth:1.77,internalLength:2.58},{id:"l2h2",name:"L2H2 (Medium/Medium)",height:2.5,width:2.07,length:5.55,weight:3.5,fuelConsumption:11,internalHeight:1.85,internalWidth:1.77,internalLength:3.08},{id:"l3h2",name:"L3H2 (Long/Medium)",height:2.5,width:2.07,length:6.2,weight:3.5,fuelConsumption:11.5,internalHeight:1.85,internalWidth:1.77,internalLength:3.73},{id:"l3h3",name:"L3H3 (Long/High)",height:2.75,width:2.07,length:6.2,weight:4,fuelConsumption:12,internalHeight:2.1,internalWidth:1.77,internalLength:3.73},{id:"l4h3",name:"L4H3 (XLong/High)",height:2.75,width:2.07,length:6.85,weight:4.5,fuelConsumption:12.5,internalHeight:2.1,internalWidth:1.77,internalLength:4.38}]},{id:"vivaro",name:"Vivaro",variants:[{id:"l1",name:"L1 Standard",height:1.9,width:1.92,length:4.96,weight:2.7,fuelConsumption:7.5},{id:"l2",name:"L2 Long",height:1.9,width:1.92,length:5.31,weight:2.9,fuelConsumption:8}]}]},{id:"iveco",name:"Iveco",country:"Italy",models:[{id:"daily",name:"Daily",variants:[{id:"7.2",name:"7.2mÂ³ (Short)",height:2.3,width:2.01,length:5,weight:3.5,fuelConsumption:10.5,internalHeight:1.55,internalWidth:1.8,internalLength:2.61},{id:"10.8",name:"10.8mÂ³ (Medium)",height:2.55,width:2.01,length:5.55,weight:3.5,fuelConsumption:11.5,internalHeight:1.8,internalWidth:1.8,internalLength:3.16},{id:"12",name:"12mÂ³ (Medium/High)",height:2.7,width:2.01,length:5.55,weight:3.5,fuelConsumption:12,internalHeight:1.95,internalWidth:1.8,internalLength:3.16},{id:"15.6",name:"15.6mÂ³ (Long)",height:2.55,width:2.01,length:6.5,weight:4,fuelConsumption:12.5,internalHeight:1.8,internalWidth:1.8,internalLength:4.68},{id:"18",name:"18mÂ³ (Long/High)",height:2.7,width:2.01,length:6.5,weight:4.5,fuelConsumption:13,internalHeight:1.95,internalWidth:1.8,internalLength:4.68}]}]}],Ee=[{id:"vw-california",name:"VW California",make:"Volkswagen",base:"T6.1 California",height:1.99,width:1.9,length:4.9,weight:3,fuelConsumption:9.5},{id:"ford-nugget",name:"Ford Nugget",make:"Ford",base:"Transit Custom",height:2.09,width:1.99,length:4.97,weight:3.1,fuelConsumption:8},{id:"mercedes-marco-polo",name:"Mercedes Marco Polo",make:"Mercedes-Benz",base:"V-Class",height:2,width:1.93,length:5.14,weight:3.1,fuelConsumption:9.5},{id:"hymer-camper-van",name:"Hymer Camper Van",make:"Hymer",base:"Fiat Ducato L2H2",height:2.65,width:2.05,length:5.99,weight:3.5,fuelConsumption:12},{id:"adria-twin",name:"Adria Twin",make:"Adria",base:"Fiat Ducato L2H2",height:2.58,width:2.05,length:5.99,weight:3.3,fuelConsumption:11.5},{id:"possl-summit",name:"PÃ¶ssl Summit",make:"PÃ¶ssl",base:"Fiat Ducato L3H2",height:2.65,width:2.05,length:6.36,weight:3.5,fuelConsumption:12.5},{id:"hymer-b-class",name:"Hymer B-Class",make:"Hymer",base:"Mercedes Sprinter",height:2.95,width:2.3,length:7.49,weight:4.5,fuelConsumption:15},{id:"burstner-elegance",name:"BÃ¼rstner Elegance",make:"BÃ¼rstner",base:"Fiat Ducato",height:2.96,width:2.32,length:7.42,weight:4.4,fuelConsumption:14.5},{id:"carthago-c-tourer",name:"Carthago C-Tourer",make:"Carthago",base:"Fiat Ducato",height:2.9,width:2.3,length:6.99,weight:4,fuelConsumption:14},{id:"car-small-caravan",name:"Car + Small Caravan",make:"Various",base:"2-berth caravan",height:2.6,width:2.3,length:10,weight:3.5,fuelConsumption:10},{id:"car-medium-caravan",name:"Car + Medium Caravan",make:"Various",base:"4-berth caravan",height:2.65,width:2.3,length:12,weight:4,fuelConsumption:11.5},{id:"car-large-caravan",name:"Car + Large Caravan",make:"Various",base:"Twin-axle caravan",height:2.7,width:2.5,length:14,weight:5,fuelConsumption:13}];function Ua(s){return We.find(a=>a.id===s)?.models||[]}function qa(s,t){return We.find(r=>r.id===s)?.models.find(r=>r.id===t)?.variants||[]}const dt={height:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},width:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},length:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},weight:{metric:{label:"t",factor:1},imperial:{label:"lbs",factor:2204.62}}},mt={height:{min:1.5,max:4.5,step:.1},width:{min:1.5,max:3,step:.1},weight:{min:1,max:40,step:.1},length:{min:3,max:20,step:.1}},Ga=({className:s,onClose:t,compact:a=!1})=>{const{profile:n,setProfile:r,clearProfile:l}=he(),{addNotification:i}=me(),[d,o]=c.useState("vehicle"),[g,h]=c.useState(""),[m,u]=c.useState(""),[v,N]=c.useState(""),[S,k]=c.useState(""),[C,x]=c.useState(n||{height:2,width:1.9,weight:3,length:5}),[w,f]=c.useState({}),[E,W]=c.useState(!1),[D,O]=c.useState(()=>localStorage.getItem("camper-planner-unit-system")||"metric"),[G,K]=c.useState(!1),B=c.useMemo(()=>g?Ua(g):[],[g]),p=c.useMemo(()=>g&&m?qa(g,m):[],[g,m]);c.useEffect(()=>{n&&(x(n),W(!1))},[n]),c.useEffect(()=>{localStorage.setItem("camper-planner-unit-system",D)},[D]);const I=c.useCallback((y,P)=>{const U=mt[y];return isNaN(P)||P<=0?`${y} must be a positive number`:P<U.min?`${y} must be at least ${U.min}${dt[y].metric.label}`:P>U.max?`${y} cannot exceed ${U.max}${dt[y].metric.label}`:""},[]),F=c.useCallback(y=>{const P={};return["height","width","weight","length"].forEach(ae=>{const re=I(ae,y[ae]);re&&(P[ae]=re)}),P},[I]),Z=c.useCallback((y,P,U,ae)=>{if(U===ae)return y;const re=dt[P];return U==="metric"&&ae==="imperial"?y*re.imperial.factor:U==="imperial"&&ae==="metric"?y/re.imperial.factor:y},[]),Y=c.useCallback(y=>Z(C[y],y,"metric",D),[C,D,Z]),se=c.useCallback((y,P)=>{const U=Z(P,y,D,"metric");x(re=>({...re,[y]:U})),W(!0);const ae=I(y,U);f(re=>({...re,[y]:ae}))},[D,Z,I]),R=c.useCallback(y=>{h(y),u(""),N("")},[]),$=c.useCallback(y=>{u(y),N("")},[]),J=c.useCallback(y=>{N(y);const P=p.find(U=>U.id===y);if(P){const U=We.find(Q=>Q.id===g),ae=U?.models.find(Q=>Q.id===m),re={name:`${U?.name} ${ae?.name} ${P.name}`,height:P.height,width:P.width,weight:P.weight,length:P.length};x(re),W(!0),f({}),i({type:"info",message:`Applied ${U?.name} ${ae?.name} ${P.name} dimensions`})}},[p,g,m,i]),M=c.useCallback(y=>{k(y);const P=Ee.find(U=>U.id===y);if(P){const U={name:P.name,height:P.height,width:P.width,weight:P.weight,length:P.length};x(U),W(!0),f({}),i({type:"info",message:`Applied ${P.name} dimensions`})}},[i]),z=c.useCallback(async()=>{const y=F(C);if(f(y),Object.keys(y).length===0){K(!0);try{await new Promise(P=>setTimeout(P,300)),r(C),W(!1),i({type:"success",message:"Vehicle profile saved successfully"}),t&&t()}catch{i({type:"error",message:"Failed to save vehicle profile"})}finally{K(!1)}}else i({type:"error",message:"Please fix validation errors before saving"})},[C,F,r,i,t]),q=c.useCallback(()=>{x(n||{height:2,width:1.9,weight:3,length:5}),f({}),W(!1),h(""),u(""),N(""),k("")},[n]),T=c.useCallback(()=>{l(),x({height:2,width:1.9,weight:3,length:5}),f({}),W(!1),h(""),u(""),N(""),k(""),i({type:"info",message:"Vehicle profile cleared"})},[l,i]),j=c.useCallback(()=>{O(y=>y==="metric"?"imperial":"metric")},[]),H=({field:y,label:P,icon:U,helpText:ae})=>{const re=Y(y),Q=!!w[y],ee=dt[y][D];return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-base",children:U}),e.jsx("label",{htmlFor:y,className:"text-sm font-medium text-neutral-700",children:P}),ae&&e.jsx(rs,{content:ae,size:"sm",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-neutral-400 cursor-help",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:y,type:"number",value:re.toFixed(1),onChange:X=>se(y,parseFloat(X.target.value)||0),step:mt[y].step,min:Z(mt[y].min,y,"metric",D),max:Z(mt[y].max,y,"metric",D),className:L("w-full px-3 py-2 pr-12 border rounded-lg text-sm focus:outline-none focus:ring-2 transition-colors",Q?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-neutral-300 focus:ring-primary-500 focus:border-primary-500"),placeholder:`Enter ${P.toLowerCase()}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-500 text-sm",children:ee.label})})]}),Q&&e.jsx("p",{className:"text-red-600 text-xs",children:w[y]})]})};return e.jsxs("div",{className:L("bg-white rounded-lg",a?"":"shadow-lg border border-neutral-200 p-6",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-neutral-900 flex items-center",children:"ðŸš Vehicle Profile"}),e.jsx("p",{className:"text-xs text-neutral-600 mt-0.5",children:"Set your vehicle dimensions for safe routing"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(rs,{content:`Switch to ${D==="metric"?"imperial":"metric"} units`,children:e.jsx("button",{onClick:j,className:L("px-2 py-1 rounded text-xs font-medium transition-colors",D==="metric"?"bg-primary-100 text-primary-700":"bg-orange-100 text-orange-700"),children:D==="metric"?"Metric":"Imperial"})})})]}),e.jsxs("div",{className:"flex space-x-1 mb-4 bg-neutral-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>o("vehicle"),className:L("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",d==="vehicle"?"bg-white text-primary-700 shadow-sm":"text-neutral-600 hover:text-neutral-900"),children:"ðŸš Base Vehicle"}),e.jsx("button",{onClick:()=>o("motorhome"),className:L("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",d==="motorhome"?"bg-white text-primary-700 shadow-sm":"text-neutral-600 hover:text-neutral-900"),children:"ðŸšŒ Motorhome"}),e.jsx("button",{onClick:()=>o("custom"),className:L("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",d==="custom"?"bg-white text-primary-700 shadow-sm":"text-neutral-600 hover:text-neutral-900"),children:"âœï¸ Custom"})]}),d==="vehicle"&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("p",{className:"text-xs text-neutral-500",children:"Select your base vehicle to auto-fill dimensions"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"vehicle-make-select",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Make"}),e.jsxs("select",{id:"vehicle-make-select",value:g,onChange:y=>R(y.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Select make..."}),We.map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.country,")"]},y.id))]})]}),g&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"vehicle-model-select",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Model"}),e.jsxs("select",{id:"vehicle-model-select",value:m,onChange:y=>$(y.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Select model..."}),B.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),m&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"vehicle-variant-select",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Size / Variant"}),e.jsxs("select",{id:"vehicle-variant-select",value:v,onChange:y=>J(y.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Select variant..."}),p.map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.length,"m Ã— ",y.height,"m)"]},y.id))]})]}),v&&e.jsx("div",{className:"p-3 bg-primary-50 border border-primary-200 rounded-lg",children:e.jsxs("div",{className:"text-xs text-primary-800",children:[e.jsx("strong",{children:"Selected:"})," ",We.find(y=>y.id===g)?.name," ",B.find(y=>y.id===m)?.name," ",p.find(y=>y.id===v)?.name]})})]}),d==="motorhome"&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("p",{className:"text-xs text-neutral-500",children:"Select a popular motorhome model"}),e.jsxs("select",{value:S,onChange:y=>M(y.target.value),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Select motorhome..."}),e.jsx("optgroup",{label:"Compact Campervans",children:Ee.filter(y=>y.length<5.5).map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.length,"m)"]},y.id))}),e.jsx("optgroup",{label:"Medium Motorhomes",children:Ee.filter(y=>y.length>=5.5&&y.length<7).map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.length,"m)"]},y.id))}),e.jsx("optgroup",{label:"Large Motorhomes",children:Ee.filter(y=>y.length>=7&&y.length<10).map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.length,"m)"]},y.id))}),e.jsx("optgroup",{label:"Car + Caravan",children:Ee.filter(y=>y.length>=10).map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.length,"m)"]},y.id))})]}),S&&e.jsx("div",{className:"p-3 bg-primary-50 border border-primary-200 rounded-lg",children:(()=>{const y=Ee.find(P=>P.id===S);return y?e.jsxs("div",{className:"text-xs text-primary-800",children:[e.jsx("strong",{children:y.name}),e.jsxs("div",{className:"text-primary-600 mt-1",children:["Base: ",y.base," â€¢ ",y.make]})]}):null})()})]}),d==="custom"&&e.jsx("div",{className:"mb-4 p-3 bg-neutral-50 border border-neutral-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-neutral-600",children:"Enter your vehicle dimensions manually below. Measure your vehicle including any roof equipment (AC, antenna, solar panels)."})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(H,{field:"height",label:"Height",icon:"ðŸ“",helpText:"Max height including roof equipment"}),e.jsx(H,{field:"width",label:"Width",icon:"â†”ï¸",helpText:"Max width including mirrors"}),e.jsx(H,{field:"length",label:"Length",icon:"ðŸ“",helpText:"Total length front to back"}),e.jsx(H,{field:"weight",label:"Weight",icon:"âš–ï¸",helpText:"Gross vehicle weight when loaded"})]}),n&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h3",{className:"text-xs font-medium text-green-800 mb-1",children:"âœ… Saved Profile"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs text-green-700",children:[e.jsxs("div",{children:["H: ",n.height,"m"]}),e.jsxs("div",{children:["W: ",n.width,"m"]}),e.jsxs("div",{children:["L: ",n.length,"m"]}),e.jsxs("div",{children:["Wt: ",n.weight,"t"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:z,disabled:!E||Object.keys(w).length>0||G,className:L("flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center",E&&Object.keys(w).length===0&&!G?"bg-primary-600 text-white hover:bg-primary-700":"bg-neutral-300 text-neutral-500 cursor-not-allowed"),children:[G&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:G?"Saving...":n?"Update":"Save"})]}),e.jsx("button",{onClick:q,disabled:!E,className:L("px-4 py-2 rounded-lg text-sm font-medium border transition-colors",E?"border-neutral-300 text-neutral-700 hover:bg-neutral-50":"border-neutral-200 text-neutral-400 cursor-not-allowed"),children:"Reset"}),n&&e.jsx("button",{onClick:T,className:"px-4 py-2 rounded-lg text-sm font-medium border border-red-300 text-red-700 hover:bg-red-50 transition-colors",children:"Clear"})]}),e.jsx("div",{className:"mt-4 p-2 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Routes will avoid roads with height/weight restrictions your vehicle cannot handle."]})})]})},Za=()=>{const{profile:s,setProfile:t}=he(),{vehicleSidebarOpen:a,closeVehicleSidebar:n}=me();return c.useEffect(()=>{if(s&&!s.name){for(const r of We)for(const l of r.models)for(const i of l.variants)if(i.height===s.height&&i.width===s.width&&i.length===s.length&&i.weight===s.weight){t({...s,name:`${r.name} ${l.name} ${i.name}`});return}for(const r of Ee)if(r.height===s.height&&r.width===s.width&&r.length===s.length&&r.weight===s.weight){t({...s,name:r.name});return}}},[s,t]),e.jsx(e.Fragment,{children:a&&e.jsxs("div",{className:"vehicle-sidebar-wrapper fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"vehicle-sidebar-backdrop absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:n,onKeyDown:r=>r.key==="Escape"&&n(),role:"button",tabIndex:0,"aria-label":"Close vehicle sidebar"}),e.jsx("div",{"data-tour-id":"vehicle-sidebar-panel",className:"absolute left-0 top-0 h-full w-full max-w-md bg-white shadow-xl transform transition-transform",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Vehicle Configuration"}),e.jsx("button",{onClick:n,className:"text-neutral-400 hover:text-neutral-600 p-1 rounded transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Ga,{onClose:n,compact:!0})})]})})]})})},Ka=({className:s,autoCalculate:t=!0})=>{const{waypoints:a,setCalculatedRoute:n,isValidForRouting:r}=ce(),{profile:l}=he(),{addNotification:i}=me(),[d,o]=c.useState(!1),[g,h]=c.useState(null),[m,u]=c.useState(null),[v,N]=c.useState(null),[S,k]=c.useState(null),[C,x]=c.useState([]),[w,f]=c.useState(!1),{openWizard:E,setStart:W,setEnd:D}=zt(),O=c.useMemo(()=>{if(a.length>=2){const B=a[0],p=a[a.length-1];return ha(B.lat,B.lng,p.lat,p.lng)}return!1},[a]),G=c.useCallback(()=>{if(a.length>=2){const B=a[0],p=a[a.length-1];W({name:B.name||"Start",lat:B.lat,lng:B.lng}),D({name:p.name||"Destination",lat:p.lat,lng:p.lng}),E()}},[a,E,W,D]);c.useEffect(()=>{if(t&&r()&&$e.BASIC_ROUTING){const B=setTimeout(()=>{K()},1e3);return()=>clearTimeout(B)}},[a,t]),c.useEffect(()=>{if(t&&r()&&$e.BASIC_ROUTING&&v){const B=setTimeout(()=>{i({type:"info",message:"Recalculating route with updated vehicle profile..."}),K()},500);return()=>clearTimeout(B)}},[l]);const K=c.useCallback(async()=>{if(!r()){i({type:"warning",message:"Need at least 2 waypoints to calculate route"});return}o(!0),u(null);try{const B={waypoints:a.map(I=>({lat:I.lat,lng:I.lng,name:I.name||`Waypoint ${I.id}`,id:I.id,type:I.type})),vehicleProfile:l||void 0,options:{profile:l?"driving-hgv":"driving-car",geometry:!0,instructions:!0,elevation:!1,units:"km"}},p=await Js.calculateRoute(B);if(n(p),p.routes.length>0){const I=p.routes[0];N({distance:Math.round(I.summary.distance/1e3*10)/10,duration:Math.round(I.summary.duration/60),service:p.metadata.service})}k(p.restrictions||null),x(p.alternativeRoutes||[]),h(Date.now()),p.warnings&&p.warnings.length>0?i({type:"warning",message:`Route calculated with warnings: ${p.warnings[0]}`}):i({type:"success",message:`Route calculated successfully using ${p.metadata.service}`})}catch(B){console.error("Route calculation failed:",B);let p="Failed to calculate route";B instanceof Ys&&(p=B.message,B.recoverable||(n(null),N(null))),u(p),i({type:"error",message:p})}finally{o(!1)}},[a,l,r,n,i]);return e.jsxs("div",{className:L("bg-white rounded-2xl shadow-soft p-4",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-900",children:"Route Calculation"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary-600 border-t-transparent"}),v&&e.jsxs("span",{className:"text-xs text-neutral-500",children:[v.distance,"km â€¢ ",Math.floor(v.duration/60),"h",v.duration%60,"m"]})]})]}),S&&S.violatedDimensions.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-red-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium text-red-800",children:"Vehicle Restriction Violations"})]}),e.jsx("div",{className:"space-y-1",children:S.suggestedActions.map((B,p)=>e.jsxs("div",{className:"text-red-700",children:["â€¢ ",B]},p))}),S.cannotAccommodate&&e.jsx("div",{className:"mt-2 p-2 bg-red-100 rounded text-red-800 font-medium",children:"âš ï¸ Your vehicle cannot use European roads with these dimensions"})]}),v&&e.jsxs("div",{className:L("mb-3 p-2 rounded text-xs",S?.violatedDimensions.length?"bg-amber-50 border border-amber-200":"bg-green-50 border border-green-200"),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:L("font-medium",S?.violatedDimensions.length?"text-amber-800":"text-green-800"),children:[e.jsxs("strong",{children:[v.distance," km"]})," â€¢ ",Math.floor(v.duration/60),"h"," ",v.duration%60,"m"]}),e.jsx("span",{className:L("capitalize",S?.violatedDimensions.length?"text-amber-600":"text-green-600"),children:v.service==="openrouteservice"?"OpenRoute":v.service})]}),l&&e.jsxs("div",{className:L("mt-1",S?.violatedDimensions.length?"text-amber-700":"text-green-700"),children:["Vehicle: ",l.height,"m H Ã— ",l.width,"m W Ã— ",l.weight,"t Ã—"," ",l.length,"m L"]}),S?.violatedDimensions.length?e.jsx("div",{className:"text-amber-700 mt-1 font-medium",children:"âš ï¸ Route may include restricted roads"}):null]}),C.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("button",{onClick:()=>f(!w),className:"w-full flex items-center justify-between p-2 bg-primary-50 border border-primary-200 rounded text-xs text-primary-800 hover:bg-primary-100 transition-colors",children:[e.jsxs("span",{className:"font-medium",children:[C.length," Alternative Route",C.length>1?"s":""," ","Available"]}),e.jsx("svg",{className:L("w-4 h-4 transform transition-transform",w&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsx("div",{className:"mt-2 space-y-2",children:C.map((B,p)=>e.jsxs("div",{className:"p-2 bg-neutral-50 border border-neutral-200 rounded text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-neutral-700",children:["Alternative ",p+1,":"," ",e.jsxs("strong",{children:[Math.round(B.summary.distance/1e3*10)/10," km"]})]}),e.jsxs("span",{className:"text-neutral-600",children:[Math.floor(B.summary.duration/60),"h"," ",Math.round(B.summary.duration/60)%60,"m"]})]}),e.jsx("button",{onClick:()=>{const I={id:`alt_${Date.now()}`,status:"success",routes:[B],metadata:{service:"openrouteservice",profile:l?"driving-hgv":"driving-car",timestamp:Date.now(),query:{},attribution:"openrouteservice.org | Alternative route"}};n(I),N({distance:Math.round(B.summary.distance/1e3*10)/10,duration:Math.round(B.summary.duration/60),service:"openrouteservice"}),i({type:"info",message:`Switched to alternative route ${p+1}`})},className:"mt-1 text-primary-600 hover:text-primary-800 font-medium underline",children:"Use this route"})]},p))})]}),v&&v.duration>240&&!O&&e.jsx("div",{className:"mb-3 p-3 bg-accent-50 border border-accent-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-accent-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-accent-900",children:[Math.floor(v.duration/60),"+ hour drive"]}),e.jsx("p",{className:"text-xs text-accent-700 mt-0.5",children:"Use the Trip Planner to split this into daily legs with overnight campsite stops along the way."}),e.jsx("button",{onClick:G,className:"mt-2 text-xs font-semibold text-accent-700 hover:text-accent-900 underline underline-offset-2",children:"Open Trip Planner â†’"})]})]})}),v&&O&&e.jsx("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Channel crossing required"}),e.jsx("p",{className:"text-xs text-blue-700 mt-0.5",children:"Your route crosses between the UK and mainland Europe. Use the Trip Planner to choose a ferry or tunnel option with times and costs."}),e.jsx("button",{onClick:G,className:"mt-2 text-xs font-semibold text-blue-700 hover:text-blue-900 underline underline-offset-2",children:"Choose a crossing â†’"})]})]})}),m&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-800 font-medium",children:m}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"The routing service may be temporarily unavailable. Please try again in a few seconds."})]})]})}),e.jsxs("button",{onClick:()=>{u(null),K()},disabled:d,className:"mt-2 w-full flex items-center justify-center space-x-2 px-3 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded text-xs font-medium transition-colors disabled:opacity-50",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Try again"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:K,disabled:!r()||d,className:L("flex items-center space-x-2 px-3 py-2 rounded text-sm font-medium transition-colors",r()&&!d?"bg-primary-600 text-white hover:bg-primary-700":"bg-neutral-100 text-neutral-400 cursor-not-allowed"),children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Calculating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("span",{children:"Calculate Route"})]})}),e.jsxs("label",{className:"flex items-center space-x-2 text-xs text-neutral-600",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:B=>{},className:"h-3 w-3 text-primary-600 rounded border-neutral-300",disabled:!0}),e.jsx("span",{children:"Auto-calculate"})]})]}),g&&e.jsxs("div",{className:"mt-2 text-xs text-neutral-500",children:["Last updated: ",new Date(g).toLocaleTimeString()]}),v&&e.jsx("div",{className:"mt-3 p-2 bg-neutral-50 border border-neutral-200 rounded text-xs",children:e.jsxs("div",{className:"flex items-center justify-between text-neutral-600",children:[e.jsx("span",{children:"Route ready for export"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})]})}),!r()&&a.length<2&&e.jsx("div",{className:"mt-3 p-2 bg-primary-50 border border-primary-200 rounded text-xs text-primary-800",children:"Add at least 2 waypoints to enable route calculation"})]})},Xa=({restrictions:s,className:t})=>{const{waypoints:a}=ce(),{profile:n}=he();if(!s||s.violatedDimensions.length===0)return null;const r={height:4,width:2.55,weight:40,length:18.75},l=()=>s.cannotAccommodate?"critical":s.violatedDimensions.length>=2?"high":"medium",i=()=>{const m=[];return s.cannotAccommodate?m.push({type:"critical",title:"Vehicle Cannot Use European Roads",description:"Your vehicle dimensions exceed EU road limits. Consider reviewing vehicle specifications.",actions:["Double-check vehicle measurements","Consider a smaller vehicle for European travel","Contact authorities for special transport permits"]}):m.push({type:"warning",title:"Limited Route Options",description:"Your vehicle may face restrictions on some European roads.",actions:["Plan routes using major highways when possible","Avoid city centers and narrow rural roads","Check local restrictions before travel","Consider overnight parking at designated motorhome areas"]}),m},d=()=>{const m=[];return s.violatedDimensions.includes("height")&&m.push(`Height: Reduce to ${r.height}m or less`),s.violatedDimensions.includes("width")&&m.push(`Width: Reduce to ${r.width}m or less`),s.violatedDimensions.includes("weight")&&m.push(`Weight: Reduce to ${r.weight}t or less`),s.violatedDimensions.includes("length")&&m.push(`Length: Reduce to ${r.length}m or less`),m},o=l(),g=i(),h=d();return e.jsxs("div",{className:L("p-4 rounded-lg border",o==="critical"&&"bg-red-50 border-red-200",o==="high"&&"bg-amber-50 border-amber-200",o==="medium"&&"bg-yellow-50 border-yellow-200",t),children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx("div",{className:L("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center",o==="critical"&&"bg-red-100",o==="high"&&"bg-amber-100",o==="medium"&&"bg-yellow-100"),children:o==="critical"?e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:L("text-lg font-semibold",o==="critical"&&"text-red-900",o==="high"&&"text-amber-900",o==="medium"&&"text-yellow-900"),children:"Vehicle Restriction Issues"}),e.jsxs("p",{className:L("text-sm mt-1",o==="critical"&&"text-red-700",o==="high"&&"text-amber-700",o==="medium"&&"text-yellow-700"),children:[a.length," waypoints â€¢ ",s.violatedDimensions.length," dimension",s.violatedDimensions.length>1?"s":""," exceed EU limits"]})]})]}),n&&e.jsxs("div",{className:"mb-4 p-3 bg-white rounded border",children:[e.jsx("h4",{className:"font-medium text-neutral-900 mb-2",children:"Current Vehicle Dimensions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("height")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Height:"}),e.jsxs("span",{children:[n.height,"m ",s.violatedDimensions.includes("height")&&"âš ï¸"]})]}),e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("width")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Width:"}),e.jsxs("span",{children:[n.width,"m ",s.violatedDimensions.includes("width")&&"âš ï¸"]})]}),e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("weight")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Weight:"}),e.jsxs("span",{children:[n.weight,"t ",s.violatedDimensions.includes("weight")&&"âš ï¸"]})]}),e.jsxs("div",{className:L("flex justify-between",s.violatedDimensions.includes("length")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Length:"}),e.jsxs("span",{children:[n.length,"m ",s.violatedDimensions.includes("length")&&"âš ï¸"]})]})]})]}),g.map((m,u)=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:L("font-medium mb-2",m.type==="critical"&&"text-red-900",m.type==="warning"&&"text-amber-900"),children:m.title}),e.jsx("p",{className:L("text-sm mb-3",m.type==="critical"&&"text-red-700",m.type==="warning"&&"text-amber-700"),children:m.description}),e.jsx("ul",{className:"space-y-1",children:m.actions.map((v,N)=>e.jsxs("li",{className:L("text-sm flex items-start",m.type==="critical"&&"text-red-700",m.type==="warning"&&"text-amber-700"),children:[e.jsx("span",{className:"mr-2",children:"â€¢"}),e.jsx("span",{children:v})]},N))})]},u)),h.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-primary-50 border border-primary-200 rounded",children:[e.jsx("h4",{className:"font-medium text-primary-900 mb-2",children:"ðŸ’¡ Suggested Dimension Adjustments"}),e.jsx("ul",{className:"space-y-1",children:h.map((m,u)=>e.jsxs("li",{className:"text-sm text-primary-700 flex items-start",children:[e.jsx("span",{className:"mr-2",children:"â€¢"}),e.jsx("span",{children:m})]},u))})]}),e.jsxs("div",{className:"mt-4 p-3 bg-neutral-50 border border-neutral-200 rounded",children:[e.jsx("h4",{className:"font-medium text-neutral-900 mb-2",children:"ðŸ“‹ EU Standard Road Limits"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-neutral-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Height:"}),e.jsxs("span",{children:[r.height,"m"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Width:"}),e.jsxs("span",{children:[r.width,"m"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Weight:"}),e.jsxs("span",{children:[r.weight,"t"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Length:"}),e.jsxs("span",{children:[r.length,"m"]})]})]})]})]})};function Ja(s,t,a,n){const l=(a-s)*Math.PI/180,i=(n-t)*Math.PI/180,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}const Ya=({route:s,className:t})=>{const a=c.useMemo(()=>{if(!s.geometry?.coordinates)return null;const v=s.geometry.coordinates,N=[];let S=0;return v.forEach((k,C)=>{const[x,w,f]=k;if(f!==void 0){if(C>0){const E=v[C-1],W=Ja(E[1],E[0],w,x);S+=W}N.push({distance:S,elevation:f,index:C})}}),N.length>0?N:null},[s.geometry]),n=c.useMemo(()=>{if(!a)return null;const v=a.map(w=>w.elevation),N=Math.min(...v),S=Math.max(...v),k=a[a.length-1].distance;let C=0,x=0;for(let w=1;w<a.length;w++){const f=a[w].elevation-a[w-1].elevation;f>0?C+=f:x+=Math.abs(f)}return{minElevation:Math.round(N),maxElevation:Math.round(S),totalGain:Math.round(C),totalLoss:Math.round(x),totalDistance:Math.round(k/1e3*10)/10}},[a]);if(!a||!n)return e.jsx("div",{className:L("bg-white rounded-lg border border-neutral-200 p-6",t),children:e.jsxs("div",{className:"text-center text-neutral-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-neutral-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("h3",{className:"text-lg font-medium text-neutral-900 mb-1",children:"No Elevation Data"}),e.jsx("p",{children:"Elevation profile not available for this route"}),e.jsx("p",{className:"text-sm mt-1",children:"Enable elevation in route options to see the profile"})]})});const r=600,l=200,i={top:20,right:20,bottom:40,left:60},d=r-i.left-i.right,o=l-i.top-i.bottom,g=v=>v/n.totalDistance/1e3*d,h=v=>o-(v-n.minElevation)/(n.maxElevation-n.minElevation)*o,m=a.map((v,N)=>{const S=g(v.distance),k=h(v.elevation);return`${N===0?"M":"L"} ${S} ${k}`}).join(" "),u=m+` L ${g(a[a.length-1].distance)} ${o} L 0 ${o} Z`;return e.jsxs("div",{className:L("bg-white rounded-lg border border-neutral-200",t),children:[e.jsxs("div",{className:"p-4 border-b border-neutral-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"Elevation Profile"}),e.jsxs("p",{className:"text-sm text-neutral-600 mt-1",children:[n.totalDistance," km route"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-900",children:[n.maxElevation,"m"]}),e.jsx("div",{className:"text-sm text-blue-700",children:"Highest"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-green-900",children:[n.minElevation,"m"]}),e.jsx("div",{className:"text-sm text-green-700",children:"Lowest"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-orange-900",children:["+",n.totalGain,"m"]}),e.jsx("div",{className:"text-sm text-orange-700",children:"Total Gain"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-red-900",children:["-",n.totalLoss,"m"]}),e.jsx("div",{className:"text-sm text-red-700",children:"Total Loss"})]})]}),e.jsx("div",{className:"bg-neutral-50 rounded-lg p-4 overflow-x-auto",children:e.jsxs("svg",{width:r,height:l,viewBox:`0 0 ${r} ${l}`,className:"w-full h-auto min-w-96",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"elevationGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#2794a8",stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:"#2794a8",stopOpacity:.1})]})}),e.jsxs("g",{stroke:"#e2e5e9",strokeWidth:"1",children:[[0,.25,.5,.75,1].map(v=>{const N=i.top+v*o,S=n.maxElevation-v*(n.maxElevation-n.minElevation);return e.jsxs("g",{children:[e.jsx("line",{x1:i.left,y1:N,x2:i.left+d,y2:N}),e.jsxs("text",{x:i.left-10,y:N+4,textAnchor:"end",fontSize:"12",fill:"#6b7785",children:[Math.round(S),"m"]})]},v)}),[0,.25,.5,.75,1].map(v=>{const N=i.left+v*d,S=v*n.totalDistance;return e.jsxs("g",{children:[e.jsx("line",{x1:N,y1:i.top,x2:N,y2:i.top+o}),e.jsxs("text",{x:N,y:i.top+o+20,textAnchor:"middle",fontSize:"12",fill:"#6b7785",children:[S.toFixed(1),"km"]})]},v)})]}),e.jsx("path",{d:u,fill:"url(#elevationGradient)",transform:`translate(${i.left}, ${i.top})`}),e.jsx("path",{d:m,fill:"none",stroke:"#2794a8",strokeWidth:"2",transform:`translate(${i.left}, ${i.top})`}),e.jsx("text",{x:i.left+d/2,y:l-10,textAnchor:"middle",fontSize:"14",fill:"#374151",fontWeight:"500",children:"Distance (km)"}),e.jsx("text",{x:20,y:i.top+o/2,textAnchor:"middle",fontSize:"14",fill:"#374151",fontWeight:"500",transform:`rotate(-90, 20, ${i.top+o/2})`,children:"Elevation (m)"})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"â›°ï¸ Elevation Insights"}),e.jsxs("div",{className:"text-sm text-yellow-800 space-y-1",children:[n.totalGain>500&&e.jsx("div",{children:"â€¢ Significant climbing ahead - expect reduced fuel efficiency"}),n.totalLoss>500&&e.jsx("div",{children:"â€¢ Long descents - use engine braking and check brakes beforehand"}),n.maxElevation-n.minElevation>1e3&&e.jsx("div",{children:"â€¢ Large elevation changes - check weather conditions at altitude"}),n.maxElevation>1500&&e.jsx("div",{children:"â€¢ High altitude sections - consider altitude effects on engine performance"})]})]})]})]})},is=({route:s,compact:t})=>{const{profile:a}=he();if(!s.routes.length)return null;const n=s.routes[0],{distance:r,duration:l}=n.summary,i=Math.round(r/1e3*10)/10,d=Math.floor(l/3600),o=Math.round(l%3600/60),h=s.restrictions?.cannotAccommodate?"incompatible":s.restrictions?.violatedDimensions?.length?"restricted":s.warnings?.length?"limited":"compatible";return t?e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium",children:[i," km"]}),e.jsxs("span",{className:"text-neutral-600",children:[d,"h ",o,"m"]}),e.jsx("div",{className:L("w-2 h-2 rounded-full",h==="compatible"&&"bg-green-500",h==="limited"&&"bg-yellow-500",h==="restricted"&&"bg-orange-500",h==="incompatible"&&"bg-red-500")})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"Route Summary"}),e.jsx("span",{className:"text-sm text-neutral-500 capitalize",children:s.metadata.service})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-primary-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-900",children:i}),e.jsx("div",{className:"text-sm text-primary-700",children:"kilometers"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[d,"h ",o,"m"]}),e.jsx("div",{className:"text-sm text-green-700",children:"travel time"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-neutral-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:"Vehicle Compatibility"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:L("w-3 h-3 rounded-full",h==="compatible"&&"bg-green-500",h==="limited"&&"bg-yellow-500",h==="restricted"&&"bg-orange-500",h==="incompatible"&&"bg-red-500")}),e.jsx("span",{className:L("text-sm font-medium capitalize",h==="compatible"&&"text-green-700",h==="limited"&&"text-yellow-700",h==="restricted"&&"text-orange-700",h==="incompatible"&&"text-red-700"),children:h})]})]}),a&&e.jsxs("div",{className:"mt-3 text-xs text-neutral-600",children:["Vehicle: ",a.height,"m H Ã— ",a.width,"m W Ã— ",a.weight,"t Ã— ",a.length,"m L"]})]})},Qa=({segments:s})=>s.length?e.jsxs("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-3",children:"Route Segments"}),e.jsx("div",{className:"space-y-3",children:s.map((t,a)=>{const n=Math.round(t.distance/1e3*10)/10,r=Math.floor(t.duration/3600),l=Math.round(t.duration%3600/60);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-neutral-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-primary-900",children:a+1})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-neutral-900",children:["Segment ",a+1]}),e.jsxs("div",{className:"text-sm text-neutral-600",children:[n," km"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-neutral-900",children:[r>0?`${r}h `:"",l,"m"]}),e.jsx("div",{className:"text-sm text-neutral-600",children:"travel time"})]})]},a)})})]}):null,er=({segments:s})=>{const[t,a]=c.useState(0),n=c.useMemo(()=>s.flatMap((r,l)=>(r.steps||[]).map((i,d)=>({...i,segmentIndex:l,stepIndex:d,id:`${l}-${d}`}))),[s]);return n.length?e.jsxs("div",{className:"bg-white rounded-lg border border-neutral-200",children:[e.jsxs("div",{className:"p-4 border-b border-neutral-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"Turn-by-Turn Directions"}),e.jsxs("p",{className:"text-sm text-neutral-600 mt-1",children:[n.length," instructions"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:n.map((r,l)=>{const i=r.distance>1e3?`${Math.round(r.distance/1e3*10)/10} km`:`${Math.round(r.distance)} m`;return e.jsxs("div",{className:L("flex items-start space-x-3 p-4 border-b border-neutral-100 hover:bg-neutral-50 transition-colors",l===n.length-1&&"border-b-0"),children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary-900",children:l+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 mb-1",children:r.instruction}),r.name&&e.jsxs("div",{className:"text-sm text-neutral-600 mb-1",children:["on ",e.jsx("span",{className:"font-medium",children:r.name})]}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Continue for ",i]})]})]},r.id)})})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-3",children:"Turn-by-Turn Directions"}),e.jsxs("div",{className:"text-center py-6 text-neutral-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-neutral-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("p",{children:"Detailed turn-by-turn directions not available"}),e.jsx("p",{className:"text-sm",children:"Try recalculating with OpenRouteService for detailed instructions"})]})]})},tr=({className:s,compact:t=!1})=>{const{calculatedRoute:a}=ce(),[n,r]=c.useState("summary");if(!a||!a.routes.length)return e.jsx("div",{className:L("bg-white rounded-lg border border-neutral-200 p-6",s),children:e.jsxs("div",{className:"text-center text-neutral-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-neutral-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("h3",{className:"text-lg font-medium text-neutral-900 mb-1",children:"No Route Information"}),e.jsx("p",{children:"Calculate a route to see detailed information"})]})});if(t)return e.jsx("div",{className:L("bg-white rounded-lg border border-neutral-200 p-3",s),children:e.jsx(is,{route:a,compact:!0})});const l=a.routes[0];return e.jsxs("div",{className:L("bg-white rounded-lg border border-neutral-200",s),children:[e.jsx("div",{className:"border-b border-neutral-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-4",children:[{id:"summary",label:"Summary",icon:"ðŸ“Š"},{id:"segments",label:"Segments",icon:"ðŸ›£ï¸"},{id:"directions",label:"Directions",icon:"ðŸ§­"},{id:"elevation",label:"Elevation",icon:"â›°ï¸"}].map(i=>e.jsxs("button",{onClick:()=>r(i.id),className:L("flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors",n===i.id?"border-primary-500 text-primary-600":"border-transparent text-neutral-500 hover:text-neutral-700 hover:border-neutral-300"),children:[e.jsx("span",{children:i.icon}),e.jsx("span",{children:i.label})]},i.id))})}),e.jsxs("div",{className:"p-4",children:[n==="summary"&&e.jsx(is,{route:a}),n==="segments"&&e.jsx(Qa,{segments:l.segments}),n==="directions"&&e.jsx(er,{segments:l.segments}),n==="elevation"&&e.jsx(Ya,{route:l})]})]})},sr=({className:s})=>{const{calculatedRoute:t,setCalculatedRoute:a}=ce(),{profile:n}=he(),{addNotification:r}=me(),[l,i]=c.useState("main");if(!t)return null;const d=[{id:"main",route:t.routes[0],label:"Main Route",isCurrent:!0},...(t.alternativeRoutes||[]).map((u,v)=>({id:`alt-${v}`,route:u,label:`Alternative ${v+1}`,isAlternative:!0,isCurrent:!1}))];if(d.length<=1)return null;const o=u=>{const v=d.find(S=>S.id===u);if(!v||u==="main")return;const N={...t,routes:[v.route],id:`selected_${u}_${Date.now()}`};a(N),i(u),r({type:"info",message:`Switched to ${v.label.toLowerCase()}`})},g=(u,v)=>{const N=u.summary.distance-v.summary.distance,S=u.summary.duration-v.summary.duration;return{distanceDiff:Math.round(N/1e3*10)/10,timeDiff:Math.round(S/60),distancePercent:Math.round(N/v.summary.distance*100),timePercent:Math.round(S/v.summary.duration*100)}},h=(u,v,N=!1)=>{const S=u>0?"+":"",k=N?"%":` ${v}`;return`${S}${u}${k}`},m=d[0].route;return e.jsxs("div",{className:L("bg-white rounded-lg border border-neutral-200",s),children:[e.jsxs("div",{className:"p-4 border-b border-neutral-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"Route Comparison"}),e.jsxs("p",{className:"text-sm text-neutral-600 mt-1",children:[d.length," route options available"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"space-y-3",children:d.map((u,v)=>{const N=l===u.id,S=v>0?g(u.route,m):null,k=Math.round(u.route.summary.distance/1e3*10)/10,C=Math.floor(u.route.summary.duration/3600),x=Math.round(u.route.summary.duration%3600/60);return e.jsxs("div",{className:L("relative p-4 rounded-lg border cursor-pointer transition-all",N?"border-primary-500 bg-primary-50 ring-2 ring-primary-200":"border-neutral-200 hover:border-neutral-300 hover:bg-neutral-50"),role:"button",tabIndex:0,onClick:()=>o(u.id),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),o(u.id))},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:L("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",N?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-700"),children:[v===0?"1":String.fromCharCode(65+v)," "]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-neutral-900",children:u.label}),u.isAlternative&&e.jsx("div",{className:"text-xs text-neutral-500",children:"Alternative route option"})]})]}),N&&e.jsxs("div",{className:"flex items-center space-x-1 text-primary-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-medium",children:"Current"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-500",children:"Distance"}),e.jsxs("div",{className:"font-medium",children:[k," km"]}),S&&e.jsx("div",{className:L("text-xs",S.distanceDiff>0?"text-red-600":"text-green-600"),children:h(S.distanceDiff,"km")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-500",children:"Time"}),e.jsxs("div",{className:"font-medium",children:[C,"h ",x,"m"]}),S&&e.jsx("div",{className:L("text-xs",S.timeDiff>0?"text-red-600":"text-green-600"),children:h(S.timeDiff,"min")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-500",children:"Type"}),e.jsx("div",{className:"font-medium",children:v===0?"Fastest":S?S.distanceDiff<0?"Shorter":"Scenic":"Alternative"}),n&&e.jsx("div",{className:"text-xs text-neutral-500",children:"Vehicle safe"})]})]}),S&&e.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-xs text-neutral-600",children:[Math.abs(S.distancePercent)>10&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:L("w-2 h-2 rounded-full",S.distancePercent>0?"bg-red-400":"bg-green-400")}),e.jsx("span",{children:S.distancePercent>0?"Longer route":"Shorter route"})]}),Math.abs(S.timePercent)>15&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:L("w-2 h-2 rounded-full",S.timePercent>0?"bg-orange-400":"bg-primary-400")}),e.jsx("span",{children:S.timePercent>0?"Slower":"Faster"})]})]})]},u.id)})}),e.jsxs("div",{className:"mt-4 p-3 bg-neutral-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-neutral-900 mb-2",children:"Route Selection Guide"}),e.jsxs("div",{className:"text-sm text-neutral-600 space-y-1",children:[e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Main Route:"})," Fastest route optimized for your vehicle"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Alternatives:"})," Different paths that may avoid restrictions or offer scenic routes"]}),n&&e.jsxs("div",{children:["â€¢ All routes respect your vehicle dimensions (",n.height,"m H Ã— ",n.width,"m W Ã— ",n.weight,"t)"]})]})]})]})]})},nr={objective:"balanced",enableTimeConstraints:!1,maxDrivingTime:8,preferredStartTime:9,avoidNightDriving:!0,enableCampsitePreferences:!1,maxDistanceBetweenStops:300,requireCampsiteOvernight:!1,autoOptimizeOnChange:!1},ar=({className:s,onOptimizationComplete:t,onWaypointInsert:a,isVisible:n=!0})=>{const{waypoints:r,reorderWaypoints:l}=ce(),{profile:i}=he(),{addNotification:d}=me(),[o,g]=c.useState(nr),[h,m]=c.useState(!1),[u,v]=c.useState(null),[N,S]=c.useState(new Set),[k,C]=c.useState(!1),[x,w]=c.useState(!1),[f,E]=c.useState(null),[W,D]=c.useState(null),O=c.useMemo(()=>r.length>=3&&!h,[r.length,h]),G=c.useCallback(async()=>{if(O){m(!0);try{const p={objective:o.objective,vehicleProfile:i||void 0,lockedWaypoints:Array.from(N)};o.enableTimeConstraints&&(p.timeConstraints={maxDrivingTime:o.maxDrivingTime,preferredStartTime:o.preferredStartTime,avoidNightDriving:o.avoidNightDriving}),o.enableCampsitePreferences&&(p.campsitePreferences={maxDistanceBetweenStops:o.maxDistanceBetweenStops,preferredStopDuration:8,requireCampsiteOvernight:o.requireCampsiteOvernight});const I=await _t.optimizeRoute(r,p);v(I),I.improvements.percentageImprovement>1?d({type:"success",message:`Route optimized! Saved ${I.improvements.distanceSaved.toFixed(1)}km and ${Math.round(I.improvements.timeSaved)} minutes`}):d({type:"info",message:"Route is already well optimized"}),t?.(I)}catch(p){console.error("Optimization failed:",p),d({type:"error",message:`Optimization failed: ${p instanceof Error?p.message:"Unknown error"}`})}finally{m(!1)}}},[r,o,i,N,O,d,t]),K=c.useCallback(()=>{u&&(l(u.optimizedRoute.waypoints),v(null),d({type:"success",message:"Route optimization applied successfully"}))},[u,l,d]),B=c.useCallback(p=>{S(I=>{const F=new Set(I);return F.has(p)?F.delete(p):F.add(p),F})},[]);return c.useCallback((p,I)=>{if(!x)return;const F={id:`temp_${Date.now()}`,lat:p,lng:I,name:"New Waypoint",type:"waypoint"};D({lat:p,lng:I}),_t.findOptimalInsertion(r,F,{objective:o.objective,vehicleProfile:i||void 0}).then(Z=>{E(Z)}).catch(Z=>{console.error("Insertion analysis failed:",Z),d({type:"error",message:"Failed to analyze waypoint insertion"})})},[x,r,o.objective,i,d]),c.useEffect(()=>{if(o.autoOptimizeOnChange&&r.length>=3&&!h){const p=setTimeout(()=>{G()},2e3);return()=>clearTimeout(p)}},[r,o.autoOptimizeOnChange,G,h]),n?e.jsxs("div",{className:L("bg-white rounded-lg shadow-lg border border-neutral-200",s),children:[e.jsxs("div",{className:"p-4 border-b border-neutral-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),"Route Optimizer"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>C(!k),className:"p-2 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 rounded",title:"Advanced Settings",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})})]}),r.length<3&&e.jsxs("p",{className:"text-sm text-amber-600 mt-2 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),"Add at least 3 waypoints to enable route optimization"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Optimization Goal"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"shortest",label:"Shortest",icon:Vn,desc:"Minimize distance"},{value:"fastest",label:"Fastest",icon:nt,desc:"Minimize time"},{value:"balanced",label:"Balanced",icon:Gn,desc:"Balance time & distance"}].map(p=>{const I=p.icon;return e.jsxs("button",{onClick:()=>g(F=>({...F,objective:p.value})),className:L("p-3 rounded-lg border text-center transition-colors text-sm",o.objective===p.value?"border-primary-500 bg-primary-50 text-primary-700":"border-neutral-200 hover:border-neutral-300 text-neutral-700"),children:[e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(I,{className:"w-5 h-5"})}),e.jsx("div",{className:"font-medium",children:p.label}),e.jsx("div",{className:"text-xs text-neutral-500",children:p.desc})]},p.value)})})]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("button",{onClick:G,disabled:!O,className:L("flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-lg font-medium transition-colors",O?"bg-primary-600 text-white hover:bg-primary-700":"bg-neutral-300 text-neutral-500 cursor-not-allowed"),children:h?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Optimizing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{children:"Optimize Route"})]})}),e.jsx("button",{onClick:()=>w(!x),className:L("px-4 py-3 rounded-lg font-medium transition-colors",x?"bg-green-600 text-white hover:bg-green-700":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200"),title:"Smart waypoint insertion",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o.autoOptimizeOnChange,onChange:p=>g(I=>({...I,autoOptimizeOnChange:p.target.checked})),className:"rounded border-neutral-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{children:"Auto-optimize when route changes"})]})}),k&&e.jsxs("div",{className:"space-y-4 p-4 bg-neutral-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-neutral-900",children:"Advanced Settings"}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm mb-2",children:[e.jsx("input",{type:"checkbox",checked:o.enableTimeConstraints,onChange:p=>g(I=>({...I,enableTimeConstraints:p.target.checked})),className:"rounded border-neutral-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{children:"Enable time constraints"})]}),o.enableTimeConstraints&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 ml-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"optimizer-max-driving-time",className:"block text-xs text-neutral-600 mb-1",children:"Max driving time (hours)"}),e.jsx("input",{id:"optimizer-max-driving-time",type:"number",min:"4",max:"12",value:o.maxDrivingTime,onChange:p=>g(I=>({...I,maxDrivingTime:parseInt(p.target.value)})),className:"w-full px-2 py-1 border border-neutral-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"optimizer-preferred-start-time",className:"block text-xs text-neutral-600 mb-1",children:"Preferred start time"}),e.jsx("input",{id:"optimizer-preferred-start-time",type:"number",min:"6",max:"12",value:o.preferredStartTime,onChange:p=>g(I=>({...I,preferredStartTime:parseInt(p.target.value)})),className:"w-full px-2 py-1 border border-neutral-300 rounded text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm mb-2",children:[e.jsx("input",{type:"checkbox",checked:o.enableCampsitePreferences,onChange:p=>g(I=>({...I,enableCampsitePreferences:p.target.checked})),className:"rounded border-neutral-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{children:"Enable campsite preferences"})]}),o.enableCampsitePreferences&&e.jsxs("div",{className:"ml-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"block text-xs text-neutral-600 mb-1",children:["Max distance between stops: ",o.maxDistanceBetweenStops,"km"]}),e.jsx("input",{type:"range",min:"100",max:"500",step:"50",value:o.maxDistanceBetweenStops,onChange:p=>g(I=>({...I,maxDistanceBetweenStops:parseInt(p.target.value)})),className:"w-full"})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:o.requireCampsiteOvernight,onChange:p=>g(I=>({...I,requireCampsiteOvernight:p.target.checked})),className:"rounded border-neutral-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{children:"Require campsite for overnight stops"})]})]})]})]})]}),r.length>0&&e.jsx("div",{className:"border-t border-neutral-200",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-neutral-900 mb-3 flex items-center",children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Waypoint Order (",r.length," stops)"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:r.map((p,I)=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-neutral-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-primary-100 text-primary-800 rounded-full text-xs font-medium",children:I+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 truncate",children:p.name}),e.jsx("div",{className:"text-xs text-neutral-500",children:e.jsx("span",{className:"inline-flex items-center gap-1",children:p.type==="campsite"?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-3 h-3"})," Campsite"]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-3 h-3"})," Waypoint"]})})})]}),e.jsx("button",{onClick:()=>B(p.id),className:L("p-1 rounded text-xs",N.has(p.id)?"text-red-600 hover:bg-red-50":"text-neutral-400 hover:bg-neutral-100"),title:N.has(p.id)?"Unlock waypoint":"Lock waypoint order",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:N.has(p.id)?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})})})]},p.id))}),N.size>0&&e.jsxs("div",{className:"mt-2 text-xs text-neutral-600 flex items-center",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),N.size," waypoint(s) locked in position"]})]})}),u&&e.jsx("div",{className:"border-t border-neutral-200 bg-green-50",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-green-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Optimization Complete"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-xs text-neutral-600 mb-1",children:"Distance Saved"}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[u.improvements.distanceSaved.toFixed(1),"km"]}),e.jsxs("div",{className:"text-xs text-neutral-500",children:[u.improvements.percentageImprovement.toFixed(1),"% improvement"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-xs text-neutral-600 mb-1",children:"Time Saved"}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[Math.round(u.improvements.timeSaved)," min"]}),e.jsx("div",{className:"text-xs text-neutral-500",children:u.optimizationMetadata.algorithm})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:K,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"Apply Optimization"}),e.jsx("button",{onClick:()=>v(null),className:"px-4 py-2 border border-neutral-300 text-neutral-700 rounded-lg hover:bg-neutral-50 transition-colors text-sm",children:"Dismiss"})]})]})}),x&&e.jsx("div",{className:"border-t border-neutral-200 bg-primary-50",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-primary-800 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Click on the map to find the optimal position for a new waypoint"})]})})}),f&&W&&e.jsx("div",{className:"border-t border-neutral-200 bg-yellow-50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Waypoint Insertion Analysis"}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-3",children:["Best position: After waypoint ",f.suggestedPosition+1,e.jsx("br",{}),"Impact: +",f.routeImpact.distanceAdded.toFixed(1),"km, +",Math.round(f.routeImpact.timeAdded)," min",e.jsx("br",{}),"Efficiency: ",(f.routeImpact.efficiency*100).toFixed(0),"%"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{a?.(f.suggestedPosition),E(null),D(null),w(!1)},className:"bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:"Insert Here"}),e.jsx("button",{onClick:()=>{E(null),D(null)},className:"px-4 py-2 border border-neutral-300 text-neutral-700 rounded-lg hover:bg-neutral-50 transition-colors text-sm",children:"Cancel"})]})]})})]}):null},rr={consumptionType:"l_per_100km",consumption:12,fuelType:"diesel",tankCapacity:80},ir={priceType:"default_european",currency:"EUR",lastUpdated:new Date},lr={showCostBreakdown:!0,showDailyEstimates:!0,showOptimizationSuggestions:!0,currency:"EUR",includeAccommodationCosts:!0,includeTollEstimates:!1},or=on()(Qs((s,t)=>({fuelConsumptionSettings:rr,setFuelConsumptionSettings:a=>{s({fuelConsumptionSettings:a}),s({lastCalculation:{}})},fuelPriceSettings:ir,setFuelPriceSettings:a=>{s({fuelPriceSettings:a}),s({lastCalculation:{}})},preferences:lr,setPreferences:a=>{s({preferences:{...t().preferences,...a}})},autoUpdatePrices:!1,setAutoUpdatePrices:a=>{s({autoUpdatePrices:a})},lastCalculation:{},setLastCalculation:a=>{s({lastCalculation:a})}}),{name:"camper-planner-cost-settings",partialize:s=>({fuelConsumptionSettings:s.fuelConsumptionSettings,fuelPriceSettings:s.fuelPriceSettings,preferences:s.preferences,autoUpdatePrices:s.autoUpdatePrices})}));function cr(s,t){const a=s.map(r=>r.id).join("-"),n=t?`${t.type}-${t.length}-${t.weight}`:"default";return`${a}_${n}`}function dr(s,t=30){if(!s)return!1;const a=Date.now(),n=t*60*1e3;return a-s<n}const mr=({className:s="",onCostUpdate:t,isVisible:a=!0})=>{const{waypoints:n}=ce(),{profile:r}=he(),{settings:l}=Fe(),{preferences:i,lastCalculation:d,setLastCalculation:o}=or(),[g,h]=c.useState(!1),[m,u]=c.useState(null),[v,N]=c.useState(null),[S,k]=c.useState(null),C=c.useMemo(()=>({consumptionType:l.fuelConsumption.unit==="l_per_100km"?"l_per_100km":l.fuelConsumption.unit==="mpg_imperial"?"mpg_imperial":"mpg_us",consumption:l.fuelConsumption.value,fuelType:l.fuelConsumption.fuelType==="electric"?"electricity":l.fuelConsumption.fuelType,tankCapacity:l.fuelConsumption.tankCapacity}),[l.fuelConsumption]),x=c.useMemo(()=>({priceType:"manual",currency:l.currency,manualPrices:{petrol:l.fuelPricePerLitre,diesel:l.fuelPricePerLitre,lpg:l.fuelPricePerLitre,electricity:l.fuelPricePerLitre}}),[l.currency,l.fuelPricePerLitre]),w=c.useMemo(()=>{const D=cr(n,r),O=`${l.dailyBudget.food}-${l.dailyBudget.campsite}-${l.crossing.type}-${l.crossing.estimatedCost??0}-${l.fuelPricePerLitre}-${l.fuelConsumption.value}-${l.currency}`;return`${D}_${O}`},[n,r,l]);c.useEffect(()=>{if(n.length<2){u(null),N(null);return}if(d.routeHash===w&&d.breakdown&&dr(d.timestamp)){u(d.breakdown);return}f()},[n,r,C,x,l]),c.useEffect(()=>{m&&t&&t(m)},[m,t]);const f=async()=>{if(!(n.length<2)){h(!0),k(null);try{const D=await vt.calculateRouteCosts(n,r||void 0,C,x),O=D.dailyBreakdown.length||1,G=l.dailyBudget.food*O,K=(l.crossing.type==="ferry"||l.crossing.type==="eurotunnel")&&l.crossing.estimatedCost||0,B=D.segments.filter(Y=>Y.segmentType==="overnight").length,p=B>0?B*l.dailyBudget.campsite:(O-1)*l.dailyBudget.campsite,I=l.dailyBudget.food,F=D.dailyBreakdown.map(Y=>({...Y,foodCost:I,accommodationCost:l.dailyBudget.campsite,totalDailyCost:Y.fuelCost+l.dailyBudget.campsite+I})),Z={...D,foodCost:G,ferryCost:K,accommodationCost:p,dailyBreakdown:F,totalCost:D.fuelCost+p+G+D.tollCost+K};if(u(Z),o({routeHash:w,breakdown:Z,timestamp:Date.now()}),i.showOptimizationSuggestions){const Y=await vt.calculateCostOptimizations(Z,r||void 0);N(Y)}}catch(D){console.error("Cost calculation failed:",D),k("Failed to calculate trip costs. Please try again.")}finally{h(!1)}}},E=(D,O="EUR")=>new Intl.NumberFormat("en-EU",{style:"currency",currency:O,minimumFractionDigits:2,maximumFractionDigits:2}).format(D),W=(D,O)=>O>0?Math.round(D/O*100):0;return a?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-green-50 to-primary-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-neutral-800",children:"Trip Cost Calculator"})]}),e.jsx("span",{className:"text-xs text-neutral-500",children:"Edit budget in Trip Settings"})]}),e.jsxs("div",{className:"p-4",children:[S&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Bt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:S})]})}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-neutral-600",children:"Calculating costs..."})]}):m?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-50 to-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-neutral-800 mb-1",children:E(m.totalCost,m.currency)}),e.jsx("div",{className:"text-sm text-neutral-600",children:"Estimated Trip Cost"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ue,{icon:e.jsx(ys,{className:"w-4 h-4 text-blue-600"}),label:"Fuel",amount:E(m.fuelCost,m.currency),percentage:W(m.fuelCost,m.totalCost),color:"bg-blue-500"}),e.jsx(Ue,{icon:e.jsx(Ie,{className:"w-4 h-4 text-green-600"}),label:"Campsites",amount:E(m.accommodationCost,m.currency),percentage:W(m.accommodationCost,m.totalCost),color:"bg-green-500"}),e.jsx(Ue,{icon:e.jsx(Ot,{className:"w-4 h-4 text-orange-600"}),label:"Food",amount:E(m.foodCost,m.currency),percentage:W(m.foodCost,m.totalCost),color:"bg-orange-500"}),m.tollCost>0&&e.jsx(Ue,{icon:e.jsx(It,{className:"w-4 h-4 text-purple-600"}),label:"Tolls",amount:E(m.tollCost,m.currency),percentage:W(m.tollCost,m.totalCost),color:"bg-purple-500"}),m.ferryCost>0&&e.jsx(Ue,{icon:e.jsx(Jn,{className:"w-4 h-4 text-cyan-600"}),label:"Ferry / Crossing",amount:E(m.ferryCost,m.currency),percentage:W(m.ferryCost,m.totalCost),color:"bg-cyan-500"})]}),i.showDailyEstimates&&m.dailyBreakdown.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Oe,{className:"w-4 h-4 text-primary-600"}),e.jsx("h4",{className:"font-medium text-neutral-800",children:"Daily Cost Breakdown"})]}),e.jsx("div",{className:"space-y-2",children:m.dailyBreakdown.map((D,O)=>e.jsx("div",{className:"bg-neutral-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-neutral-800",children:["Day ",O+1," - ",D.date.toLocaleDateString()]}),e.jsxs("div",{className:"text-sm text-neutral-600",children:[D.distance.toFixed(0),"km driving"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold",children:E(D.totalDailyCost,m.currency)}),e.jsxs("div",{className:"text-xs text-neutral-500 space-x-2",children:[e.jsxs("span",{children:["Fuel: ",E(D.fuelCost,m.currency)]}),e.jsxs("span",{children:["Food: ",E(D.foodCost,m.currency)]})]})]})]})},O))})]}),i.showCostBreakdown&&m.segments.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ye,{className:"w-4 h-4 text-green-600"}),e.jsx("h4",{className:"font-medium text-neutral-800",children:"Route Segments"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:m.segments.map((D,O)=>e.jsx("div",{className:"bg-neutral-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-neutral-800 truncate",children:[D.startWaypoint.name," â†’ ",D.endWaypoint.name]}),e.jsxs("div",{className:"text-sm text-neutral-600",children:[D.distance.toFixed(0),"km â€¢ ",Math.round(D.duration),"min",D.segmentType==="overnight"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs",children:"Overnight"})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"font-semibold",children:E(D.fuelCost+(D.accommodationCost||0),m.currency)}),e.jsxs("div",{className:"text-sm text-neutral-600",children:["Fuel: ",E(D.fuelCost,m.currency)]})]})]})},O))})]}),i.showOptimizationSuggestions&&v&&v.suggestions.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(na,{className:"w-4 h-4 text-orange-600"}),e.jsx("h4",{className:"font-medium text-neutral-800",children:"Cost Optimization"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsxs("div",{className:"text-lg font-semibold text-orange-800",children:["Potential Savings:"," ",E(v.savings,m.currency)]}),e.jsxs("div",{className:"text-sm text-orange-600",children:["Optimized total:"," ",E(v.optimizedCost,m.currency)]})]}),e.jsx("div",{className:"space-y-2",children:v.suggestions.slice(0,3).map((D,O)=>e.jsx("div",{className:"bg-white rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-neutral-800",children:D.description}),e.jsx("div",{className:"text-sm text-neutral-600 mt-1",children:D.actionRequired})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:"font-semibold text-green-600",children:["-",E(D.potentialSaving,m.currency)]})})]})},O))})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(Vt,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:"Add waypoints to your route to calculate trip costs"})]})]})]}):null},Ue=({icon:s,label:t,amount:a,percentage:n,color:r})=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 w-36 shrink-0",children:[s,e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:t})]}),e.jsx("div",{className:"flex-1 h-2 bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${r} rounded-full transition-all`,style:{width:`${n}%`}})}),e.jsx("div",{className:"text-sm font-semibold text-neutral-800 w-24 text-right",children:a}),e.jsxs("div",{className:"text-xs text-neutral-500 w-10 text-right",children:[n,"%"]})]});function qe({title:s,defaultOpen:t=!1,children:a}){const[n,r]=c.useState(t);return e.jsxs("div",{className:"border-b border-neutral-200 last:border-b-0",children:[e.jsxs("button",{type:"button",onClick:()=>r(!n),className:"flex w-full items-center justify-between py-2.5 text-sm font-medium text-neutral-700 hover:text-neutral-900 transition-colors",children:[s,n?e.jsx(Cs,{className:"w-4 h-4 text-neutral-400"}):e.jsx(ws,{className:"w-4 h-4 text-neutral-400"})]}),n&&e.jsx("div",{className:"pb-3 space-y-3",children:a})]})}function hr(s,t){if(!s||!t)return null;const a=new Date(s),r=new Date(t).getTime()-a.getTime();return r<0?null:Math.ceil(r/(1e3*60*60*24))}const ur={spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},xr=[{value:"relaxed",label:"Relaxed"},{value:"moderate",label:"Moderate"},{value:"intensive",label:"Intensive"}],pr=[{value:0,label:"None"},{value:3,label:"Every 3 days"},{value:5,label:"Every 5 days"},{value:7,label:"Every 7 days"}],gr=[{value:"ferry",label:"Ferry"},{value:"eurotunnel",label:"Eurotunnel"},{value:"drive_around",label:"Drive around"},{value:"none",label:"Not applicable"}],fr=[{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"},{value:"USD",label:"USD"}],br=[{value:"diesel",label:"Diesel"},{value:"petrol",label:"Petrol"},{value:"lpg",label:"LPG"},{value:"electric",label:"Electric"}],vr=[{value:"l_per_100km",label:"L/100km"},{value:"mpg_imperial",label:"MPG (UK)"},{value:"mpg_us",label:"MPG (US)"}],Le="w-full text-xs border border-neutral-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-sky-400 focus:border-sky-400",ht="w-full text-xs border border-neutral-300 rounded px-2 py-1.5 bg-white focus:outline-none focus:ring-1 focus:ring-sky-400 focus:border-sky-400",yr=({className:s=""})=>{const{settings:t,setStartDate:a,setEndDate:n,setDrivingStyle:r,setRestDayFrequency:l,setCrossingType:i,setCrossingCost:d,setCurrency:o,setDailyBudget:g,setFuelType:h,setFuelConsumption:m,setFuelConsumptionUnit:u,setFuelPrice:v,setTankCapacity:N}=Fe(),{profile:S}=he(),{openVehicleSidebar:k}=me(),C=Ut[t.currency],x=hr(t.startDate,t.endDate),w=ps(t.startDate);return e.jsxs("div",{className:`space-y-0 ${s}`,children:[e.jsxs(qe,{title:"Dates & Duration",defaultOpen:!0,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-settings-start-date",className:"block text-xs text-neutral-500 mb-1",children:"Start date"}),e.jsx("input",{id:"trip-settings-start-date",type:"date",value:t.startDate??"",onChange:f=>a(f.target.value||void 0),className:Le})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-settings-end-date",className:"block text-xs text-neutral-500 mb-1",children:"End date"}),e.jsx("input",{id:"trip-settings-end-date",type:"date",value:t.endDate??"",onChange:f=>n(f.target.value||void 0),className:Le})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[x!==null?e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-sky-100 text-sky-700 font-medium",children:[x," ",x===1?"day":"days"]}):e.jsx("span",{className:"text-neutral-400",children:"Duration: not set"}),t.startDate&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-amber-50 text-amber-700 font-medium",children:ur[w]})]})]}),e.jsxs(qe,{title:"Driving Style",children:[e.jsx("div",{className:"space-y-1.5",children:xr.map(f=>{const E=en(f.value);return e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"drivingStyle",value:f.value,checked:t.drivingStyle===f.value,onChange:()=>r(f.value),className:"text-sky-600 focus:ring-sky-400"}),e.jsx("span",{className:"text-neutral-700 group-hover:text-neutral-900",children:f.label}),e.jsxs("span",{className:"text-neutral-400 ml-auto",children:[E.maxHours,"h / ",E.maxKmPerDay,"km"]})]},f.value)})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-settings-rest-days",className:"block text-xs text-neutral-500 mb-1",children:"Rest days"}),e.jsx("select",{id:"trip-settings-rest-days",value:t.restDayFrequency,onChange:f=>l(Number(f.target.value)),className:ht,children:pr.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]})]}),e.jsxs(qe,{title:"Channel Crossing",children:[e.jsx("div",{className:"space-y-1.5",children:gr.map(f=>e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"crossingType",value:f.value,checked:t.crossing.type===f.value,onChange:()=>i(f.value),className:"text-sky-600 focus:ring-sky-400"}),e.jsx("span",{className:"text-neutral-700 group-hover:text-neutral-900",children:f.label})]},f.value))}),t.crossing.type!=="none"&&t.crossing.type!=="drive_around"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-neutral-500 mb-1",children:["Estimated cost (",C,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-xs text-neutral-400",children:C}),e.jsx("input",{type:"number",min:0,step:5,value:t.crossing.estimatedCost??"",onChange:f=>{const E=f.target.value;d(E===""?void 0:Number(E))},placeholder:"e.g. 150",className:`${Le} pl-5`})]})]})]}),e.jsxs(qe,{title:"Daily Budget",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-settings-currency",className:"block text-xs text-neutral-500 mb-1",children:"Currency"}),e.jsx("select",{id:"trip-settings-currency",value:t.currency,onChange:f=>o(f.target.value),className:ht,children:fr.map(f=>e.jsxs("option",{value:f.value,children:[f.value," (",Ut[f.value],")"]},f.value))})]}),e.jsx("div",{className:"space-y-2",children:[{key:"campsite",label:"Campsite (per night)"},{key:"food",label:"Food (per day)"},{key:"activities",label:"Activities (per day)"}].map(f=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:`trip-settings-budget-${f.key}`,className:"block text-xs text-neutral-500 mb-1",children:f.label}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-xs text-neutral-400",children:C}),e.jsx("input",{id:`trip-settings-budget-${f.key}`,type:"number",min:0,step:5,value:t.dailyBudget[f.key],onChange:E=>g({[f.key]:Number(E.target.value)}),className:`${Le} pl-5`})]})]},f.key))})]}),e.jsxs(qe,{title:"Fuel Settings",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-settings-fuel-type",className:"block text-xs text-neutral-500 mb-1",children:"Fuel type"}),e.jsx("select",{id:"trip-settings-fuel-type",value:t.fuelConsumption.fuelType,onChange:f=>h(f.target.value),className:ht,children:br.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-settings-fuel-unit",className:"block text-xs text-neutral-500 mb-1",children:"Unit"}),e.jsx("select",{id:"trip-settings-fuel-unit",value:t.fuelConsumption.unit,onChange:f=>u(f.target.value),className:ht,children:vr.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip-settings-fuel-consumption",className:"block text-xs text-neutral-500 mb-1",children:"Consumption"}),e.jsx("input",{id:"trip-settings-fuel-consumption",type:"number",min:0,step:.5,value:t.fuelConsumption.value,onChange:f=>m(Number(f.target.value)),className:Le})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-neutral-500 mb-1",children:["Price per litre (",C,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-xs text-neutral-400",children:C}),e.jsx("input",{type:"number",min:0,step:.05,value:t.fuelPricePerLitre,onChange:f=>v(Number(f.target.value)),className:`${Le} pl-5`})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tank-capacity",className:"block text-xs text-neutral-500 mb-1",children:"Tank capacity (litres)"}),e.jsx("input",{id:"tank-capacity",type:"number",min:0,step:5,value:t.fuelConsumption.tankCapacity,onChange:f=>N(Number(f.target.value)),className:Le})]})]}),e.jsx("div",{className:"pt-3 border-t border-neutral-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"text-neutral-500",children:["Vehicle:"," ",e.jsx("span",{className:"text-neutral-700 font-medium",children:S?.name??"Not set"})]}),e.jsxs("button",{type:"button",onClick:k,className:"inline-flex items-center gap-1 text-sky-600 hover:text-sky-700 font-medium transition-colors",children:["Edit",e.jsx(xs,{className:"w-3 h-3"})]})]})})]})},Pt=()=>({visibleTypes:["campsite","caravan_site","aire"],amenities:{electricity:!1,wifi:!1,shower:!1,toilets:!1,drinking_water:!1,waste_disposal:!1,laundry:!1,restaurant:!1,shop:!1,playground:!1,swimming_pool:!1,pet_allowed:!1},vehicleCompatibleOnly:!1,routeOnlyMode:!1,maxDistanceFromRoute:20,openNow:!1,freeOnly:!1,acceptsReservations:!1,searchQuery:"",searchLocation:"",maxResults:100,sortBy:"distance"}),ze=[{type:"campsite",label:"Campsites",icon:Ie,description:"Traditional camping with tents/caravans"},{type:"caravan_site",label:"Caravan Sites",icon:jt,description:"Sites specifically for caravans/motorhomes"},{type:"aire",label:"Aires de Service",icon:Ss,description:"Motorhome service areas with facilities"}],jr=[{key:"electricity",label:"Electricity",icon:nt},{key:"wifi",label:"WiFi",icon:$s},{key:"shower",label:"Showers",icon:Ls},{key:"toilets",label:"Toilets",icon:ks},{key:"drinking_water",label:"Drinking Water",icon:Ts},{key:"waste_disposal",label:"Waste Disposal",icon:st},{key:"laundry",label:"Laundry",icon:As},{key:"restaurant",label:"Restaurant",icon:Ot},{key:"shop",label:"Shop",icon:Ps},{key:"playground",label:"Playground",icon:Ns},{key:"swimming_pool",label:"Swimming Pool",icon:zs},{key:"pet_allowed",label:"Pets Allowed",icon:Ms}],wr=[{value:"distance",label:"Distance from route"},{value:"name",label:"Name A-Z"},{value:"rating",label:"Rating"},{value:"relevance",label:"Search relevance"}],Nr=[25,50,100,200,500],kr=[5,10,20,50,100],ls=({className:s,filterState:t,onFilterChange:a,onSearchChange:n,campsiteCount:r=0,isLoading:l=!1})=>{const[i,d]=c.useState(!1),[o,g]=c.useState("types"),{calculatedRoute:h}=ce(),m=c.useCallback(x=>{try{localStorage.setItem("camper-planner-campsite-filters",JSON.stringify(x))}catch{}},[]);c.useEffect(()=>{try{const x=localStorage.getItem("camper-planner-campsite-filters");if(x){const w=JSON.parse(x),f={...Pt(),...w};a(f)}}catch{}},[a]);const u=c.useCallback((x,w)=>{const f={...t,[x]:w};a(f),m(f)},[t,a,m]),v=c.useCallback(x=>{const w=t.visibleTypes.includes(x)?t.visibleTypes.filter(f=>f!==x):[...t.visibleTypes,x];u("visibleTypes",w)},[t.visibleTypes,u]),N=c.useCallback(x=>{const w={...t.amenities,[x]:!t.amenities[x]};u("amenities",w)},[t.amenities,u]),S=c.useCallback(()=>{const x=Pt();a(x),m(x)},[a,m]),k=c.useMemo(()=>{let x=0;return t.visibleTypes.length!==ze.length&&x++,x+=Object.values(t.amenities).filter(Boolean).length,t.vehicleCompatibleOnly&&x++,t.routeOnlyMode&&x++,t.openNow&&x++,t.freeOnly&&x++,t.acceptsReservations&&x++,t.searchQuery.trim()&&x++,t.searchLocation.trim()&&x++,x},[t]),C=h?.routes?.[0]?.geometry;return e.jsxs("div",{className:L("bg-white rounded-xl shadow-soft",s),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-neutral-100",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ft,{className:"w-5 h-5 text-neutral-600"}),e.jsx("h3",{className:"text-sm font-display font-semibold text-neutral-900",children:"Campsite Filters"}),k>0&&e.jsxs("span",{className:"bg-primary-100 text-primary-800 px-2 py-1 rounded-full text-xs font-medium",children:[k," active"]}),r>0&&e.jsxs("span",{className:"text-xs text-neutral-500",children:["(",r," results)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[k>0&&e.jsx("button",{onClick:S,className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),l&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary-600 border-t-transparent"}),e.jsx("button",{onClick:()=>d(!i),className:"p-1.5 rounded text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 transition-colors",children:e.jsx("svg",{className:L("w-4 h-4 transform transition-transform",i&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),!i&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[ze.map(({type:x,icon:w,label:f})=>e.jsx("button",{onClick:()=>v(x),className:L("flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all",t.visibleTypes.includes(x)?"border-green-500 bg-green-50 text-green-700":"border-neutral-300 bg-neutral-50 text-neutral-400 hover:border-neutral-400"),title:f,children:e.jsx(w,{className:"w-4 h-4"})},x)),C&&e.jsxs("button",{onClick:()=>u("routeOnlyMode",!t.routeOnlyMode),className:L("px-2 py-1 text-xs font-medium rounded transition-colors",t.routeOnlyMode?"bg-primary-100 text-primary-800":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"),children:[e.jsx(ye,{className:"w-3 h-3 inline mr-0.5"})," Route only"]})]}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Max: ",t.maxResults]})]})}),i&&e.jsxs("div",{className:"border-b border-neutral-200",children:[e.jsx("div",{className:"flex border-b border-neutral-200 bg-neutral-50",children:[{id:"types",label:"Types",icon:Ie},{id:"amenities",label:"Amenities",icon:nt},{id:"advanced",label:"Advanced",icon:Is},{id:"search",label:"Search",icon:ft}].map(x=>{const w=x.icon;return e.jsxs("button",{onClick:()=>g(x.id),className:L("flex-1 flex items-center justify-center space-x-1 py-3 px-2 text-sm font-medium transition-colors",o===x.id?"text-primary-600 border-b-2 border-primary-600 bg-white":"text-neutral-500 hover:text-neutral-700"),children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{children:x.label})]},x.id)})}),e.jsxs("div",{className:"p-4 space-y-4",children:[o==="types"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-900",children:"Campsite Types"}),e.jsx("button",{onClick:()=>{const x=t.visibleTypes.length===ze.length;u("visibleTypes",x?[]:ze.map(w=>w.type))},className:"text-xs text-primary-600 hover:text-primary-800 font-medium",children:t.visibleTypes.length===ze.length?"None":"All"})]}),ze.map(({type:x,label:w,icon:f,description:E})=>e.jsxs("label",{htmlFor:`filter-type-${x}`,className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{id:`filter-type-${x}`,type:"checkbox",checked:t.visibleTypes.includes(x),onChange:()=>v(x),className:"mt-1 h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsx(f,{className:"w-4 h-4 mt-1"}),e.jsxs("span",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:w}),e.jsx("p",{className:"text-xs text-neutral-500 mt-0.5",children:E})]})]},x))]}),o==="amenities"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-900",children:"Required Amenities"}),e.jsx("button",{onClick:()=>{const x=Object.values(t.amenities).every(Boolean),w=Object.keys(t.amenities).reduce((f,E)=>({...f,[E]:!x}),{});u("amenities",w)},className:"text-xs text-primary-600 hover:text-primary-800 font-medium",children:Object.values(t.amenities).every(Boolean)?"None":"All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:jr.map(({key:x,label:w,icon:f})=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.amenities[x],onChange:()=>N(x),className:"h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-neutral-900",children:w})]},x))}),e.jsxs("div",{className:"mt-3 p-2 bg-primary-50 rounded-lg text-xs text-primary-800 flex items-center gap-1.5",children:[e.jsx(cn,{className:"w-3.5 h-3.5 flex-shrink-0"})," Only campsites with ALL selected amenities will be shown"]})]}),o==="advanced"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{htmlFor:"filter-vehicle-compatible",className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{id:"filter-vehicle-compatible",type:"checkbox",checked:t.vehicleCompatibleOnly,onChange:x=>u("vehicleCompatibleOnly",x.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsxs("span",{className:"flex-1",children:["Vehicle Compatible Only",e.jsx("p",{className:"text-xs text-neutral-500 mt-0.5",children:"Show only campsites that can accommodate your vehicle dimensions"})]})]}),C&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"filter-route-only",className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{id:"filter-route-only",type:"checkbox",checked:t.routeOnlyMode,onChange:x=>u("routeOnlyMode",x.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsxs("span",{className:"flex-1",children:["Show Along Route Only",e.jsx("p",{className:"text-xs text-neutral-500 mt-0.5",children:"Filter campsites within distance of your planned route"})]})]}),t.routeOnlyMode&&e.jsxs("div",{className:"ml-7",children:[e.jsxs("label",{className:"block text-xs font-medium text-neutral-700 mb-1",children:["Max Distance from Route: ",t.maxDistanceFromRoute,"km"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:5,max:100,step:5,value:t.maxDistanceFromRoute,onChange:x=>u("maxDistanceFromRoute",parseInt(x.target.value)),className:"flex-1 h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer"}),e.jsx("select",{value:t.maxDistanceFromRoute,onChange:x=>u("maxDistanceFromRoute",parseInt(x.target.value)),className:"text-xs border border-neutral-300 rounded px-2 py-1 bg-white",children:kr.map(x=>e.jsxs("option",{value:x,children:[x,"km"]},x))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.openNow,onChange:x=>u("openNow",x.target.checked),className:"h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-neutral-900",children:"Open Now"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.freeOnly,onChange:x=>u("freeOnly",x.target.checked),className:"h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-neutral-900",children:"Free Only"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.acceptsReservations,onChange:x=>u("acceptsReservations",x.target.checked),className:"h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-neutral-900",children:"Accepts Reservations"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-max-results",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Max Results"}),e.jsx("select",{id:"filter-max-results",value:t.maxResults,onChange:x=>u("maxResults",parseInt(x.target.value)),className:"w-full text-sm border border-neutral-300 rounded px-2 py-1 bg-white",children:Nr.map(x=>e.jsx("option",{value:x,children:x},x))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-sort-by",className:"block text-xs font-medium text-neutral-700 mb-1",children:"Sort By"}),e.jsx("select",{id:"filter-sort-by",value:t.sortBy,onChange:x=>u("sortBy",x.target.value),className:"w-full text-sm border border-neutral-300 rounded px-2 py-1 bg-white",children:wr.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]})]}),e.jsxs("div",{className:"p-3 bg-neutral-50 border border-neutral-200 rounded mt-4",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-700 mb-2",children:"Map Legend"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#27ae60",stroke:"#1a8a4b",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Campsite (tent/caravan)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#2794a8",stroke:"#1e7a8d",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Caravan/Motorhome site"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#7c5cbf",stroke:"#6b47b0",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Aire de Service"})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-neutral-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#e63946",stroke:"#d32535",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"May not fit your vehicle"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 text-white text-[8px] font-bold flex items-center justify-center border-2 border-white shadow",children:"3"})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Clustered markers (zoom in)"})]})]})]})]})]}),o==="search"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-search-name",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Search by Name"}),e.jsx("input",{id:"filter-search-name",type:"text",value:t.searchQuery,onChange:x=>{u("searchQuery",x.target.value),n?.(x.target.value)},placeholder:"Search campsite names...",className:"w-full px-3 py-2 text-sm border border-neutral-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-search-location",className:"block text-sm font-medium text-neutral-700 mb-2",children:"Search by Location"}),e.jsx("input",{id:"filter-search-location",type:"text",value:t.searchLocation,onChange:x=>u("searchLocation",x.target.value),placeholder:"City, region, or address...",className:"w-full px-3 py-2 text-sm border border-neutral-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{className:"p-3 bg-neutral-50 border border-neutral-200 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-neutral-900 mb-1",children:"Search Tips:"}),e.jsxs("ul",{className:"space-y-0.5 text-neutral-700",children:[e.jsx("li",{children:"â€¢ Use partial names for broader results"}),e.jsx("li",{children:"â€¢ Search by city or region names"}),e.jsx("li",{children:"â€¢ Combine with other filters for precise results"}),e.jsx("li",{children:"â€¢ Clear search to see all campsites in area"})]})]})]})]})]})]})},Ge={campsite:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 12h3v8h14v-8h3L12 2zm-1 15h-2v-3h2v3zm4 0h-2v-3h2v3z"/></svg>',caravan_site:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 7h-3V6a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v6h2a3 3 0 0 0 6 0h6a3 3 0 0 0 6 0h2V10a3 3 0 0 0-3-3zM6 14a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm12 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></svg>',aire:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 15c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 2.5c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5zm12-2.5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 2.5c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5zm-4.5-12H11V3H9v2.5H6.5l1.38 1.38C8.51 7.45 9.2 8 10 8h4c.8 0 1.49-.55 1.88-1.38L17.26 5.5H15V3h-2v2.5z"/></svg>',parking:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.5 2h11A1.5 1.5 0 0 1 19 3.5v17a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 5 20.5v-17A1.5 1.5 0 0 1 6.5 2zM8 8v8h2v-3h2.5a2.5 2.5 0 0 0 0-5H8zm2 2h2.5a.5.5 0 0 1 0 1H10v-1z"/></svg>',unknown:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"/></svg>'},os={campsite:{icon:Ge.campsite,color:"#ffffff",backgroundColor:"#27ae60",borderColor:"#1a8a4b",size:32,description:"Traditional campsite with tent/caravan pitches"},caravan_site:{icon:Ge.caravan_site,color:"#ffffff",backgroundColor:"#2794a8",borderColor:"#1e7a8d",size:32,description:"Caravan and motorhome specific site"},aire:{icon:Ge.aire,color:"#ffffff",backgroundColor:"#7c5cbf",borderColor:"#6b47b0",size:32,description:"Aire de service for motorhomes"},parking:{icon:Ge.parking,color:"#ffffff",backgroundColor:"#e9a100",borderColor:"#cc7d00",size:32,description:"Parking area with overnight stays allowed"},unknown:{icon:Ge.unknown,color:"#ffffff",backgroundColor:"#6b7785",borderColor:"#556170",size:28,description:"Unknown campsite type"}},cs={electricity:{borderColor:"#cc7d00",backgroundColor:"#e9a100"},wifi:{borderColor:"#1e7a8d",backgroundColor:"#2794a8"},shower:{borderColor:"#1a8a4b",backgroundColor:"#27ae60"},toilets:{borderColor:"#6b47b0",backgroundColor:"#7c5cbf"},drinking_water:{borderColor:"#1e7a8d",backgroundColor:"#3eaec2"}},Cr={small:24,medium:32,large:40};function Sr(s){const{campsite:t,vehicleCompatible:a=!0,isSelected:n=!1,isHighlighted:r=!1,isInRoute:l=!1,isMobile:i=!1,size:d="medium",showTooltip:o=!1}=s,g=os[t.type]||os.unknown;let h=i?Cr[d]:g.size;(n||r)&&(h=Math.floor(h*1.2));let m=g.backgroundColor,u=g.borderColor;if(a||(m="#e63946",u="#d32535"),n&&(u="#f25d2a"),r&&(u="#2794a8"),a&&t.amenities){for(const[E,W]of Object.entries(t.amenities))if(W&&cs[E]){const D=cs[E];D.backgroundColor&&(m=D.backgroundColor),D.borderColor&&(u=D.borderColor);break}}const v=n?`
    animation: campsite-pulse 1.5s ease-in-out infinite;
  `:r?`
    animation: campsite-glow 1s ease-in-out infinite;
  `:"",N=Math.floor(h*.6),S=o&&t.name?`
    <div class="campsite-tooltip" style="
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      white-space: nowrap;
      font-size: 11px;
      font-weight: 500;
      color: #374151;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      margin-bottom: 4px;
      z-index: 1000;
    ">${t.name.substring(0,30)}${t.name.length>30?"...":""}</div>
  `:"",k=l?`
    <div style="
      position: absolute;
      top: -4px;
      right: -4px;
      width: 14px;
      height: 14px;
      background: #27ae60;
      border: 2px solid white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    ">
      <svg viewBox="0 0 20 20" fill="white" style="width: 8px; height: 8px;">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
      </svg>
    </div>
  `:"",C=!a&&!l?`
    <div style="
      position: absolute;
      top: -2px;
      right: -2px;
      width: 12px;
      height: 12px;
      background: #fef2f2;
      border: 2px solid #d32535;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      font-weight: bold;
      color: #d32535;
    ">!</div>
  `:"",x=h,w=Math.floor(h*1.4),f=`
    <div class="campsite-marker-wrapper" style="
      position: relative;
      width: ${x}px;
      height: ${w}px;
      ${v}
    ">
      ${S}
      <div style="
        position: relative;
        width: ${x}px;
        height: ${w}px;
        cursor: pointer;
        filter: drop-shadow(0 3px 4px rgba(0,0,0,0.3));
      ">
        <!-- Pin/teardrop SVG shape -->
        <svg viewBox="0 0 32 44" style="width: 100%; height: 100%;">
          <!-- Main pin shape -->
          <path d="M16 0C7.163 0 0 7.163 0 16c0 12 16 28 16 28s16-16 16-28C32 7.163 24.837 0 16 0z"
                fill="${m}"
                stroke="${u}"
                stroke-width="2"/>
          <!-- Inner circle for icon -->
          <circle cx="16" cy="14" r="10" fill="${u}" opacity="0.2"/>
        </svg>
        <!-- Icon container centered in top portion -->
        <div style="
          position: absolute;
          top: ${Math.floor(w*.12)}px;
          left: 50%;
          transform: translateX(-50%);
          width: ${N}px;
          height: ${N}px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: ${g.color};
        ">
          ${g.icon}
        </div>
        ${k}
        ${C}
      </div>
    </div>
  `;return He.divIcon({className:`campsite-marker-icon ${n?"selected":""} ${r?"highlighted":""} ${l?"in-route":""}`,html:f,iconSize:[x,w],iconAnchor:[x/2,w],popupAnchor:[0,-w+10]})}function Mr(s){const t=s.getChildCount(),a=t<10?30:t<100?40:50;return He.divIcon({html:`
      <div style="
        width: ${a}px;
        height: ${a}px;
        background: linear-gradient(135deg, #27ae60, #1a8a4b);
        border: 3px solid #ffffff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: ${Math.floor(a*.3)}px;
        font-weight: bold;
        color: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        cursor: pointer;
      ">
        ${t}
      </div>
    `,className:"campsite-cluster-icon",iconSize:[a,a],iconAnchor:[a/2,a/2]})}function Lr(s,t,a=!1){const n=a?t>12?15:t>10?25:40:t>12?20:t>10?30:50,r=[],l=new Set;for(const i of s){if(l.has(i.id))continue;const d=[i];l.add(i.id);for(const o of s){if(l.has(o.id)||o.id===i.id)continue;Tr(i.lat,i.lng,o.lat,o.lng,t)<n&&(d.push(o),l.add(o.id))}if(d.length>1){const o=d.reduce((h,m)=>h+m.lat,0)/d.length,g=d.reduce((h,m)=>h+m.lng,0)/d.length;r.push({...i,id:Date.now()+r.length,location:{lat:o,lng:g},name:`${d.length} campsites`,isCluster:!0,clusterCount:d.length,clusterCampsites:d})}else r.push(i)}return r}function Tr(s,t,a,n,r){const i=s*Math.PI/180,d=a*Math.PI/180,o=(a-s)*Math.PI/180,g=(n-t)*Math.PI/180,h=Math.sin(o/2)*Math.sin(o/2)+Math.cos(i)*Math.cos(d)*Math.sin(g/2)*Math.sin(g/2),u=6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))),v=156543.03392*Math.cos(i)/Math.pow(2,r);return u/v}const Dr=({visibleTypes:s,maxResults:t,vehicleCompatibleOnly:a,searchQuery:n="",isVisible:r,onCampsiteClick:l,onCampsitesLoaded:i,isMobile:d=!1,filterState:o,highlightedCampsiteId:g,selectedCampsiteId:h})=>{const m=wt(),{calculatedRoute:u,waypoints:v,addWaypoint:N}=ce(),{profile:S}=he(),{addNotification:k}=me(),{trackFeature:C}=$t(),x=c.useCallback(M=>v.some(z=>Math.abs(z.lat-M.lat)<1e-4&&Math.abs(z.lng-M.lng)<1e-4),[v]),w=c.useCallback((M,z)=>{if(z.stopPropagation(),x(M)){k({type:"warning",message:`${M.name||"This campsite"} is already in your route`});return}const q={id:`campsite-${M.id}-${Date.now()}`,lat:M.lat,lng:M.lng,type:"campsite",name:M.name||`${M.type.replace("_"," ")} #${M.id}`,notes:M.address||""};N(q),k({type:"success",message:`Added "${q.name}" to your route`})},[N,k,x]),[f,E]=c.useState([]),[W,D]=c.useState(!1),[O,G]=c.useState(null),[K,B]=c.useState(m.getZoom());c.useEffect(()=>{const M=()=>B(m.getZoom());return m.on("zoomend",M),()=>{m.off("zoomend",M)}},[m]);const p=c.useCallback(M=>{if(!(M instanceof Error))return{message:"Failed to load campsites",suggestion:"Please try again or zoom to a different area.",retryable:!0};const z=M.message.toLowerCase();return z.includes("timeout")?{message:"Request timed out while loading campsites",suggestion:"The area may be too large. Try zooming in to search a smaller area.",retryable:!0}:z.includes("failed to fetch")||z.includes("network")?{message:"Network connection failed",suggestion:"Please check your internet connection and try again.",retryable:!0}:z.includes("rate limit")||z.includes("too many requests")?{message:"Too many requests",suggestion:"Please wait a moment before searching again.",retryable:!0}:z.includes("bounding box too large")?{message:"Search area too large",suggestion:"Please zoom in to search a smaller area.",retryable:!1}:z.includes("no data")||z.includes("404")?{message:"No campsites found in this area",suggestion:"Try zooming out or searching a different location.",retryable:!1}:z.includes("http 5")?{message:"Campsite service temporarily unavailable",suggestion:"Please try again in a few moments.",retryable:!0}:{message:M.message||"Failed to load campsites",suggestion:"Please try again. If the problem persists, try zooming to a different area.",retryable:!0}},[]),I=c.useCallback(M=>S?!(S.height&&M.access?.max_height&&S.height>M.access.max_height||S.length&&M.access?.max_length&&S.length>M.access.max_length||S.weight&&M.access?.max_weight&&S.weight>M.access.max_weight):!0,[S]),F=c.useMemo(()=>{{let M=f.map(z=>({...z,vehicleCompatible:I(z)}));if(a&&(M=M.filter(z=>z.vehicleCompatible)),n.trim()){const z=n.toLowerCase();M=M.filter(q=>q.name?.toLowerCase().includes(z)||q.address?.toLowerCase().includes(z)||q.type.toLowerCase().includes(z)||Object.keys(q.amenities||{}).some(T=>T.toLowerCase().includes(z)))}return M=M.filter(z=>s.includes(z.type)),M}},[f,a,n,s,o,u,m,I]),Z=c.useMemo(()=>!r||K>=15?F:Lr(F,K,d),[F,K,r,d]),Y=c.useCallback(async()=>{if(!(!m||!r||m.getZoom()<7)){D(!0),G(null);try{const z=m.getBounds();if(!z){D(!1);return}const q=z.getNorth(),T=z.getSouth(),j=z.getEast(),H=z.getWest();if(typeof q>"u"||typeof T>"u"||typeof j>"u"||typeof H>"u"||isNaN(q)||isNaN(T)||isNaN(j)||isNaN(H)){D(!1);return}const y={bounds:{north:q,south:T,east:j,west:H},types:s,maxResults:t,includeDetails:!0,vehicleFilter:S||void 0},P=await Qe.searchCampsites(y);if(P.status==="success")E(P.campsites),i?.(P.campsites.length,P.campsites),C("campsite_search","completed",{results:P.campsites.length});else{const U=p(new Error(P.error||"Failed to load campsites"));G(U)}}catch(z){const q=p(z);G(q)}finally{D(!1)}}},[m,s,t,S,r,i,p,C]),se=c.useCallback(async()=>{if(!u?.routes?.[0]?.geometry||!r)return;const M=u.routes[0].geometry;let z=1/0,q=-1/0,T=1/0,j=-1/0;M.coordinates.forEach(ee=>{const[X,le]=ee;z=Math.min(z,le),q=Math.max(q,le),T=Math.min(T,X),j=Math.max(j,X)});const H=.1,y=z-H,P=q+H,U=T-H,ae=j+H,re=4.5,Q=[];for(let ee=y;ee<P;ee+=re)for(let X=U;X<ae;X+=re)Q.push({south:ee,north:Math.min(ee+re,P),west:X,east:Math.min(X+re,ae)});D(!0),G(null);try{const ee=[],X=new Set,le=await Promise.allSettled(Q.map(ne=>Qe.searchCampsites({bounds:ne,types:s,maxResults:t,includeDetails:!0,vehicleFilter:S||void 0})));for(const ne of le)if(ne.status==="fulfilled"&&ne.value.status==="success")for(const oe of ne.value.campsites)X.has(oe.id)||(X.add(oe.id),ee.push(oe));E(ee),i?.(ee.length,ee)}catch(ee){const X=p(ee);G(X)}finally{D(!1)}},[u,s,t,S,r,i,p]),R=c.useRef(null),$=c.useRef(0),J=c.useRef(null);return c.useEffect(()=>{if(!r||!m)return;const M=()=>{J.current&&clearTimeout(J.current),J.current=setTimeout(()=>{const z=m.getBounds(),q=m.getZoom(),T=R.current,j=$.current;if(T&&Math.abs(q-j)<1){const y=Math.abs(z.getSouth()-T.getSouth())+Math.abs(z.getNorth()-T.getNorth()),P=Math.abs(z.getWest()-T.getWest())+Math.abs(z.getEast()-T.getEast()),U=T.getNorth()-T.getSouth(),ae=T.getEast()-T.getWest();if(y<U*.3&&P<ae*.3)return}R.current=z,$.current=q,Y()},300)};return m.on("moveend",M),Y(),()=>{m.off("moveend",M),J.current&&clearTimeout(J.current)}},[m,r,Y]),c.useEffect(()=>{u&&r&&se()},[u,r,se]),r?e.jsxs(e.Fragment,{children:[W&&e.jsxs("div",{className:"fixed top-24 right-4 z-50 bg-white shadow-lg rounded-lg px-4 py-2 flex items-center space-x-2 animate-fade-in",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-primary-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-neutral-700",children:"Loading campsites..."})]}),O&&!W&&e.jsx("div",{className:"fixed top-24 right-4 z-50 max-w-sm bg-red-50 shadow-lg rounded-lg p-4 border border-red-200 animate-slide-in-right",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-red-900",children:O.message}),O.suggestion&&e.jsx("p",{className:"text-xs text-red-700 mt-1",children:O.suggestion}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[O.retryable&&e.jsxs("button",{onClick:()=>{G(null),Y()},className:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 bg-white border border-red-300 rounded hover:bg-red-50 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Retry"]}),e.jsx("button",{onClick:()=>G(null),className:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 hover:text-red-900",children:"Dismiss"})]})]}),e.jsx("button",{onClick:()=>G(null),className:"flex-shrink-0 text-red-400 hover:text-red-600 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),Z.map(M=>{const z=g===M.id.toString(),q=h===M.id.toString(),T=M.isCluster,j=x(M),H=T?Mr({getChildCount:()=>M.clusterCount||0}):Sr({campsite:M,vehicleCompatible:M.vehicleCompatible,isSelected:q,isHighlighted:z,isInRoute:j,isMobile:d,showTooltip:!0});return e.jsx(Be,{position:T&&M.location?[M.location.lat,M.location.lng]:[M.lat,M.lng],icon:H,eventHandlers:{click:()=>{if(T){if(M.clusterCampsites){const y=He.latLngBounds(M.clusterCampsites.map(P=>[P.lat,P.lng]));m.fitBounds(y,{padding:[20,20]})}}else l?.(M)}},children:e.jsx(et,{children:T?e.jsxs("div",{className:"p-3",children:[e.jsxs("h3",{className:"font-medium text-neutral-900 text-sm mb-2",children:[M.clusterCount," Campsites"]}),e.jsx("p",{className:"text-xs text-neutral-600 mb-2",children:"Click to zoom in and see individual campsites"}),e.jsxs("div",{className:"space-y-1",children:[M.clusterCampsites?.slice(0,3).map((y,P)=>e.jsxs("div",{className:"text-xs text-neutral-700",children:["â€¢ ",y.name||y.type.replace("_"," ")]},P)),M.clusterCampsites&&M.clusterCampsites.length>3&&e.jsxs("div",{className:"text-xs text-neutral-500",children:["and ",M.clusterCampsites.length-3," more..."]})]})]}):e.jsxs("div",{className:"campsite-popup-content p-3 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-neutral-900 text-sm leading-tight pr-2",children:M.name||`${M.type.replace("_"," ")} #${M.id}`}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${M.vehicleCompatible?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:M.vehicleCompatible?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"inline-block w-3 h-3 mr-1"})," Compatible"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"inline-block w-3 h-3 mr-1"})," Check Size"]})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs text-neutral-600 capitalize mb-1",children:M.type.replace("_"," ")}),M.address&&e.jsxs("div",{className:"text-xs text-neutral-700 mb-1",children:["ðŸ“ ",M.address]}),M.phone&&e.jsxs("div",{className:"text-xs text-neutral-700 mb-1",children:["ðŸ“ž ",M.phone]}),M.website&&e.jsxs("div",{className:"text-xs text-neutral-700 mb-1",children:["ðŸŒ"," ",e.jsx("a",{href:M.website,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-800 underline",children:"Website"})]}),M.opening_hours&&e.jsxs("div",{className:"text-xs text-neutral-700 mb-1",children:["ðŸ•’ ",M.opening_hours]})]}),M.amenities&&Object.keys(M.amenities).length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-900 mb-1",children:"Amenities:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(M.amenities).filter(([y,P])=>P).map(([y])=>e.jsx("span",{className:"px-1.5 py-0.5 bg-primary-100 text-primary-800 text-xs rounded",children:y.replace(/_/g," ")},y))})]}),!M.vehicleCompatible&&M.restrictions&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:[e.jsxs("div",{className:"text-xs font-medium text-red-800 mb-1",children:[e.jsx(Se,{className:"inline-block w-3 h-3 mr-1"})," Vehicle Restrictions:"]}),e.jsx("div",{className:"text-xs text-red-700",children:M.restrictions})]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-neutral-200",children:x(M)?e.jsxs("div",{className:"flex items-center justify-center py-2 px-3 bg-green-50 text-green-700 rounded-md text-xs font-medium",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Already in route"]}):e.jsxs("button",{onClick:y=>w(M,y),className:"w-full flex items-center justify-center py-2 px-3 bg-primary-600 hover:bg-primary-700 text-white rounded-md text-sm font-medium transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add to Route"]})}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-500",children:["Data from ",M.source," â€¢ ID: ",M.osmId||M.id]})]})})},M.id)})]}):null},Te=[{type:"campsite",label:"Campsites",icon:Ie,description:"Traditional camping with tents/caravans"},{type:"caravan_site",label:"Caravan Sites",icon:jt,description:"Sites specifically for caravans/motorhomes"},{type:"aire",label:"Aires de Service",icon:Ss,description:"Motorhome service areas with facilities"}],Er=[25,50,100,200,500],ds=({className:s,visibleTypes:t,onTypesChange:a,maxResults:n,onMaxResultsChange:r,vehicleCompatibleOnly:l,onVehicleCompatibleChange:i,isVisible:d=!0,onVisibilityChange:o,onRefresh:g,isLoading:h=!1,campsiteCount:m=0})=>{const[u,v]=c.useState(!1),N=k=>{t.includes(k)?a(t.filter(C=>C!==k)):a([...t,k])},S=()=>{t.length===Te.length?a([]):a(Te.map(k=>k.type))};return e.jsxs("div",{className:L("bg-white rounded-lg shadow-sm border border-neutral-200",s),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-neutral-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>o?.(!d),className:L("flex items-center space-x-2 px-2 py-1 rounded text-sm font-medium transition-colors",d?"bg-green-100 text-green-800 hover:bg-green-200":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"),children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{children:"Campsites"}),d&&m>0&&e.jsx("span",{className:"bg-green-200 text-green-800 px-1.5 py-0.5 rounded-full text-xs font-medium",children:m})]}),e.jsxs("span",{className:"text-xs text-neutral-500",children:["(",t.length,"/",Te.length," types)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g&&e.jsx("button",{onClick:g,disabled:h,className:L("p-1.5 rounded text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 transition-colors",h&&"cursor-not-allowed opacity-50"),title:"Refresh campsite data",children:e.jsx("svg",{className:L("w-4 h-4",h&&"animate-spin"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("button",{onClick:()=>v(!u),className:"p-1.5 rounded text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 transition-colors",children:e.jsx("svg",{className:L("w-4 h-4 transform transition-transform",u&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),!u&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:Te.map(({type:k,icon:C})=>e.jsx("button",{onClick:()=>N(k),className:L("flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all",t.includes(k)?"border-green-500 bg-green-50 text-green-700":"border-neutral-300 bg-neutral-50 text-neutral-400 hover:border-neutral-400"),title:Te.find(x=>x.type===k)?.label,children:e.jsx(C,{className:"w-4 h-4"})},k))}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Max: ",n," â€¢ ",l?"Compatible only":"All sites"]})]})}),u&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-neutral-700",children:"Campsite Types"}),e.jsx("button",{onClick:S,className:"text-xs text-primary-600 hover:text-primary-800 font-medium",children:t.length===Te.length?"None":"All"})]}),e.jsx("div",{className:"space-y-2",children:Te.map(({type:k,label:C,icon:x,description:w})=>e.jsxs("label",{htmlFor:`controls-type-${k}`,className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{id:`controls-type-${k}`,type:"checkbox",checked:t.includes(k),onChange:()=>N(k),className:"mt-1 h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsx(x,{className:"w-4 h-4 mt-1"}),e.jsxs("span",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:C}),e.jsx("p",{className:"text-xs text-neutral-500 mt-0.5",children:w})]})]},k))})]}),e.jsx("div",{children:e.jsxs("label",{htmlFor:"controls-vehicle-compatible",className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{id:"controls-vehicle-compatible",type:"checkbox",checked:l,onChange:k=>i(k.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-neutral-300 focus:ring-green-500"}),e.jsxs("span",{className:"flex-1",children:["Vehicle Compatible Only",e.jsx("p",{className:"text-xs text-neutral-500 mt-0.5",children:"Show only campsites that can accommodate your vehicle dimensions"})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-neutral-700 mb-2",children:["Maximum Results: ",n]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:25,max:500,step:25,value:n,onChange:k=>r(parseInt(k.target.value)),className:"flex-1 h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer slider"}),e.jsx("select",{value:n,onChange:k=>r(parseInt(k.target.value)),className:"text-xs border border-neutral-300 rounded px-2 py-1 bg-white",children:Er.map(k=>e.jsx("option",{value:k,children:k},k))})]}),e.jsxs("div",{className:"flex justify-between text-xs text-neutral-500 mt-1",children:[e.jsx("span",{children:"25"}),e.jsx("span",{children:"500"})]})]}),e.jsxs("div",{className:"p-3 bg-neutral-50 border border-neutral-200 rounded",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-700 mb-2",children:"Map Legend"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#27ae60",stroke:"#1a8a4b",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Campsite (tent/caravan)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#2794a8",stroke:"#1e7a8d",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Caravan/Motorhome site"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#7c5cbf",stroke:"#6b47b0",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Aire de Service"})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-neutral-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#e63946",stroke:"#d32535",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"May not fit your vehicle"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 text-white text-[8px] font-bold flex items-center justify-center border-2 border-white shadow",children:"3"})}),e.jsx("span",{className:"text-xs text-neutral-700",children:"Clustered markers (zoom in)"})]})]})]})]})]})]})};class Ir{constructor(){Ae(this,"providers",{booking:{id:"booking",name:"Booking.com",description:"World's largest accommodation booking platform",baseUrl:"https://www.booking.com",commissionRate:"3-5%",features:["Instant booking","Free cancellation","Reviews","Mobile app"],searchCapabilities:{locationSearch:!0,campsiteTypeFilter:!0,amenityFilter:!1,availabilityCheck:!0},enabled:!0},eurocampings:{id:"eurocampings",name:"Eurocampings",description:"Europe's largest campsite search and booking platform",baseUrl:"https://www.eurocampings.co.uk",commissionRate:"3%",features:["European focus","Campsite reviews","Detailed filters","Booking integration"],searchCapabilities:{locationSearch:!0,campsiteTypeFilter:!0,amenityFilter:!0,availabilityCheck:!0},enabled:!1},campinginfo:{id:"campinginfo",name:"camping.info",description:"European campsite directory with online booking",baseUrl:"https://www.camping.info",commissionRate:"5.8%",features:["European directory","Online booking","Campsite ratings","Mobile app"],searchCapabilities:{locationSearch:!0,campsiteTypeFilter:!0,amenityFilter:!0,availabilityCheck:!0},enabled:!1}})}getProviders(){return Object.values(this.providers)}getEnabledProviders(){return Object.values(this.providers).filter(t=>t.enabled)}getProvider(t){return this.providers[t]||null}generateBookingLinks(t,a={}){const n=this.getEnabledProviders(),r=[];return n.forEach(l=>{const i=this.generateProviderLink(l,t,a);i&&r.push({provider:l,url:i,searchParams:this.getSearchParams(l,t,a),description:this.getSearchDescription(l,t,a)})}),r}generateProviderLink(t,a,n={}){if(!t.enabled)return null;const r=this.getAffiliateParams(t.id),l=this.getSearchParams(t,a,n),i={...r,...l},d=new URLSearchParams(i),o=this.getSearchPath(t.id);return`${t.baseUrl}${o}?${d.toString()}`}getAffiliateParams(t){switch(t){case"booking":return{aid:"your_booking_affiliate_id",label:"camper-planner-search",utm_source:"camper-planner",utm_medium:"affiliate"};case"eurocampings":return{utm_source:"camper-planner",utm_medium:"affiliate",utm_campaign:"campsite-search"};case"campinginfo":return{utm_source:"camper-planner",utm_medium:"affiliate",utm_campaign:"campsite-search"};default:return{}}}getSearchParams(t,a,n){const r={};switch(r.lat=a.lat.toString(),r.lng=a.lng.toString(),t.id){case"booking":a.name?r.ss=a.name:a.address&&(r.ss=a.address),r.accommodation_type="camping",r.latitude=a.lat.toString(),r.longitude=a.lng.toString(),n.checkIn&&(r.checkin=n.checkIn.toISOString().split("T")[0]),n.checkOut&&(r.checkout=n.checkOut.toISOString().split("T")[0]),n.guests&&(r.group_adults=n.guests.toString());break;case"eurocampings":a.name?r.q=a.name:a.address&&(r.q=a.address),n.checkIn&&(r.arrival=n.checkIn.toISOString().split("T")[0]),n.checkOut&&(r.departure=n.checkOut.toISOString().split("T")[0]);break;case"campinginfo":a.name?r.q=a.name:a.address&&(r.q=a.address),n.checkIn&&(r.dateFrom=n.checkIn.toISOString().split("T")[0]),n.checkOut&&(r.dateTo=n.checkOut.toISOString().split("T")[0]);break}return r}getSearchPath(t){switch(t){case"booking":return"/searchresults.html";case"eurocampings":return"/search";case"campinginfo":return"/en/search";default:return"/search"}}getSearchDescription(t,a,n){const r=a.name||a.address||"this location",l=n.checkIn&&n.checkOut?` for ${n.checkIn.toLocaleDateString()} - ${n.checkOut.toLocaleDateString()}`:"";return`Search ${t.name} for camping near ${r}${l}`}getProviderStats(){return{totalProviders:Object.keys(this.providers).length,enabledProviders:this.getEnabledProviders().length,coverageByRegion:{europe:["booking","eurocampings","campinginfo"],worldwide:["booking"],specialist:["eurocampings","campinginfo"]},features:{instantBooking:this.getProvidersByFeature("Instant booking"),freeCancellation:this.getProvidersByFeature("Free cancellation"),mobileApp:this.getProvidersByFeature("Mobile app"),europeanFocus:this.getProvidersByFeature("European focus")}}}getProvidersByFeature(t){return Object.values(this.providers).filter(a=>a.features.includes(t)).map(a=>a.name)}async validateBookingLink(t){try{new URL(t);const a=["booking.com","eurocampings.co.uk","camping.info"],n=new URL(t).hostname.replace("www.","");return a.includes(n)}catch{return!1}}trackBookingClick(t,a){}}const ms=new Ir,hs={electricity:{icon:nt,label:"Power"},wifi:{icon:$s,label:"WiFi"},showers:{icon:Ls,label:"Showers"},toilets:{icon:ks,label:"Toilets"},drinking_water:{icon:Ts,label:"Water"},waste_disposal:{icon:st,label:"Waste"},laundry:{icon:As,label:"Laundry"},restaurant:{icon:Ot,label:"Food"},shop:{icon:Ps,label:"Shop"},playground:{icon:Ns,label:"Kids"},swimming_pool:{icon:zs,label:"Pool"},pet_allowed:{icon:Ms,label:"Pets OK"}},Rr=["electricity","showers","wifi","toilets","drinking_water","waste_disposal","shop","restaurant"],Ar=({campsite:s,onClose:t,onAddAsWaypoint:a,onExportData:n,className:r})=>{const[l,i]=c.useState(!1),[d,o]=c.useState(!1),g=c.useRef(null),{addWaypoint:h,waypoints:m}=ce(),{profile:u}=he(),{addNotification:v}=me(),{trackFeature:N}=$t();c.useEffect(()=>{N("campsite_details","viewed")},[s.id,N]);const S=m.some(p=>Math.abs(p.lat-s.lat)<1e-4&&Math.abs(p.lng-s.lng)<1e-4),k=c.useCallback(()=>{if(S){v({type:"warning",message:"This campsite is already in your route"});return}const p={id:`campsite_${s.id}`,lat:s.lat,lng:s.lng,name:s.name||`${s.type} #${s.id}`,type:"waypoint"};h(p),a?.(s),v({type:"success",message:`Added ${p.name} to your route`})},[s,S,h,a,v]),C=c.useCallback(()=>{s.contact?.website?window.open(s.contact.website,"_blank"):g.current&&g.current.scrollIntoView({behavior:"smooth"})},[s.contact?.website]),x=c.useCallback(()=>{const p=`${s.lat.toFixed(6)}, ${s.lng.toFixed(6)}`;navigator.clipboard.writeText(p),v({type:"success",message:"Coordinates copied to clipboard"})},[s.lat,s.lng,v]),w=c.useCallback(()=>{const p={campsite:{id:s.id,name:s.name,type:s.type,location:{lat:s.lat,lng:s.lng},address:s.address,phone:s.contact?.phone,website:s.contact?.website,email:s.contact?.email,openingHours:s.opening_hours,amenities:s.amenities,access:s.access,source:s.source},exportedAt:new Date().toISOString(),exportedBy:"European Camper Trip Planner"},I=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),F=URL.createObjectURL(I),Z=document.createElement("a");Z.href=F,Z.download=`campsite_${s.id}_${s.name?.replace(/[^a-zA-Z0-9]/g,"_")||"unnamed"}.json`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(F),n?.(s),v({type:"success",message:"Campsite data exported successfully"})},[s,n,v]),f=c.useMemo(()=>ms.generateBookingLinks(s),[s]),E=()=>`https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}`,W=s.access&&(s.access.max_height||s.access.max_length||s.access.max_weight),D=u&&W&&(s.access?.max_height&&u.height>s.access.max_height||s.access?.max_length&&u.length>s.access.max_length||s.access?.max_weight&&u.weight>s.access.max_weight),O=s.amenities?Object.entries(s.amenities):[],G=O.filter(([p,I])=>I).map(([p])=>p),K=Rr.filter(p=>s.amenities&&s.amenities[p]),B=typeof window<"u"&&window.innerWidth<640;return e.jsxs("div",{className:L("bg-white shadow-lg border border-neutral-200 overflow-hidden flex flex-col",B?"rounded-t-xl":"rounded-lg",r),children:[B&&e.jsx("div",{className:"flex justify-center py-2 bg-neutral-50",children:e.jsx("div",{className:"w-12 h-1 bg-neutral-300 rounded-full"})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-display font-semibold truncate",children:s.name||`${s.type.replace("_"," ")} #${s.id}`}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1 text-sm text-green-100",children:[e.jsx("span",{className:"capitalize",children:s.type.replace("_"," ")}),e.jsx("span",{className:L("px-2 py-0.5 rounded-full text-xs font-medium",s.access?.motorhome?"bg-green-700 text-green-100":"bg-orange-500 text-white"),children:s.access?.motorhome?"âœ“ Vehicle OK":"âš  Check Size"})]})]}),t&&e.jsx("button",{onClick:t,className:"p-1 hover:bg-green-700 rounded transition-colors ml-2","aria-label":"Close details",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:L("flex items-center gap-2 mt-3",B&&"flex-col w-full"),children:[e.jsx("button",{onClick:k,disabled:S,className:L("flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-colors",B?"w-full":"flex-1",S?"bg-green-700 text-green-300 cursor-default":"bg-white text-green-600 hover:bg-green-50 active:bg-green-100"),children:S?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"In Route"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add to Route"})]})}),e.jsxs("button",{onClick:C,className:L("flex items-center justify-center gap-2 px-4 py-2.5 bg-green-700 text-white rounded-lg font-medium hover:bg-green-800 transition-colors",B?"w-full":"flex-1"),children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Book Now"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[K.length>0&&e.jsx("div",{className:"p-4 border-b border-neutral-100",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:K.slice(0,8).map(p=>{const I=hs[p];return e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-green-50 text-green-800 rounded-lg text-sm",title:I?.label||p,children:[I?.icon?e.jsx(I.icon,{className:"w-4 h-4"}):e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"font-medium",children:I?.label||p.replace(/_/g," ")})]},p)})})}),e.jsxs("div",{className:"p-4 space-y-3 border-b border-neutral-100",children:[s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("svg",{className:"w-5 h-5 text-neutral-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"text-sm text-neutral-700",children:s.address})]}),s.opening_hours&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-neutral-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-neutral-700",children:s.opening_hours})]}),!s.address&&!s.opening_hours&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-neutral-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("span",{className:"text-sm text-neutral-500 italic",children:s.type==="aire"?"Motorhome service area with facilities":s.type==="caravan_site"?"Caravan and motorhome site":"Camping site"})]})]}),W&&e.jsx("div",{className:L("p-4 border-b",D?"bg-red-50 border-red-100":"bg-orange-50 border-orange-100"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:L("w-5 h-5 mt-0.5 flex-shrink-0",D?"text-red-600":"text-orange-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{children:[e.jsx("div",{className:L("text-sm font-medium",D?"text-red-800":"text-orange-800"),children:D?"Vehicle may not fit!":"Size restrictions"}),e.jsxs("div",{className:L("text-sm mt-1 space-y-0.5",D?"text-red-700":"text-orange-700"),children:[s.access?.max_height&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max height: ",s.access.max_height,"m"]}),u&&e.jsxs("span",{className:L("text-xs px-1.5 py-0.5 rounded",u.height>s.access.max_height?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",u.height,"m"]})]}),s.access?.max_length&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max length: ",s.access.max_length,"m"]}),u&&e.jsxs("span",{className:L("text-xs px-1.5 py-0.5 rounded",u.length>s.access.max_length?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",u.length,"m"]})]}),s.access?.max_weight&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max weight: ",s.access.max_weight,"t"]}),u&&e.jsxs("span",{className:L("text-xs px-1.5 py-0.5 rounded",u.weight>s.access.max_weight?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",u.weight,"t"]})]})]})]})]})}),s.access?.motorhome&&u&&!W&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("span",{className:"font-medium",children:"Compatible"}),e.jsxs("span",{className:"text-green-700",children:[" ","with your ",u.height,"m Ã— ",u.length,"m vehicle"]})]})]})}),O.length>0&&e.jsxs("div",{className:"border-b border-neutral-100",children:[e.jsxs("button",{onClick:()=>i(!l),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsxs("span",{className:"text-sm font-medium text-neutral-700",children:["All Amenities (",G.length,"/",O.length," available)"]})]}),e.jsx("svg",{className:L("w-5 h-5 text-neutral-400 transition-transform",l&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&e.jsxs("div",{className:"px-4 pb-4",children:[G.length===0&&e.jsxs("div",{className:"mb-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-700 flex items-start gap-1.5",children:[e.jsx(Bt,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"})," Amenity data not available from OpenStreetMap. Check the campsite website for details."]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:O.map(([p,I])=>{const F=hs[p],Z=I===!0;return e.jsxs("div",{className:L("flex items-center gap-2 p-2 rounded text-sm",Z?"bg-green-50 text-green-800 border border-green-200":"bg-neutral-50 text-neutral-500 border border-neutral-200"),children:[F?.icon?e.jsx(F.icon,{className:"w-4 h-4 flex-shrink-0"}):e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"flex-1 capitalize",children:F?.label||p.replace(/_/g," ")}),Z?e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("span",{className:"w-4 h-4 flex items-center justify-center text-neutral-400 font-medium text-xs",children:"?"})]},p)})})]})]}),(s.contact?.phone||s.contact?.website||s.contact?.email)&&e.jsxs("div",{className:"border-b border-neutral-100",children:[e.jsxs("button",{onClick:()=>o(!d),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:"Contact Details"})]}),e.jsx("svg",{className:L("w-5 h-5 text-neutral-400 transition-transform",d&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d&&e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[s.contact?.phone&&e.jsxs("a",{href:`tel:${s.contact.phone.replace(/[^\d+]/g,"")}`,className:"flex items-center gap-3 text-primary-600 hover:text-primary-800 text-sm",children:[e.jsx(Hn,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:s.contact.phone})]}),s.contact?.email&&e.jsxs("a",{href:`mailto:${s.contact.email}`,className:"flex items-center gap-3 text-primary-600 hover:text-primary-800 text-sm",children:[e.jsx(Fn,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:s.contact.email})]}),s.contact?.website&&e.jsxs("a",{href:s.contact.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 text-primary-600 hover:text-primary-800 text-sm",children:[e.jsx(js,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.contact.website.replace(/^https?:\/\//,"")})]})]})]}),e.jsxs("div",{ref:g,className:"p-4 border-b border-neutral-100",children:[e.jsxs("h3",{className:"text-sm font-medium text-neutral-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Book This Campsite"]}),s.contact?.website&&e.jsxs("a",{href:s.contact.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium mb-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),e.jsx("span",{children:"Visit Official Website"})]}),f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-500 mb-2",children:"Search on booking platforms:"}),f.map(p=>e.jsxs("a",{href:p.url,target:"_blank",rel:"sponsored noopener noreferrer",className:"w-full flex items-center justify-between p-3 border border-primary-200 bg-primary-50 text-primary-800 hover:bg-primary-100 rounded-lg text-sm transition-colors",onClick:()=>{ms.trackBookingClick(p.provider.id,String(s.id)),N("affiliate_link","clicked",{provider:p.provider.id==="booking_com"?"booking":"other"})},children:[e.jsx("span",{children:p.provider.name}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]},p.provider.id)),e.jsx("p",{className:"text-[10px] text-neutral-400 mt-1.5 leading-relaxed",children:"We may earn a small commission from bookings at no extra cost to you."})]}),f.length===0&&!s.contact?.website&&e.jsx("p",{className:"text-sm text-neutral-500 italic",children:"No booking links available. Try searching for this campsite online."}),e.jsxs("div",{className:"mt-4 p-3 bg-primary-50 border border-primary-200 rounded-lg text-xs text-primary-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"Booking Tips:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"Check availability directly with the campsite"}),e.jsx("li",{children:"Book in advance during peak season"}),e.jsx("li",{children:"Confirm vehicle size restrictions"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-neutral-100",children:e.jsxs("a",{href:E(),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),e.jsx("span",{children:"Get Directions in Google Maps"})]})}),e.jsxs("div",{className:"p-4 bg-neutral-50",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-500 mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Data from ",s.source||"OpenStreetMap"]})}),e.jsxs("button",{onClick:x,className:"flex items-center gap-1 text-neutral-400 hover:text-neutral-600 transition-colors",title:"Copy coordinates",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),e.jsx("span",{children:"Copy coords"})]})]}),e.jsxs("button",{onClick:w,className:"w-full flex items-center justify-center gap-2 px-3 py-2 border border-neutral-300 rounded-lg text-sm text-neutral-600 hover:bg-neutral-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"Export Campsite Data"})]})]})]})]})};class De extends c.Component{constructor(a){super(a);Ae(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,n){console.error("Component Error Boundary caught an error:",{component:this.props.componentName||"Unknown",error:a.message,stack:a.stack,componentStack:n.componentStack}),this.setState({error:a,errorInfo:n}),this.props.onError&&this.props.onError(a,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 m-2",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Component Error"}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsxs("p",{children:[this.props.componentName?`The ${this.props.componentName} component`:"A component"," ","encountered an error and couldn't render properly."]}),!1]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:this.handleRetry,className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors",children:"Try Again"})})]})]})}):this.props.children}}const Pr=({map:s,visibleTypes:t,onCampsiteSelect:a,onCampsiteHover:n,onLocationSelect:r,className:l})=>{const{addWaypoint:i,waypoints:d}=ce(),{profile:o}=he(),{addNotification:g}=me(),{setCenter:h,setZoom:m}=yt(),[u,v]=c.useState(""),[N,S]=c.useState(!1),[k,C]=c.useState([]),[x,w]=c.useState(!1),[f,E]=c.useState(-1),[W,D]=c.useState([]),[O,G]=c.useState(null),K=c.useRef(null),B=c.useRef(null),p=c.useRef("");c.useEffect(()=>{const j=localStorage.getItem("camper-planner-unified-search-history");if(j)try{D(JSON.parse(j))}catch{}},[]);const I=c.useCallback(j=>{if(j.trim().length<2)return;const H=[j,...W.filter(y=>y!==j)].slice(0,10);D(H),localStorage.setItem("camper-planner-unified-search-history",JSON.stringify(H))},[W]),F=c.useCallback((j,H,y,P)=>{const ae=(y-j)*Math.PI/180,re=(P-H)*Math.PI/180,Q=Math.sin(ae/2)*Math.sin(ae/2)+Math.cos(j*Math.PI/180)*Math.cos(y*Math.PI/180)*Math.sin(re/2)*Math.sin(re/2);return 6371*(2*Math.atan2(Math.sqrt(Q),Math.sqrt(1-Q)))},[]),Z=c.useCallback(j=>d.some(H=>Math.abs(H.lat-j.lat)<1e-4&&Math.abs(H.lng-j.lng)<1e-4),[d]),Y=c.useCallback(async j=>{if(j.trim().length<2){C([]);return}if(N&&p.current===j.trim())return;p.current=j.trim(),S(!0),G(null);const H=[];let y=s?.getCenter(),P=null;try{let U=[];try{U=await Qe.geocodeLocationMultiple(j,5)}catch(ee){console.error("Geocoding failed:",ee),G("Unable to search locations. Please try again.")}if(U.length>0){const ee=(ne,oe)=>ne>=34&&ne<=72&&oe>=-25&&oe<=45,X=j.toLowerCase().trim(),le=[...U].sort((ne,oe)=>{const pe=(ne.name||"").toLowerCase(),ge=(oe.name||"").toLowerCase(),xe=pe===X?1:0,fe=ge===X?1:0;if(xe!==fe)return fe-xe;const je=pe.startsWith(X)?1:0,be=ge.startsWith(X)?1:0;if(je!==be)return be-je;const we=ee(ne.lat,ne.lng),Re=ee(oe.lat,oe.lng);return we&&!Re?-1:!we&&Re?1:(oe.importance||0)-(ne.importance||0)});le.forEach(ne=>{H.push({type:"location",id:`location-${ne.lat}-${ne.lng}`,name:ne.name||ne.display_name.split(",")[0],description:ne.display_name,lat:ne.lat,lng:ne.lng})}),P=He.latLng(le[0].lat,le[0].lng),y=P}const re={bounds:y?{north:y.lat+1,south:y.lat-1,east:y.lng+1.5,west:y.lng-1.5}:{north:72,south:34,east:45,west:-25},types:t,maxResults:20,includeDetails:!0,vehicleFilter:o||void 0},Q=await Qe.searchCampsites(re);if(Q.status==="success"){const ee=Q.campsites.map(X=>{const le=y?F(y.lat,y.lng,X.lat,X.lng):void 0;return{type:"campsite",id:X.id.toString(),name:X.name||`${X.type.replace("_"," ")} #${X.id}`,description:X.address||X.type.replace("_"," "),lat:X.lat,lng:X.lng,distance:le,campsite:X,vehicleCompatible:X.vehicleCompatible}}).filter(X=>{const le=X.name.toLowerCase().includes(j.toLowerCase())||X.description?.toLowerCase().includes(j.toLowerCase()),ne=X.distance!==void 0&&X.distance<=100;return le||ne}).sort((X,le)=>{const ne=X.name.toLowerCase().includes(j.toLowerCase())?1:0,oe=le.name.toLowerCase().includes(j.toLowerCase())?1:0;return oe!==ne?oe-ne:(X.distance??1/0)-(le.distance??1/0)}).slice(0,10);H.push(...ee)}C(H),w(!0)}catch(U){console.error("Search error:",U),C([])}finally{S(!1)}},[s,t,o,F,N]);c.useEffect(()=>{const j=setTimeout(()=>{u.trim()?Y(u):(C([]),p.current="")},300);return()=>clearTimeout(j)},[u]);const se=c.useCallback(j=>{v(j.target.value),E(-1),w(j.target.value.trim().length>=2)},[]),R=c.useCallback(j=>{if(I(u),w(!1),j.type==="location")h([j.lat,j.lng]),m(10),s&&s.setView([j.lat,j.lng],10,{animate:!0}),r?.({lat:j.lat,lng:j.lng,name:j.name}),g({type:"success",message:`Navigated to ${j.name}`});else if(j.campsite){const H=s?Math.max(s.getZoom(),14):14;h([j.lat,j.lng]),m(H),s&&s.setView([j.lat,j.lng],H,{animate:!0}),a?.(j.campsite)}},[s,u,I,r,a,g,h,m]),$=c.useCallback((j,H)=>{if(H.stopPropagation(),d.some(U=>Math.abs(U.lat-j.lat)<1e-4&&Math.abs(U.lng-j.lng)<1e-4)){g({type:"warning",message:`${j.name} is already in your route`});return}const P={id:`location-${Date.now()}`,lat:j.lat,lng:j.lng,type:"waypoint",name:j.name,notes:j.description||""};i(P),g({type:"success",message:`Added "${j.name}" to your route`}),h([j.lat,j.lng]),m(10),s&&s.setView([j.lat,j.lng],10),w(!1)},[i,g,d,s,h,m]),J=c.useCallback((j,H)=>{if(H.stopPropagation(),!j.campsite)return;if(Z(j.campsite)){g({type:"warning",message:`${j.name} is already in your route`});return}const y={id:`campsite-${j.id}-${Date.now()}`,lat:j.lat,lng:j.lng,type:"campsite",name:j.name,notes:j.description||""};i(y),g({type:"success",message:`Added "${j.name}" to your route`}),w(!1)},[i,g,Z]),M=c.useCallback(j=>{if(!(!x||k.length===0))switch(j.key){case"ArrowDown":j.preventDefault(),E(H=>Math.min(H+1,k.length-1));break;case"ArrowUp":j.preventDefault(),E(H=>Math.max(H-1,-1));break;case"Enter":if(j.preventDefault(),N)return;f>=0&&f<k.length?R(k[f]):k.length>0&&R(k[0]);break;case"Escape":w(!1),E(-1),K.current?.blur();break}},[x,k,f,R,N]),z=c.useCallback(()=>{v(""),C([]),w(!1),E(-1)},[]),q=k.filter(j=>j.type==="location"),T=k.filter(j=>j.type==="campsite");return e.jsxs("div",{className:L("relative",l),children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center bg-white rounded-xl shadow-float border-0 ring-1 ring-black/5 overflow-hidden",children:[e.jsx("div",{className:"pl-4 pr-2 py-3",children:e.jsx("svg",{className:"h-5 w-5 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{ref:K,type:"text",value:u,onChange:se,onKeyDown:M,onFocus:()=>w(u.trim().length>=2||W.length>0),onBlur:()=>setTimeout(()=>w(!1),200),placeholder:"Search for a location or campsite...",className:"flex-1 py-3 pr-4 text-sm bg-transparent border-0 focus:ring-0 focus:outline-none placeholder-neutral-400"}),u&&e.jsx("button",{onClick:z,className:"px-3 py-2 text-neutral-400 hover:text-neutral-600 transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),N&&e.jsx("div",{className:"px-3",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-primary-500 border-t-transparent rounded-full"})})]})}),x&&(k.length>0||W.length>0||O)&&e.jsxs("div",{ref:B,className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-float border-0 ring-1 ring-black/5 z-50 max-h-96 overflow-y-auto",onMouseDown:j=>j.preventDefault(),role:"listbox",tabIndex:-1,children:[O&&e.jsxs("div",{className:"px-4 py-3 bg-amber-50 border-b border-amber-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm text-amber-700",children:O})]}),e.jsx("button",{onClick:()=>{G(null),Y(u)},className:"text-xs text-amber-700 hover:text-amber-900 underline font-medium",children:"Retry"})]}),q.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-neutral-500 bg-neutral-50/80 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),"LOCATIONS"]}),q.map((j,H)=>{const y=d.some(P=>Math.abs(P.lat-j.lat)<1e-4&&Math.abs(P.lng-j.lng)<1e-4);return e.jsxs("div",{className:L("w-full px-4 py-3 flex items-center justify-between hover:bg-neutral-50 transition-all duration-150",f===H&&"bg-primary-50"),children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0 cursor-pointer",onClick:()=>R(j),role:"button",tabIndex:0,onKeyDown:P=>P.key==="Enter"&&R(j),children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900",children:j.name}),e.jsx("div",{className:"text-xs text-neutral-500 truncate",title:j.description,children:j.description||"Go to this location"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2 flex-shrink-0",children:[e.jsx("button",{onClick:P=>{P.stopPropagation(),P.preventDefault(),R(j)},onMouseDown:P=>P.stopPropagation(),className:"px-2 py-1 text-xs text-neutral-500 hover:text-neutral-700 hover:bg-neutral-50 rounded transition-colors",title:"View on map without adding to route",children:"Go"}),y?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded font-medium",children:"In Route"}):e.jsx("button",{onClick:P=>$(j,P),className:"px-2.5 py-1 text-xs bg-primary-600 text-white rounded font-medium hover:bg-primary-700 transition-colors",title:"Add this location to your route",children:"+ Add"})]})]},j.id)})]}),T.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-neutral-500 bg-neutral-50/80 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"CAMPSITES (",T.length,")"]}),T.map((j,H)=>{const y=q.length+H,P=j.campsite&&Z(j.campsite);return e.jsxs("div",{onMouseEnter:()=>n?.(j.id),onMouseLeave:()=>n?.(null),className:L("w-full px-4 py-3 flex items-center justify-between hover:bg-neutral-50 transition-all duration-150",f===y&&"bg-green-50"),role:"option","aria-selected":f===y,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0 cursor-pointer",onClick:()=>R(j),role:"button",tabIndex:0,onKeyDown:U=>U.key==="Enter"&&R(j),children:[e.jsx("div",{className:L("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",j.vehicleCompatible?"bg-green-100":"bg-red-100"),children:e.jsx("svg",{className:L("w-4 h-4",j.vehicleCompatible?"text-green-600":"text-red-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 truncate",children:j.name}),e.jsxs("div",{className:"text-xs text-neutral-500 flex items-center space-x-2",children:[e.jsx("span",{className:"truncate",children:j.description}),j.distance!==void 0&&e.jsxs("span",{className:"flex-shrink-0",children:["â€¢"," ",j.distance<1?`${Math.round(j.distance*1e3)}m`:`${j.distance.toFixed(1)}km`]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2 flex-shrink-0",children:[j.vehicleCompatible?e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"âœ“"}):e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"âš "}),P?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded font-medium",children:"In Route"}):e.jsx("button",{onClick:U=>J(j,U),className:"px-2.5 py-1 text-xs bg-primary-600 text-white rounded font-medium hover:bg-primary-700 transition-colors",title:"Add this location to your route",children:"+ Add"})]})]},j.id)})]}),k.length===0&&u.trim().length>=2&&!N&&e.jsxs("div",{className:"px-4 py-6 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-neutral-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("p",{className:"text-sm text-neutral-500",children:['No results found for "',u,'"']}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"Try a different search term"})]}),u.trim().length<2&&W.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-neutral-500 bg-neutral-50/80 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"RECENT SEARCHES"]}),W.slice(0,5).map(j=>e.jsxs("button",{onClick:()=>v(j),className:"w-full px-4 py-3 text-left flex items-center space-x-3 hover:bg-neutral-50 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-neutral-700",children:j})]},j))]})]})]})},zr=({waypointCount:s,hasCalculatedRoute:t,hasRouteOptimization:a,onToggleTripSettings:n,onToggleTripManager:r,onToggleVehicle:l,onToggleRouteInfo:i,onTogglePlanningTools:d,onToggleCostCalculator:o,onToggleRouteOptimizer:g,onExportRoute:h,onClearRoute:m,onMenuOpen:u,activePanels:v})=>{const[N,S]=c.useState(!1),k=c.useRef(null),C=c.useRef(null),x=Object.values(v).some(Boolean),w=c.useCallback(()=>{S(p=>{const I=!p;return I&&u&&u(),I})},[u]),f=c.useCallback(()=>{S(!1)},[]);c.useEffect(()=>{if(!N)return;const p=I=>{k.current&&!k.current.contains(I.target)&&C.current&&!C.current.contains(I.target)&&f()};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[N,f]),c.useEffect(()=>{if(!N)return;const p=I=>{I.key==="Escape"&&(f(),C.current?.focus())};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[N,f]);const E=c.useCallback(p=>{p(),f()},[f]),W=[{id:"trip-settings",icon:Rs,label:"Trip Settings",onClick:n,visible:!0,activeKey:"tripSettings",activeColor:"border-sky-500",activeBg:"bg-sky-50/50"},{id:"trip-manager",icon:An,label:"Trip Manager",onClick:r,visible:!0,activeKey:"tripManager",activeColor:"border-indigo-500",activeBg:"bg-indigo-50/50"},{id:"vehicle-setup",icon:jt,label:"Vehicle Setup",onClick:l,visible:!0}],D=[{id:"route-info",icon:bs,label:"Route Info",onClick:i,visible:t,activeKey:"routeInfo",activeColor:"border-blue-500",activeBg:"bg-blue-50/50"},{id:"planning-tools",icon:Oe,label:"Planning Tools",onClick:d,visible:s>=2,activeKey:"planningTools",activeColor:"border-violet-500",activeBg:"bg-violet-50/50"},{id:"cost-calculator",icon:Dn,label:"Cost Calculator",onClick:o,visible:s>=2,activeKey:"costCalculator",activeColor:"border-emerald-500",activeBg:"bg-emerald-50/50"},{id:"route-optimizer",icon:nt,label:"Route Optimizer",onClick:g,visible:s>=3&&a,activeKey:"routeOptimizer",activeColor:"border-orange-500",activeBg:"bg-orange-50/50"},{id:"export-route",icon:Wt,label:"Export Route",onClick:h,visible:t}],O=[{id:"clear-route",icon:st,label:"Clear Route",onClick:m,visible:s>0,variant:"danger"}],G=D.filter(p=>p.visible),K=O.filter(p=>p.visible),B=p=>{const I=p.icon,F=p.activeKey?v[p.activeKey]:!1,Z=p.variant==="danger";return e.jsxs("button",{onClick:()=>E(p.onClick),className:L("flex items-center gap-3 px-3 py-2 text-sm cursor-pointer transition-colors w-full text-left",Z?"text-red-600 hover:bg-red-50":"text-neutral-700 hover:bg-neutral-50",F&&p.activeColor&&`border-l-[3px] ${p.activeColor}`,F&&p.activeBg,F&&"pl-[9px]",!F&&"border-l-[3px] border-transparent pl-[9px]"),role:"menuitem",children:[e.jsx(I,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:p.label})]},p.id)};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:C,onClick:w,className:L("w-10 h-10 flex items-center justify-center rounded-lg transition-colors","bg-white/90 backdrop-blur-sm shadow-medium hover:bg-neutral-50",N&&"bg-neutral-100",x&&"ring-2 ring-blue-400 ring-offset-1"),title:"Tools","aria-label":"Tools menu","aria-expanded":N,"aria-haspopup":"menu",children:[e.jsx(gs,{className:"w-4 h-4"}),x&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 bg-blue-500 rounded-full border-2 border-white"})]}),N&&e.jsxs("div",{ref:k,className:"absolute left-12 top-0 z-50 bg-white rounded-lg shadow-lg border border-neutral-200 py-1 min-w-[200px]",role:"menu","aria-label":"Tools",children:[W.map(B),G.length>0&&e.jsx("div",{className:"border-t border-neutral-100 my-1",role:"separator"}),G.map(B),K.length>0&&e.jsx("div",{className:"border-t border-neutral-100 my-1",role:"separator"}),K.map(B)]})]})},$r=({onOpenWizard:s,onSearchFocus:t})=>e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none",children:e.jsxs("div",{className:L("pointer-events-auto","bg-white rounded-xl shadow-lg p-8 max-w-md w-full mx-4","flex flex-col items-center gap-5"),children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-blue-50",children:e.jsx(ye,{className:"w-8 h-8 text-blue-500"})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 text-center",children:"Where are you starting from?"}),e.jsx("p",{className:"text-sm text-neutral-500 text-center",children:"Search for an address, city, or campsite to begin planning your trip"}),e.jsxs("button",{type:"button",onClick:t,className:L("flex items-center gap-2 px-4 py-3","bg-neutral-50 border border-neutral-200 rounded-lg","cursor-pointer hover:border-neutral-300 transition-colors w-full","text-left"),children:[e.jsx(ft,{className:"w-4 h-4 text-neutral-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-neutral-400",children:"Search locations..."})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full text-xs text-neutral-400",children:[e.jsx("div",{className:"flex-1 border-t border-neutral-200"}),e.jsx("span",{children:"or"}),e.jsx("div",{className:"flex-1 border-t border-neutral-200"})]}),e.jsx("button",{type:"button",onClick:s,className:"text-sm text-primary-600 hover:text-primary-700 cursor-pointer text-center",children:"Use the Trip Wizard for a guided setup"}),e.jsx("p",{className:"text-xs text-neutral-400 text-center hidden sm:block",children:"Right-click the map to add a point directly"}),e.jsx("p",{className:"text-xs text-neutral-400 text-center sm:hidden",children:"Long press the map to add a point directly"})]})}),Fr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",Wr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",Br="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg==";He.Icon.Default.mergeOptions({iconUrl:Fr,iconRetinaUrl:Br,shadowUrl:Wr});const Ze={defaultCenter:[54.526,15.2551],defaultZoom:5,minZoom:3,maxZoom:19,maxBounds:[[34,-25],[72,45]]},Or=({onMapMove:s})=>{const t=wt();return fs({moveend:()=>{const a=t.getCenter(),n=t.getZoom();s([a.lat,a.lng],n)},zoomend:()=>{const a=t.getCenter(),n=t.getZoom();s([a.lat,a.lng],n)}}),null},Hr=({onMapReady:s})=>{const t=wt();return c.useEffect(()=>{s(t)},[t,s]),null},_r=()=>{const s=wt(),{center:t,zoom:a}=yt(),n=c.useRef(t),r=c.useRef(a);return c.useEffect(()=>{(t[0]!==n.current[0]||t[1]!==n.current[1])&&(s.setView(t,a),n.current=t)},[t,s,a]),c.useEffect(()=>{a!==r.current&&(s.setZoom(a),r.current=a)},[a,s]),null},Vr=()=>{const{center:s,zoom:t,setCenter:a,setZoom:n}=yt(),{waypoints:r,clearRoute:l,undo:i,redo:d,canUndo:o,canRedo:g,calculatedRoute:h}=ce(),{addNotification:m,openVehicleSidebar:u}=me(),{openWizard:v}=zt(),[N,S]=c.useState(!1),[k,C]=c.useState(!1),[x,w]=c.useState("openstreetmap"),[f,E]=c.useState(!1),[W,D]=c.useState(!0),[O,G]=c.useState(!1),[K,B]=c.useState("info"),p=c.useRef(null),[I,F]=c.useState(null),Z=_=>{F(_),p.current=_},[Y,se]=c.useState(null),[R,$]=c.useState(null),[J,M]=c.useState(!1),[z,q]=c.useState(!1),[T,j]=c.useState(!1),[H,y]=c.useState(!1),[P,U]=c.useState(!1),[ae,re]=c.useState(0),[Q,ee]=c.useState(Pt),[,X]=c.useState([]),[le,ne]=c.useState(!1),[oe,pe]=c.useState(!1),[ge,xe]=c.useState(!1),[fe,je]=c.useState(!1),[be,we]=c.useState(!1),[Re,_e]=c.useState(!1),[de,at]=c.useState(!1);c.useEffect(()=>{const _=Dt.getMapState();_&&(a(_.center),n(_.zoom),_.layerId&&w(_.layerId),_.isFullscreen!==void 0&&E(_.isFullscreen),_.layerControlCollapsed!==void 0&&D(_.layerControlCollapsed))},[a,n]),c.useEffect(()=>{const _=()=>{const ue=document.fullscreenElement!==null;ue!==f&&E(ue)};return document.addEventListener("fullscreenchange",_),()=>document.removeEventListener("fullscreenchange",_)},[f]),c.useEffect(()=>{const _=()=>_e(window.innerWidth<768);return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]);const[rt,ve]=c.useState(null);c.useEffect(()=>{const _=new MutationObserver(()=>{const ue=document.body.getAttribute("data-tour-step");at(!!ue),ve(ue)});return _.observe(document.body,{attributes:!0,attributeFilter:["data-tour-step"]}),at(document.body.hasAttribute("data-tour-step")),ve(document.body.getAttribute("data-tour-step")),()=>_.disconnect()},[]);const Nt=rt!==null&&["add-start","search-destination"].includes(rt),b=c.useCallback(()=>{we(!1),xe(!1),je(!1),pe(!1),G(!1),ne(!1),j(!1),q(!1),M(!1)},[]),A=c.useCallback((_,ue)=>{if(ue)switch(_){case"tripSettings":we(!1);break;case"tripManager":xe(!1);break;case"planningTools":je(!1);break;case"costCalculator":pe(!1);break;case"routeInfo":G(!1);break;case"routeOptimizer":ne(!1);break;case"campsiteControls":M(!1);break;case"campsiteFilter":q(!1);break;case"campsiteDetails":j(!1);break}else switch(b(),_){case"tripSettings":we(!0);break;case"tripManager":xe(!0);break;case"planningTools":je(!0);break;case"costCalculator":pe(!0);break;case"routeInfo":G(!0);break;case"routeOptimizer":ne(!0);break;case"campsiteControls":M(!0);break;case"campsiteFilter":q(!0);break;case"campsiteDetails":j(!0);break}},[b]);c.useEffect(()=>{const _=setTimeout(()=>{N||(console.warn("Map ready timeout - forcing map to be visible"),S(!0))},2e3);return()=>clearTimeout(_)},[N]);const V=c.useCallback((_,ue)=>{re(_),ue&&X(ue)},[]),ie=(_,ue)=>{a(_),n(ue),Dt.saveMapState({center:_,zoom:ue,timestamp:Date.now(),layerId:x,isFullscreen:f,layerControlCollapsed:W})},Ne=async()=>{try{f?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch{m({type:"warning",message:"Fullscreen mode not supported in this browser"})}},Ve=()=>{a(Ze.defaultCenter),n(Ze.defaultZoom),m({type:"info",message:"Map view reset to Europe"})},it=()=>{D(!W)},Vs=_=>{w(_),Dt.saveMapState({center:s,zoom:t,timestamp:Date.now(),layerId:_,isFullscreen:f,layerControlCollapsed:W})},Us=()=>{S(!0)},lt=_=>{se(_),b(),j(!0),y(!1),m({type:"info",message:`Selected ${_.name||_.type}`})},qs=()=>{j(!1),se(null)};return e.jsxs("div",{"data-tour-id":"map-area",className:L("h-full relative transition-all duration-300",f&&"fixed inset-0 z-50 bg-black"),children:[!N&&e.jsx("div",{className:"absolute inset-0 bg-neutral-100 flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-neutral-600",children:"Loading European map..."})]})}),e.jsxs(rn,{ref:p,center:s,zoom:t,minZoom:Ze.minZoom,maxZoom:Ze.maxZoom,maxBounds:Ze.maxBounds,maxBoundsViscosity:1,className:"h-full w-full z-map",zoomControl:!1,whenReady:Us,style:{height:"100%",width:"100%"},children:[e.jsx($a,{currentLayerId:x,onLayerChange:Vs,collapsed:W,onToggleCollapse:it}),e.jsx(Or,{onMapMove:ie}),e.jsx(_r,{}),e.jsx(Hr,{onMapReady:Z}),e.jsx(za,{}),e.jsx(Dr,{visibleTypes:Q.visibleTypes,maxResults:Q.maxResults,vehicleCompatibleOnly:Q.vehicleCompatibleOnly,searchQuery:"",isVisible:P,onCampsiteClick:lt,onCampsitesLoaded:V,isMobile:Re,filterState:z?Q:void 0,highlightedCampsiteId:R,selectedCampsiteId:Y?.id?.toString()||null})]}),(!de||Nt)&&e.jsx("div",{"data-tour-id":"search-bar",className:"absolute top-2 md:top-4 left-1/2 transform -translate-x-1/2 z-30 w-full max-w-[calc(100%-1.5rem)] md:max-w-md px-2 md:px-4",children:e.jsx(De,{componentName:"UnifiedSearch",children:e.jsx(Pr,{map:I,visibleTypes:Q.visibleTypes,onCampsiteSelect:lt,onCampsiteHover:$,onLocationSelect:_=>{m({type:"info",message:`Navigated to ${_.name}`})}})})}),e.jsx(De,{componentName:"VehicleProfileSidebar",children:e.jsx(Za,{})}),!de&&r.length>=1&&e.jsx("div",{className:"absolute top-4 right-14 z-20 w-64 hidden lg:block",children:e.jsx(De,{componentName:"RouteCalculator",children:e.jsx(Ka,{})})}),J&&!z&&!de&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 left-[60px] z-20 w-72 hidden md:block",children:e.jsx(De,{componentName:"CampsiteControls",children:e.jsx(ds,{visibleTypes:Q.visibleTypes,onTypesChange:_=>ee({...Q,visibleTypes:_}),maxResults:Q.maxResults,onMaxResultsChange:_=>ee({...Q,maxResults:_}),vehicleCompatibleOnly:Q.vehicleCompatibleOnly,onVehicleCompatibleChange:_=>ee({...Q,vehicleCompatibleOnly:_}),isVisible:P,onVisibilityChange:U,campsiteCount:ae})})}),e.jsxs("div",{className:"fixed inset-y-0 right-0 z-40 w-full bg-white border-l border-neutral-200 shadow-xl md:hidden overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-green-50 sticky top-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Campsite Settings"}),e.jsx("button",{onClick:()=>M(!1),className:"p-1.5 hover:bg-green-200 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4",children:e.jsx(De,{componentName:"CampsiteControls",children:e.jsx(ds,{visibleTypes:Q.visibleTypes,onTypesChange:_=>ee({...Q,visibleTypes:_}),maxResults:Q.maxResults,onMaxResultsChange:_=>ee({...Q,maxResults:_}),vehicleCompatibleOnly:Q.vehicleCompatibleOnly,onVehicleCompatibleChange:_=>ee({...Q,vehicleCompatibleOnly:_}),isVisible:P,onVisibilityChange:U,campsiteCount:ae})})})]})]}),z&&!de&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 left-[60px] z-20 w-80 hidden md:block",children:e.jsx(De,{componentName:"CampsiteFilter",children:e.jsx(ls,{filterState:Q,onFilterChange:ee,onSearchChange:_=>ee({...Q,searchQuery:_}),onCampsiteSelect:lt,campsiteCount:ae})})}),e.jsxs("div",{className:"fixed inset-y-0 right-0 z-40 w-full bg-white border-l border-neutral-200 shadow-xl md:hidden overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-green-50 sticky top-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Campsite Filters"}),e.jsx("button",{onClick:()=>q(!1),className:"p-1.5 hover:bg-green-200 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4",children:e.jsx(De,{componentName:"CampsiteFilter",children:e.jsx(ls,{filterState:Q,onFilterChange:ee,onSearchChange:_=>ee({...Q,searchQuery:_}),onCampsiteSelect:lt,campsiteCount:ae})})})]})]}),h?.restrictions?.violatedDimensions?.length&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 w-96 max-w-full",children:e.jsx(Xa,{restrictions:h.restrictions,className:"shadow-xl"})}),e.jsx(Ba,{map:p.current,isFullscreen:f,onToggleFullscreen:Ne,onResetView:Ve,onToggleLayerControl:it,layerControlCollapsed:W}),e.jsx(Oa,{map:p.current,isFullscreen:f,onToggleFullscreen:Ne,onResetView:Ve,onToggleLayerControl:it}),e.jsxs("div",{"data-tour-id":"left-toolbar",className:"absolute top-4 left-4 z-30 flex flex-col space-y-2 hidden sm:flex",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:i,disabled:!o(),className:L("block w-10 h-10 flex items-center justify-center border-b border-neutral-200 transition-colors",o()?"hover:bg-neutral-50 text-neutral-700":"text-neutral-300 cursor-not-allowed"),title:"Undo (Ctrl+Z)","aria-label":"Undo last action",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),e.jsx("button",{onClick:d,disabled:!g(),className:L("block w-10 h-10 flex items-center justify-center transition-colors",g()?"hover:bg-neutral-50 text-neutral-700":"text-neutral-300 cursor-not-allowed"),title:"Redo (Ctrl+Y)","aria-label":"Redo last action",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})})})]}),e.jsx(zr,{waypointCount:r.length,hasCalculatedRoute:!!h,hasRouteOptimization:$e.ROUTE_OPTIMIZATION,onToggleTripSettings:()=>A("tripSettings",be),onToggleTripManager:()=>A("tripManager",ge),onToggleVehicle:()=>{b(),u()},onToggleRouteInfo:()=>A("routeInfo",O),onTogglePlanningTools:()=>A("planningTools",fe),onToggleCostCalculator:()=>A("costCalculator",oe),onToggleRouteOptimizer:()=>A("routeOptimizer",le),onExportRoute:()=>{b(),xe(!0)},onClearRoute:()=>C(!0),onMenuOpen:()=>{M(!1),q(!1)},activePanels:{tripSettings:be,tripManager:ge,routeInfo:O,planningTools:fe,costCalculator:oe,routeOptimizer:le}}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{"data-tour-id":"campsite-toggle",onClick:()=>{P?(M(!1),q(!1),U(!1)):(b(),M(!0),U(!0))},className:L("w-10 h-10 flex items-center justify-center rounded-lg shadow-md transition-colors",P?"bg-green-600 text-white hover:bg-green-700":"bg-white text-neutral-700 hover:bg-neutral-50"),title:P?"Hide campsites":"Show campsites","aria-label":"Toggle campsites",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),P&&e.jsx("button",{onClick:()=>q(!z),className:L("w-7 h-7 flex items-center justify-center rounded-md shadow-sm transition-colors",z?"bg-green-100 text-green-700":"bg-white text-neutral-500 hover:text-neutral-700"),title:"Campsite filters","aria-label":"Toggle campsite filters",children:e.jsxs("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.573-1.066z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),!de&&e.jsx("div",{className:"absolute bottom-4 left-4 z-30 hidden sm:block",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg shadow-sm px-3 py-1.5 text-xs text-neutral-500 animate-fade-in",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-primary-600 font-medium",children:[r.length," waypoint",r.length!==1?"s":""]}),r.length===0&&e.jsx("span",{className:"text-neutral-400",children:"Right-click map to add"}),r.length===1&&e.jsx("span",{className:"text-orange-500",children:"Add 1 more for routing"}),r.length>=2&&e.jsx("span",{className:"text-green-600",children:"âœ“ Ready"})]})})}),!de&&r.length===0&&e.jsx($r,{onOpenWizard:()=>{b(),v()},onSearchFocus:()=>{document.querySelector('[data-tour-id="search-bar"] input')?.focus()}}),e.jsx(St,{nudgeId:"first-waypoint",message:"Add a second stop to calculate your route â€” search above or toggle campsites to browse.",show:!de&&r.length===1}),e.jsx(St,{nudgeId:"route-ready",message:"Your route is ready! Open the Tools menu for vehicle setup, cost estimates, and daily stages.",show:!de&&r.length>=2&&!!h}),e.jsx(St,{nudgeId:"campsites-on",message:"Zoom in to see individual campsites. Click any marker for details.",show:!de&&(J||z)}),!de&&e.jsx(Va,{waypointCount:r.length,calculatedRoute:h,campsitesVisible:P,showCampsiteControls:J,showCampsiteFilter:z,showRouteInfo:O,showTripManager:ge,showPlanningTools:fe,showCostCalculator:oe,showTripSettings:be,onToggleTripSettings:()=>A("tripSettings",be),onToggleCampsiteControls:()=>{!J&&!z?(b(),M(!0)):J?(M(!1),q(!0)):q(!1)},onToggleRouteInfo:()=>A("routeInfo",O),onToggleTripManager:()=>A("tripManager",ge),onTogglePlanningTools:()=>A("planningTools",fe),onToggleCostCalculator:()=>A("costCalculator",oe),onOpenVehicleSidebar:()=>{b(),u()},onClearWaypoints:()=>C(!0)}),O&&$e.BASIC_ROUTING&&h&&!T&&!H&&e.jsxs("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-neutral-200 shadow-xl transform transition-transform sm:translate-x-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-neutral-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-neutral-900",children:"Route Details"}),h.alternativeRoutes&&h.alternativeRoutes.length>0&&e.jsxs("span",{className:"bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded-full",children:["+",h.alternativeRoutes.length," alternatives"]})]}),e.jsx("button",{onClick:()=>G(!1),className:"p-1 hover:bg-neutral-200 rounded transition-colors","aria-label":"Close route information",children:e.jsx("svg",{className:"w-5 h-5 text-neutral-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h.alternativeRoutes&&h.alternativeRoutes.length>0&&e.jsxs("div",{className:"flex border-b border-neutral-200 bg-neutral-50",children:[e.jsx("button",{onClick:()=>B("info"),className:L("flex-1 py-3 px-4 text-sm font-medium transition-colors",K==="info"?"text-primary-600 border-b-2 border-primary-600 bg-white":"text-neutral-500 hover:text-neutral-700"),children:"Route Info"}),e.jsx("button",{onClick:()=>B("comparison"),className:L("flex-1 py-3 px-4 text-sm font-medium transition-colors",K==="comparison"?"text-primary-600 border-b-2 border-primary-600 bg-white":"text-neutral-500 hover:text-neutral-700"),children:"Compare Routes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[K==="info"&&e.jsx(tr,{className:"border-0 rounded-none"}),K==="comparison"&&e.jsx(sr,{className:"border-0 rounded-none"})]})]}),T&&Y&&$e.CAMPSITE_DISPLAY&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-neutral-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsx(Ar,{campsite:Y,onClose:qs,className:"h-full border-0 rounded-none"})}),le&&$e.ROUTE_OPTIMIZATION&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-neutral-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-orange-50",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-neutral-900",children:"Route Optimizer"}),e.jsx("button",{onClick:()=>ne(!1),className:"p-1 hover:bg-orange-200 rounded transition-colors","aria-label":"Close optimizer",children:e.jsx("svg",{className:"w-5 h-5 text-neutral-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ar,{className:"h-full border-0 rounded-none",onOptimizationComplete:_=>{},onWaypointInsert:_=>{}})})]})}),oe&&e.jsx("div",{className:"map-panel-right fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-neutral-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-emerald-50",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-neutral-900",children:"Trip Cost Calculator"}),e.jsx("button",{onClick:()=>pe(!1),className:"p-1 hover:bg-emerald-200 rounded transition-colors","aria-label":"Close cost calculator",children:e.jsx("svg",{className:"w-5 h-5 text-neutral-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(mr,{className:"h-full border-0 rounded-none",onCostUpdate:_=>{}})})]})}),ge&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-neutral-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-indigo-50",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-neutral-900",children:"Trip Manager"}),e.jsx("button",{onClick:()=>xe(!1),className:"p-1 hover:bg-indigo-200 rounded transition-colors","aria-label":"Close trip manager",children:e.jsx("svg",{className:"w-5 h-5 text-neutral-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(va,{className:"h-full border-0 rounded-none",onTripLoad:_=>{xe(!1)},onClose:()=>xe(!1)})})]})}),fe&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-neutral-200 shadow-xl transform transition-transform sm:translate-x-0","data-tour-id":"planning-tools-panel",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-violet-50",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-neutral-900",children:"Trip Plan"}),e.jsx("button",{onClick:()=>je(!1),className:"p-1 hover:bg-violet-200 rounded transition-colors","aria-label":"Close trip plan",children:e.jsx("svg",{className:"w-5 h-5 text-neutral-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ya,{className:"h-full border-0 rounded-none",onPlanUpdate:_=>{}})})]})}),be&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-neutral-200 shadow-xl transform transition-transform sm:translate-x-0","data-tour-id":"trip-settings-panel",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 bg-sky-50",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-neutral-900",children:"Trip Settings"}),e.jsx("button",{onClick:()=>we(!1),className:"p-1 hover:bg-sky-200 rounded transition-colors","aria-label":"Close trip settings",children:e.jsx("svg",{className:"w-5 h-5 text-neutral-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(yr,{})})]})}),e.jsx(Fs,{isOpen:k,title:"Clear All Waypoints",message:`Are you sure you want to remove all ${r.length} waypoints? This action can be undone with Ctrl+Z.`,confirmLabel:"Clear All",confirmVariant:"danger",onConfirm:()=>{l(),m({type:"success",message:"All waypoints cleared"}),C(!1)},onCancel:()=>C(!1)})]})},Ur=Ft.lazy(()=>nn(()=>import("./TripWizard-4lcsCykp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),us="planner-hero-dismissed",qr=({onDismiss:s})=>e.jsx("div",{className:"relative overflow-hidden bg-gradient-to-r from-primary-800 to-primary-700",children:e.jsx("div",{className:"relative px-4 sm:px-6 py-2.5",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0",children:[e.jsx("h2",{className:"text-sm sm:text-base font-display font-bold text-white whitespace-nowrap",children:"Plan Your European Camper Adventure"}),e.jsx("div",{className:"hidden sm:flex items-center gap-2",children:[{icon:ye,label:"Vehicle-Safe Routing"},{icon:Ie,label:"Campsite Finder"},{icon:Wt,label:"GPX Export"}].map(({icon:t,label:a})=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-white/15 text-white/90 text-xs font-medium rounded-full",children:[e.jsx(t,{className:"w-3 h-3"}),a]},a))})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs(an,{to:"/guides",className:"hidden md:inline-flex items-center gap-1 text-xs text-primary-200 hover:text-white transition-colors",children:[e.jsx(sn,{className:"w-3.5 h-3.5"}),"Travel guides"]}),e.jsx("button",{onClick:s,className:"p-1 text-white/60 hover:text-white hover:bg-white/10 rounded transition-colors","aria-label":"Dismiss welcome banner",children:e.jsx(Je,{className:"w-4 h-4"})})]})]})})}),Gr=()=>{const{openWizard:s,wizardOpen:t}=zt(),{waypoints:a,calculatedRoute:n}=ce(),{showOnboarding:r}=tn(),{trackFeature:l}=$t(),i=a.length>0,d=c.useRef(n);c.useEffect(()=>{if(n&&n!==d.current){const u=n.routes?.[0];u&&l("route_calculation","completed",{waypoints:a.length,distance:u.summary?.distance?Math.round(u.summary.distance/1e3):0})}d.current=n},[n,a.length,l]);const[o,g]=c.useState(()=>!localStorage.getItem(us)),h=()=>{g(!1),localStorage.setItem(us,"1")},m=o&&!r&&!i;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx(dn,{title:"Plan Your European Camper Trip â€” Free Route Planner",description:"Interactive route planner with vehicle-safe routing, campsite discovery, and GPX export for 40+ European countries. Free, no account required.",url:"https://camperplanning.com/"}),m&&e.jsx(qr,{onDismiss:h}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Vr,{}),i&&!t&&!r&&e.jsxs("button",{"data-tour-id":"plan-trip-float",onClick:s,className:"absolute z-[1000] bottom-14 left-4 sm:bottom-4 sm:right-4 sm:left-auto flex items-center gap-2 px-4 py-2.5 bg-white text-accent-600 rounded-xl hover:bg-accent-50 text-sm font-semibold shadow-medium ring-1 ring-black/5 transition-all",children:[e.jsx(ut,{className:"w-4 h-4"}),"Continue Planning"]})]}),t&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(Ur,{})})]})},hi=Object.freeze(Object.defineProperty({__proto__:null,default:Gr},Symbol.toStringTag,{value:"Module"}));export{vn as C,hi as P,Jn as S,Gn as a,ma as b,mi as g,bt as i,ha as n};
