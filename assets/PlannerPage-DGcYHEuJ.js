var Qt=Object.defineProperty;var es=(n,s,a)=>s in n?Qt(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a;var ce=(n,s,a)=>es(n,typeof s!="symbol"?s+"":s,a);import{c as S,j as e,u as ne,a as ie,b as Ft,d as oe,e as yt,g as ts,f as ss,V as st,M as je,r as as,R as ns,h as Nt,i as rs,k as is,D as os,A as ls,l as cs}from"./index-Dwv01dMo.js";import{R as Ot,a as d}from"./react-vendor-DB9SfNWA.js";import{P as ht,M as ke,a as $e,L as _e,u as Wt,T as wt,l as Ce,b as Qe,c as ds}from"./map-vendor-D1_z6wB-.js";import"./state-vendor--7Lts539.js";const pe={BASIC_ROUTING:!0,CAMPSITE_DISPLAY:!0,ROUTE_OPTIMIZATION:!0},Vt=({isOpen:n,title:s,message:a,confirmLabel:t="Confirm",cancelLabel:r="Cancel",confirmVariant:i="primary",onConfirm:o,onCancel:c})=>{if(Ot.useEffect(()=>{if(!n)return;const m=h=>{h.key==="Escape"?c():h.key==="Enter"&&o()};return document.addEventListener("keydown",m),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",m),document.body.style.overflow="auto"}},[n,c,o]),!n)return null;const l=S("px-4 py-2 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",{"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500":i==="danger","bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":i==="primary","bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500":i==="warning"});return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:c}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors","aria-label":"Close dialog",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:a})}),e.jsxs("div",{className:"flex space-x-3 justify-end",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:r}),e.jsx("button",{onClick:o,className:l,children:t})]})]})})]})},ms=({isOpen:n,position:s,items:a,onClose:t})=>{const r=d.useRef(null);return d.useEffect(()=>{if(!n)return;const i=c=>{r.current&&!r.current.contains(c.target)&&t()},o=c=>{c.key==="Escape"&&t()};return document.addEventListener("mousedown",i),document.addEventListener("keydown",o),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("keydown",o)}},[n,t]),d.useEffect(()=>{if(!n||!r.current)return;const i=r.current,o=i.getBoundingClientRect(),c={width:window.innerWidth,height:window.innerHeight};let{x:l,y:m}=s;l+o.width>c.width&&(l=c.width-o.width-10),m+o.height>c.height&&(m=c.height-o.height-10),i.style.left=`${Math.max(10,l)}px`,i.style.top=`${Math.max(10,m)}px`},[n,s]),n?e.jsx("div",{ref:r,className:"fixed z-50 min-w-48 bg-white border border-gray-200 rounded-lg shadow-lg py-2 animate-fade-in",style:{left:s.x,top:s.y},children:a.map(i=>{const o=S("flex items-center justify-between px-4 py-2 text-sm cursor-pointer transition-colors",{"text-gray-700 hover:bg-gray-50":i.variant==="default"||!i.variant,"text-red-600 hover:bg-red-50":i.variant==="danger","text-blue-600 hover:bg-blue-50":i.variant==="primary","text-gray-400 cursor-not-allowed":i.disabled});return e.jsxs("button",{className:o,onClick:()=>{i.disabled||(i.onClick(),t())},disabled:i.disabled,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i.icon&&e.jsx("span",{className:"flex-shrink-0",children:i.icon}),e.jsx("span",{children:i.label})]}),i.shortcut&&e.jsx("span",{className:"text-xs text-gray-400 ml-4",children:i.shortcut})]},i.id)})}):null},hs={petrol:1.65,diesel:1.55,lpg:.85,electricity:.35},kt={motorhome:{small:{petrol:12,diesel:10,lpg:14},medium:{petrol:15,diesel:12,lpg:17},large:{petrol:18,diesel:15,lpg:20}},caravan:{small:{petrol:10,diesel:8,lpg:12},medium:{petrol:13,diesel:10,lpg:15},large:{petrol:16,diesel:13,lpg:18}},campervan:{small:{petrol:9,diesel:7,lpg:11},medium:{petrol:11,diesel:9,lpg:13},large:{petrol:14,diesel:11,lpg:16}}};class Ge{static initializeSettings(s,a){this.fuelConsumptionSettings=s,this.fuelPriceSettings=a}static getDefaultConsumption(s){const a=s.type,t=this.determineVehicleSize(s);return{consumptionType:"l_per_100km",consumption:kt[a]?.[t]?.diesel||12,fuelType:"diesel",tankCapacity:80}}static getCurrentFuelPrices(){return this.fuelPriceSettings?.priceType==="manual"&&this.fuelPriceSettings.manualPrices?this.fuelPriceSettings.manualPrices:hs}static async calculateRouteCosts(s,a,t,r){if(s.length<2)return this.createEmptyCostBreakdown();const i=t||this.fuelConsumptionSettings||(a?this.getDefaultConsumption(a):{consumptionType:"l_per_100km",consumption:12,fuelType:"diesel"}),o=r||this.fuelPriceSettings||{priceType:"default_european",currency:"EUR"},c=await this.calculateRouteSegments(s,i,o),l=this.calculateDailyBreakdown(c),m=c.reduce((g,b)=>g+b.fuelCost,0),h=c.reduce((g,b)=>g+(b.tollCost||0),0),u=c.reduce((g,b)=>g+(b.accommodationCost||0),0);return{totalCost:m+h+u,fuelCost:m,tollCost:h,accommodationCost:u,otherCosts:0,currency:o.currency,segments:c,dailyBreakdown:l}}static async calculateCostOptimizations(s,a){const t=[];if(a){const o=this.fuelConsumptionSettings?.consumption||12,c=this.getOptimalConsumption(a);if(o>c*1.1){const l=this.calculateFuelEfficiencySaving(s.fuelCost,o,c);t.push({type:"fuel_efficiency",description:"Improve fuel efficiency through eco-driving techniques",potentialSaving:l,actionRequired:"Maintain steady speeds, avoid rapid acceleration, plan efficient routes"})}}const r=s.fuelCost*.05;t.push({type:"route_alternative",description:"Consider alternative routes to reduce fuel consumption",potentialSaving:r,actionRequired:"Use route optimization with fuel efficiency priority"}),s.segments.length>3&&t.push({type:"fuel_stop",description:"Optimize fuel stops at cheaper stations",potentialSaving:s.fuelCost*.03,actionRequired:"Plan fuel stops at hypermarkets or discount stations"});const i=t.reduce((o,c)=>o+c.potentialSaving,0);return{currentCost:s.totalCost,optimizedCost:s.totalCost-i,savings:i,suggestions:t.sort((o,c)=>c.potentialSaving-o.potentialSaving)}}static convertConsumption(s,a,t){let r;switch(a){case"l_per_100km":r=s;break;case"mpg_imperial":r=282.481/s;break;case"mpg_us":r=235.215/s;break}switch(t){case"l_per_100km":return r;case"mpg_imperial":return 282.481/r;case"mpg_us":return 235.215/r}}static calculateFuelCost(s,a,t){const r=this.convertConsumption(a.consumption,a.consumptionType,"l_per_100km"),i=s/100*r,c=this.getCurrentFuelPrices()[a.fuelType];return i*c}static async calculateRouteSegments(s,a,t){const r=[];for(let i=0;i<s.length-1;i++){const o=s[i],c=s[i+1],l=this.calculateDistance(o,c),m=this.estimateDrivingTime(l),h=this.calculateFuelCost(l,a,t);let u="driving",g=0;c.type==="campsite"||c.type==="accommodation"?(u="overnight",g=this.estimateAccommodationCost(c)):i>0&&l<50&&(u="stop"),r.push({startWaypoint:o,endWaypoint:c,distance:l,duration:m,fuelCost:h,accommodationCost:g,segmentType:u,tollCost:0})}return r}static calculateDailyBreakdown(s){const a=[];let t=new Date,r=0,i=0,o=0;return s.forEach((c,l)=>{r+=c.distance,i+=c.fuelCost,(c.segmentType==="overnight"||l===s.length-1)&&(o+=c.accommodationCost||0,a.push({date:new Date(t),distance:r,fuelCost:i,accommodationCost:o,totalDailyCost:i+o}),t=new Date(t.getTime()+1440*60*1e3),r=0,i=0,o=0)}),a}static createEmptyCostBreakdown(){return{totalCost:0,fuelCost:0,tollCost:0,accommodationCost:0,otherCosts:0,currency:"EUR",segments:[],dailyBreakdown:[]}}static determineVehicleSize(s){const a=s.length||6;return a<6?"small":a<8?"medium":"large"}static getOptimalConsumption(s){const a=s.type,t=this.determineVehicleSize(s);return kt[a]?.[t]?.diesel||12}static calculateFuelEfficiencySaving(s,a,t){const r=(a-t)/a;return s*r}static calculateDistance(s,a){const r=(a.lat-s.lat)*Math.PI/180,i=(a.lng-s.lng)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(s.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}static estimateDrivingTime(s){return s/70*60}static estimateAccommodationCost(s){switch(s.type){case"campsite":return 25;case"accommodation":return 80;default:return 0}}}ce(Ge,"fuelConsumptionSettings",null),ce(Ge,"fuelPriceSettings",null);const us=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),xs=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,a,t)=>t?t.toUpperCase():a.toLowerCase()),Ct=n=>{const s=xs(n);return s.charAt(0).toUpperCase()+s.slice(1)},Ht=(...n)=>n.filter((s,a,t)=>!!s&&s.trim()!==""&&t.indexOf(s)===a).join(" ").trim(),ps=n=>{for(const s in n)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};var gs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const fs=d.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:a=2,absoluteStrokeWidth:t,className:r="",children:i,iconNode:o,...c},l)=>d.createElement("svg",{ref:l,...gs,width:s,height:s,stroke:n,strokeWidth:t?Number(a)*24/Number(s):a,className:Ht("lucide",r),...!i&&!ps(c)&&{"aria-hidden":"true"},...c},[...o.map(([m,h])=>d.createElement(m,h)),...Array.isArray(i)?i:[i]]));const X=(n,s)=>{const a=d.forwardRef(({className:t,...r},i)=>d.createElement(fs,{ref:i,iconNode:s,className:Ht(`lucide-${us(Ct(n))}`,`lucide-${n}`,t),...r}));return a.displayName=Ct(n),a};const bs=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],Mt=X("bed",bs);const ys=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],vs=X("briefcase",ys);const js=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],at=X("calculator",js);const Ns=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Pe=X("calendar",Ns);const ws=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ks=X("camera",ws);const Cs=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],Ut=X("car",Cs);const Ms=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],qt=X("chart-column",Ms);const Ss=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ls=X("chevron-down",Ss);const Ds=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ts=X("chevron-up",Ds);const Es=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Oe=X("circle-check-big",Es);const Is=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ze=X("clock",Is);const As=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Rs=X("cloud",As);const zs=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],$s=X("coffee",zs);const Ps=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],_s=X("copy",Ps);const Bs=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Fs=X("download",Bs);const Os=[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]],ut=X("euro",Os);const Ws=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Vs=X("external-link",Ws);const Hs=[["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 4 0v-6.998a2 2 0 0 0-.59-1.42L18 5",key:"1wtuz0"}],["path",{d:"M14 21V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16",key:"e09ifn"}],["path",{d:"M2 21h13",key:"1x0fut"}],["path",{d:"M3 9h11",key:"1p7c0w"}]],Zt=X("fuel",Hs);const Us=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],qs=X("globe",Us);const Zs=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Ks=X("heart",Zs);const Gs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Kt=X("info",Gs);const Xs=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Xe=X("map-pin",Xs);const Js=[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]],Ys=X("mountain",Js);const Qs=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],xt=X("navigation",Qs);const ea=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],nt=X("route",ea);const ta=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],St=X("save",ta);const sa=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],aa=X("search",sa);const na=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Gt=X("settings",na);const ra=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Lt=X("star",ra);const ia=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],rt=X("target",ia);const oa=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],Dt=X("thermometer",oa);const la=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ca=X("trash-2",la);const da=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ma=X("trending-down",da);const ha=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],it=X("trending-up",ha);const ua=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ee=X("triangle-alert",ua);const xa=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],pa=X("upload",xa);const ga=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],pt=X("users",ga);const fa=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ot=X("x",fa),lt="camper-planner-trips",ct="camper-planner-trip-history",dt="1.0.0",ba=50;class he{static async saveTrip(s){const a=new Date,t=await this.getAllTrips(),r=t.find(c=>c.metadata.id===s.metadata.id),i={...s,timestamps:{created:r?.timestamps.created||a,modified:a,lastOpened:r?.timestamps.lastOpened||a,version:dt}},o=t.findIndex(c=>c.metadata.id===s.metadata.id);return o>=0?t[o]=i:t.push(i),localStorage.setItem(lt,JSON.stringify(t)),await this.addToHistory(i),i}static async loadTrip(s){const t=(await this.getAllTrips()).find(r=>r.metadata.id===s);return t&&(t.timestamps.lastOpened=new Date,await this.saveTrip(t)),t||null}static async getAllTrips(){try{const s=localStorage.getItem(lt);return s?JSON.parse(s).map(t=>({...t,timestamps:{...t.timestamps,created:new Date(t.timestamps.created),modified:new Date(t.timestamps.modified),lastOpened:new Date(t.timestamps.lastOpened)},data:{...t.data,costCalculations:t.data.costCalculations?{...t.data.costCalculations,lastCalculated:new Date(t.data.costCalculations.lastCalculated)}:void 0,optimization:t.data.optimization?{...t.data.optimization,appliedAt:new Date(t.data.optimization.appliedAt)}:void 0}})):[]}catch(s){return console.error("Failed to load trips:",s),[]}}static async getTripSummaries(s){let t=await this.getAllTrips();return s?.excludeTemplates&&(t=t.filter(r=>!r.metadata.isTemplate)),s?.category&&(t=t.filter(r=>r.metadata.category===s.category)),s?.tags&&s.tags.length>0&&(t=t.filter(r=>s.tags.some(i=>r.metadata.tags.includes(i)))),t.map(r=>({id:r.metadata.id,name:r.metadata.name,category:r.metadata.category,tags:r.metadata.tags,duration:r.metadata.duration,estimatedCost:r.metadata.estimatedCost,currency:r.metadata.currency,waypointCount:r.data.waypoints.length,countries:r.metadata.countries,lastModified:r.timestamps.modified,lastOpened:r.timestamps.lastOpened,isTemplate:r.metadata.isTemplate})).sort((r,i)=>i.lastModified.getTime()-r.lastModified.getTime())}static async deleteTrip(s){try{const a=await this.getAllTrips(),t=a.length,r=a.filter(i=>i.metadata.id!==s);return r.length===t?!1:(localStorage.setItem(lt,JSON.stringify(r)),!0)}catch(a){return console.error("Failed to delete trip:",a),!1}}static async duplicateTrip(s,a){const t=await this.loadTrip(s);if(!t)return null;const r=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={...t,metadata:{...t.metadata,id:r,name:a||`${t.metadata.name} (Copy)`,isTemplate:!1,isPublic:!1}};return await this.saveTrip(i)}static async exportTrip(s){const a=await this.loadTrip(s);if(!a)return null;const t={...a,exportInfo:{exportedAt:new Date,exportedBy:"camper-planner",version:dt,exportId:`export_${Date.now()}`}};return JSON.stringify(t,null,2)}static async importTrip(s,a){try{const t=JSON.parse(s);if(!t.metadata||!t.data)throw new Error("Invalid trip data structure");const r=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={metadata:{...t.metadata,id:r,name:a||`${t.metadata.name} (Imported)`,isTemplate:!1,isPublic:!1},data:t.data,timestamps:{created:new Date,modified:new Date,lastOpened:new Date,version:dt},sharing:{originalTripId:t.metadata.id,sharedBy:t.exportInfo?.exportedBy||"unknown",sharedAt:t.exportInfo?.exportedAt?new Date(t.exportInfo.exportedAt):new Date,exportId:t.exportInfo?.exportId}};return await this.saveTrip(i)}catch(t){return console.error("Failed to import trip:",t),null}}static async getRecentTrips(s=10){return(await this.getTripSummaries({excludeTemplates:!0})).sort((t,r)=>r.lastOpened.getTime()-t.lastOpened.getTime()).slice(0,s)}static async addToHistory(s){try{const a=localStorage.getItem(ct);let t=[];a&&(t=JSON.parse(a).map(r=>({...r,accessedAt:new Date(r.accessedAt)}))),t=t.filter(r=>r.tripId!==s.metadata.id),t.unshift({tripId:s.metadata.id,accessedAt:new Date,tripName:s.metadata.name}),t=t.slice(0,ba),localStorage.setItem(ct,JSON.stringify(t))}catch(a){console.error("Failed to update trip history:",a)}}static async getTripHistory(){try{const s=localStorage.getItem(ct);return s?JSON.parse(s).map(a=>({...a,accessedAt:new Date(a.accessedAt)})):[]}catch(s){return console.error("Failed to load trip history:",s),[]}}static async compareTrips(s){try{const t=(await Promise.all(s.map(l=>this.loadTrip(l)))).filter(l=>l!==null);if(t.length<2)return null;const r={trips:t,comparison:{costs:{},routes:{},analysis:{cheapest:"",shortest:"",fastest:"",mostScenic:"",recommendations:[]}}};let i=1/0,o=1/0,c=1/0;return t.forEach(l=>{const m=l.metadata.id,h=l.data.costCalculations?.breakdown;h&&(r.comparison.costs[m]={total:h.totalCost,fuel:h.fuelCost,accommodation:h.accommodationCost,tolls:h.tollCost},h.totalCost<i&&(i=h.totalCost,r.comparison.analysis.cheapest=m));const u=this.calculateTotalDistance(l.data.waypoints),g=u/70;r.comparison.routes[m]={distance:u,duration:g,waypointCount:l.data.waypoints.length,countries:l.metadata.countries},u<o&&(o=u,r.comparison.analysis.shortest=m),g<c&&(c=g,r.comparison.analysis.fastest=m)}),t.forEach(l=>{const m=l.metadata.id,h=[];m===r.comparison.analysis.cheapest&&h.push({tripId:m,reason:"Most cost-effective option",advantage:`Lowest total cost: â‚¬${r.comparison.costs[m]?.total.toFixed(2)||"N/A"}`}),m===r.comparison.analysis.shortest&&h.push({tripId:m,reason:"Shortest distance",advantage:`Least driving: ${o.toFixed(0)}km`}),(l.metadata.tags.includes("scenic")||l.metadata.tags.includes("nature"))&&(r.comparison.analysis.mostScenic=m,h.push({tripId:m,reason:"Most scenic route",advantage:"Best for sightseeing and photography"})),r.comparison.analysis.recommendations.push(...h)}),r}catch(a){return console.error("Failed to compare trips:",a),null}}static async getTripCategories(){const s=await this.getAllTrips(),a=new Map;return s.forEach(t=>{if(!t.metadata.isTemplate){const r=a.get(t.metadata.category)||0;a.set(t.metadata.category,r+1)}}),Array.from(a.entries()).map(([t,r])=>({category:t,count:r})).sort((t,r)=>r.count-t.count)}static async getAllTags(){const s=await this.getAllTrips(),a=new Map;return s.forEach(t=>{t.metadata.isTemplate||t.metadata.tags.forEach(r=>{const i=a.get(r)||0;a.set(r,i+1)})}),Array.from(a.entries()).map(([t,r])=>({tag:t,count:r})).sort((t,r)=>r.count-t.count)}static async searchTrips(s){const a=await this.getTripSummaries(),t=s.toLowerCase();return a.filter(r=>r.name.toLowerCase().includes(t)||r.tags.some(i=>i.toLowerCase().includes(t))||r.countries.some(i=>i.toLowerCase().includes(t)))}static calculateTotalDistance(s){if(s.length<2)return 0;let a=0;for(let t=0;t<s.length-1;t++)a+=this.calculateDistance(s[t],s[t+1]);return a}static calculateDistance(s,a){const r=(a.lat-s.lat)*Math.PI/180,i=(a.lng-s.lng)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(s.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}}function Ze(n,s,a){if(!n.routes.length)throw new Error("No routes available for export");const t=n.routes[0],r=new Date().toISOString(),i=s.map((u,g)=>({id:u.id,name:u.name||`Waypoint ${g+1}`,description:void 0,lat:u.lat,lng:u.lng,elevation:void 0,type:u.type,order:g})),o=t.geometry.coordinates,c={north:Math.max(...o.map(u=>u[1])),south:Math.min(...o.map(u=>u[1])),east:Math.max(...o.map(u=>u[0])),west:Math.min(...o.map(u=>u[0]))},l=t.segments.map((u,g)=>{const b=[],j=Math.floor(o.length/t.segments.length),C=g*j,N=g===t.segments.length-1?o.length:(g+1)*j;let k=0;for(let w=C;w<N;w++){const D=o[w];if(w>C){const V=o[w-1];k+=ya(V[1],V[0],D[1],D[0])}b.push({lat:D[1],lng:D[0],elevation:D[2],distance:k})}const p=(u.steps||[]).map(w=>({distance:w.distance,duration:w.duration,instruction:w.instruction,streetName:w.name,coordinates:w.wayPoints}));return{points:b,distance:u.distance,duration:u.duration,instructions:p.length>0?p:void 0}}),m={name:a||`Route ${n.id}`,segments:l,totalDistance:t.summary.distance,totalDuration:t.summary.duration,bounds:c},h={creator:"European Camper Trip Planner",version:"1.0.0",timestamp:r,service:n.metadata.service,profile:n.metadata.profile,vehicleProfile:n.metadata.query.vehicleProfile,restrictions:n.restrictions?{violatedDimensions:n.restrictions.violatedDimensions,warnings:n.warnings||[]}:void 0};return{id:n.id,name:a||`European Camper Route - ${new Date().toLocaleDateString()}`,description:`Generated route with ${s.length} waypoints. Distance: ${Math.round(t.summary.distance/1e3)} km, Duration: ${Math.round(t.summary.duration/3600)}h ${Math.round(t.summary.duration%3600/60)}m`,waypoints:i,track:m,metadata:h}}function ya(n,s,a,t){const i=(a-n)*Math.PI/180,o=(t-s)*Math.PI/180,c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function Ke(n){if(!n.id||!n.waypoints.length||!n.track.segments.length)return!1;for(const s of n.waypoints)if(!s.id||!s.name||!Tt(s.lat,s.lng))return!1;for(const s of n.track.segments){if(!s.points.length)return!1;for(const a of s.points)if(!Tt(a.lat,a.lng))return!1}return!0}function Tt(n,s){return n>=-90&&n<=90&&s>=-180&&s<=180}const Et={gpx:{format:"gpx",mimeType:"application/gpx+xml",extension:".gpx",supportsElevation:!0,supportsInstructions:!0},kml:{format:"kml",mimeType:"application/vnd.google-earth.kml+xml",extension:".kml",supportsElevation:!0,supportsInstructions:!1},json:{format:"json",mimeType:"application/json",extension:".json",supportsElevation:!0,supportsInstructions:!0},csv:{format:"csv",mimeType:"text/csv",extension:".csv",supportsElevation:!0,supportsInstructions:!1}};class Xt{static async exportToGPX(s,a,t,r={}){try{const i={...this.DEFAULT_OPTIONS,...r},o=Ze(s,a,t);if(!Ke(o))return{success:!1,error:"Invalid route data for export",format:"gpx"};const c=this.generateGPXContent(o,i),l=this.generateFilename(o.name,"gpx");return{success:!0,data:c,filename:l,format:"gpx",size:new Blob([c]).size}}catch(i){return console.error("GPX export error:",i),{success:!1,error:i instanceof Error?i.message:"Unknown export error",format:"gpx"}}}static generateGPXContent(s,a){const t=this.escapeXML(s.name),r=this.escapeXML(s.description);let i=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="${this.escapeXML(a.creator||"Camper Planner")}"
     xmlns="http://www.topografix.com/GPX/1/1"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
`;return a.includeMetadata&&(i+=`  <metadata>
    <name>${t}</name>
    <desc>${r}</desc>
    <author>
      <name>${this.escapeXML(s.metadata.creator)}</name>
    </author>
    <time>${s.metadata.timestamp}</time>
    <bounds minlat="${s.track.bounds.south}" minlon="${s.track.bounds.west}"
            maxlat="${s.track.bounds.north}" maxlon="${s.track.bounds.east}"/>
`,s.metadata.vehicleProfile&&(i+=`    <extensions>
      <vehicle_profile>
        <height>${s.metadata.vehicleProfile.height}</height>
        <width>${s.metadata.vehicleProfile.width}</width>
        <length>${s.metadata.vehicleProfile.length}</length>
        <weight>${s.metadata.vehicleProfile.weight}</weight>
      </vehicle_profile>
`,s.metadata.restrictions&&(i+=`      <restrictions>
        <violated_dimensions>${s.metadata.restrictions.violatedDimensions.join(", ")}</violated_dimensions>
        <warnings>${s.metadata.restrictions.warnings.join("; ")}</warnings>
      </restrictions>
`),i+=`    </extensions>
`),i+=`  </metadata>
`),a.includeWaypoints&&s.waypoints.forEach(o=>{i+=`  <wpt lat="${o.lat}" lon="${o.lng}">
    <name>${this.escapeXML(o.name)}</name>
    <type>${o.type}</type>
`,o.description&&(i+=`    <desc>${this.escapeXML(o.description)}</desc>
`),o.elevation&&a.includeElevation&&(i+=`    <ele>${o.elevation}</ele>
`),i+=`    <extensions>
      <order>${o.order}</order>
      <waypoint_type>${o.type}</waypoint_type>
    </extensions>
`,i+=`  </wpt>
`}),a.includeTrackPoints&&(i+=`  <trk>
    <name>${t} Track</name>
    <desc>Route track with ${s.track.segments.length} segments</desc>
    <extensions>
      <total_distance>${s.track.totalDistance}</total_distance>
      <total_duration>${s.track.totalDuration}</total_duration>
      <service>${this.escapeXML(s.metadata.service)}</service>
      <profile>${this.escapeXML(s.metadata.profile)}</profile>
    </extensions>
`,s.track.segments.forEach((o,c)=>{i+=`    <trkseg>
`,o.points.forEach(l=>{i+=`      <trkpt lat="${l.lat}" lon="${l.lng}">
`,l.elevation&&a.includeElevation&&(i+=`        <ele>${l.elevation}</ele>
`),l.time&&(i+=`        <time>${l.time}</time>
`),l.distance!==void 0&&(i+=`        <extensions>
          <distance>${l.distance}</distance>
        </extensions>
`),i+=`      </trkpt>
`}),a.includeInstructions&&o.instructions&&o.instructions.forEach((l,m)=>{i+=`      <!-- Instruction ${m+1}: ${this.escapeXML(l.instruction)} -->
      <trkpt lat="${l.coordinates[1]}" lon="${l.coordinates[0]}">
        <name>Instruction ${m+1}</name>
        <desc>${this.escapeXML(l.instruction)}</desc>
        <extensions>
          <instruction>
            <text>${this.escapeXML(l.instruction)}</text>
            <distance>${l.distance}</distance>
            <duration>${l.duration}</duration>
            ${l.direction?`<direction>${this.escapeXML(l.direction)}</direction>`:""}
            ${l.streetName?`<street>${this.escapeXML(l.streetName)}</street>`:""}
          </instruction>
        </extensions>
      </trkpt>
`}),i+=`    </trkseg>
`}),i+=`  </trk>
`),i+=`  <rte>
    <name>${t} Route</name>
    <desc>Waypoint-based route</desc>
`,s.waypoints.forEach(o=>{i+=`    <rtept lat="${o.lat}" lon="${o.lng}">
      <name>${this.escapeXML(o.name)}</name>
      <desc>${o.type}</desc>
    </rtept>
`}),i+=`  </rte>
`,i+="</gpx>",i}static async downloadGPX(s,a,t,r){try{const i=await this.exportToGPX(s,a,t,r);if(!i.success||!i.data||!i.filename)throw new Error(i.error||"Export failed");const o=new Blob([i.data],{type:"application/gpx+xml"}),c=URL.createObjectURL(o),l=document.createElement("a");return l.href=c,l.download=i.filename,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),!0}catch(i){return console.error("GPX download error:",i),!1}}static validateGPX(s){const a=[];s.includes("<?xml")||a.push("Missing XML declaration"),s.includes("<gpx")||a.push("Missing GPX root element"),s.includes("</gpx>")||a.push("Missing closing GPX tag"),s.includes("<metadata>")||a.push("Missing metadata section");const t=/lat="(-?\d+\.?\d*)" lon="(-?\d+\.?\d*)"/g,r=[...s.matchAll(t)];for(const i of r){const o=parseFloat(i[1]),c=parseFloat(i[2]);(o<-90||o>90)&&a.push(`Invalid latitude: ${o}`),(c<-180||c>180)&&a.push(`Invalid longitude: ${c}`)}return{valid:a.length===0,errors:a}}static getExportStats(s){const a=s.track.segments.reduce((i,o)=>i+o.points.length,0),t=s.track.segments.some(i=>i.points.some(o=>o.elevation!==void 0)),r=s.track.segments.some(i=>i.instructions&&i.instructions.length>0);return{waypoints:s.waypoints.length,trackPoints:a,segments:s.track.segments.length,distance:`${(s.track.totalDistance/1e3).toFixed(1)} km`,duration:this.formatDuration(s.track.totalDuration),hasElevation:t,hasInstructions:r}}static escapeXML(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}static generateFilename(s,a){const t=s.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"_").toLowerCase(),r=new Date().toISOString().split("T")[0];return`${t}_${r}.${a}`}static formatDuration(s){const a=Math.floor(s/3600),t=Math.floor(s%3600/60);return a>0?`${a}h ${t}m`:`${t}m`}}ce(Xt,"DEFAULT_OPTIONS",{includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner"});class va{static async exportRoute(s,a,t,r,i={}){const o={includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner",format:t,...i};try{switch(t){case"gpx":return await Xt.exportToGPX(s,a,r,o);case"kml":return await this.exportToKML(s,a,r,o);case"json":return await this.exportToJSON(s,a,r,o);case"csv":return await this.exportToCSV(s,a,r,o);default:return{success:!1,error:`Unsupported format: ${t}`,format:t}}}catch(c){return console.error(`${t.toUpperCase()} export error:`,c),{success:!1,error:c instanceof Error?c.message:"Unknown export error",format:t}}}static async exportToKML(s,a,t,r={}){const i=Ze(s,a,t);if(!Ke(i))return{success:!1,error:"Invalid route data for KML export",format:"kml"};const o=this.generateKMLContent(i,r),c=this.generateFilename(i.name,"kml");return{success:!0,data:o,filename:c,format:"kml",size:new Blob([o]).size}}static generateKMLContent(s,a){const t=this.escapeXML(s.name),r=this.escapeXML(s.description);let i=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <name>${t}</name>
    <description>${r}</description>
`;return i+=`    <!-- Styles -->
    <Style id="start-point">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/grn-circle.png</href></Icon>
        <scale>1.2</scale>
      </IconStyle>
    </Style>
    <Style id="end-point">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/red-circle.png</href></Icon>
        <scale>1.2</scale>
      </IconStyle>
    </Style>
    <Style id="waypoint">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/blu-circle.png</href></Icon>
      </IconStyle>
    </Style>
    <Style id="campsite">
      <IconStyle>
        <Icon><href>http://maps.google.com/mapfiles/kml/paddle/ylw-stars.png</href></Icon>
      </IconStyle>
    </Style>
    <Style id="route-line">
      <LineStyle>
        <color>ff0000ff</color>
        <width>4</width>
      </LineStyle>
    </Style>
`,a.includeWaypoints&&(i+=`    <!-- Waypoints -->
    <Folder>
      <name>Waypoints</name>
`,s.waypoints.forEach((o,c)=>{let l="waypoint";o.type==="start"?l="start-point":o.type==="end"?l="end-point":o.type==="campsite"&&(l="campsite"),i+=`      <Placemark>
        <name>${this.escapeXML(o.name)}</name>
        <description>
          <![CDATA[
            <strong>Type:</strong> ${o.type}<br/>
            <strong>Position:</strong> ${c+1} of ${s.waypoints.length}<br/>
            <strong>Coordinates:</strong> ${o.lat.toFixed(4)}, ${o.lng.toFixed(4)}
            ${o.description?`<br/><strong>Description:</strong> ${o.description}`:""}
          ]]>
        </description>
        <styleUrl>#${l}</styleUrl>
        <Point>
          <coordinates>${o.lng},${o.lat}${o.elevation?`,${o.elevation}`:""}</coordinates>
        </Point>
      </Placemark>
`}),i+=`    </Folder>
`),a.includeTrackPoints&&(i+=`    <!-- Route Track -->
    <Placemark>
      <name>${t} Track</name>
      <description>
        <![CDATA[
          <strong>Distance:</strong> ${(s.track.totalDistance/1e3).toFixed(1)} km<br/>
          <strong>Duration:</strong> ${this.formatDuration(s.track.totalDuration)}<br/>
          <strong>Service:</strong> ${s.metadata.service}<br/>
          <strong>Profile:</strong> ${s.metadata.profile}
        ]]>
      </description>
      <styleUrl>#route-line</styleUrl>
      <LineString>
        <tessellate>1</tessellate>
        <coordinates>
`,s.track.segments.forEach(o=>{o.points.forEach(c=>{i+=`          ${c.lng},${c.lat}${c.elevation?`,${c.elevation}`:",0"}
`})}),i+=`        </coordinates>
      </LineString>
    </Placemark>
`),a.includeInstructions&&(i+=`    <!-- Instructions -->
    <Folder>
      <name>Turn Instructions</name>
`,s.track.segments.forEach((o,c)=>{o.instructions&&o.instructions.forEach((l,m)=>{i+=`      <Placemark>
        <name>Instruction ${c+1}.${m+1}</name>
        <description>
          <![CDATA[
            ${this.escapeXML(l.instruction)}<br/>
            <strong>Distance:</strong> ${(l.distance/1e3).toFixed(1)} km<br/>
            <strong>Duration:</strong> ${this.formatDuration(l.duration)}
            ${l.streetName?`<br/><strong>Street:</strong> ${this.escapeXML(l.streetName)}`:""}
            ${l.direction?`<br/><strong>Direction:</strong> ${this.escapeXML(l.direction)}`:""}
          ]]>
        </description>
        <Point>
          <coordinates>${l.coordinates[0]},${l.coordinates[1]},0</coordinates>
        </Point>
      </Placemark>
`})}),i+=`    </Folder>
`),i+=`  </Document>
</kml>`,i}static async exportToJSON(s,a,t,r={}){const i=Ze(s,a,t);if(!Ke(i))return{success:!1,error:"Invalid route data for JSON export",format:"json"};const o={...i,exportInfo:{format:"json",version:"1.0",exportedAt:new Date().toISOString(),exportedBy:r.creator||"European Camper Trip Planner",options:{includeWaypoints:r.includeWaypoints,includeTrackPoints:r.includeTrackPoints,includeInstructions:r.includeInstructions,includeElevation:r.includeElevation,includeMetadata:r.includeMetadata}},statistics:{totalWaypoints:i.waypoints.length,totalTrackPoints:i.track.segments.reduce((m,h)=>m+h.points.length,0),totalSegments:i.track.segments.length,totalInstructions:i.track.segments.reduce((m,h)=>m+(h.instructions?.length||0),0),hasElevation:i.track.segments.some(m=>m.points.some(h=>h.elevation!==void 0)),bounds:i.track.bounds}},c=JSON.stringify(o,null,2),l=this.generateFilename(i.name,"json");return{success:!0,data:c,filename:l,format:"json",size:new Blob([c]).size}}static async exportToCSV(s,a,t,r={}){const i=Ze(s,a,t);if(!Ke(i))return{success:!1,error:"Invalid route data for CSV export",format:"csv"};let o="";r.includeWaypoints&&(o+=`# Waypoints
`,o+=`ID,Name,Type,Latitude,Longitude,Elevation,Order,Description
`,i.waypoints.forEach(l=>{o+=`"${l.id}","${this.escapeCSV(l.name)}","${l.type}",${l.lat},${l.lng},${l.elevation||""},${l.order},"${this.escapeCSV(l.description||"")}"
`}),o+=`
`),r.includeTrackPoints&&(o+=`# Track Points
`,o+=`Segment,Point_Index,Latitude,Longitude,Elevation,Distance,Time
`,i.track.segments.forEach((l,m)=>{l.points.forEach((h,u)=>{o+=`${m+1},${u+1},${h.lat},${h.lng},${h.elevation||""},${h.distance||""},${h.time||""}
`})}),o+=`
`),r.includeInstructions&&(o+=`# Instructions
`,o+=`Segment,Instruction_Index,Instruction,Distance,Duration,Direction,Street_Name,Latitude,Longitude
`,i.track.segments.forEach((l,m)=>{l.instructions&&l.instructions.forEach((h,u)=>{o+=`${m+1},${u+1},"${this.escapeCSV(h.instruction)}",${h.distance},${h.duration},"${this.escapeCSV(h.direction||"")}","${this.escapeCSV(h.streetName||"")}",${h.coordinates[1]},${h.coordinates[0]}
`})}),o+=`
`),o+=`# Route Summary
`,o+=`Property,Value
`,o+=`"Route Name","${this.escapeCSV(i.name)}"
`,o+=`"Description","${this.escapeCSV(i.description)}"
`,o+=`"Total Distance (km)","${(i.track.totalDistance/1e3).toFixed(2)}"
`,o+=`"Total Duration","${this.formatDuration(i.track.totalDuration)}"
`,o+=`"Total Waypoints","${i.waypoints.length}"
`,o+=`"Total Segments","${i.track.segments.length}"
`,o+=`"Service","${i.metadata.service}"
`,o+=`"Profile","${i.metadata.profile}"
`,o+=`"Created","${i.metadata.timestamp}"
`;const c=this.generateFilename(i.name,"csv");return{success:!0,data:o,filename:c,format:"csv",size:new Blob([o]).size}}static async downloadRoute(s,a,t,r,i){try{const o=await this.exportRoute(s,a,t,r,i);if(!o.success||!o.data||!o.filename)throw new Error(o.error||"Export failed");const c=Et[t],l=new Blob([o.data],{type:c.mimeType}),m=URL.createObjectURL(l),h=document.createElement("a");return h.href=m,h.download=o.filename,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(m),!0}catch(o){return console.error(`${t.toUpperCase()} download error:`,o),!1}}static getAvailableFormats(){return Object.values(Et).map(s=>({...s,capabilities:["Waypoints",...s.supportsElevation?["Elevation"]:[],...s.supportsInstructions?["Turn Instructions"]:[],"Track Points","Metadata"]}))}static escapeXML(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}static escapeCSV(s){return s?s.replace(/"/g,'""'):""}static generateFilename(s,a){const t=s.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"_").toLowerCase(),r=new Date().toISOString().split("T")[0];return`${t}_${r}.${a}`}static formatDuration(s){const a=Math.floor(s/3600),t=Math.floor(s%3600/60);return a>0?`${a}h ${t}m`:`${t}m`}}const ja=({className:n="",onTripLoad:s,onClose:a,isVisible:t=!0})=>{const{waypoints:r}=ne(),{profile:i}=ie(),{fuelConsumptionSettings:o,fuelPriceSettings:c}=Ft(),[l,m]=d.useState("my_trips"),[h,u]=d.useState([]),[g,b]=d.useState([]),[j,C]=d.useState([]),[N,k]=d.useState([]),[p,w]=d.useState(null),[D,V]=d.useState(""),[$,z]=d.useState("all"),[F,G]=d.useState("all"),[R,A]=d.useState(!1),[T,E]=d.useState(null),[J,Q]=d.useState(!1),[Z,se]=d.useState({name:"",description:"",category:"leisure",tags:[],isPublic:!1}),[re,y]=d.useState(!1),[O,K]=d.useState(""),[te,x]=d.useState(!1),[L,B]=d.useState(null),[P,v]=d.useState("gpx"),[_,W]=d.useState({includeWaypoints:!0,includeTrackPoints:!0,includeInstructions:!0,includeElevation:!0,includeMetadata:!0,creator:"European Camper Trip Planner"});d.useEffect(()=>{U(),ee(),ae()},[]);const H=h.filter(f=>{const I=f.name.toLowerCase().includes(D.toLowerCase())||f.tags.some(Y=>Y.toLowerCase().includes(D.toLowerCase())),M=$==="all"||f.category===$;return I&&M}),q=g.filter(f=>{const I=f.metadata.name.toLowerCase().includes(D.toLowerCase())||f.metadata.tags.some(ve=>ve.toLowerCase().includes(D.toLowerCase())),M=$==="all"||f.metadata.category===$,Y=F==="all"||f.metadata.difficulty===F;return I&&M&&Y}),U=async()=>{try{const f=await he.getTripSummaries({excludeTemplates:!0});u(f)}catch(f){E("Failed to load trips"),console.error("Load trips error:",f)}},ee=async()=>{try{b([])}catch(f){E("Failed to load templates"),console.error("Load templates error:",f)}},ae=async()=>{try{const f=await he.getRecentTrips(10);C(f)}catch(f){console.error("Load recent trips error:",f)}},le=async()=>{if(r.length<2){E("Add at least 2 waypoints to save a trip");return}Q(!0)},de=async()=>{if(!Z.name.trim()){E("Trip name is required");return}A(!0);try{const f=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,I=De(r),M=Math.ceil(r.length/2),Y=100*r.length,ve={metadata:{id:f,name:Z.name,description:Z.description,category:Z.category,tags:Z.tags,duration:M,difficulty:"moderate",season:"year_round",countries:I,estimatedCost:Y,currency:"EUR",isTemplate:!1,isPublic:Z.isPublic},data:{waypoints:r,vehicleProfile:i||void 0,routePreferences:{avoidTolls:!1,avoidFerries:!1,preferScenic:!1,fuelEfficient:!0},campsiteSelections:[],costCalculations:{breakdown:{totalCost:Y,fuelCost:Y*.6,tollCost:0,accommodationCost:Y*.4,otherCosts:0,currency:"EUR",segments:[],dailyBreakdown:[]},fuelSettings:o,priceSettings:c,lastCalculated:new Date}}};await he.saveTrip(ve),await U(),Q(!1),se({name:"",description:"",category:"leisure",tags:[],isPublic:!1})}catch(f){E("Failed to save trip"),console.error("Save trip error:",f)}finally{A(!1)}},ue=async f=>{A(!0);try{const I=await he.loadTrip(f);I&&s&&(s(I),await ae())}catch(I){E("Failed to load trip"),console.error("Load trip error:",I)}finally{A(!1)}},be=async f=>{A(!0);try{await he.duplicateTrip(f),await U()}catch(I){E("Failed to duplicate trip"),console.error("Duplicate trip error:",I)}finally{A(!1)}},Me=async f=>{if(confirm("Are you sure you want to delete this trip?")){A(!0);try{await he.deleteTrip(f),await U()}catch(I){E("Failed to delete trip"),console.error("Delete trip error:",I)}finally{A(!1)}}},ye=f=>{B(f),x(!0)},Se=async()=>{if(L)try{A(!0);const f=await he.loadTrip(L);if(!f)throw new Error("Trip not found");const I=Fe(f),M={format:P,includeWaypoints:_.includeWaypoints??!0,includeTrackPoints:_.includeTrackPoints??!0,includeInstructions:_.includeInstructions??!0,includeElevation:_.includeElevation??!0,includeMetadata:_.includeMetadata??!0,creator:_.creator||"European Camper Trip Planner",description:`${f.metadata.name} - ${f.metadata.description||"Exported from Trip Manager"}`};if(await va.downloadRoute(I,f.data.waypoints,P,f.metadata.name,M))x(!1),B(null);else throw new Error("Export download failed")}catch(f){E("Failed to export trip"),console.error("Export trip error:",f)}finally{A(!1)}},Be=async()=>{if(!O.trim()){E("Please paste trip data to import");return}A(!0);try{await he.importTrip(O)?(await U(),y(!1),K("")):E("Invalid trip data format")}catch(f){E("Failed to import trip"),console.error("Import trip error:",f)}finally{A(!1)}},et=async f=>{A(!0);try{E("Templates not available in MVP version")}catch(I){E("Failed to create trip from template"),console.error("Template to trip error:",I)}finally{A(!1)}},tt=async()=>{if(N.length<2){E("Select at least 2 trips to compare");return}A(!0);try{const f=await he.compareTrips(N);w(f),m("comparison")}catch(f){E("Failed to compare trips"),console.error("Compare trips error:",f)}finally{A(!1)}},Le=(f,I)=>{const Y=(I.lat-f.lat)*Math.PI/180,ve=(I.lng-f.lng)*Math.PI/180,jt=Math.sin(Y/2)*Math.sin(Y/2)+Math.cos(f.lat*Math.PI/180)*Math.cos(I.lat*Math.PI/180)*Math.sin(ve/2)*Math.sin(ve/2);return 6371*(2*Math.atan2(Math.sqrt(jt),Math.sqrt(1-jt)))},ge=f=>{if(f.length<2)return 0;let I=0;for(let M=0;M<f.length-1;M++)I+=Le(f[M],f[M+1]);return I},Fe=f=>{const I=f.data.waypoints;return{id:`trip_${f.metadata.id}`,status:"success",routes:[{geometry:{coordinates:I.map(M=>[M.lng,M.lat]),type:"LineString"},summary:{distance:I.length>1?ge(I)*1e3:0,duration:I.length>1?ge(I)/70*3600:0},waypoints:I.map((M,Y)=>Y),segments:[{distance:I.length>1?ge(I)*1e3:0,duration:I.length>1?ge(I)/70*3600:0,steps:I.map((M,Y)=>({instruction:Y===0?`Start at ${M.name}`:`Continue to ${M.name}`,name:M.name,distance:Y>0?Le(I[Y-1],M)*1e3:0,duration:Y>0?Le(I[Y-1],M)/70*3600:0,geometry:{coordinates:[M.lng,M.lat]},maneuver:{location:[M.lng,M.lat]},wayPoints:[0,1]}))}]}],metadata:{service:"openrouteservice",profile:f.data.vehicleProfile?.type||"driving-hgv",timestamp:Date.now(),query:{waypoints:I,vehicleProfile:f.data.vehicleProfile},attribution:"OpenRouteService"}}},De=f=>{const I=new Set;return f.forEach(M=>{M.lat>=46&&M.lat<=51&&M.lng>=-5&&M.lng<=10&&I.add("France"),M.lat>=47&&M.lat<=55&&M.lng>=5&&M.lng<=15&&I.add("Germany"),M.lat>=36&&M.lat<=47&&M.lng>=6&&M.lng<=19&&I.add("Italy"),M.lat>=36&&M.lat<=44&&M.lng>=-10&&M.lng<=5&&I.add("Spain")}),Array.from(I)},me=(f,I="EUR")=>new Intl.NumberFormat("en-EU",{style:"currency",currency:I,minimumFractionDigits:0,maximumFractionDigits:0}).format(f),xe=f=>{switch(f){case"adventure":return e.jsx(Ys,{className:"w-4 h-4"});case"romantic":return e.jsx(Ks,{className:"w-4 h-4"});case"business":return e.jsx(vs,{className:"w-4 h-4"});case"family":return e.jsx(pt,{className:"w-4 h-4"});default:return e.jsx(Ut,{className:"w-4 h-4"})}},Te=f=>{switch(f){case"easy":return"text-green-600 bg-green-100";case"moderate":return"text-yellow-600 bg-yellow-100";case"challenging":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return t?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xt,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Trip Manager"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:le,disabled:r.length<2,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(St,{className:"w-4 h-4"}),"Save Current"]}),a&&e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ot,{className:"w-4 h-4 text-gray-600"})})]})]}),e.jsx("div",{className:"flex border-b bg-gray-50",children:[{id:"my_trips",label:"My Trips",icon:e.jsx(St,{className:"w-4 h-4"})},{id:"templates",label:"Templates",icon:e.jsx(Lt,{className:"w-4 h-4"})},{id:"recent",label:"Recent",icon:e.jsx(ze,{className:"w-4 h-4"})}].map(f=>e.jsxs("button",{onClick:()=>m(f.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors ${l===f.id?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[f.icon,f.label]},f.id))}),T&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(ot,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:T}),e.jsx("button",{onClick:()=>E(null),className:"ml-auto p-1 hover:bg-red-100 rounded",children:e.jsx(ot,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(aa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search trips, tags, or countries...",value:D,onChange:f=>V(f.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:$,onChange:f=>z(f.target.value),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"leisure",children:"Leisure"}),e.jsx("option",{value:"adventure",children:"Adventure"}),e.jsx("option",{value:"romantic",children:"Romantic"}),e.jsx("option",{value:"family",children:"Family"}),e.jsx("option",{value:"business",children:"Business"})]}),l==="templates"&&e.jsxs("select",{value:F,onChange:f=>G(f.target.value),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"challenging",children:"Challenging"})]})]})]})}),e.jsxs("div",{className:"p-4",children:[l==="my_trips"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800",children:["My Trips (",H.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-3 py-2 border rounded-lg hover:bg-gray-50 text-sm",children:[e.jsx(pa,{className:"w-4 h-4"}),"Import"]}),N.length>=2&&e.jsxs("button",{onClick:tt,className:"flex items-center gap-2 px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm",children:[e.jsx(qt,{className:"w-4 h-4"}),"Compare (",N.length,")"]})]})]}),H.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xt,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No trips found. Start by saving your current route or using a template."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:H.map(f=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:N.includes(f.id),onChange:I=>{I.target.checked?k([...N,f.id]):k(N.filter(M=>M!==f.id))},className:"rounded"}),e.jsxs("div",{className:"flex items-center gap-2",children:[xe(f.category),e.jsx("h4",{className:"font-semibold text-gray-800",children:f.name})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ue(f.id),className:"p-1 hover:bg-blue-100 rounded text-blue-600",title:"Load trip",children:e.jsx(Vs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>be(f.id),className:"p-1 hover:bg-green-100 rounded text-green-600",title:"Duplicate trip",children:e.jsx(_s,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ye(f.id),className:"p-1 hover:bg-purple-100 rounded text-purple-600",title:"Export trip",children:e.jsx(Fs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Me(f.id),className:"p-1 hover:bg-red-100 rounded text-red-600",title:"Delete trip",children:e.jsx(ca,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),f.duration," days"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ut,{className:"w-4 h-4"}),me(f.estimatedCost)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-4 h-4"}),f.waypointCount," stops"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qs,{className:"w-4 h-4"}),f.countries.length," countries"]})]}),f.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[f.tags.slice(0,3).map(I=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs",children:I},I)),f.tags.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded-full text-xs",children:["+",f.tags.length-3," more"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last modified: ",f.lastModified.toLocaleDateString()]})]},f.id))})]}),l==="templates"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-800",children:["Trip Templates (",q.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:q.map(f=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[xe(f.metadata.category),e.jsx("h4",{className:"font-semibold text-gray-800",children:f.metadata.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${Te(f.metadata.difficulty)}`,children:f.metadata.difficulty}),e.jsx("button",{onClick:()=>et(),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Use Template"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:f.metadata.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),f.metadata.duration," days"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ut,{className:"w-4 h-4"}),me(f.metadata.estimatedCost)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-4 h-4"}),f.data.waypoints.length," stops"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Lt,{className:"w-4 h-4"}),f.templateInfo.popularity,"% popularity"]})]}),e.jsxs("div",{className:"text-sm mb-3",children:[e.jsx("strong",{children:"Countries: "}),f.metadata.countries.join(", ")]}),e.jsxs("div",{className:"text-sm mb-3",children:[e.jsx("strong",{children:"Best months: "}),f.templateInfo.recommendedMonths.map(I=>new Date(2024,I-1,1).toLocaleDateString("en",{month:"short"})).join(", ")]}),f.templateInfo.highlights.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Highlights:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[f.templateInfo.highlights.slice(0,2).map((I,M)=>e.jsxs("li",{className:"text-gray-600",children:["â€¢ ",I]},M)),f.templateInfo.highlights.length>2&&e.jsxs("li",{className:"text-gray-500",children:["â€¢ +",f.templateInfo.highlights.length-2," more highlights"]})]})]})]},f.metadata.id))})]}),l==="recent"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-800",children:["Recent Trips (",j.length,")"]})}),j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ze,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No recent trips. Start planning your next adventure!"})]}):e.jsx("div",{className:"space-y-3",children:j.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>ue(f.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[xe(f.category),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:f.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[f.duration," days"]}),e.jsx("span",{children:me(f.estimatedCost)}),e.jsxs("span",{children:[f.waypointCount," stops"]})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:f.lastOpened.toLocaleDateString()})]},f.id))})]}),l==="comparison"&&p&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Trip Comparison"}),e.jsx("button",{onClick:()=>m("my_trips"),className:"text-blue-600 hover:text-blue-700",children:"Back to My Trips"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Cost Comparison"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.trips.map(f=>{const I=p.comparison.costs[f.metadata.id],M=p.comparison.analysis.cheapest===f.metadata.id;return e.jsxs("div",{className:`p-4 rounded-lg border ${M?"border-green-500 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[xe(f.metadata.category),e.jsx("h5",{className:"font-medium",children:f.metadata.name}),M&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs",children:"Cheapest"})]}),I&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"font-medium",children:me(I.total)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Fuel:"}),e.jsx("span",{children:me(I.fuel)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Accommodation:"}),e.jsx("span",{children:me(I.accommodation)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tolls:"}),e.jsx("span",{children:me(I.tolls)})]})]})]},f.metadata.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Route Comparison"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-200 rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Trip"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Distance"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Duration"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Waypoints"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"Countries"})]})}),e.jsx("tbody",{children:p.trips.map(f=>{const I=p.comparison.routes[f.metadata.id],M=p.comparison.analysis.shortest===f.metadata.id,Y=p.comparison.analysis.fastest===f.metadata.id;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[xe(f.metadata.category),f.metadata.name]})}),e.jsxs("td",{className:"border border-gray-200 px-4 py-2",children:[e.jsxs("span",{className:M?"font-semibold text-green-600":"",children:[I.distance.toFixed(0),"km"]}),M&&e.jsx("span",{className:"ml-1 text-xs text-green-600",children:"(shortest)"})]}),e.jsxs("td",{className:"border border-gray-200 px-4 py-2",children:[e.jsxs("span",{className:Y?"font-semibold text-blue-600":"",children:[I.duration.toFixed(1),"h"]}),Y&&e.jsx("span",{className:"ml-1 text-xs text-blue-600",children:"(fastest)"})]}),e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:I.waypointCount}),e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:I.countries.join(", ")})]},f.metadata.id)})})]})})]}),p.comparison.analysis.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Recommendations"}),e.jsx("div",{className:"space-y-3",children:p.comparison.analysis.recommendations.map((f,I)=>{const M=p.trips.find(Y=>Y.metadata.id===f.tripId);return e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M&&xe(M.metadata.category),e.jsx("span",{className:"font-medium text-blue-800",children:M?.metadata.name})]}),e.jsxs("div",{className:"text-blue-700",children:[e.jsx("div",{className:"font-medium",children:f.reason}),e.jsx("div",{className:"text-sm",children:f.advantage})]})]},I)})})]})]})]})]}),R&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Save Current Trip"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trip Name *"}),e.jsx("input",{type:"text",value:Z.name,onChange:f=>se({...Z,name:f.target.value}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"My European Adventure"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:Z.description,onChange:f=>se({...Z,description:f.target.value}),className:"w-full px-3 py-2 border rounded-lg resize-none",rows:3,placeholder:"Describe your trip..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{value:Z.category,onChange:f=>se({...Z,category:f.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"leisure",children:"Leisure"}),e.jsx("option",{value:"adventure",children:"Adventure"}),e.jsx("option",{value:"romantic",children:"Romantic"}),e.jsx("option",{value:"family",children:"Family"}),e.jsx("option",{value:"business",children:"Business"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:Z.tags.join(", "),onChange:f=>se({...Z,tags:f.target.value.split(",").map(I=>I.trim()).filter(Boolean)}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"scenic, historic, wine-tasting"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isPublic",checked:Z.isPublic,onChange:f=>se({...Z,isPublic:f.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"isPublic",className:"ml-2 text-sm text-gray-700",children:"Make trip public (for future sharing features)"})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Q(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:de,disabled:!Z.name.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Save Trip"})]})]})}),re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Import Trip"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paste trip data (JSON format):"}),e.jsx("textarea",{value:O,onChange:f=>K(f.target.value),className:"w-full px-3 py-2 border rounded-lg resize-none font-mono text-sm",rows:8,placeholder:"Paste the exported trip JSON data here..."})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>y(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:Be,disabled:!O.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Import Trip"})]})]})}),te&&L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Export Trip"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"gpx",label:"GPX",desc:"For GPS devices"},{id:"kml",label:"KML",desc:"For Google Earth"},{id:"json",label:"JSON",desc:"Complete trip data"},{id:"csv",label:"CSV",desc:"For spreadsheets"}].map(f=>e.jsxs("label",{className:"relative",children:[e.jsx("input",{type:"radio",name:"exportFormat",value:f.id,checked:P===f.id,onChange:I=>v(I.target.value),className:"sr-only"}),e.jsxs("div",{className:`p-2 border-2 rounded-lg cursor-pointer transition-all text-center ${P===f.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:f.label}),e.jsx("div",{className:"text-xs text-gray-500",children:f.desc})]})]},f.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Include Data"}),e.jsx("div",{className:"space-y-2",children:[{key:"includeWaypoints",label:"Route Waypoints"},{key:"includeTrackPoints",label:"Track Points"},{key:"includeInstructions",label:"Turn Instructions"},{key:"includeElevation",label:"Elevation Data"},{key:"includeMetadata",label:"Trip Metadata"}].map(f=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:_[f.key],onChange:I=>W(M=>({...M,[f.key]:I.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:f.label})]},f.key))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Creator"}),e.jsx("input",{type:"text",value:_.creator||"",onChange:f=>W(I=>({...I,creator:f.target.value})),placeholder:"European Camper Trip Planner",className:"w-full px-3 py-2 border rounded-lg text-sm"})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{x(!1),B(null)},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:Se,disabled:R,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:R?"Exporting...":"Export Trip"})]})]})})]}):null},It={motorhome:{maxDailyDistance:300,maxDailyDrivingTime:6,recommendedBreakInterval:2,breakDuration:20,averageSpeed:65},caravan:{maxDailyDistance:350,maxDailyDrivingTime:7,recommendedBreakInterval:2.5,breakDuration:15,averageSpeed:70},campervan:{maxDailyDistance:400,maxDailyDrivingTime:8,recommendedBreakInterval:3,breakDuration:15,averageSpeed:75},default:{maxDailyDistance:350,maxDailyDrivingTime:7,recommendedBreakInterval:2.5,breakDuration:15,averageSpeed:70}},At={winter:{speedMultiplier:.8,distanceMultiplier:.7,difficultyIncrease:30},spring:{speedMultiplier:.95,distanceMultiplier:.9,difficultyIncrease:0},summer:{speedMultiplier:1,distanceMultiplier:1,difficultyIncrease:0},autumn:{speedMultiplier:.9,distanceMultiplier:.85,difficultyIncrease:10}};class Ne{static createTripPlan(s,a,t,r="summer"){if(s.length<2)throw new Error("At least 2 waypoints required for trip planning");const i=this.getDrivingLimits(a,r),o=this.calculateRouteSegments(s),c=this.planDailyStages(o,i,t,r),l=this.analyzeFeasibility(c,i),m=o.reduce((g,b)=>g+b.distance,0),h=o.reduce((g,b)=>g+b.drivingTime,0),u=this.calculateRestDays(c);return{totalDays:c.length+u,totalDistance:m,totalDrivingTime:h,startDate:t,endDate:t?new Date(t.getTime()+(c.length+u-1)*24*60*60*1e3):void 0,dailyStages:c,restDays:u,feasibilityScore:l.score,overallFeasibility:l.overall,warnings:l.warnings,recommendations:l.recommendations}}static getDrivingLimits(s,a="summer"){const t=s?.type||"default",r=It[t]||It.default,i=At[a]||At.summer;let o=1;if(s){const c=s.length||6,l=s.weight||3e3;c>8||l>4e3?o=.8:(c>7||l>3500)&&(o=.9)}return{maxDailyDistance:Math.round(r.maxDailyDistance*i.distanceMultiplier*o),maxDailyDrivingTime:Math.round(r.maxDailyDrivingTime*i.speedMultiplier*o*10)/10,recommendedBreakInterval:r.recommendedBreakInterval,breakDuration:r.breakDuration,averageSpeed:Math.round(r.averageSpeed*i.speedMultiplier)}}static calculateRouteSegments(s){const a=[];for(let t=0;t<s.length-1;t++){const r=s[t],i=s[t+1],o=this.calculateDistance(r,i),c=o/70;a.push({startWaypoint:r,endWaypoint:i,distance:o,drivingTime:c})}return a}static planDailyStages(s,a,t,r="summer"){const i=[];let o=1,c=t||new Date,l=0,m=0,h=[];return s.forEach((u,g)=>{(l+u.distance>a.maxDailyDistance||m+u.drivingTime>a.maxDailyDrivingTime)&&h.length>0&&(i.push(this.createDailyStage(o,c,h,l,m,a,r)),o++,c=new Date(c.getTime()+1440*60*1e3),l=0,m=0,h=[]),h.push(u),l+=u.distance,m+=u.drivingTime,g===s.length-1&&h.length>0&&i.push(this.createDailyStage(o,c,h,l,m,a,r))}),i}static createDailyStage(s,a,t,r,i,o,c){const l=t[0].startWaypoint,m=t[t.length-1].endWaypoint,h=this.planStopsForDay(t,i,o),u=this.determineAccommodationType(m,c),g=this.assessDayFeasibility(r,i,o),b=this.generateDayWarnings(r,i,o,c),j=this.generateDayRecommendations(r,i,o,c);return{day:s,date:a,startWaypoint:l,endWaypoint:m,distance:r,drivingTime:i,stops:h,accommodationType:u,feasibility:g,warnings:b,recommendations:j}}static planStopsForDay(s,a,t){const r=[],i=Math.floor(a/t.recommendedBreakInterval);for(let o=0;o<i;o++)r.push({waypointId:`break_${o}`,type:"rest",minDuration:t.breakDuration/60,recommendedDuration:t.breakDuration/60,maxDuration:1,reasoning:`Mandatory rest break after ${t.recommendedBreakInterval} hours of driving`});return s.forEach(o=>{this.isPointOfInterest(o.endWaypoint)&&r.push({waypointId:o.endWaypoint.id,type:"sightseeing",minDuration:1,recommendedDuration:2,maxDuration:4,reasoning:"Recommended sightseeing stop at point of interest"})}),a>4&&r.push({waypointId:"lunch",type:"lunch",minDuration:.5,recommendedDuration:1,maxDuration:2,reasoning:"Lunch break for long driving day"}),r}static determineAccommodationType(s,a){return!s||s.type==="campsite"?"campsite":s.type==="accommodation"||a==="winter"?"hotel":"campsite"}static assessDayFeasibility(s,a,t){const r=s/t.maxDailyDistance,i=a/t.maxDailyDrivingTime,o=Math.max(r,i);return o<=.7?"excellent":o<=.9?"good":o<=1.1?"challenging":"unrealistic"}static generateDayWarnings(s,a,t,r){const i=[];return s>t.maxDailyDistance&&i.push(`Daily distance of ${s.toFixed(0)}km exceeds recommended limit of ${t.maxDailyDistance}km`),a>t.maxDailyDrivingTime&&i.push(`Driving time of ${a.toFixed(1)}h exceeds recommended limit of ${t.maxDailyDrivingTime}h`),s>t.maxDailyDistance*1.2&&i.push("This is a very long driving day - consider splitting into multiple days"),r==="winter"&&s>t.maxDailyDistance*.8&&i.push("Winter driving conditions - allow extra time and reduce daily distance"),i}static generateDayRecommendations(s,a,t,r){const i=[];return a>4&&i.push("Plan multiple rest stops for this long driving day"),s<t.maxDailyDistance*.5&&i.push("Light driving day - perfect opportunity for sightseeing"),r==="summer"&&s>t.maxDailyDistance*.8&&i.push("Start early to avoid afternoon heat and traffic"),r==="winter"&&i.push("Check weather conditions and road status before departure"),i}static analyzeFeasibility(s,a){let t=0;const r=[],i=[];s.forEach((h,u)=>{let g=100;h.feasibility==="excellent"?g=100:h.feasibility==="good"?g=80:h.feasibility==="challenging"?g=60:h.feasibility==="unrealistic"&&(g=30),t+=g,h.feasibility==="unrealistic"&&r.push(`Day ${h.day}: Unrealistic driving distance/time`)});const o=s.reduce((h,u)=>h+u.distance,0)/s.length,c=this.findConsecutiveIntensiveDays(s);o>a.maxDailyDistance*.9&&(r.push("Overall trip intensity is very high - consider adding rest days"),t*=.9),c>=3&&(r.push("Multiple consecutive intensive driving days detected"),i.push("Consider adding rest days between intensive driving periods"),t*=.85),s.length>14&&i.push("Long trip - ensure adequate rest and recovery time");const l=t/s.length*(s.length<=21?1:.9);let m;return l>=85?m="excellent":l>=70?m="good":l>=50?m="challenging":m="unrealistic",{score:Math.round(l),overall:m,warnings:r,recommendations:i}}static getSeasonalFactors(s,a){const r={spring:{season:"spring",temperature:{min:8,max:18},precipitation:"medium",touristDensity:"medium",campsiteAvailability:"good",drivingConditions:"good",recommendations:["Perfect weather for touring, but pack layers","Some mountain passes may still be closed","Booking campsite in advance recommended"],warnings:["Variable weather conditions possible","Some seasonal businesses may not be open yet"]},summer:{season:"summer",temperature:{min:15,max:28},precipitation:"low",touristDensity:"high",campsiteAvailability:"limited",drivingConditions:"excellent",recommendations:["Book accommodations well in advance","Start driving early to avoid heat and traffic","Stay hydrated and use sun protection"],warnings:["Peak tourist season - expect crowds and higher prices","Extreme heat possible in southern regions"]},autumn:{season:"autumn",temperature:{min:5,max:15},precipitation:"medium",touristDensity:"low",campsiteAvailability:"good",drivingConditions:"good",recommendations:["Beautiful fall colors and fewer crowds","Pack warm clothing for cooler evenings","Great time for wine regions"],warnings:["Some campsites may close for winter","Daylight hours are decreasing"]},winter:{season:"winter",temperature:{min:-5,max:8},precipitation:"high",touristDensity:"low",campsiteAvailability:"poor",drivingConditions:"challenging",recommendations:["Focus on southern routes and cities","Book heated accommodations","Carry winter driving equipment"],warnings:["Many campsites closed in northern regions","Snow and ice possible - check road conditions","Shorter daylight hours limit driving time"]}}[s];return a.some(i=>["Norway","Sweden","Finland"].includes(i))&&s==="winter"?{...r,temperature:{min:-15,max:0},drivingConditions:"challenging",warnings:[...r.warnings,"Arctic conditions possible","Winter tires mandatory"]}:a.some(i=>["Spain","Portugal","Italy","Greece"].includes(i))&&s==="summer"?{...r,temperature:{min:20,max:40},warnings:[...r.warnings,"Extreme heat in inland areas","Air conditioning essential"]}:r}static calculateTripMetrics(s,a){const t=s.totalDistance/s.totalDays,r=s.restDays/s.totalDays,i=new Set(s.dailyStages.map(u=>this.getCountryFromWaypoint(u.endWaypoint))),o=new Set(s.dailyStages.map(u=>u.endWaypoint.type)),c=Math.min(100,i.size*20+o.size*10),l=s.dailyStages.filter(u=>u.feasibility==="challenging"||u.feasibility==="unrealistic").length,m=Math.min(100,l/s.dailyStages.length*100+t/500*50);let h;return t<200&&s.feasibilityScore>80?h="relaxed":t<300&&s.feasibilityScore>60?h="moderate":t<400&&s.feasibilityScore>40?h="intensive":h="extreme",{drivingIntensity:Math.round(t),restRatio:Math.round(r*100)/100,varietyScore:Math.round(c),difficultyScore:Math.round(m),comfortLevel:h,suitability:{beginners:h==="relaxed"&&m<30,families:h!=="extreme"&&m<50,experienced:!0,seniors:h==="relaxed"&&s.feasibilityScore>70}}}static generatePlanningRecommendations(s,a,t,r){const i=[];return a.difficultyScore>70&&i.push({type:"safety",priority:"high",title:"High Difficulty Trip",description:"This trip has challenging daily stages that may be tiring",action:"Add rest days between intensive driving periods",impact:"Improved safety and enjoyment"}),(a.comfortLevel==="intensive"||a.comfortLevel==="extreme")&&i.push({type:"comfort",priority:"medium",title:"Intensive Driving Schedule",description:"Multiple long driving days may be exhausting",action:"Consider reducing daily distances or adding overnight stops",impact:"More relaxed and enjoyable travel experience"}),t==="winter"&&i.push({type:"season",priority:"high",title:"Winter Travel Considerations",description:"Winter conditions require special preparation",action:"Pack winter gear, check road conditions, reduce daily distances",impact:"Safe winter travel"}),r&&r.type==="motorhome"&&r.length&&r.length>8&&i.push({type:"route",priority:"medium",title:"Large Vehicle Considerations",description:"Your large motorhome may face restrictions on some routes",action:"Check height and length restrictions, avoid narrow mountain roads",impact:"Avoid routing problems and damage"}),s.dailyStages.some(o=>o.accommodationType==="hotel")&&i.push({type:"cost",priority:"low",title:"Accommodation Cost Optimization",description:"Hotel stays increase trip costs significantly",action:"Consider campsites or wild camping where legal",impact:"Reduced accommodation costs"}),s.dailyStages.length>14&&i.push({type:"timing",priority:"medium",title:"Extended Trip Duration",description:"Long trips require careful planning and preparation",action:"Plan for vehicle maintenance, ensure adequate supplies",impact:"Smooth extended travel experience"}),i.sort((o,c)=>{const l={high:3,medium:2,low:1};return l[c.priority]-l[o.priority]})}static calculateRestDays(s){const a=s.filter(t=>t.distance>300||t.drivingTime>6).length;return Math.floor(a/3)}static findConsecutiveIntensiveDays(s){let a=0,t=0;return s.forEach(r=>{r.distance>300||r.drivingTime>6?(t++,a=Math.max(a,t)):t=0}),a}static isPointOfInterest(s){return!s||!s.name?!1:["castle","museum","cathedral","palace","historic","scenic"].some(t=>s.name.toLowerCase().includes(t))}static getCountryFromWaypoint(s){return s.lat>=46&&s.lat<=51&&s.lng>=-5&&s.lng<=10?"France":s.lat>=47&&s.lat<=55&&s.lng>=5&&s.lng<=15?"Germany":s.lat>=36&&s.lat<=47&&s.lng>=6&&s.lng<=19?"Italy":s.lat>=36&&s.lat<=44&&s.lng>=-10&&s.lng<=5?"Spain":"Europe"}static calculateDistance(s,a){const r=(a.lat-s.lat)*Math.PI/180,i=(a.lng-s.lng)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(s.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}}const Na=({className:n="",onPlanUpdate:s,isVisible:a=!0})=>{const{waypoints:t}=ne(),{profile:r}=ie(),[i,o]=d.useState("overview"),[c,l]=d.useState("summer"),[m,h]=d.useState(""),[u,g]=d.useState(null),[b,j]=d.useState(null),[C,N]=d.useState([]),[k,p]=d.useState(null),[w,D]=d.useState(null),[V,$]=d.useState(!1),[z,F]=d.useState(null),[G,R]=d.useState(new Set);d.useEffect(()=>{t.length>=2?A():(g(null),j(null),N([]))},[t,r,c,m]);const A=async()=>{$(!0),F(null);try{const y=m?new Date(m):void 0,O=Ne.createTripPlan(t,r||void 0,y,c),K=Ne.calculateTripMetrics(O,r||void 0),te=Ne.getDrivingLimits(r||void 0,c),x=Ne.generatePlanningRecommendations(O,K,c,r||void 0),L=[...new Set(O.dailyStages.map(P=>Ne.getCountryFromWaypoint(P.endWaypoint)))],B=Ne.getSeasonalFactors(c,L);g(O),j(K),N(x),p(B),D(te),s&&s(O)}catch(y){console.error("Trip planning error:",y),F("Failed to calculate trip plan. Please check your route.")}finally{$(!1)}},T=y=>y.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),E=y=>{const O=Math.floor(y),K=Math.round((y-O)*60);return`${O}h ${K}m`},J=y=>{switch(y){case"excellent":return"text-green-600 bg-green-100";case"good":return"text-blue-600 bg-blue-100";case"challenging":return"text-yellow-600 bg-yellow-100";case"unrealistic":return"text-red-600 bg-red-100"}},Q=y=>{switch(y){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-blue-600 bg-blue-100"}},Z=y=>{switch(y){case"safety":return e.jsx(Ee,{className:"w-4 h-4"});case"comfort":return e.jsx(pt,{className:"w-4 h-4"});case"cost":return e.jsx(it,{className:"w-4 h-4"});case"timing":return e.jsx(ze,{className:"w-4 h-4"});case"season":return e.jsx(Dt,{className:"w-4 h-4"});case"route":return e.jsx(nt,{className:"w-4 h-4"})}},se=y=>{switch(y){case"overnight":return e.jsx(Mt,{className:"w-4 h-4"});case"sightseeing":return e.jsx(ks,{className:"w-4 h-4"});case"lunch":return e.jsx($s,{className:"w-4 h-4"});case"fuel":return e.jsx(Zt,{className:"w-4 h-4"});case"rest":return e.jsx(ze,{className:"w-4 h-4"})}},re=y=>{const O=new Set(G);O.has(y)?O.delete(y):O.add(y),R(O)};return a?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-purple-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Trip Planning Tools"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Gt,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Travel Season"}),e.jsxs("select",{value:c,onChange:y=>l(y.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"spring",children:"Spring (Mar-May)"}),e.jsx("option",{value:"summer",children:"Summer (Jun-Aug)"}),e.jsx("option",{value:"autumn",children:"Autumn (Sep-Nov)"}),e.jsx("option",{value:"winter",children:"Winter (Dec-Feb)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",value:m,onChange:y=>h(y.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Type"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white border rounded-lg text-sm",children:[e.jsx(Ut,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"capitalize",children:[r?.type||"Default",r?.length&&` (${r.length}m)`]})]})]})]})}),e.jsx("div",{className:"flex border-b bg-gray-50",children:[{id:"overview",label:"Overview",icon:e.jsx(qt,{className:"w-4 h-4"})},{id:"calendar",label:"Daily Plan",icon:e.jsx(Pe,{className:"w-4 h-4"})},{id:"recommendations",label:"Tips",icon:e.jsx(Oe,{className:"w-4 h-4"})},{id:"metrics",label:"Analysis",icon:e.jsx(it,{className:"w-4 h-4"})}].map(y=>e.jsxs("button",{onClick:()=>o(y.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors ${i===y.id?"text-purple-600 border-b-2 border-purple-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[y.icon,y.label]},y.id))}),z&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:z})]})}),e.jsx("div",{className:"p-4",children:V?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Calculating trip plan..."})]}):t.length<2?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xt,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Add at least 2 waypoints to your route to start planning."})]}):u?e.jsxs(e.Fragment,{children:[i==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:"Duration"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:u.totalDays}),e.jsx("div",{className:"text-sm text-blue-600",children:"days total"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(nt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Distance"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:Math.round(u.totalDistance)}),e.jsx("div",{className:"text-sm text-green-600",children:"km total"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ze,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-purple-600 font-medium",children:"Driving"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:Math.round(u.totalDrivingTime)}),e.jsx("div",{className:"text-sm text-purple-600",children:"hours total"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm text-orange-600 font-medium",children:"Feasibility"})]}),e.jsx("div",{className:"text-xl font-bold text-orange-800 capitalize",children:u.overallFeasibility}),e.jsxs("div",{className:"text-sm text-orange-600",children:[u.feasibilityScore,"% score"]})]})]}),w&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Daily Driving Limits (Based on Vehicle & Season)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Distance:"}),e.jsxs("div",{className:"font-semibold",children:[w.maxDailyDistance,"km"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Time:"}),e.jsxs("div",{className:"font-semibold",children:[w.maxDailyDrivingTime,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Break Every:"}),e.jsxs("div",{className:"font-semibold",children:[w.recommendedBreakInterval,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Average Speed:"}),e.jsxs("div",{className:"font-semibold",children:[w.averageSpeed,"km/h"]})]})]})]}),k&&e.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Dt,{className:"w-4 h-4 text-blue-600"}),e.jsxs("h4",{className:"font-medium text-gray-800 capitalize",children:[c," Travel Conditions"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Expected Conditions:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Temperature: ",k.temperature.min,"Â°C - ",k.temperature.max,"Â°C"]}),e.jsxs("div",{children:["Tourist Density: ",e.jsx("span",{className:"capitalize",children:k.touristDensity})]}),e.jsxs("div",{children:["Campsite Availability: ",e.jsx("span",{className:"capitalize",children:k.campsiteAvailability})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Top Recommendations:"}),e.jsx("ul",{className:"space-y-1 text-sm",children:k.recommendations.slice(0,3).map((y,O)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx(Oe,{className:"w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:y})]},O))})]})]})]}),u.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800",children:"Important Warnings"})]}),e.jsx("ul",{className:"space-y-1",children:u.warnings.slice(0,3).map((y,O)=>e.jsxs("li",{className:"text-sm text-yellow-700",children:["â€¢ ",y]},O))})]})]}),i==="calendar"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Daily Itinerary"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[u.dailyStages.length," driving days + ",u.restDays," rest days"]})]}),u.dailyStages.map(y=>e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50",onClick:()=>re(y.day),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-semibold",children:y.day}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-800",children:[y.startWaypoint.name," â†’ ",y.endWaypoint.name]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[y.date&&T(y.date)," â€¢ ",Math.round(y.distance),"km â€¢ ",E(y.drivingTime)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${J(y.feasibility)}`,children:y.feasibility}),G.has(y.day)?e.jsx(Ts,{className:"w-4 h-4 text-gray-400"}):e.jsx(Ls,{className:"w-4 h-4 text-gray-400"})]})]})}),G.has(y.day)&&e.jsxs("div",{className:"px-4 pb-4 border-t bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Accommodation"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Mt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"capitalize",children:y.accommodationType.replace("_"," ")})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Average Speed"}),e.jsxs("div",{className:"text-sm",children:[Math.round(y.distance/y.drivingTime),"km/h"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Stops Planned"}),e.jsxs("div",{className:"text-sm",children:[y.stops.length," stops"]})]})]}),y.stops.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Planned Stops:"}),e.jsx("div",{className:"space-y-2",children:y.stops.map((O,K)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[se(O.type),e.jsx("span",{className:"capitalize",children:O.type.replace("_"," ")}),e.jsxs("span",{className:"text-gray-600",children:["(",E(O.recommendedDuration),")"]}),e.jsxs("span",{className:"text-gray-500",children:["- ",O.reasoning]})]},K))})]}),y.warnings.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium mb-1",children:"Warnings:"}),e.jsx("ul",{className:"space-y-1",children:y.warnings.map((O,K)=>e.jsxs("li",{className:"text-sm text-red-700 flex items-start gap-1",children:[e.jsx(Ee,{className:"w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"}),O]},K))})]}),y.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Recommendations:"}),e.jsx("ul",{className:"space-y-1",children:y.recommendations.map((O,K)=>e.jsxs("li",{className:"text-sm text-blue-700 flex items-start gap-1",children:[e.jsx(Kt,{className:"w-3 h-3 text-blue-500 mt-0.5 flex-shrink-0"}),O]},K))})]})]})]},y.day))]}),i==="recommendations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-4",children:["Planning Recommendations (",C.length,")"]}),C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Oe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No specific recommendations - your trip plan looks great!"})]}):e.jsx("div",{className:"space-y-3",children:C.map((y,O)=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${Q(y.priority)}`,children:Z(y.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-800",children:y.title}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(y.priority)}`,children:[y.priority," priority"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:y.description}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Action: "}),e.jsx("span",{className:"text-gray-600",children:y.action})]}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Impact: "}),e.jsx("span",{className:"text-gray-600",children:y.impact})]})]})]})},O))}),k&&k.warnings.length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Rs,{className:"w-4 h-4 text-orange-600"}),e.jsx("h5",{className:"font-medium text-orange-800",children:"Seasonal Considerations"})]}),e.jsx("ul",{className:"space-y-1",children:k.warnings.map((y,O)=>e.jsxs("li",{className:"text-sm text-orange-700 flex items-start gap-1",children:[e.jsx(Ee,{className:"w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"}),y]},O))})]})]}),i==="metrics"&&b&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-4",children:"Trip Analysis & Metrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(nt,{className:"w-4 h-4 text-blue-600"}),e.jsx("h5",{className:"font-medium text-blue-800",children:"Driving Intensity"})]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-800 mb-1",children:[b.drivingIntensity,"km"]}),e.jsx("div",{className:"text-sm text-blue-600",children:"average per day"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Comfort Level: ",e.jsx("span",{className:"font-medium capitalize",children:b.comfortLevel})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(it,{className:"w-4 h-4 text-green-600"}),e.jsx("h5",{className:"font-medium text-green-800",children:"Trip Variety"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800 mb-1",children:b.varietyScore}),e.jsx("div",{className:"text-sm text-green-600",children:"variety score"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Rest Ratio: ",(b.restRatio*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(rt,{className:"w-4 h-4 text-purple-600"}),e.jsx("h5",{className:"font-medium text-purple-800",children:"Difficulty Score"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800 mb-1",children:b.difficultyScore}),e.jsx("div",{className:"text-sm text-purple-600",children:"out of 100"}),e.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min(100,b.difficultyScore)}%`}})})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(pt,{className:"w-4 h-4 text-orange-600"}),e.jsx("h5",{className:"font-medium text-orange-800",children:"Trip Suitability"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beginners:"}),e.jsx("span",{className:b.suitability.beginners?"text-green-600":"text-red-600",children:b.suitability.beginners?"âœ“ Suitable":"âœ— Not recommended"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Families:"}),e.jsx("span",{className:b.suitability.families?"text-green-600":"text-red-600",children:b.suitability.families?"âœ“ Suitable":"âœ— Not recommended"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Seniors:"}),e.jsx("span",{className:b.suitability.seniors?"text-green-600":"text-red-600",children:b.suitability.seniors?"âœ“ Suitable":"âœ— Not recommended"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-3",children:"Detailed Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-2",children:"Trip Characteristics:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ Total driving days: ",u.dailyStages.length]}),e.jsxs("li",{children:["â€¢ Recommended rest days: ",u.restDays]}),e.jsxs("li",{children:["â€¢ Average daily distance: ",b.drivingIntensity,"km"]}),e.jsxs("li",{children:["â€¢ Total driving time: ",Math.round(u.totalDrivingTime),"h"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 mb-2",children:"Planning Insights:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ Comfort level: ",b.comfortLevel]}),e.jsxs("li",{children:["â€¢ Difficulty: ",b.difficultyScore,"/100"]}),e.jsxs("li",{children:["â€¢ Route variety: ",b.varietyScore,"/100"]}),e.jsxs("li",{children:["â€¢ Feasibility: ",u.feasibilityScore,"%"]})]})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(rt,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Unable to create trip plan. Please check your route."})]})})]}):null},We="camper-planner-map-state",Rt="1.0",wa=10080*60*1e3;class ka{getMapState(){try{const s=localStorage.getItem(We);if(!s)return null;const a=JSON.parse(s);return a.version!==Rt?(console.warn("Map storage version mismatch, clearing stored state"),this.clearMapState(),null):a.mapState&&a.mapState.timestamp&&Date.now()-a.mapState.timestamp>wa?(console.log("Map state expired, clearing stored state"),this.clearMapState(),null):a.mapState||null}catch(s){return console.error("Error reading map state from storage:",s),this.clearMapState(),null}}saveMapState(s){try{if(!this.validateCoordinates(s.center[0],s.center[1])){console.warn("Invalid coordinates, not saving map state:",s.center);return}if(s.zoom<1||s.zoom>20){console.warn("Invalid zoom level, not saving map state:",s.zoom);return}const a={mapState:{center:[Number(s.center[0].toFixed(6)),Number(s.center[1].toFixed(6))],zoom:Math.round(s.zoom),timestamp:Date.now()},version:Rt};localStorage.setItem(We,JSON.stringify(a))}catch(a){console.error("Error saving map state to storage:",a)}}clearMapState(){try{localStorage.removeItem(We)}catch(s){console.error("Error clearing map state from storage:",s)}}getStorageInfo(){try{const s=localStorage.getItem(We);if(!s)return{size:0,lastUpdated:null};const a=JSON.parse(s);return{size:new Blob([s]).size,lastUpdated:a.mapState?.timestamp||null}}catch(s){return console.error("Error getting storage info:",s),{size:0,lastUpdated:null}}}validateCoordinates(s,a){return typeof s=="number"&&typeof a=="number"&&s>=-90&&s<=90&&a>=-180&&a<=180&&!isNaN(s)&&!isNaN(a)}isStorageAvailable(){try{const s="__storage_test__";return localStorage.setItem(s,s),localStorage.removeItem(s),!0}catch{return!1}}}const mt=new ka,Ca=n=>_e.divIcon({html:`
      <div class="relative w-6 h-6 flex items-center justify-center">
        <div
          class="w-4 h-4 bg-blue-500 text-white flex items-center justify-center rounded-full shadow-md transform transition-transform"
          style="transform: rotate(${n}deg)"
        >
          <svg class="w-2 h-2" fill="currentColor" viewBox="0 0 12 12">
            <path d="M6 1l5 4-5 4V6H1V4h5V1z"/>
          </svg>
        </div>
      </div>
    `,className:"direction-arrow",iconSize:[24,24],iconAnchor:[12,12]}),Ma=(n,s,a,t)=>{const r=t-s,i=a-n;return(Math.atan2(r,i)*(180/Math.PI)+360)%360},gt=(n,s,a,t)=>[(n+a)/2,(s+t)/2],Jt=n=>n<1e3?`${Math.round(n)}m`:`${(n/1e3).toFixed(1)}km`,Yt=n=>{const s=Math.floor(n/3600),a=Math.floor(n%3600/60);return s>0?`${s}h ${a}m`:`${a}m`},Sa=(n,s,a=!1)=>{const t=Jt(n),r=Yt(s);return _e.divIcon({html:`
      <div class="route-info-label ${a?"highlighted":""}">
        <div class="bg-white border-2 border-blue-500 rounded-lg px-2 py-1 shadow-lg text-xs font-medium text-gray-800">
          <div class="text-blue-600 font-semibold">${t}</div>
          <div class="text-gray-600">${r}</div>
        </div>
      </div>
    `,className:"route-info-marker",iconSize:[60,30],iconAnchor:[30,15]})},La=n=>{const s=i=>i==="error"?"#dc2626":"#f59e0b",a=i=>{switch(i){case"height":return"â†•ï¸";case"width":return"â†”ï¸";case"weight":return"âš–ï¸";case"length":return"ðŸ“";default:return"âš ï¸"}},t=s(n.severity),r=a(n.restriction);return _e.divIcon({html:`
      <div class="relative">
        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center shadow-lg animate-pulse"
             style="background-color: ${t}; border-color: ${t}">
          <span class="text-white text-xs font-bold">${r}</span>
        </div>
        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2">
          <div class="w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent"
               style="border-top-color: ${t}"></div>
        </div>
      </div>
    `,className:"restriction-warning-icon",iconSize:[32,36],iconAnchor:[16,36],popupAnchor:[0,-36]})},Da=({waypoint:n,index:s,total:a})=>{const{updateWaypoint:t,removeWaypoint:r}=ne(),{addNotification:i}=oe(),[o,c]=d.useState(!1),[l,m]=d.useState(n.name||""),[h,u]=d.useState(n.notes||""),g=()=>n.type==="start"?"bg-green-500 border-green-600":n.type==="end"?"bg-red-500 border-red-600":"bg-blue-500 border-blue-600",b=d.useCallback(()=>{const w={};l.trim()!==(n.name||"")&&(w.name=l.trim()),h!==(n.notes||"")&&(w.notes=h),Object.keys(w).length>0&&(t(n.id,w),i({type:"success",message:"Waypoint updated successfully"})),c(!1)},[n.id,n.name,n.notes,l,h,t,i]),j=d.useCallback(()=>{m(n.name||""),u(n.notes||""),c(!1)},[n.name,n.notes]),C=d.useCallback(()=>{r(n.id),i({type:"success",message:`Removed ${n.name||"waypoint"} from route`})},[n.id,n.name,r,i]),N=()=>n.type==="start"?"S":n.type==="end"?"E":(s+1).toString(),k=()=>n.type==="start"||n.type==="end"?"ðŸ":n.type==="campsite"?"ðŸ•ï¸":n.type==="accommodation"?"ðŸ¨":"ðŸ“",p=_e.divIcon({html:`
      <div class="relative waypoint-marker">
        <!-- Main waypoint container -->
        <div class="${S("relative w-10 h-10 rounded-full border-3 text-white font-bold text-sm","flex items-center justify-center shadow-lg","transform hover:scale-110 transition-all duration-300","cursor-pointer",g())}">
          <!-- Icon background -->
          <div class="absolute inset-1 rounded-full bg-white bg-opacity-20"></div>

          <!-- Main content -->
          <div class="relative z-10 flex flex-col items-center">
            <div class="text-xs">${k()}</div>
            <div class="text-xs font-bold -mt-1">${N()}</div>
          </div>
        </div>

        <!-- Pulse animation for important waypoints -->
        <div class="${S("absolute inset-0 rounded-full border-2 animate-pulse opacity-20",g())}"></div>

        <!-- Route progress indicator -->
        ${a>1?`
          <div class="absolute -bottom-3 left-1/2 transform -translate-x-1/2">
            <div class="w-2 h-4 bg-gray-300 rounded-full border border-gray-400">
              <div
                class="w-full bg-gradient-to-t from-green-500 to-blue-500 rounded-full transition-all duration-500"
                style="height: ${(s+1)/a*100}%"
              ></div>
            </div>
          </div>
        `:""}

        <!-- Waypoint name label -->
        <div class="absolute top-12 left-1/2 transform -translate-x-1/2 whitespace-nowrap">
          <div class="bg-white bg-opacity-90 text-gray-800 text-xs font-medium px-2 py-1 rounded shadow-md border">
            ${n.name||`Stop ${s+1}`}
          </div>
        </div>
      </div>
    `,className:"enhanced-waypoint-marker",iconSize:[40,60],iconAnchor:[20,30],popupAnchor:[0,-30]});return e.jsx(ke,{position:[n.lat,n.lng],icon:p,zIndexOffset:2e3,children:e.jsx($e,{eventHandlers:{click:w=>w.originalEvent?.stopPropagation()},children:e.jsxs("div",{className:"p-3 min-w-[250px]",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:k()}),e.jsx("h3",{className:"font-semibold text-sm",children:n.name||`Waypoint ${s+1}`})]}),!o&&e.jsx("button",{onClick:w=>{w.stopPropagation(),w.preventDefault(),c(!0)},className:"bg-blue-600 text-white hover:bg-blue-700 px-2 py-1 rounded text-xs font-medium transition-colors",title:"Edit waypoint",children:"Edit"})]}),o?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:l,onChange:w=>m(w.target.value),onClick:w=>w.stopPropagation(),onFocus:w=>w.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter waypoint name",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:h,onChange:w=>u(w.target.value),onClick:w=>w.stopPropagation(),onFocus:w=>w.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3,placeholder:"Add notes about this waypoint..."})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),w.preventDefault(),b()},className:"flex-1 px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:w=>{w.stopPropagation(),w.preventDefault(),j()},className:"flex-1 px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:n.type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Position:"}),e.jsxs("span",{className:"font-medium",children:[s+1," of ",a]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Coordinates:"}),e.jsxs("span",{className:"font-mono text-xs",children:[n.lat.toFixed(4),", ",n.lng.toFixed(4)]})]}),n.visitDate&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Visit Date:"}),e.jsx("span",{className:"font-medium",children:n.visitDate})]}),n.duration&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Stay Duration:"}),e.jsxs("span",{className:"font-medium",children:[n.duration,"h"]})]}),n.notes&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Notes:"}),e.jsx("div",{className:"text-gray-600",children:n.notes})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),w.preventDefault(),c(!0)},className:"flex-1 px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:w=>{w.stopPropagation(),w.preventDefault(),C()},className:"flex-1 px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Delete"})]})]})]})})})},Ta=({route:n})=>{const s=n?.routes?.[0],a=d.useMemo(()=>s?.geometry?.coordinates?s.geometry.coordinates.map(([i,o])=>[o,i]):[],[s]);if(!n||!n.routes||n.routes.length===0)return null;const t=()=>n.restrictions?.cannotAccommodate?"#dc2626":n.restrictions?.violatedDimensions.length||n.warnings&&n.warnings.length>0?"#f59e0b":n.metadata.service==="openrouteservice"?"#059669":"#3b82f6",r=()=>{if(n.restrictions?.cannotAccommodate)return"5, 10";if(n.restrictions?.violatedDimensions.length)return"10, 5";if(n.warnings&&n.warnings.length>0)return"15, 5"};return a.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(ht,{positions:a,color:"#ffffff",weight:8,opacity:.6,className:"calculated-route-outline",interactive:!1}),e.jsx(ht,{positions:a,color:t(),weight:6,opacity:.8,className:"calculated-route",dashArray:r()}),s.segments?.map((i,o)=>{const c=a[Math.floor(o*a.length/s.segments.length)],l=a[Math.floor((o+1)*a.length/s.segments.length)];if(c&&l){const m=gt(c[0],c[1],l[0],l[1]),h=Sa(i.distance,i.duration);return e.jsx(ke,{position:m,icon:h,zIndexOffset:1500,children:e.jsx($e,{children:e.jsxs("div",{className:"p-2",children:[e.jsxs("h3",{className:"font-semibold text-sm mb-2",children:["Route Segment ",o+1]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Distance:"}),e.jsx("span",{className:"font-medium",children:Jt(i.distance)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duration:"}),e.jsx("span",{className:"font-medium",children:Yt(i.duration)})]}),i.steps&&i.steps.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-gray-600 font-medium",children:"Instructions:"}),e.jsxs("div",{className:"max-h-24 overflow-y-auto",children:[i.steps.slice(0,3).map((u,g)=>e.jsxs("div",{className:"text-xs text-gray-700 mt-1",children:["â€¢ ",u.instruction]},g)),i.steps.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["... and ",i.steps.length-3," more steps"]})]})]})]})]})})},`segment-info-${o}`)}return null}),n.restrictions?.restrictedSegments?.map((i,o)=>{if(i.coordinates.length>=2){const c=i.coordinates[0],l=i.coordinates[i.coordinates.length-1],m=gt(c[1],c[0],l[1],l[0]),h=La(i);return e.jsx(ke,{position:m,icon:h,zIndexOffset:3e3,children:e.jsx($e,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2 text-red-600",children:"Route Restriction"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:i.restriction})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Severity:"}),e.jsx("span",{className:`font-medium capitalize ${i.severity==="error"?"text-red-600":"text-amber-600"}`,children:i.severity})]}),e.jsx("div",{className:"mt-2 text-gray-600",children:i.severity==="error"?"Vehicle cannot pass this section":"Caution: Check vehicle dimensions"})]})]})})},`restriction-${o}`)}return null})]})},Ea=({waypoints:n})=>{const s=d.useMemo(()=>{if(n.length<2)return[];const t=[];for(let r=0;r<n.length-1;r++)t.push({start:n[r],end:n[r+1],segmentIndex:r,totalSegments:n.length-1});return t},[n]),a=(t,r)=>{if(r===1)return"#94a3b8";const i=t/(r-1),o={r:34,g:197,b:94},c={r:239,g:68,b:68},l=Math.round(o.r+(c.r-o.r)*i),m=Math.round(o.g+(c.g-o.g)*i),h=Math.round(o.b+(c.b-o.b)*i);return`rgb(${l}, ${m}, ${h})`};return e.jsx(e.Fragment,{children:s.map((t,r)=>{const i=Ma(t.start.lat,t.start.lng,t.end.lat,t.end.lng),o=gt(t.start.lat,t.start.lng,t.end.lat,t.end.lng),c=Ca(i),l=a(t.segmentIndex,t.totalSegments);return e.jsxs(Ot.Fragment,{children:[e.jsx(ht,{positions:[[t.start.lat,t.start.lng],[t.end.lat,t.end.lng]],color:l,weight:4,opacity:.6,className:"straight-line-route",dashArray:"8, 4"}),e.jsx(ke,{position:o,icon:c,zIndexOffset:1e3})]},`segment-${t.start.id}-${t.end.id}`)})})},Ia=()=>{const{waypoints:n,calculatedRoute:s}=ne();return n.length===0?null:e.jsxs(e.Fragment,{children:[s?e.jsx(Ta,{route:s}):n.length>=2?e.jsx(Ea,{waypoints:n}):null,n.map((a,t)=>e.jsx(Da,{waypoint:a,index:t,total:n.length},`number-${a.id}`))]})},Aa=()=>{const{undo:n,redo:s,canUndo:a,canRedo:t,clearRoute:r,waypoints:i,isValidForRouting:o}=ne();return d.useEffect(()=>{const c=l=>{if(l.target instanceof HTMLInputElement||l.target instanceof HTMLTextAreaElement||l.target?.contentEditable==="true")return;const m={"ctrl+z":()=>{a()&&(l.preventDefault(),n())},"ctrl+y":()=>{t()&&(l.preventDefault(),s())},"ctrl+shift+z":()=>{t()&&(l.preventDefault(),s())},delete:()=>{i.length>0&&console.log("Delete shortcut pressed - UI should handle confirmation")},backspace:()=>{i.length>0&&console.log("Backspace shortcut pressed - UI should handle confirmation")},escape:()=>{console.log("Escape pressed")},"ctrl+a":()=>{l.preventDefault(),console.log("Select all waypoints")},"ctrl+shift+c":()=>{i.length>0&&(l.preventDefault(),console.log("Clear all shortcut pressed - UI should handle confirmation"))}},u=(b=>{const j=[];return(b.ctrlKey||b.metaKey)&&j.push("ctrl"),b.shiftKey&&j.push("shift"),b.altKey&&j.push("alt"),j.push(b.key.toLowerCase()),j.join("+")})(l),g=m[u];g&&g()};return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[n,s,a,t,r,i,o]),{shortcuts:[{key:"Ctrl+Z",description:"Undo last action",available:a()},{key:"Ctrl+Y",description:"Redo last action",available:t()},{key:"Ctrl+Shift+Z",description:"Redo last action",available:t()},{key:"Delete",description:"Delete selected waypoint",available:i.length>0},{key:"Ctrl+Shift+C",description:"Clear all waypoints",available:i.length>0},{key:"Escape",description:"Close dialogs/deselect",available:!0}],isValidForRouting:o()}},Ra=(n,s,a=!1,t=!1,r=!1)=>{const i={start:"bg-green-500 border-green-600 text-white shadow-green-200",waypoint:"bg-blue-500 border-blue-600 text-white shadow-blue-200",end:"bg-red-500 border-red-600 text-white shadow-red-200"},o={start:"ðŸš©",waypoint:s.toString(),end:"ðŸ"},c=r?56:48,h=S("flex items-center justify-center rounded-full border-3 font-bold cursor-pointer relative touch-manipulation",r?"w-14 h-14":"w-12 h-12",r?"text-lg":"text-base","transform transition-all duration-200",i[n]),u=S(a&&"scale-125 ring-4 ring-white ring-opacity-60",t&&"scale-110 shadow-2xl z-50",!t&&!a&&"hover:scale-105 active:scale-95 hover:shadow-lg shadow-md"),g=r?`
    <div class="absolute -inset-2 rounded-full" style="touch-action: none;"></div>
  `:"";return _e.divIcon({html:`
      <div class="${h} ${u}">
        ${g}
        <!-- Main icon content -->
        <span class="relative z-10">${o[n]}</span>

        <!-- Pulse effect for start/end points -->
        ${n==="start"||n==="end"?`
          <div class="absolute inset-0 rounded-full ${i[n].split(" ")[0]} opacity-20 animate-ping"></div>
        `:""}

        <!-- Selection indicator -->
        ${a?`
          <div class="absolute -inset-1 rounded-full border-2 border-white animate-pulse"></div>
        `:""}

        <!-- Drag drop zone indicator -->
        ${t?`
          <div class="absolute -inset-3 rounded-full border-2 border-dashed border-yellow-400 bg-yellow-100 bg-opacity-20"></div>
        `:""}
      </div>
    `,className:S("waypoint-marker",t&&"dragging",r&&"touch-target"),iconSize:[c,c],iconAnchor:[c/2,c/2],popupAnchor:[0,-c/2]})},za=(n,s)=>{switch(n){case"start":return"Start Point";case"end":return"Destination";case"waypoint":return`Waypoint ${s}`;default:return`Point ${s+1}`}},ft=(n,s,a,t)=>({id:`waypoint-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,lat:Number(n.toFixed(6)),lng:Number(s.toFixed(6)),type:a,name:za(a,t)}),$a=({waypoint:n,index:s,onDelete:a,onUpdate:t,onInsertAfter:r,onDragEnd:i})=>{const{selectedWaypoint:o,setSelectedWaypoint:c}=yt(),[l,m]=d.useState(null),[h,u]=d.useState(!1),[g,b]=d.useState(n.name),[j,C]=d.useState(n.notes||""),[N,k]=d.useState(!1),[,p]=d.useState(!1),w="ontouchstart"in window||navigator.maxTouchPoints>0,D=o===n.id,V=d.useCallback(()=>{c(n.id)},[n.id,c]),$=d.useCallback(y=>{y?.stopPropagation(),a(n.id)},[n.id,a]),z=d.useCallback(()=>{k(!0),"vibrate"in navigator&&navigator.vibrate(50)},[]),F=d.useCallback(y=>{k(!1);const O=y.target.getLatLng().lat,K=y.target.getLatLng().lng;i(n.id,O,K),"vibrate"in navigator&&navigator.vibrate([50,100,50])},[n.id,i]),G=d.useCallback(()=>{p(!0)},[]),R=d.useCallback(()=>{p(!1)},[]),A=d.useCallback(y=>{y.originalEvent.preventDefault();const{clientX:O,clientY:K}=y.originalEvent;m({x:O,y:K})},[]),T=d.useCallback(()=>{const y={};g.trim()!==n.name&&(y.name=g.trim()),j!==(n.notes||"")&&(y.notes=j),Object.keys(y).length>0&&t(n.id,y),u(!1)},[n.id,n.name,n.notes,g,j,t]),E=d.useCallback(()=>{b(n.name),C(n.notes||""),u(!1)},[n.name,n.notes]),J=d.useCallback(()=>{const y=ft(n.lat-.01,n.lng-.01,"waypoint",s);r(y,n.id)},[n,s,r]),Q=d.useCallback(()=>{const y=ft(n.lat+.01,n.lng+.01,"waypoint",s+1);r(y,n.id)},[n,s,r]),Z=[{id:"edit",label:"Edit Waypoint",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),onClick:()=>u(!0),shortcut:"E"},{id:"insert-before",label:"Insert Before",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),onClick:J,shortcut:"Shift+â†‘"},{id:"insert-after",label:"Insert After",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),onClick:Q,shortcut:"Shift+â†“"},{id:"delete",label:"Delete Waypoint",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:$,variant:"danger",shortcut:"Del"}],se=n.type==="campsite"||n.type==="accommodation"?"waypoint":n.type,re=Ra(se,s+1,D,N,w);return e.jsxs(e.Fragment,{children:[e.jsx(ke,{position:[n.lat,n.lng],icon:re,draggable:!0,eventHandlers:{click:V,contextmenu:A,dragstart:z,dragend:F,mouseover:G,mouseout:R},children:e.jsx($e,{eventHandlers:{click:y=>y.originalEvent?.stopPropagation()},children:e.jsxs("div",{className:"min-w-72 p-2",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:S("px-2 py-1 rounded text-xs font-semibold",n.type==="start"&&"bg-green-100 text-green-800",n.type==="waypoint"&&"bg-blue-100 text-blue-800",n.type==="end"&&"bg-red-100 text-red-800"),children:n.type==="start"?"START":n.type==="end"?"END":`WAYPOINT ${s+1}`}),e.jsx("span",{className:"text-xs text-gray-500",children:"Drag to move"})]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),u(!h)},className:"bg-blue-600 text-white hover:bg-blue-700 px-3 py-2 rounded text-sm font-bold transition-colors flex items-center space-x-2 border-2 border-blue-800 shadow-lg",title:"Edit waypoint","aria-label":"Edit waypoint",style:{minWidth:"80px",zIndex:1e3},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{children:"EDIT"})]})]}),h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:g,onChange:y=>b(y.target.value),onClick:y=>y.stopPropagation(),onFocus:y=>y.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter waypoint name",autoFocus:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:j,onChange:y=>C(y.target.value),onClick:y=>y.stopPropagation(),onFocus:y=>y.stopPropagation(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3,placeholder:"Add notes about this waypoint..."})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),T()},className:"flex-1 px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),E()},className:"flex-1 px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:n.name}),n.notes&&e.jsx("div",{className:"text-xs text-gray-600 bg-gray-50 rounded p-2",children:n.notes})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Coordinates"}),e.jsxs("div",{className:"text-xs text-gray-600 font-mono",children:[e.jsxs("div",{children:["Lat: ",n.lat.toFixed(6)]}),e.jsxs("div",{children:["Lng: ",n.lng.toFixed(6)]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),u(!0)},className:"flex-1 px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),$()},className:"flex-1 px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Delete"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),y.preventDefault(),c(null)},className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Close"})]})]})]})})}),e.jsx(ms,{isOpen:!!l,position:l||{x:0,y:0},items:Z,onClose:()=>m(null)})]})},Pa=({onMapRightClick:n})=>(Wt({contextmenu:s=>{s.originalEvent.preventDefault();const{lat:a,lng:t}=s.latlng,{clientX:r,clientY:i}=s.originalEvent;n(a,t,r,i)},dblclick:s=>{const{lat:a,lng:t}=s.latlng,{clientX:r,clientY:i}=s.originalEvent;n(a,t,r,i)}}),null),_a=()=>{const{waypoints:n,addWaypoint:s,removeWaypoint:a,updateWaypoint:t,insertWaypoint:r}=ne(),{addNotification:i}=oe(),[o,c]=d.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[l,m]=d.useState({isOpen:!1,position:{x:0,y:0},coordinates:{lat:0,lng:0}});Aa();const h=d.useCallback((N,k,p,w)=>{m({isOpen:!0,position:{x:p,y:w},coordinates:{lat:N,lng:k}})},[]),u=d.useCallback((N,k)=>{const p=ft(N,k,"waypoint",n.length);try{s(p),i({type:"success",message:`Added ${p.name} to route`})}catch{i({type:"error",message:"Failed to add waypoint"})}},[n.length,s,i]),g=d.useCallback(N=>{const k=n.find(p=>p.id===N);try{a(N),i({type:"success",message:`Removed ${k?.name||"waypoint"} from route`})}catch{i({type:"error",message:"Failed to remove waypoint"})}},[n,a,i]),b=d.useCallback((N,k)=>{try{t(N,k),(k.name||k.notes)&&i({type:"success",message:"Waypoint updated successfully"})}catch{i({type:"error",message:"Failed to update waypoint"})}},[t,i]),j=d.useCallback((N,k)=>{try{r(N,k),i({type:"success",message:`Inserted ${N.name} into route`})}catch{i({type:"error",message:"Failed to insert waypoint"})}},[r,i]),C=d.useCallback((N,k,p)=>{try{t(N,{lat:Number(k.toFixed(6)),lng:Number(p.toFixed(6))}),i({type:"success",message:"Waypoint position updated"})}catch{i({type:"error",message:"Failed to update waypoint position"})}},[t,i]);return e.jsxs(e.Fragment,{children:[typeof window<"u"&&e.jsx(Pa,{onMapRightClick:h}),e.jsx(Ia,{}),n.map((N,k)=>e.jsx($a,{waypoint:N,index:k,onDelete:g,onUpdate:b,onInsertAfter:j,onDragEnd:C},N.id)),e.jsx(Vt,{isOpen:o.isOpen,title:o.title,message:o.message,confirmLabel:"Clear All",confirmVariant:"danger",onConfirm:o.onConfirm,onCancel:()=>c(N=>({...N,isOpen:!1}))}),l.isOpen&&e.jsx("div",{className:"fixed z-[10000] bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[160px]",style:{left:l.position.x,top:l.position.y},onMouseLeave:()=>m(N=>({...N,isOpen:!1})),children:e.jsxs("button",{onClick:()=>{u(l.coordinates.lat,l.coordinates.lng),m(N=>({...N,isOpen:!1}))},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 flex items-center space-x-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Add Waypoint"})]})}),l.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[9999]",onClick:()=>m(N=>({...N,isOpen:!1}))})]})},Ve=[{id:"openstreetmap",name:"OpenStreetMap",description:"Standard street map",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,subdomains:["a","b","c"],category:"standard",icon:"ðŸ—ºï¸"},{id:"opentopomap",name:"OpenTopoMap",description:"Topographic map with contours",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attribution:'Map data: Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: Â© <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',maxZoom:15,subdomains:["a","b","c"],category:"topographic",icon:"ðŸ”ï¸"},{id:"cyclosm",name:"CyclOSM",description:"Cycling-focused map",url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors. Tiles style by <a href="https://www.cyclosm.org">CyclOSM</a> hosted by <a href="https://openstreetmap.fr">OpenStreetMap France</a>',maxZoom:19,subdomains:["a","b","c"],category:"outdoor",icon:"ðŸš´"},{id:"humanitarian",name:"Humanitarian",description:"Clear, humanitarian mapping style",url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors. Tiles style by <a href="https://www.hotosm.org">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr">OpenStreetMap France</a>',maxZoom:19,subdomains:["a","b"],category:"standard",icon:"ðŸ¥"}],Ba=({currentLayerId:n,onLayerChange:s,collapsed:a=!1,onToggleCollapse:t})=>{const{addNotification:r}=oe(),[i,o]=d.useState(null),c=d.useCallback(async m=>{if(m!==n){o(m);try{const h=Ve.find(b=>b.id===m);if(!h)throw new Error("Layer not found");const u=h.url.replace("{s}",h.subdomains?.[0]||"").replace("{z}","5").replace("{x}","16").replace("{y}","10"),g=new Image;await new Promise((b,j)=>{g.onload=b,g.onerror=j,g.src=u,setTimeout(()=>j(new Error("Tile load timeout")),5e3)}),s(m),r({type:"success",message:`Switched to ${h.name} map layer`})}catch{r({type:"error",message:`Failed to load ${Ve.find(u=>u.id===m)?.name} layer`})}finally{o(null)}}},[n,s,r]),l=Ve.find(m=>m.id===n);return a?e.jsxs(e.Fragment,{children:[l&&e.jsx(wt,{url:l.url,attribution:l.attribution,subdomains:l.subdomains,maxZoom:l.maxZoom,detectRetina:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:4},l.id),e.jsx("div",{className:"absolute top-4 left-4 z-30 bg-white rounded-lg shadow-md",children:e.jsx("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center hover:bg-gray-50 transition-colors rounded-lg",title:`Current: ${l?.name||"Unknown"}`,"aria-label":"Open layer control",children:e.jsx("span",{className:"text-lg",children:l?.icon||"ðŸ—ºï¸"})})})]}):e.jsxs(e.Fragment,{children:[l&&e.jsx(wt,{url:l.url,attribution:l.attribution,subdomains:l.subdomains,maxZoom:l.maxZoom,detectRetina:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:4},l.id),e.jsxs("div",{className:"absolute top-4 left-4 z-30 bg-white rounded-lg shadow-md overflow-hidden min-w-64",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm",children:"Map Layers"}),t&&e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors","aria-label":"Collapse layer control",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-2 space-y-1",children:Ve.map(m=>{const h=m.id===n,u=i===m.id;return e.jsxs("button",{onClick:()=>c(m.id),disabled:u,className:S("w-full flex items-center space-x-3 p-2 rounded-lg text-left transition-all",h?"bg-blue-50 text-blue-900 border border-blue-200":"hover:bg-gray-50 text-gray-700",u&&"opacity-50 cursor-wait"),children:[e.jsx("div",{className:"flex-shrink-0",children:u?e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"})}):e.jsx("span",{className:"text-lg",children:m.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-sm",children:m.name}),h&&e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:m.description})]})]},m.id)})}),l&&e.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Current Layer"}),e.jsx("span",{className:"text-blue-600",children:l.name})]}),e.jsxs("div",{className:"text-gray-500",children:["Max Zoom: ",l.maxZoom,"x â€¢ Category: ",l.category]})]})})]})]})},Fa=n=>{if(n.length===0)return null;let s=n[0].lat,a=n[0].lat,t=n[0].lng,r=n[0].lng;return n.forEach(i=>{s=Math.max(s,i.lat),a=Math.min(a,i.lat),t=Math.max(t,i.lng),r=Math.min(r,i.lng)}),{north:s,south:a,east:t,west:r}},vt=(n,s,a={})=>{if(s.length===0)return!1;const t=Fa(s);if(!t)return!1;const{padding:r=[50,50],maxZoom:i=15,minZoom:o=3,animate:c=!0,duration:l=1e3}=a;try{if(s.length===1){const m=s[0];n.setView([m.lat,m.lng],10,{animate:c,duration:l/1e3})}else{const h=Ce.latLngBounds([t.south,t.west],[t.north,t.east]).pad(.1);n.fitBounds(h,{padding:r,maxZoom:i,animate:c,duration:l/1e3})}return!0}catch(m){return console.error("Error fitting bounds:",m),!1}},Oa=(n,s,a,t)=>{const i=He(a-n),o=He(t-s),c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(He(n))*Math.cos(He(a))*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},He=n=>n*(Math.PI/180),Wa=n=>{if(n.length<2)return 0;let s=0;for(let a=0;a<n.length-1;a++){const t=n[a],r=n[a+1];s+=Oa(t.lat,t.lng,r.lat,r.lng)}return s},Va=({map:n,onToggleFullscreen:s,onToggleLayerControl:a,onResetView:t})=>{const{waypoints:r}=ne(),i=d.useCallback(()=>{n&&n.zoomIn()},[n]),o=d.useCallback(()=>{n&&n.zoomOut()},[n]),c=d.useCallback(()=>{if(n){const N=n.getCenter(),k=n.getZoom(),p=180/Math.pow(2,k)*.25;n.panTo([N.lat+p,N.lng])}},[n]),l=d.useCallback(()=>{if(n){const N=n.getCenter(),k=n.getZoom(),p=180/Math.pow(2,k)*.25;n.panTo([N.lat-p,N.lng])}},[n]),m=d.useCallback(()=>{if(n){const N=n.getCenter(),k=n.getZoom(),p=360/Math.pow(2,k)*.25;n.panTo([N.lat,N.lng-p])}},[n]),h=d.useCallback(()=>{if(n){const N=n.getCenter(),k=n.getZoom(),p=360/Math.pow(2,k)*.25;n.panTo([N.lat,N.lng+p])}},[n]),u=d.useCallback(()=>{n&&r.length>0&&vt(n,r,{padding:[50,50],maxZoom:15,animate:!0,duration:1e3})},[n,r]),g=d.useCallback(()=>{t&&t()},[t]),b=d.useCallback(()=>{s&&s()},[s]),j=d.useCallback(()=>{a&&a()},[a]);return d.useEffect(()=>{const N=k=>{if(k.target instanceof HTMLInputElement||k.target instanceof HTMLTextAreaElement||k.target?.contentEditable==="true")return;const p=k.ctrlKey||k.metaKey,w=k.shiftKey,D=k.altKey;switch(k.key.toLowerCase()){case"+":case"=":p||(k.preventDefault(),i());break;case"-":case"_":p||(k.preventDefault(),o());break;case"arrowup":!p&&!w&&(k.preventDefault(),c());break;case"arrowdown":!p&&!w&&(k.preventDefault(),l());break;case"arrowleft":!p&&!w&&(k.preventDefault(),m());break;case"arrowright":!p&&!w&&(k.preventDefault(),h());break;case"w":p||(k.preventDefault(),c());break;case"s":p||(k.preventDefault(),l());break;case"a":p||(k.preventDefault(),m());break;case"d":p||(k.preventDefault(),h());break;case"f":p?(k.preventDefault(),u()):D&&(k.preventDefault(),b());break;case"r":p&&(k.preventDefault(),g());break;case"l":p&&(k.preventDefault(),j());break;case"0":p||(k.preventDefault(),g());break;case"home":k.preventDefault(),u();break;case"end":k.preventDefault(),g();break}};return document.addEventListener("keydown",N),()=>{document.removeEventListener("keydown",N)}},[i,o,c,l,m,h,u,g,b,j]),{shortcuts:[{key:"+/-",description:"Zoom in/out",action:i,available:!!n},{key:"â†‘â†“â†â†’",description:"Pan map",action:c,available:!!n},{key:"WASD",description:"Pan map (alternative)",action:c,available:!!n},{key:"Ctrl+F",description:"Zoom to fit waypoints",action:u,available:r.length>0},{key:"Ctrl+R",description:"Reset view",action:g,available:!!t},{key:"Alt+F",description:"Toggle fullscreen",action:b,available:!!s},{key:"Ctrl+L",description:"Toggle layer control",action:j,available:!!a},{key:"Home",description:"Zoom to fit waypoints",action:u,available:r.length>0},{key:"End",description:"Reset view",action:g,available:!!t},{key:"0",description:"Reset view",action:g,available:!!t}].filter(N=>N.available),actions:{zoomIn:i,zoomOut:o,panUp:c,panDown:l,panLeft:m,panRight:h,zoomToFit:u,resetView:g,toggleFullscreen:b,toggleLayerControl:j}}},Ha=({map:n,isFullscreen:s,onToggleFullscreen:a,onResetView:t,onToggleLayerControl:r,layerControlCollapsed:i})=>{const{waypoints:o}=ne(),{addNotification:c}=oe(),[l,m]=d.useState(!1),{shortcuts:h,actions:u}=Va({map:n,onToggleFullscreen:a,onToggleLayerControl:r,onResetView:t}),g=d.useCallback(()=>{if(!n||o.length===0){c({type:"warning",message:"Add waypoints to use zoom to fit"});return}const C=vt(n,o,{padding:[50,50],maxZoom:15,animate:!0,duration:1e3});c(C?{type:"success",message:"Zoomed to fit all waypoints"}:{type:"error",message:"Failed to zoom to waypoints"})},[n,o,c]),b=d.useCallback(()=>{n&&u.zoomIn()},[n,u]),j=d.useCallback(()=>{n&&u.zoomOut()},[n,u]);return Wa(o),e.jsxs("div",{className:"absolute top-4 right-3 z-40 flex flex-col space-y-2 hidden sm:flex",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:b,className:"block w-10 h-10 flex items-center justify-center hover:bg-gray-50 border-b border-gray-200 transition-colors",title:"Zoom in (+)","aria-label":"Zoom in",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{onClick:j,className:"block w-10 h-10 flex items-center justify-center hover:bg-gray-50 transition-colors",title:"Zoom out (-)","aria-label":"Zoom out",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:g,disabled:o.length===0,className:S("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",o.length>0?"hover:bg-gray-50 text-gray-700":"text-gray-300 cursor-not-allowed"),title:`Zoom to fit waypoints (Ctrl+F)${o.length===0?" - Add waypoints first":""}`,"aria-label":"Zoom to fit all waypoints",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),e.jsx("button",{onClick:t,className:"block w-10 h-10 flex items-center justify-center hover:bg-gray-50 border-b border-gray-200 transition-colors",title:"Reset to Europe view (Ctrl+R)","aria-label":"Reset to Europe view",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a9 9 0 019 9 9 9 0 019-9M12 12V9"})})}),e.jsx("button",{onClick:r,className:S("block w-10 h-10 flex items-center justify-center hover:bg-gray-50 border-b border-gray-200 transition-colors",!i&&"bg-blue-50 text-blue-600"),title:"Toggle layer control (Ctrl+L)","aria-label":"Toggle map layer control",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),e.jsx("button",{onClick:a,className:S("block w-10 h-10 flex items-center justify-center hover:bg-gray-50 transition-colors",s&&"bg-blue-50 text-blue-600"),title:`${s?"Exit":"Enter"} fullscreen (Alt+F)`,"aria-label":`${s?"Exit":"Enter"} fullscreen mode`,children:s?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4.5M9 9H4.5M9 9L3.5 3.5M15 9h4.5M15 9V4.5M15 9l5.5-5.5M9 15v4.5M9 15H4.5M9 15l-5.5 5.5M15 15h4.5M15 15v4.5m0-4.5l5.5 5.5"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsx("button",{onClick:()=>m(!l),className:S("bg-white rounded-lg shadow-md p-2 hover:bg-gray-50 transition-colors",l&&"bg-blue-50 text-blue-600"),title:"Show keyboard shortcuts","aria-label":"Toggle keyboard shortcuts help",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})})}),l&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 min-w-64 max-w-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3 text-sm",children:"Keyboard Shortcuts"}),e.jsx("div",{className:"space-y-2",children:h.map((C,N)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:C.description}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded text-gray-900 font-mono",children:C.key})]},N))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Shortcuts work when not typing in input fields"})})]})]})},Ua=({map:n,isFullscreen:s,onToggleFullscreen:a,onResetView:t,onToggleLayerControl:r,className:i})=>{const{waypoints:o}=ne(),{addNotification:c}=oe(),[l,m]=d.useState(!1),[h,u]=d.useState(!1);d.useEffect(()=>{const p=()=>{u(window.innerWidth<768||"ontouchstart"in window)};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]);const g=d.useCallback(()=>{n&&n.zoomIn()},[n]),b=d.useCallback(()=>{n&&n.zoomOut()},[n]),j=d.useCallback(()=>{if(!n||o.length===0){c({type:"warning",message:"Add waypoints to use zoom to fit"});return}vt(n,o,{padding:[60,60],maxZoom:14,animate:!0,duration:800})&&c({type:"success",message:"Zoomed to fit waypoints"}),m(!1)},[n,o,c]),C=d.useCallback(()=>{a(),m(!1)},[a]),N=d.useCallback(()=>{t(),m(!1)},[t]),k=d.useCallback(()=>{r(),m(!1)},[r]);return h?e.jsxs("div",{className:S("fixed bottom-4 right-4 z-40 flex flex-col items-end space-y-2","sm:hidden",i),children:[l&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-2 grid grid-cols-2 gap-2 animate-fade-in",children:[e.jsxs("button",{onClick:j,disabled:o.length===0,className:S("flex flex-col items-center justify-center h-16 w-16 rounded-lg transition-colors",o.length>0?"bg-blue-50 hover:bg-blue-100 text-blue-600 active:bg-blue-200":"bg-gray-50 text-gray-300 cursor-not-allowed"),children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs font-medium",children:"Fit"})]}),e.jsxs("button",{onClick:N,className:"flex flex-col items-center justify-center h-16 w-16 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 active:bg-gray-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a9 9 0 019 9 9 9 0 019-9M12 12V9"})}),e.jsx("span",{className:"text-xs font-medium",children:"Reset"})]}),e.jsxs("button",{onClick:k,className:"flex flex-col items-center justify-center h-16 w-16 rounded-lg bg-purple-50 hover:bg-purple-100 text-purple-600 active:bg-purple-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),e.jsx("span",{className:"text-xs font-medium",children:"Layers"})]}),e.jsx("button",{onClick:C,className:S("flex flex-col items-center justify-center h-16 w-16 rounded-lg transition-colors",s?"bg-blue-100 text-blue-700 active:bg-blue-200":"bg-green-50 hover:bg-green-100 text-green-600 active:bg-green-200"),children:s?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4.5M9 9H4.5M9 9L3.5 3.5M15 9h4.5M15 9V4.5M15 9l5.5-5.5M9 15v4.5M9 15H4.5M9 15l-5.5 5.5M15 15h4.5M15 15v4.5m0-4.5l5.5 5.5"})}),e.jsx("span",{className:"text-xs font-medium",children:"Exit"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs font-medium",children:"Full"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:g,className:"w-12 h-12 flex items-center justify-center hover:bg-gray-50 active:bg-gray-100 border-r border-gray-200 transition-colors","aria-label":"Zoom in",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{onClick:b,className:"w-12 h-12 flex items-center justify-center hover:bg-gray-50 active:bg-gray-100 transition-colors","aria-label":"Zoom out",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})})]})}),e.jsx("button",{onClick:()=>m(!l),className:S("w-12 h-12 bg-blue-600 text-white rounded-lg shadow-lg flex items-center justify-center transition-all",l?"bg-gray-600 rotate-45":"hover:bg-blue-700 active:bg-blue-800"),"aria-label":l?"Close more options":"Open more options",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),o.length===0&&e.jsx("div",{className:"bg-blue-600 text-white rounded-lg shadow-lg p-3 max-w-48",children:e.jsx("p",{className:"text-xs text-center",children:"Tap map to add waypoints"})})]}):null},Je=({content:n,children:s,position:a="auto",size:t="md",variant:r="default",delay:i=500,disabled:o=!1,className:c,maxWidth:l="300px",showArrow:m=!0,trigger:h="hover",interactive:u=!1})=>{const[g,b]=d.useState(!1),[j,C]=d.useState(a),[N,k]=d.useState({x:0,y:0}),p=d.useRef(null),w=d.useRef(null),D=d.useRef(),V={default:"bg-gray-900 text-white border-gray-700",info:"bg-blue-600 text-white border-blue-500",warning:"bg-yellow-600 text-white border-yellow-500",error:"bg-red-600 text-white border-red-500",success:"bg-green-600 text-white border-green-500"},$={sm:"text-xs px-2 py-1",md:"text-sm px-3 py-2",lg:"text-base px-4 py-3"},z=y=>{if(a!=="auto")return a;const{innerWidth:O,innerHeight:K}=window,te=window.scrollX,x=window.scrollY,L=y.top-x,B=K-(y.bottom-x),P=y.left-te,v=O-(y.right-te);return B>=60?"bottom":L>=60?"top":v>=150?"right":P>=150?"left":"bottom"},F=(y,O)=>{const K=w.current;if(!K)return{x:0,y:0};const te=K.getBoundingClientRect(),x=window.scrollX,L=window.scrollY;let B=0,P=0;switch(O){case"top":B=y.left+x+y.width/2-te.width/2,P=y.top+L-te.height-8;break;case"bottom":B=y.left+x+y.width/2-te.width/2,P=y.bottom+L+8;break;case"left":B=y.left+x-te.width-8,P=y.top+L+y.height/2-te.height/2;break;case"right":B=y.right+x+8,P=y.top+L+y.height/2-te.height/2;break}const v=8;return B=Math.max(v,Math.min(B,window.innerWidth+x-te.width-v)),P=Math.max(v,Math.min(P,window.innerHeight+L-te.height-v)),{x:B,y:P}},G=()=>{o||!n||(D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{const y=p.current;if(!y)return;const O=y.getBoundingClientRect(),K=z(O);C(K),b(!0),requestAnimationFrame(()=>{const te=F(O,K);k(te)})},i))},R=()=>{D.current&&clearTimeout(D.current),u?D.current=setTimeout(()=>{b(!1)},100):b(!1)},A=()=>{h==="hover"&&G()},T=()=>{h==="hover"&&R()},E=()=>{h==="click"&&(g?R():G())},J=()=>{h==="focus"&&G()},Q=()=>{h==="focus"&&R()},Z=()=>{u&&D.current&&clearTimeout(D.current)},se=()=>{u&&R()};d.useEffect(()=>()=>{D.current&&clearTimeout(D.current)},[]);const re=({position:y})=>{if(!m)return null;const O={top:"border-l-transparent border-r-transparent border-b-0 border-t-8 border-t-gray-900 bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full",bottom:"border-l-transparent border-r-transparent border-t-0 border-b-8 border-b-gray-900 top-0 left-1/2 transform -translate-x-1/2 -translate-y-full",left:"border-t-transparent border-b-transparent border-r-0 border-l-8 border-l-gray-900 right-0 top-1/2 transform translate-x-full -translate-y-1/2",right:"border-t-transparent border-b-transparent border-l-0 border-r-8 border-r-gray-900 left-0 top-1/2 transform -translate-x-full -translate-y-1/2"};return e.jsx("div",{className:S("absolute w-0 h-0",O[y]||O.bottom),style:{borderColor:r==="default"?"rgb(17 24 39)":V[r].split(" ")[0].replace("bg-","rgb(")}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:p,onMouseEnter:A,onMouseLeave:T,onClick:E,onFocus:J,onBlur:Q,className:"inline-block",children:s}),g&&e.jsxs("div",{ref:w,role:"tooltip",className:S("fixed z-50 rounded-lg border shadow-lg transition-opacity duration-200","pointer-events-auto select-text",V[r],$[t],c),style:{left:N.x,top:N.y,maxWidth:l,pointerEvents:u?"auto":"none"},onMouseEnter:Z,onMouseLeave:se,children:[n,e.jsx(re,{position:j})]})]})},Ue={height:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},width:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},length:{metric:{label:"m",factor:1},imperial:{label:"ft",factor:3.28084}},weight:{metric:{label:"t",factor:1},imperial:{label:"lbs",factor:2204.62}}},qe={height:{min:1.5,max:4.5,step:.1},width:{min:1.5,max:3,step:.1},weight:{min:1,max:40,step:.1},length:{min:3,max:20,step:.1}},qa=({className:n,onClose:s,compact:a=!1})=>{const{profile:t,setProfile:r,clearProfile:i}=ie(),{addNotification:o}=oe(),[c,l]=d.useState("vehicle"),[m,h]=d.useState(""),[u,g]=d.useState(""),[b,j]=d.useState(""),[C,N]=d.useState(""),[k,p]=d.useState(t||{height:2,width:1.9,weight:3,length:5}),[w,D]=d.useState({}),[V,$]=d.useState(!1),[z,F]=d.useState(()=>localStorage.getItem("camper-planner-unit-system")||"metric"),[G,R]=d.useState(!1),A=d.useMemo(()=>m?ts(m):[],[m]),T=d.useMemo(()=>m&&u?ss(m,u):[],[m,u]);d.useEffect(()=>{t&&(p(t),$(!1))},[t]),d.useEffect(()=>{localStorage.setItem("camper-planner-unit-system",z)},[z]);const E=d.useCallback((v,_)=>{const W=qe[v];return isNaN(_)||_<=0?`${v} must be a positive number`:_<W.min?`${v} must be at least ${W.min}${Ue[v].metric.label}`:_>W.max?`${v} cannot exceed ${W.max}${Ue[v].metric.label}`:""},[]),J=d.useCallback(v=>{const _={};return["height","width","weight","length"].forEach(H=>{const q=E(H,v[H]);q&&(_[H]=q)}),_},[E]),Q=d.useCallback((v,_,W,H)=>{if(W===H)return v;const q=Ue[_];return W==="metric"&&H==="imperial"?v*q.imperial.factor:W==="imperial"&&H==="metric"?v/q.imperial.factor:v},[]),Z=d.useCallback(v=>Q(k[v],v,"metric",z),[k,z,Q]),se=d.useCallback((v,_)=>{const W=Q(_,v,z,"metric");p(q=>({...q,[v]:W})),$(!0);const H=E(v,W);D(q=>({...q,[v]:H}))},[z,Q,E]),re=d.useCallback(v=>{h(v),g(""),j("")},[]),y=d.useCallback(v=>{g(v),j("")},[]),O=d.useCallback(v=>{j(v);const _=T.find(W=>W.id===v);if(_){const W={height:_.height,width:_.width,weight:_.weight,length:_.length};p(W),$(!0),D({});const H=st.find(U=>U.id===m),q=H?.models.find(U=>U.id===u);o({type:"info",message:`Applied ${H?.name} ${q?.name} ${_.name} dimensions`})}},[T,m,u,o]),K=d.useCallback(v=>{N(v);const _=je.find(W=>W.id===v);if(_){const W={height:_.height,width:_.width,weight:_.weight,length:_.length};p(W),$(!0),D({}),o({type:"info",message:`Applied ${_.name} dimensions`})}},[o]),te=d.useCallback(async()=>{const v=J(k);if(D(v),Object.keys(v).length===0){R(!0);try{await new Promise(_=>setTimeout(_,300)),r(k),$(!1),o({type:"success",message:"Vehicle profile saved successfully"}),s&&s()}catch{o({type:"error",message:"Failed to save vehicle profile"})}finally{R(!1)}}else o({type:"error",message:"Please fix validation errors before saving"})},[k,J,r,o,s]),x=d.useCallback(()=>{p(t||{height:2,width:1.9,weight:3,length:5}),D({}),$(!1),h(""),g(""),j(""),N("")},[t]),L=d.useCallback(()=>{i(),p({height:2,width:1.9,weight:3,length:5}),D({}),$(!1),h(""),g(""),j(""),N(""),o({type:"info",message:"Vehicle profile cleared"})},[i,o]),B=d.useCallback(()=>{F(v=>v==="metric"?"imperial":"metric")},[]),P=({field:v,label:_,icon:W,helpText:H})=>{const q=Z(v),U=!!w[v],ee=Ue[v][z];return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-base",children:W}),e.jsx("label",{htmlFor:v,className:"text-sm font-medium text-gray-700",children:_}),H&&e.jsx(Je,{content:H,size:"sm",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-gray-400 cursor-help",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:v,type:"number",value:q.toFixed(1),onChange:ae=>se(v,parseFloat(ae.target.value)||0),step:qe[v].step,min:Q(qe[v].min,v,"metric",z),max:Q(qe[v].max,v,"metric",z),className:S("w-full px-3 py-2 pr-12 border rounded-lg text-sm focus:outline-none focus:ring-2 transition-colors",U?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"),placeholder:`Enter ${_.toLowerCase()}`}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm",children:ee.label})})]}),U&&e.jsx("p",{className:"text-red-600 text-xs",children:w[v]})]})};return e.jsxs("div",{className:S("bg-white rounded-lg",a?"":"shadow-lg border border-gray-200 p-6",n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 flex items-center",children:"ðŸš Vehicle Profile"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Set your vehicle dimensions for safe routing"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Je,{content:`Switch to ${z==="metric"?"imperial":"metric"} units`,children:e.jsx("button",{onClick:B,className:S("px-2 py-1 rounded text-xs font-medium transition-colors",z==="metric"?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"),children:z==="metric"?"Metric":"Imperial"})})})]}),e.jsxs("div",{className:"flex space-x-1 mb-4 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>l("vehicle"),className:S("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",c==="vehicle"?"bg-white text-blue-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"ðŸš Base Vehicle"}),e.jsx("button",{onClick:()=>l("motorhome"),className:S("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",c==="motorhome"?"bg-white text-blue-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"ðŸšŒ Motorhome"}),e.jsx("button",{onClick:()=>l("custom"),className:S("flex-1 px-3 py-2 text-xs font-medium rounded-md transition-colors",c==="custom"?"bg-white text-blue-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"âœï¸ Custom"})]}),c==="vehicle"&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Select your base vehicle to auto-fill dimensions"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Make"}),e.jsxs("select",{value:m,onChange:v=>re(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select make..."}),st.map(v=>e.jsxs("option",{value:v.id,children:[v.name," (",v.country,")"]},v.id))]})]}),m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Model"}),e.jsxs("select",{value:u,onChange:v=>y(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select model..."}),A.map(v=>e.jsx("option",{value:v.id,children:v.name},v.id))]})]}),u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Size / Variant"}),e.jsxs("select",{value:b,onChange:v=>O(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select variant..."}),T.map(v=>e.jsxs("option",{value:v.id,children:[v.name," (",v.length,"m Ã— ",v.height,"m)"]},v.id))]})]}),b&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Selected:"})," ",st.find(v=>v.id===m)?.name," ",A.find(v=>v.id===u)?.name," ",T.find(v=>v.id===b)?.name]})})]}),c==="motorhome"&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Select a popular motorhome model"}),e.jsxs("select",{value:C,onChange:v=>K(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select motorhome..."}),e.jsx("optgroup",{label:"Compact Campervans",children:je.filter(v=>v.length<5.5).map(v=>e.jsxs("option",{value:v.id,children:[v.name," (",v.length,"m)"]},v.id))}),e.jsx("optgroup",{label:"Medium Motorhomes",children:je.filter(v=>v.length>=5.5&&v.length<7).map(v=>e.jsxs("option",{value:v.id,children:[v.name," (",v.length,"m)"]},v.id))}),e.jsx("optgroup",{label:"Large Motorhomes",children:je.filter(v=>v.length>=7&&v.length<10).map(v=>e.jsxs("option",{value:v.id,children:[v.name," (",v.length,"m)"]},v.id))}),e.jsx("optgroup",{label:"Car + Caravan",children:je.filter(v=>v.length>=10).map(v=>e.jsxs("option",{value:v.id,children:[v.name," (",v.length,"m)"]},v.id))})]}),C&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(()=>{const v=je.find(_=>_.id===C);return v?e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:v.name}),e.jsxs("div",{className:"text-blue-600 mt-1",children:["Base: ",v.base," â€¢ ",v.make]})]}):null})()})]}),c==="custom"&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-gray-600",children:"Enter your vehicle dimensions manually below. Measure your vehicle including any roof equipment (AC, antenna, solar panels)."})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(P,{field:"height",label:"Height",icon:"ðŸ“",helpText:"Max height including roof equipment"}),e.jsx(P,{field:"width",label:"Width",icon:"â†”ï¸",helpText:"Max width including mirrors"}),e.jsx(P,{field:"length",label:"Length",icon:"ðŸ“",helpText:"Total length front to back"}),e.jsx(P,{field:"weight",label:"Weight",icon:"âš–ï¸",helpText:"Gross vehicle weight when loaded"})]}),t&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h3",{className:"text-xs font-medium text-green-800 mb-1",children:"âœ… Saved Profile"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs text-green-700",children:[e.jsxs("div",{children:["H: ",t.height,"m"]}),e.jsxs("div",{children:["W: ",t.width,"m"]}),e.jsxs("div",{children:["L: ",t.length,"m"]}),e.jsxs("div",{children:["Wt: ",t.weight,"t"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:te,disabled:!V||Object.keys(w).length>0||G,className:S("flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center",V&&Object.keys(w).length===0&&!G?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:[G&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:G?"Saving...":t?"Update":"Save"})]}),e.jsx("button",{onClick:x,disabled:!V,className:S("px-4 py-2 rounded-lg text-sm font-medium border transition-colors",V?"border-gray-300 text-gray-700 hover:bg-gray-50":"border-gray-200 text-gray-400 cursor-not-allowed"),children:"Reset"}),t&&e.jsx("button",{onClick:L,className:"px-4 py-2 rounded-lg text-sm font-medium border border-red-300 text-red-700 hover:bg-red-50 transition-colors",children:"Clear"})]}),e.jsx("div",{className:"mt-4 p-2 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Routes will avoid roads with height/weight restrictions your vehicle cannot handle."]})})]})},Za=({className:n})=>{const{profile:s}=ie(),[a,t]=d.useState(!1),r=()=>s?{type:i(s),dimensions:`${s.height}Ã—${s.width}Ã—${s.length}m`,weight:`${s.weight}t`}:null,i=c=>{if(!c)return"Unknown";const{length:l,height:m,weight:h}=c;return l<=6&&m<=2.5&&h<=3.5?"Compact Camper":l<=8&&m<=3.2&&h<=7.5?"Medium Motorhome":l>10?"Car + Caravan":"Large Motorhome"},o=r();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:S("fixed top-4 left-4 z-40",n),children:e.jsx(Je,{content:s?"Edit vehicle profile":"Set up your vehicle profile",position:"right",size:"sm",children:e.jsx("button",{onClick:()=>t(!0),className:S("bg-white rounded-lg shadow-md border border-gray-200 p-3 transition-all duration-200","hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500",s?"text-green-700 border-green-200 bg-green-50":"text-blue-700 border-blue-200 bg-blue-50"),"aria-label":"Vehicle profile",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸš"}),e.jsx("div",{className:"text-left",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs font-medium",children:o?.type}),e.jsx("div",{className:"text-xs text-gray-600",children:o?.dimensions})]}):e.jsx("div",{className:"text-xs font-medium",children:"Setup Vehicle"})})]})})})}),a&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:()=>t(!1)}),e.jsx("div",{className:"absolute left-0 top-0 h-full w-full max-w-md bg-white shadow-xl transform transition-transform",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Vehicle Configuration"}),e.jsx("button",{onClick:()=>t(!1),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(qa,{onClose:()=>t(!1),compact:!0})})]})})]})]})},Ka=({className:n,autoCalculate:s=!0})=>{const{waypoints:a,setCalculatedRoute:t,isValidForRouting:r}=ne(),{profile:i}=ie(),{addNotification:o}=oe(),[c,l]=d.useState(!1),[m,h]=d.useState(null),[u,g]=d.useState(null),[b,j]=d.useState(null),[C,N]=d.useState(null),[k,p]=d.useState([]),[w,D]=d.useState(!1);d.useEffect(()=>{if(s&&r()&&pe.BASIC_ROUTING){const $=setTimeout(()=>{V()},1e3);return()=>clearTimeout($)}},[a,s]),d.useEffect(()=>{if(s&&r()&&pe.BASIC_ROUTING&&b){const $=setTimeout(()=>{o({type:"info",message:"Recalculating route with updated vehicle profile..."}),V()},500);return()=>clearTimeout($)}},[i]);const V=d.useCallback(async()=>{if(!r()){o({type:"warning",message:"Need at least 2 waypoints to calculate route"});return}l(!0),g(null);try{const $={waypoints:a.map(F=>({lat:F.lat,lng:F.lng,name:F.name||`Waypoint ${F.id}`,id:F.id,type:F.type})),vehicleProfile:i||void 0,options:{profile:i?"driving-hgv":"driving-car",geometry:!0,instructions:!0,elevation:!1,units:"km"}},z=await as.calculateRoute($);if(t(z),z.routes.length>0){const F=z.routes[0];j({distance:Math.round(F.summary.distance/1e3*10)/10,duration:Math.round(F.summary.duration/60),service:z.metadata.service})}N(z.restrictions||null),p(z.alternativeRoutes||[]),h(Date.now()),z.warnings&&z.warnings.length>0?o({type:"warning",message:`Route calculated with warnings: ${z.warnings[0]}`}):o({type:"success",message:`Route calculated successfully using ${z.metadata.service}`})}catch($){console.error("Route calculation failed:",$);let z="Failed to calculate route";$ instanceof ns&&(z=$.message,$.recoverable||(t(null),j(null))),g(z),o({type:"error",message:z})}finally{l(!1)}},[a,i,r,t,o]);return e.jsxs("div",{className:S("bg-white rounded-lg shadow-sm border border-gray-200 p-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Route Calculation"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"}),b&&e.jsxs("span",{className:"text-xs text-gray-500",children:[b.distance,"km â€¢ ",Math.floor(b.duration/60),"h",b.duration%60,"m"]})]})]}),C&&C.violatedDimensions.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-red-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium text-red-800",children:"Vehicle Restriction Violations"})]}),e.jsx("div",{className:"space-y-1",children:C.suggestedActions.map(($,z)=>e.jsxs("div",{className:"text-red-700",children:["â€¢ ",$]},z))}),C.cannotAccommodate&&e.jsx("div",{className:"mt-2 p-2 bg-red-100 rounded text-red-800 font-medium",children:"âš ï¸ Your vehicle cannot use European roads with these dimensions"})]}),b&&e.jsxs("div",{className:S("mb-3 p-2 rounded text-xs",C?.violatedDimensions.length?"bg-amber-50 border border-amber-200":"bg-green-50 border border-green-200"),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:S("font-medium",C?.violatedDimensions.length?"text-amber-800":"text-green-800"),children:[e.jsxs("strong",{children:[b.distance," km"]})," â€¢ ",Math.floor(b.duration/60),"h ",b.duration%60,"m"]}),e.jsx("span",{className:S("capitalize",C?.violatedDimensions.length?"text-amber-600":"text-green-600"),children:b.service==="openrouteservice"?"OpenRoute":b.service})]}),i&&e.jsxs("div",{className:S("mt-1",C?.violatedDimensions.length?"text-amber-700":"text-green-700"),children:["Vehicle: ",i.height,"m H Ã— ",i.width,"m W Ã— ",i.weight,"t Ã— ",i.length,"m L"]}),C?.violatedDimensions.length?e.jsx("div",{className:"text-amber-700 mt-1 font-medium",children:"âš ï¸ Route may include restricted roads"}):null]}),k.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("button",{onClick:()=>D(!w),className:"w-full flex items-center justify-between p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800 hover:bg-blue-100 transition-colors",children:[e.jsxs("span",{className:"font-medium",children:[k.length," Alternative Route",k.length>1?"s":""," Available"]}),e.jsx("svg",{className:S("w-4 h-4 transform transition-transform",w&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsx("div",{className:"mt-2 space-y-2",children:k.map(($,z)=>e.jsxs("div",{className:"p-2 bg-gray-50 border border-gray-200 rounded text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-gray-700",children:["Alternative ",z+1,": ",e.jsxs("strong",{children:[Math.round($.summary.distance/1e3*10)/10," km"]})]}),e.jsxs("span",{className:"text-gray-600",children:[Math.floor($.summary.duration/60),"h ",Math.round($.summary.duration/60)%60,"m"]})]}),e.jsx("button",{onClick:()=>{const F={id:`alt_${Date.now()}`,status:"success",routes:[$],metadata:{service:"openrouteservice",profile:i?"driving-hgv":"driving-car",timestamp:Date.now(),query:{},attribution:"openrouteservice.org | Alternative route"}};t(F),j({distance:Math.round($.summary.distance/1e3*10)/10,duration:Math.round($.summary.duration/60),service:"openrouteservice"}),o({type:"info",message:`Switched to alternative route ${z+1}`})},className:"mt-1 text-blue-600 hover:text-blue-800 font-medium underline",children:"Use this route"})]},z))})]}),u&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-800 font-medium",children:u}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"The routing service may be temporarily unavailable. Please try again in a few seconds."})]})]})}),e.jsxs("button",{onClick:()=>{g(null),V()},disabled:c,className:"mt-2 w-full flex items-center justify-center space-x-2 px-3 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded text-xs font-medium transition-colors disabled:opacity-50",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Try again"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:V,disabled:!r()||c,className:S("flex items-center space-x-2 px-3 py-2 rounded text-sm font-medium transition-colors",r()&&!c?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Calculating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("span",{children:"Calculate Route"})]})}),e.jsxs("label",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:$=>{},className:"h-3 w-3 text-blue-600 rounded border-gray-300",disabled:!0}),e.jsx("span",{children:"Auto-calculate"})]})]}),m&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Last updated: ",new Date(m).toLocaleTimeString()]}),b&&e.jsx("div",{className:"mt-3 p-2 bg-gray-50 border border-gray-200 rounded text-xs",children:e.jsxs("div",{className:"flex items-center justify-between text-gray-600",children:[e.jsx("span",{children:"Route ready for export"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})]})}),!r()&&a.length<2&&e.jsx("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:"Add at least 2 waypoints to enable route calculation"})]})},Ga=({restrictions:n,className:s})=>{const{waypoints:a}=ne(),{profile:t}=ie();if(!n||n.violatedDimensions.length===0)return null;const r={height:4,width:2.55,weight:40,length:18.75},i=()=>n.cannotAccommodate?"critical":n.violatedDimensions.length>=2?"high":"medium",o=()=>{const u=[];return n.cannotAccommodate?u.push({type:"critical",title:"Vehicle Cannot Use European Roads",description:"Your vehicle dimensions exceed EU road limits. Consider reviewing vehicle specifications.",actions:["Double-check vehicle measurements","Consider a smaller vehicle for European travel","Contact authorities for special transport permits"]}):u.push({type:"warning",title:"Limited Route Options",description:"Your vehicle may face restrictions on some European roads.",actions:["Plan routes using major highways when possible","Avoid city centers and narrow rural roads","Check local restrictions before travel","Consider overnight parking at designated motorhome areas"]}),u},c=()=>{const u=[];return n.violatedDimensions.includes("height")&&u.push(`Height: Reduce to ${r.height}m or less`),n.violatedDimensions.includes("width")&&u.push(`Width: Reduce to ${r.width}m or less`),n.violatedDimensions.includes("weight")&&u.push(`Weight: Reduce to ${r.weight}t or less`),n.violatedDimensions.includes("length")&&u.push(`Length: Reduce to ${r.length}m or less`),u},l=i(),m=o(),h=c();return e.jsxs("div",{className:S("p-4 rounded-lg border",l==="critical"&&"bg-red-50 border-red-200",l==="high"&&"bg-amber-50 border-amber-200",l==="medium"&&"bg-yellow-50 border-yellow-200",s),children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx("div",{className:S("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center",l==="critical"&&"bg-red-100",l==="high"&&"bg-amber-100",l==="medium"&&"bg-yellow-100"),children:l==="critical"?e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:S("text-lg font-semibold",l==="critical"&&"text-red-900",l==="high"&&"text-amber-900",l==="medium"&&"text-yellow-900"),children:"Vehicle Restriction Issues"}),e.jsxs("p",{className:S("text-sm mt-1",l==="critical"&&"text-red-700",l==="high"&&"text-amber-700",l==="medium"&&"text-yellow-700"),children:[a.length," waypoints â€¢ ",n.violatedDimensions.length," dimension",n.violatedDimensions.length>1?"s":""," exceed EU limits"]})]})]}),t&&e.jsxs("div",{className:"mb-4 p-3 bg-white rounded border",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Current Vehicle Dimensions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:S("flex justify-between",n.violatedDimensions.includes("height")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Height:"}),e.jsxs("span",{children:[t.height,"m ",n.violatedDimensions.includes("height")&&"âš ï¸"]})]}),e.jsxs("div",{className:S("flex justify-between",n.violatedDimensions.includes("width")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Width:"}),e.jsxs("span",{children:[t.width,"m ",n.violatedDimensions.includes("width")&&"âš ï¸"]})]}),e.jsxs("div",{className:S("flex justify-between",n.violatedDimensions.includes("weight")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Weight:"}),e.jsxs("span",{children:[t.weight,"t ",n.violatedDimensions.includes("weight")&&"âš ï¸"]})]}),e.jsxs("div",{className:S("flex justify-between",n.violatedDimensions.includes("length")&&"text-red-600 font-medium"),children:[e.jsx("span",{children:"Length:"}),e.jsxs("span",{children:[t.length,"m ",n.violatedDimensions.includes("length")&&"âš ï¸"]})]})]})]}),m.map((u,g)=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:S("font-medium mb-2",u.type==="critical"&&"text-red-900",u.type==="warning"&&"text-amber-900"),children:u.title}),e.jsx("p",{className:S("text-sm mb-3",u.type==="critical"&&"text-red-700",u.type==="warning"&&"text-amber-700"),children:u.description}),e.jsx("ul",{className:"space-y-1",children:u.actions.map((b,j)=>e.jsxs("li",{className:S("text-sm flex items-start",u.type==="critical"&&"text-red-700",u.type==="warning"&&"text-amber-700"),children:[e.jsx("span",{className:"mr-2",children:"â€¢"}),e.jsx("span",{children:b})]},j))})]},g)),h.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"ðŸ’¡ Suggested Dimension Adjustments"}),e.jsx("ul",{className:"space-y-1",children:h.map((u,g)=>e.jsxs("li",{className:"text-sm text-blue-700 flex items-start",children:[e.jsx("span",{className:"mr-2",children:"â€¢"}),e.jsx("span",{children:u})]},g))})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ðŸ“‹ EU Standard Road Limits"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Height:"}),e.jsxs("span",{children:[r.height,"m"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Width:"}),e.jsxs("span",{children:[r.width,"m"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Weight:"}),e.jsxs("span",{children:[r.weight,"t"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Max Length:"}),e.jsxs("span",{children:[r.length,"m"]})]})]})]})]})};function Xa(n,s,a,t){const i=(a-n)*Math.PI/180,o=(t-s)*Math.PI/180,c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}const Ja=({route:n,className:s})=>{const a=d.useMemo(()=>{if(!n.geometry?.coordinates)return null;const b=n.geometry.coordinates,j=[];let C=0;return b.forEach((N,k)=>{const[p,w,D]=N;if(D!==void 0){if(k>0){const V=b[k-1],$=Xa(V[1],V[0],w,p);C+=$}j.push({distance:C,elevation:D,index:k})}}),j.length>0?j:null},[n.geometry]),t=d.useMemo(()=>{if(!a)return null;const b=a.map(w=>w.elevation),j=Math.min(...b),C=Math.max(...b),N=a[a.length-1].distance;let k=0,p=0;for(let w=1;w<a.length;w++){const D=a[w].elevation-a[w-1].elevation;D>0?k+=D:p+=Math.abs(D)}return{minElevation:Math.round(j),maxElevation:Math.round(C),totalGain:Math.round(k),totalLoss:Math.round(p),totalDistance:Math.round(N/1e3*10)/10}},[a]);if(!a||!t)return e.jsx("div",{className:S("bg-white rounded-lg border border-gray-200 p-6",s),children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Elevation Data"}),e.jsx("p",{children:"Elevation profile not available for this route"}),e.jsx("p",{className:"text-sm mt-1",children:"Enable elevation in route options to see the profile"})]})});const r=600,i=200,o={top:20,right:20,bottom:40,left:60},c=r-o.left-o.right,l=i-o.top-o.bottom,m=b=>b/t.totalDistance/1e3*c,h=b=>l-(b-t.minElevation)/(t.maxElevation-t.minElevation)*l,u=a.map((b,j)=>{const C=m(b.distance),N=h(b.elevation);return`${j===0?"M":"L"} ${C} ${N}`}).join(" "),g=u+` L ${m(a[a.length-1].distance)} ${l} L 0 ${l} Z`;return e.jsxs("div",{className:S("bg-white rounded-lg border border-gray-200",s),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Elevation Profile"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.totalDistance," km route"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-900",children:[t.maxElevation,"m"]}),e.jsx("div",{className:"text-sm text-blue-700",children:"Highest"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-green-900",children:[t.minElevation,"m"]}),e.jsx("div",{className:"text-sm text-green-700",children:"Lowest"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-orange-900",children:["+",t.totalGain,"m"]}),e.jsx("div",{className:"text-sm text-orange-700",children:"Total Gain"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold text-red-900",children:["-",t.totalLoss,"m"]}),e.jsx("div",{className:"text-sm text-red-700",children:"Total Loss"})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:e.jsxs("svg",{width:r,height:i,viewBox:`0 0 ${r} ${i}`,className:"w-full h-auto min-w-96",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"elevationGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsxs("g",{stroke:"#e5e7eb",strokeWidth:"1",children:[[0,.25,.5,.75,1].map(b=>{const j=o.top+b*l,C=t.maxElevation-b*(t.maxElevation-t.minElevation);return e.jsxs("g",{children:[e.jsx("line",{x1:o.left,y1:j,x2:o.left+c,y2:j}),e.jsxs("text",{x:o.left-10,y:j+4,textAnchor:"end",fontSize:"12",fill:"#6b7280",children:[Math.round(C),"m"]})]},b)}),[0,.25,.5,.75,1].map(b=>{const j=o.left+b*c,C=b*t.totalDistance;return e.jsxs("g",{children:[e.jsx("line",{x1:j,y1:o.top,x2:j,y2:o.top+l}),e.jsxs("text",{x:j,y:o.top+l+20,textAnchor:"middle",fontSize:"12",fill:"#6b7280",children:[C.toFixed(1),"km"]})]},b)})]}),e.jsx("path",{d:g,fill:"url(#elevationGradient)",transform:`translate(${o.left}, ${o.top})`}),e.jsx("path",{d:u,fill:"none",stroke:"#3b82f6",strokeWidth:"2",transform:`translate(${o.left}, ${o.top})`}),e.jsx("text",{x:o.left+c/2,y:i-10,textAnchor:"middle",fontSize:"14",fill:"#374151",fontWeight:"500",children:"Distance (km)"}),e.jsx("text",{x:20,y:o.top+l/2,textAnchor:"middle",fontSize:"14",fill:"#374151",fontWeight:"500",transform:`rotate(-90, 20, ${o.top+l/2})`,children:"Elevation (m)"})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"â›°ï¸ Elevation Insights"}),e.jsxs("div",{className:"text-sm text-yellow-800 space-y-1",children:[t.totalGain>500&&e.jsx("div",{children:"â€¢ Significant climbing ahead - expect reduced fuel efficiency"}),t.totalLoss>500&&e.jsx("div",{children:"â€¢ Long descents - use engine braking and check brakes beforehand"}),t.maxElevation-t.minElevation>1e3&&e.jsx("div",{children:"â€¢ Large elevation changes - check weather conditions at altitude"}),t.maxElevation>1500&&e.jsx("div",{children:"â€¢ High altitude sections - consider altitude effects on engine performance"})]})]})]})]})},zt=({route:n,compact:s})=>{const{profile:a}=ie();if(!n.routes.length)return null;const t=n.routes[0],{distance:r,duration:i}=t.summary,o=Math.round(r/1e3*10)/10,c=Math.floor(i/3600),l=Math.round(i%3600/60),h=n.restrictions?.cannotAccommodate?"incompatible":n.restrictions?.violatedDimensions?.length?"restricted":n.warnings?.length?"limited":"compatible";return s?e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium",children:[o," km"]}),e.jsxs("span",{className:"text-gray-600",children:[c,"h ",l,"m"]}),e.jsx("div",{className:S("w-2 h-2 rounded-full",h==="compatible"&&"bg-green-500",h==="limited"&&"bg-yellow-500",h==="restricted"&&"bg-orange-500",h==="incompatible"&&"bg-red-500")})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Route Summary"}),e.jsx("span",{className:"text-sm text-gray-500 capitalize",children:n.metadata.service})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:o}),e.jsx("div",{className:"text-sm text-blue-700",children:"kilometers"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[c,"h ",l,"m"]}),e.jsx("div",{className:"text-sm text-green-700",children:"travel time"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vehicle Compatibility"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:S("w-3 h-3 rounded-full",h==="compatible"&&"bg-green-500",h==="limited"&&"bg-yellow-500",h==="restricted"&&"bg-orange-500",h==="incompatible"&&"bg-red-500")}),e.jsx("span",{className:S("text-sm font-medium capitalize",h==="compatible"&&"text-green-700",h==="limited"&&"text-yellow-700",h==="restricted"&&"text-orange-700",h==="incompatible"&&"text-red-700"),children:h})]})]}),a&&e.jsxs("div",{className:"mt-3 text-xs text-gray-600",children:["Vehicle: ",a.height,"m H Ã— ",a.width,"m W Ã— ",a.weight,"t Ã— ",a.length,"m L"]})]})},Ya=({segments:n})=>n.length?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Route Segments"}),e.jsx("div",{className:"space-y-3",children:n.map((s,a)=>{const t=Math.round(s.distance/1e3*10)/10,r=Math.floor(s.duration/3600),i=Math.round(s.duration%3600/60);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-900",children:a+1})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["Segment ",a+1]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t," km"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[r>0?`${r}h `:"",i,"m"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"travel time"})]})]},a)})})]}):null,Qa=({segments:n})=>{const[s,a]=d.useState(0),t=d.useMemo(()=>n.flatMap((r,i)=>(r.steps||[]).map((o,c)=>({...o,segmentIndex:i,stepIndex:c,id:`${i}-${c}`}))),[n]);return t.length?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Turn-by-Turn Directions"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.length," instructions"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:t.map((r,i)=>{const o=r.distance>1e3?`${Math.round(r.distance/1e3*10)/10} km`:`${Math.round(r.distance)} m`;return e.jsxs("div",{className:S("flex items-start space-x-3 p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors",i===t.length-1&&"border-b-0"),children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-blue-900",children:i+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:r.instruction}),r.name&&e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:["on ",e.jsx("span",{className:"font-medium",children:r.name})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Continue for ",o]})]})]},r.id)})})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Turn-by-Turn Directions"}),e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("p",{children:"Detailed turn-by-turn directions not available"}),e.jsx("p",{className:"text-sm",children:"Try recalculating with OpenRouteService for detailed instructions"})]})]})},en=({className:n,compact:s=!1})=>{const{calculatedRoute:a}=ne(),[t,r]=d.useState("summary");if(!a||!a.routes.length)return e.jsx("div",{className:S("bg-white rounded-lg border border-gray-200 p-6",n),children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Route Information"}),e.jsx("p",{children:"Calculate a route to see detailed information"})]})});if(s)return e.jsx("div",{className:S("bg-white rounded-lg border border-gray-200 p-3",n),children:e.jsx(zt,{route:a,compact:!0})});const i=a.routes[0];return e.jsxs("div",{className:S("bg-white rounded-lg border border-gray-200",n),children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-4",children:[{id:"summary",label:"Summary",icon:"ðŸ“Š"},{id:"segments",label:"Segments",icon:"ðŸ›£ï¸"},{id:"directions",label:"Directions",icon:"ðŸ§­"},{id:"elevation",label:"Elevation",icon:"â›°ï¸"}].map(o=>e.jsxs("button",{onClick:()=>r(o.id),className:S("flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors",t===o.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx("span",{children:o.icon}),e.jsx("span",{children:o.label})]},o.id))})}),e.jsxs("div",{className:"p-4",children:[t==="summary"&&e.jsx(zt,{route:a}),t==="segments"&&e.jsx(Ya,{segments:i.segments}),t==="directions"&&e.jsx(Qa,{segments:i.segments}),t==="elevation"&&e.jsx(Ja,{route:i})]})]})},tn=({className:n})=>{const{calculatedRoute:s,setCalculatedRoute:a}=ne(),{profile:t}=ie(),{addNotification:r}=oe(),[i,o]=d.useState("main");if(!s)return null;const c=[{id:"main",route:s.routes[0],label:"Main Route",isCurrent:!0},...(s.alternativeRoutes||[]).map((g,b)=>({id:`alt-${b}`,route:g,label:`Alternative ${b+1}`,isAlternative:!0,isCurrent:!1}))];if(c.length<=1)return null;const l=g=>{const b=c.find(C=>C.id===g);if(!b||g==="main")return;const j={...s,routes:[b.route],id:`selected_${g}_${Date.now()}`};a(j),o(g),r({type:"info",message:`Switched to ${b.label.toLowerCase()}`})},m=(g,b)=>{const j=g.summary.distance-b.summary.distance,C=g.summary.duration-b.summary.duration;return{distanceDiff:Math.round(j/1e3*10)/10,timeDiff:Math.round(C/60),distancePercent:Math.round(j/b.summary.distance*100),timePercent:Math.round(C/b.summary.duration*100)}},h=(g,b,j=!1)=>{const C=g>0?"+":"",N=j?"%":` ${b}`;return`${C}${g}${N}`},u=c[0].route;return e.jsxs("div",{className:S("bg-white rounded-lg border border-gray-200",n),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Route Comparison"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[c.length," route options available"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"space-y-3",children:c.map((g,b)=>{const j=i===g.id,C=b>0?m(g.route,u):null,N=Math.round(g.route.summary.distance/1e3*10)/10,k=Math.floor(g.route.summary.duration/3600),p=Math.round(g.route.summary.duration%3600/60);return e.jsxs("div",{className:S("relative p-4 rounded-lg border cursor-pointer transition-all",j?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),onClick:()=>l(g.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:S("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",j?"bg-blue-500 text-white":"bg-gray-100 text-gray-700"),children:[b===0?"1":String.fromCharCode(65+b)," "]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:g.label}),g.isAlternative&&e.jsx("div",{className:"text-xs text-gray-500",children:"Alternative route option"})]})]}),j&&e.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-medium",children:"Current"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Distance"}),e.jsxs("div",{className:"font-medium",children:[N," km"]}),C&&e.jsx("div",{className:S("text-xs",C.distanceDiff>0?"text-red-600":"text-green-600"),children:h(C.distanceDiff,"km")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Time"}),e.jsxs("div",{className:"font-medium",children:[k,"h ",p,"m"]}),C&&e.jsx("div",{className:S("text-xs",C.timeDiff>0?"text-red-600":"text-green-600"),children:h(C.timeDiff,"min")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Type"}),e.jsx("div",{className:"font-medium",children:b===0?"Fastest":C?C.distanceDiff<0?"Shorter":"Scenic":"Alternative"}),t&&e.jsx("div",{className:"text-xs text-gray-500",children:"Vehicle safe"})]})]}),C&&e.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-xs text-gray-600",children:[Math.abs(C.distancePercent)>10&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:S("w-2 h-2 rounded-full",C.distancePercent>0?"bg-red-400":"bg-green-400")}),e.jsx("span",{children:C.distancePercent>0?"Longer route":"Shorter route"})]}),Math.abs(C.timePercent)>15&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:S("w-2 h-2 rounded-full",C.timePercent>0?"bg-orange-400":"bg-blue-400")}),e.jsx("span",{children:C.timePercent>0?"Slower":"Faster"})]})]})]},g.id)})}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Route Selection Guide"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Main Route:"})," Fastest route optimized for your vehicle"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Alternatives:"})," Different paths that may avoid restrictions or offer scenic routes"]}),t&&e.jsxs("div",{children:["â€¢ All routes respect your vehicle dimensions (",t.height,"m H Ã— ",t.width,"m W Ã— ",t.weight,"t)"]})]})]})]})]})},sn={objective:"balanced",enableTimeConstraints:!1,maxDrivingTime:8,preferredStartTime:9,avoidNightDriving:!0,enableCampsitePreferences:!1,maxDistanceBetweenStops:300,requireCampsiteOvernight:!1,autoOptimizeOnChange:!1},an=({className:n,onOptimizationComplete:s,onWaypointInsert:a,isVisible:t=!0})=>{const{waypoints:r,reorderWaypoints:i}=ne(),{profile:o}=ie(),{addNotification:c}=oe(),[l,m]=d.useState(sn),[h,u]=d.useState(!1),[g,b]=d.useState(null),[j,C]=d.useState(new Set),[N,k]=d.useState(!1),[p,w]=d.useState(!1),[D,V]=d.useState(null),[$,z]=d.useState(null),F=d.useMemo(()=>r.length>=3&&!h,[r.length,h]),G=d.useCallback(async()=>{if(F){u(!0);try{const T={objective:l.objective,vehicleProfile:o||void 0,lockedWaypoints:Array.from(j)};l.enableTimeConstraints&&(T.timeConstraints={maxDrivingTime:l.maxDrivingTime,preferredStartTime:l.preferredStartTime,avoidNightDriving:l.avoidNightDriving}),l.enableCampsitePreferences&&(T.campsitePreferences={maxDistanceBetweenStops:l.maxDistanceBetweenStops,preferredStopDuration:8,requireCampsiteOvernight:l.requireCampsiteOvernight});const E=await Nt.optimizeRoute(r,T);b(E),E.improvements.percentageImprovement>1?c({type:"success",message:`Route optimized! Saved ${E.improvements.distanceSaved.toFixed(1)}km and ${Math.round(E.improvements.timeSaved)} minutes`}):c({type:"info",message:"Route is already well optimized"}),s?.(E)}catch(T){console.error("Optimization failed:",T),c({type:"error",message:`Optimization failed: ${T instanceof Error?T.message:"Unknown error"}`})}finally{u(!1)}}},[r,l,o,j,F,c,s]),R=d.useCallback(()=>{g&&(i(g.optimizedRoute.waypoints),b(null),c({type:"success",message:"Route optimization applied successfully"}))},[g,i,c]),A=d.useCallback(T=>{C(E=>{const J=new Set(E);return J.has(T)?J.delete(T):J.add(T),J})},[]);return d.useCallback((T,E)=>{if(!p)return;const J={id:`temp_${Date.now()}`,lat:T,lng:E,name:"New Waypoint",type:"waypoint"};z({lat:T,lng:E}),Nt.findOptimalInsertion(r,J,{objective:l.objective,vehicleProfile:o||void 0}).then(Q=>{V(Q)}).catch(Q=>{console.error("Insertion analysis failed:",Q),c({type:"error",message:"Failed to analyze waypoint insertion"})})},[p,r,l.objective,o,c]),d.useEffect(()=>{if(l.autoOptimizeOnChange&&r.length>=3&&!h){const T=setTimeout(()=>{G()},2e3);return()=>clearTimeout(T)}},[r,l.autoOptimizeOnChange,G,h]),t?e.jsxs("div",{className:S("bg-white rounded-lg shadow-lg border border-gray-200",n),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 01.553-.894L9 2l6 3 6-3v15l-6 3-6-3z"})}),"Route Optimizer"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>k(!N),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded",title:"Advanced Settings",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})})]}),r.length<3&&e.jsxs("p",{className:"text-sm text-amber-600 mt-2 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),"Add at least 3 waypoints to enable route optimization"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Optimization Goal"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"shortest",label:"Shortest",icon:"ðŸ“",desc:"Minimize distance"},{value:"fastest",label:"Fastest",icon:"âš¡",desc:"Minimize time"},{value:"balanced",label:"Balanced",icon:"âš–ï¸",desc:"Balance time & distance"}].map(T=>e.jsxs("button",{onClick:()=>m(E=>({...E,objective:T.value})),className:S("p-3 rounded-lg border text-center transition-colors text-sm",l.objective===T.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 text-gray-700"),children:[e.jsx("div",{className:"text-lg mb-1",children:T.icon}),e.jsx("div",{className:"font-medium",children:T.label}),e.jsx("div",{className:"text-xs text-gray-500",children:T.desc})]},T.value))})]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("button",{onClick:G,disabled:!F,className:S("flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-lg font-medium transition-colors",F?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:h?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Optimizing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{children:"Optimize Route"})]})}),e.jsx("button",{onClick:()=>w(!p),className:S("px-4 py-3 rounded-lg font-medium transition-colors",p?"bg-green-600 text-white hover:bg-green-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Smart waypoint insertion",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:l.autoOptimizeOnChange,onChange:T=>m(E=>({...E,autoOptimizeOnChange:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Auto-optimize when route changes"})]})}),N&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Advanced Settings"}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm mb-2",children:[e.jsx("input",{type:"checkbox",checked:l.enableTimeConstraints,onChange:T=>m(E=>({...E,enableTimeConstraints:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable time constraints"})]}),l.enableTimeConstraints&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 ml-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max driving time (hours)"}),e.jsx("input",{type:"number",min:"4",max:"12",value:l.maxDrivingTime,onChange:T=>m(E=>({...E,maxDrivingTime:parseInt(T.target.value)})),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Preferred start time"}),e.jsx("input",{type:"number",min:"6",max:"12",value:l.preferredStartTime,onChange:T=>m(E=>({...E,preferredStartTime:parseInt(T.target.value)})),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm mb-2",children:[e.jsx("input",{type:"checkbox",checked:l.enableCampsitePreferences,onChange:T=>m(E=>({...E,enableCampsitePreferences:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable campsite preferences"})]}),l.enableCampsitePreferences&&e.jsxs("div",{className:"ml-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"block text-xs text-gray-600 mb-1",children:["Max distance between stops: ",l.maxDistanceBetweenStops,"km"]}),e.jsx("input",{type:"range",min:"100",max:"500",step:"50",value:l.maxDistanceBetweenStops,onChange:T=>m(E=>({...E,maxDistanceBetweenStops:parseInt(T.target.value)})),className:"w-full"})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:l.requireCampsiteOvernight,onChange:T=>m(E=>({...E,requireCampsiteOvernight:T.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Require campsite for overnight stops"})]})]})]})]})]}),r.length>0&&e.jsx("div",{className:"border-t border-gray-200",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Waypoint Order (",r.length," stops)"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:r.map((T,E)=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:E+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:T.name}),e.jsx("div",{className:"text-xs text-gray-500",children:T.type==="campsite"?"ðŸ•ï¸ Campsite":"ðŸ“ Waypoint"})]}),e.jsx("button",{onClick:()=>A(T.id),className:S("p-1 rounded text-xs",j.has(T.id)?"text-red-600 hover:bg-red-50":"text-gray-400 hover:bg-gray-100"),title:j.has(T.id)?"Unlock waypoint":"Lock waypoint order",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:j.has(T.id)?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})})})]},T.id))}),j.size>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex items-center",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),j.size," waypoint(s) locked in position"]})]})}),g&&e.jsx("div",{className:"border-t border-gray-200 bg-green-50",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-green-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Optimization Complete"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Distance Saved"}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[g.improvements.distanceSaved.toFixed(1),"km"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[g.improvements.percentageImprovement.toFixed(1),"% improvement"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Time Saved"}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[Math.round(g.improvements.timeSaved)," min"]}),e.jsx("div",{className:"text-xs text-gray-500",children:g.optimizationMetadata.algorithm})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:R,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"Apply Optimization"}),e.jsx("button",{onClick:()=>b(null),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Dismiss"})]})]})}),p&&e.jsx("div",{className:"border-t border-gray-200 bg-blue-50",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-blue-800 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Click on the map to find the optimal position for a new waypoint"})]})})}),D&&$&&e.jsx("div",{className:"border-t border-gray-200 bg-yellow-50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Waypoint Insertion Analysis"}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-3",children:["Best position: After waypoint ",D.suggestedPosition+1,e.jsx("br",{}),"Impact: +",D.routeImpact.distanceAdded.toFixed(1),"km, +",Math.round(D.routeImpact.timeAdded)," min",e.jsx("br",{}),"Efficiency: ",(D.routeImpact.efficiency*100).toFixed(0),"%"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{a?.(D.suggestedPosition),V(null),z(null),w(!1)},className:"bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:"Insert Here"}),e.jsx("button",{onClick:()=>{V(null),z(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm",children:"Cancel"})]})]})})]}):null},nn=({className:n="",onCostUpdate:s,isVisible:a=!0})=>{const{waypoints:t}=ne(),{profile:r}=ie(),{fuelConsumptionSettings:i,fuelPriceSettings:o,preferences:c,lastCalculation:l,setFuelConsumptionSettings:m,setFuelPriceSettings:h,setLastCalculation:u}=Ft(),[g,b]=d.useState(!1),[j,C]=d.useState(null),[N,k]=d.useState(null),[p,w]=d.useState(!1),[D,V]=d.useState(null),$=d.useMemo(()=>rs(t,r),[t,r]);d.useEffect(()=>{if(t.length<2){C(null),k(null);return}if(l.routeHash===$&&l.breakdown&&is(l.timestamp)){C(l.breakdown);return}z()},[t,r,i,o]),d.useEffect(()=>{j&&s&&s(j)},[j,s]);const z=async()=>{if(!(t.length<2)){b(!0),V(null);try{const R=await Ge.calculateRouteCosts(t,r||void 0,i,o);if(C(R),u({routeHash:$,breakdown:R,timestamp:Date.now()}),c.showOptimizationSuggestions){const A=await Ge.calculateCostOptimizations(R,r||void 0);k(A)}}catch(R){console.error("Cost calculation failed:",R),V("Failed to calculate trip costs. Please try again.")}finally{b(!1)}}},F=(R,A="EUR")=>new Intl.NumberFormat("en-EU",{style:"currency",currency:A,minimumFractionDigits:2,maximumFractionDigits:2}).format(R),G=R=>{switch(R.consumptionType){case"l_per_100km":return`${R.consumption.toFixed(1)} L/100km`;case"mpg_imperial":return`${R.consumption.toFixed(1)} MPG (UK)`;case"mpg_us":return`${R.consumption.toFixed(1)} MPG (US)`}};return a?e.jsxs("div",{className:`bg-white rounded-lg shadow-lg border ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Trip Cost Calculator"})]}),e.jsx("button",{onClick:()=>w(!p),className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(Gt,{className:"w-4 h-4 text-gray-600"})})]}),p&&e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Consumption"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("select",{value:i.consumptionType,onChange:R=>m({...i,consumptionType:R.target.value}),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"l_per_100km",children:"L/100km"}),e.jsx("option",{value:"mpg_imperial",children:"MPG (UK)"}),e.jsx("option",{value:"mpg_us",children:"MPG (US)"})]}),e.jsx("input",{type:"number",value:i.consumption,onChange:R=>m({...i,consumption:parseFloat(R.target.value)||0}),className:"px-3 py-2 border rounded-lg text-sm",placeholder:"Consumption",step:"0.1"}),e.jsxs("select",{value:i.fuelType,onChange:R=>m({...i,fuelType:R.target.value}),className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"diesel",children:"Diesel"}),e.jsx("option",{value:"petrol",children:"Petrol"}),e.jsx("option",{value:"lpg",children:"LPG"}),e.jsx("option",{value:"electric",children:"Electric"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Prices"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:o.priceType==="default_european",onChange:()=>h({...o,priceType:"default_european"}),className:"mr-2"}),"European Averages"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",checked:o.priceType==="manual",onChange:()=>h({...o,priceType:"manual",manualPrices:o.manualPrices||{petrol:1.65,diesel:1.55,lpg:.85,electricity:.35}}),className:"mr-2"}),"Manual Entry"]})]}),o.priceType==="manual"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsx("input",{type:"number",placeholder:"Petrol",value:o.manualPrices?.petrol||"",onChange:R=>h({...o,manualPrices:{...o.manualPrices,petrol:parseFloat(R.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"Diesel",value:o.manualPrices?.diesel||"",onChange:R=>h({...o,manualPrices:{...o.manualPrices,diesel:parseFloat(R.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"LPG",value:o.manualPrices?.lpg||"",onChange:R=>h({...o,manualPrices:{...o.manualPrices,lpg:parseFloat(R.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"Electric",value:o.manualPrices?.electricity||"",onChange:R=>h({...o,manualPrices:{...o.manualPrices,electricity:parseFloat(R.target.value)||0}}),className:"px-3 py-2 border rounded-lg text-sm",step:"0.01"})]})]})]})]})}),e.jsxs("div",{className:"p-4",children:[D&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Kt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:D})]})}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Calculating costs..."})]}):j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-800 mb-1",children:F(j.totalCost,j.currency)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Trip Cost"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(Zt,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Fuel"})]}),e.jsx("div",{className:"font-semibold",children:F(j.fuelCost,j.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(Xe,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Accommodation"})]}),e.jsx("div",{className:"font-semibold",children:F(j.accommodationCost,j.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(ut,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Tolls"})]}),e.jsx("div",{className:"font-semibold",children:F(j.tollCost,j.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(at,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Other"})]}),e.jsx("div",{className:"font-semibold",children:F(j.otherCosts,j.currency)})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Current Settings:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Consumption: "}),G(i)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fuel Type: "}),i.fuelType.charAt(0).toUpperCase()+i.fuelType.slice(1)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Price Source: "}),o.priceType==="default_european"?"EU Averages":"Manual"]})]})]}),c.showDailyEstimates&&j.dailyBreakdown.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Pe,{className:"w-4 h-4 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-800",children:"Daily Cost Breakdown"})]}),e.jsx("div",{className:"space-y-2",children:j.dailyBreakdown.map((R,A)=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-800",children:["Day ",A+1," - ",R.date.toLocaleDateString()]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[R.distance.toFixed(0),"km driving"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold",children:F(R.totalDailyCost,j.currency)}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Fuel: ",F(R.fuelCost,j.currency)]})]})]})},A))})]}),c.showCostBreakdown&&j.segments.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Xe,{className:"w-4 h-4 text-green-600"}),e.jsx("h4",{className:"font-medium text-gray-800",children:"Route Segments"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:j.segments.map((R,A)=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-800 truncate",children:[R.startWaypoint.name," â†’ ",R.endWaypoint.name]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[R.distance.toFixed(0),"km â€¢ ",Math.round(R.duration),"min",R.segmentType==="overnight"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs",children:"Overnight"})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"font-semibold",children:F(R.fuelCost+(R.accommodationCost||0),j.currency)}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Fuel: ",F(R.fuelCost,j.currency)]})]})]})},A))})]}),c.showOptimizationSuggestions&&N&&N.suggestions.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ma,{className:"w-4 h-4 text-orange-600"}),e.jsx("h4",{className:"font-medium text-gray-800",children:"Cost Optimization"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsxs("div",{className:"text-lg font-semibold text-orange-800",children:["Potential Savings: ",F(N.savings,j.currency)]}),e.jsxs("div",{className:"text-sm text-orange-600",children:["Optimized total: ",F(N.optimizedCost,j.currency)]})]}),e.jsx("div",{className:"space-y-2",children:N.suggestions.slice(0,3).map((R,A)=>e.jsx("div",{className:"bg-white rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:R.description}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:R.actionRequired})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:"font-semibold text-green-600",children:["-",F(R.potentialSaving,j.currency)]})})]})},A))})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(at,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Add waypoints to your route to calculate trip costs"})]})]})]}):null};class rn{constructor(){ce(this,"dbName","CampsiteCache");ce(this,"version",1);ce(this,"storeName","campsites");ce(this,"db",null)}async initialize(){return new Promise((s,a)=>{const t=indexedDB.open(this.dbName,this.version);t.onerror=()=>a(new Error("Failed to open IndexedDB")),t.onsuccess=()=>{this.db=t.result,s()},t.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(this.storeName)){const o=i.createObjectStore(this.storeName,{keyPath:"id"});o.createIndex("lat","lat",{unique:!1}),o.createIndex("lng","lng",{unique:!1}),o.createIndex("type","type",{unique:!1}),o.createIndex("last_updated","last_updated",{unique:!1}),o.createIndex("bounds",["lat","lng"],{unique:!1})}i.objectStoreNames.contains("cache_metadata")||i.createObjectStore("cache_metadata",{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}async getCampsitesInBounds(s){return this.db||await this.initialize(),new Promise((a,t)=>{const i=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),o=[],c=i.openCursor();c.onsuccess=l=>{const m=l.target.result;if(m){const h=m.value;h.lat>=s.south&&h.lat<=s.north&&h.lng>=s.west&&h.lng<=s.east&&o.push(h),m.continue()}else a(o)},c.onerror=()=>t(new Error("Failed to query campsites from cache"))})}async storeCampsites(s){return this.db||await this.initialize(),new Promise((a,t)=>{const i=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName);let o=0;const c=s.length;if(c===0){a();return}for(const l of s){const m=i.put(l);m.onsuccess=()=>{o++,o===c&&a()},m.onerror=()=>t(new Error("Failed to store campsite in cache"))}})}async getCacheMetadata(s){return this.db||await this.initialize(),new Promise((a,t)=>{const o=this.db.transaction(["cache_metadata"],"readonly").objectStore("cache_metadata").get(s);o.onsuccess=()=>a(o.result?.data),o.onerror=()=>t(new Error("Failed to get cache metadata"))})}async setCacheMetadata(s,a){return this.db||await this.initialize(),new Promise((t,r)=>{const c=this.db.transaction(["cache_metadata"],"readwrite").objectStore("cache_metadata").put({key:s,data:a,timestamp:Date.now()});c.onsuccess=()=>t(),c.onerror=()=>r(new Error("Failed to set cache metadata"))})}async clearExpiredCache(s=1440*60*1e3){this.db||await this.initialize();const a=Date.now()-s;return new Promise((t,r)=>{const c=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).index("last_updated"),l=IDBKeyRange.upperBound(a),m=c.openCursor(l);m.onsuccess=h=>{const u=h.target.result;u?(u.delete(),u.continue()):t()},m.onerror=()=>r(new Error("Failed to clear expired cache"))})}}class on extends os{constructor(){const a={baseUrl:ls.campsites.sources.overpass,timeout:3e4,retries:1,cacheEnabled:!1,cacheTtl:0,userAgent:"EuropeanCamperPlanner/1.0"};super(a,{requests:2,windowMs:1e3,enabled:!1});ce(this,"cacheManager");ce(this,"_fallbackService");ce(this,"activeRequests",new Map);this.cacheManager=new rn,this.initializeFallbackService(),this.initializeCache()}async geocodeLocationMultiple(a,t=5){try{const r=new URLSearchParams({q:a,format:"json",limit:String(t),addressdetails:"1",extratags:"1",namedetails:"1"}),i=await fetch(`/api/geocode?${r.toString()}`,{method:"GET",headers:{"User-Agent":"EuropeanCamperPlanner/1.0 (https://github.com/user/camper-planner)"}});if(!i.ok)throw new Error(`Geocoding HTTP error: ${i.status}`);const o=await i.json();return o&&o.length>0?o.map(c=>({display_name:c.display_name,lat:parseFloat(c.lat),lng:parseFloat(c.lon),boundingbox:c.boundingbox,type:c.type||c.class||"place",importance:parseFloat(c.importance||"0.5"),name:c.display_name.split(",")[0].trim()})):[]}catch(r){return console.error("Geocoding failed:",r),[]}}async geocodeLocation(a){const t=await this.geocodeLocationMultiple(a,1);return t.length>0?t[0]:null}async searchCampsites(a){const t=Date.now();if(a.locationQuery)return this.searchCampsitesByLocation(a,t);const r=this.generateCampsiteCacheKey(a);if(this.activeRequests.has(r))return console.debug("CampsiteService: Deduplicating identical request in progress"),this.activeRequests.get(r);if(!a.bounds||typeof a.bounds.south>"u"||typeof a.bounds.west>"u"||typeof a.bounds.north>"u"||typeof a.bounds.east>"u")return console.warn("CampsiteService: Invalid bounds provided, returning empty result"),{status:"error",error:"Invalid bounds provided",campsites:[],metadata:{service:"overpass",timestamp:Date.now(),query:a,results_count:0,query_duration:Date.now()-t,cache_hit:!1},cached:!1,boundingBox:a.bounds};const i=this.executeSearchRequest(a,r,t);this.activeRequests.set(r,i);try{return await i}finally{this.activeRequests.delete(r)}}async searchCampsitesByLocation(a,t){try{const r=await this.geocodeLocation(a.locationQuery);if(!r)return{status:"error",error:`Could not find location: ${a.locationQuery}`,campsites:[],metadata:{service:"overpass",timestamp:Date.now(),query:a,results_count:0,query_duration:Date.now()-t,cache_hit:!1},cached:!1,boundingBox:a.bounds};const i=50,o=i/111,c=i/(111*Math.cos(r.lat*Math.PI/180)),l={...a,bounds:{north:r.lat+o,south:r.lat-o,east:r.lng+c,west:r.lng-c},locationQuery:void 0},m=await this.searchCampsites(l);return{...m,metadata:{...m.metadata,geocoded_location:r,query:a}}}catch(r){return console.error("Location-based search failed:",r),{status:"error",error:`Location search failed: ${r instanceof Error?r.message:"Unknown error"}`,campsites:[],metadata:{service:"overpass",timestamp:Date.now(),query:a,results_count:0,query_duration:Date.now()-t,cache_hit:!1},cached:!1,boundingBox:a.bounds}}}async executeSearchRequest(a,t,r){try{const i=await this.getCachedCampsites(a);if(i)return{...i,metadata:{...i.metadata,cache_hit:!0,query_duration:Date.now()-r}};const o=await this.searchWithOverpass(a);return await this.cacheManager.storeCampsites(o.campsites),await this.setCacheMetadata(a),{...o,metadata:{...o.metadata,cache_hit:!1,query_duration:Date.now()-r}}}catch(i){console.warn("Overpass API failed:",i);const o=await this.getCachedCampsites(a,!0);return o?(console.info("Using stale cache data for campsites"),{...o,metadata:{...o.metadata,cache_hit:!0,query_duration:Date.now()-r}}):(console.warn("No campsite data available, returning empty result"),{status:"success",campsites:[],metadata:{service:"overpass",timestamp:Date.now(),query:a,results_count:0,query_duration:Date.now()-r,cache_hit:!1},cached:!1,boundingBox:a.bounds})}}async searchWithOverpass(a){const{bounds:t,types:r=["campsite","aire","caravan_site"],maxResults:i=1e3}=a,o=this.buildOverpassQuery(t,r);console.log("CampsiteService: Overpass query",{bounds:t,types:r,query:o});const c={method:"POST",endpoint:"",body:o,headers:{"Content-Type":"text/plain; charset=utf-8"}},l=await this.request(c),m=this.parseOverpassResponse(l),h=this.filterAndScoreCampsites(m,a).slice(0,i);return{status:"success",campsites:h,metadata:{service:"overpass",timestamp:Date.now(),query:a,results_count:h.length,cache_hit:!1,query_duration:0},cached:!1,boundingBox:t}}async _searchWithOpenCampingMap(a){const{bounds:t,maxResults:r=1e3}=a,i={baseUrl:"https://opencampingmap.org/api",timeout:15e3,retries:1,cacheEnabled:!1,cacheTtl:0,userAgent:"EuropeanCamperPlanner/1.0"},o=this.config;this.config=i;try{const c={method:"GET",endpoint:"/campsites",params:{bbox:`${t.west},${t.south},${t.east},${t.north}`,limit:r}},l=await this.request(c),m=this.parseOpenCampingMapResponse(l);return{campsites:m,metadata:{service:"opencampingmap",timestamp:Date.now(),query:a,results_count:m.length,cache_hit:!1,query_duration:0},cached:!1,boundingBox:t}}finally{this.config=o}}isValidCoordinate(a,t){return typeof a!="number"||isNaN(a)||!isFinite(a)?!1:t==="latitude"?a>=-90&&a<=90:a>=-180&&a<=180}buildOverpassQuery(a,t){const{south:r,west:i,north:o,east:c}=a;if(console.log("buildOverpassQuery: Raw bounds",{south:r,west:i,north:o,east:c}),!this.isValidCoordinate(r,"latitude")||!this.isValidCoordinate(o,"latitude")||!this.isValidCoordinate(i,"longitude")||!this.isValidCoordinate(c,"longitude"))throw console.error("Invalid coordinates detected",{south:r,west:i,north:o,east:c}),new Error(`Invalid coordinates: lat=${r}-${o}, lng=${i}-${c}`);const l=o-r,m=c-i;if(l>5||m>5)throw console.warn("Bounding box too large for campsite query",{latSpan:l,lngSpan:m,bounds:a}),new Error(`Bounding box too large: ${l}Â° lat x ${m}Â° lng (max 5Â° each)`);const h=`${r.toFixed(6)},${i.toFixed(6)},${o.toFixed(6)},${c.toFixed(6)}`;console.log("buildOverpassQuery: Final bbox",h);const u=[];return t.includes("campsite")&&(u.push(`node["tourism"="camp_site"](${h});`),u.push(`way["tourism"="camp_site"](${h});`)),t.includes("caravan_site")&&(u.push(`node["tourism"="caravan_site"](${h});`),u.push(`way["tourism"="caravan_site"](${h});`)),t.includes("aire")&&(u.push(`node["amenity"="parking"]["motorhome"="yes"](${h});`),u.push(`node["amenity"="parking"]["caravan"="yes"](${h});`),u.push(`node["tourism"="wilderness_hut"](${h});`),u.push(`node["highway"="services"]["motorhome"="yes"](${h});`)),`[out:json][timeout:30];(${u.join("")});out center meta 1000;`}parseOverpassResponse(a){return!a||!a.elements?[]:a.elements.map(t=>this.parseOSMElement(t)).filter(Boolean)}parseOpenCampingMapResponse(a){return!a||!a.features?[]:a.features.map(t=>this.parseOpenCampingMapFeature(t)).filter(Boolean)}parseOSMElement(a){if(!a.lat||!a.lon||!a.tags)return null;const t=a.tags;if(t.disused==="yes"||t.abandoned==="yes"||t.demolished==="yes"||t["tourism:disused"]==="yes"||t.lifecycle_status==="abandoned"||t.lifecycle_status==="disused"||t.lifecycle_status==="demolished")return console.log("Filtering out closed/abandoned campsite:",t.name||a.id),null;const r=this.determineCampsiteType(t);return{id:a.id,type:r,name:t.name||t["name:en"]||`${r} ${a.id}`,lat:a.lat,lng:a.lon,amenities:{toilets:this.parseBoolean(t.amenity==="toilets"||t.toilets),showers:this.parseBoolean(t.shower),drinking_water:this.parseBoolean(t.drinking_water),electricity:this.parseBoolean(t.electricity),wifi:this.parseBoolean(t.internet_access==="wifi"||t.wifi),restaurant:this.parseBoolean(t.amenity==="restaurant"||t.restaurant),shop:this.parseBoolean(t.shop),playground:this.parseBoolean(t.playground),laundry:this.parseBoolean(t.laundry),swimming_pool:this.parseBoolean(t.swimming_pool)},access:{motorhome:this.parseBoolean(t.motorhome),caravan:this.parseBoolean(t.caravan),tent:this.parseBoolean(t.tents!=="no"&&r==="campsite"),max_height:this.parseNumber(t.maxheight),max_length:this.parseNumber(t.maxlength),max_weight:this.parseNumber(t.maxweight)},contact:{phone:t.phone,website:t.website||t.url,email:t.email},opening_hours:t.opening_hours,fee:t.fee,reservation:t.reservation,capacity:this.parseNumber(t.capacity),source:"openstreetmap",last_updated:Date.now(),quality_score:this.calculateQualityScore(t)}}parseOpenCampingMapFeature(a){if(!a.geometry||!a.properties)return null;const t=a.properties,[r,i]=a.geometry.coordinates;return{id:t.id||Math.random()*1e6,type:"campsite",name:t.name||"Unnamed Campsite",lat:i,lng:r,amenities:{toilets:!!t.toilets,showers:!!t.showers,drinking_water:!!t.drinking_water,electricity:!!t.electricity,wifi:!!t.wifi,restaurant:!!t.restaurant,shop:!!t.shop,playground:!!t.playground,laundry:!!t.laundry,swimming_pool:!!t.swimming_pool},access:{motorhome:!!t.motorhome,caravan:!!t.caravan,tent:!!t.tent,max_height:t.max_height,max_length:t.max_length,max_weight:t.max_weight},contact:{phone:t.phone,website:t.website,email:t.email},opening_hours:t.opening_hours,fee:t.fee,reservation:t.reservation,capacity:t.capacity,source:"opencampingmap",last_updated:Date.now(),quality_score:.8}}determineCampsiteType(a){return a.tourism==="camp_site"?"campsite":a.tourism==="caravan_site"?"caravan_site":a.amenity==="parking"&&(a.motorhome==="yes"||a.caravan==="yes")||a.highway==="services"&&a.motorhome==="yes"?"aire":"campsite"}parseBoolean(a){if(typeof a=="boolean")return a;if(typeof a=="string"){const t=a.toLowerCase();return t==="yes"||t==="true"||t==="1"}return!1}parseNumber(a){if(typeof a=="number")return a;if(typeof a=="string"){const t=parseFloat(a.replace(/[^\d.]/g,""));return isNaN(t)?void 0:t}}calculateQualityScore(a){let t=0;const r=[a.name,a.phone||a.website,a.opening_hours,a.drinking_water,a.electricity,a.toilets||a.amenity==="toilets",a.motorhome||a.caravan];return t=r.filter(Boolean).length/r.length,Math.round(t*100)/100}filterAndScoreCampsites(a,t){let r=a;t.vehicleFilter&&(r=r.filter(c=>this.isVehicleCompatible(c,t.vehicleFilter))),t.amenities&&t.amenities.length>0&&(r=r.filter(c=>t.amenities.some(l=>c.amenities[l]===!0)));const i=(t.bounds.north+t.bounds.south)/2,o=(t.bounds.east+t.bounds.west)/2;return r.sort((c,l)=>{const m=this.calculateDistance(i,o,c.lat,c.lng),h=this.calculateDistance(i,o,l.lat,l.lng),u=(c.quality_score||.5)-m/100;return(l.quality_score||.5)-h/100-u})}isVehicleCompatible(a,t){return!(t.motorhome&&!a.access.motorhome||t.caravan&&!a.access.caravan||t.height&&a.access.max_height&&t.height>a.access.max_height||t.length&&a.access.max_length&&t.length>a.access.max_length||t.weight&&a.access.max_weight&&t.weight>a.access.max_weight)}calculateDistance(a,t,r,i){const c=(r-a)*Math.PI/180,l=(i-t)*Math.PI/180,m=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}async getCachedCampsites(a,t=!1){try{const r=this.generateCampsiteCacheKey(a),i=await this.cacheManager.getCacheMetadata(r);if(i){const o=Date.now()-i.timestamp,c=1440*60*1e3;if(t||o<c){const l=await this.cacheManager.getCampsitesInBounds(a.bounds);if(l.length>0)return{status:"success",campsites:this.filterAndScoreCampsites(l,a),metadata:{service:i.service||"overpass",timestamp:i.timestamp,query:a,results_count:l.length,cache_hit:!0,query_duration:0},cached:!0,boundingBox:a.bounds}}}return null}catch(r){return console.warn("Cache lookup failed:",r),null}}async setCacheMetadata(a){try{const t=this.generateCampsiteCacheKey(a);await this.cacheManager.setCacheMetadata(t,{timestamp:Date.now(),service:"overpass",bounds:a.bounds})}catch(t){console.warn("Failed to set cache metadata:",t)}}generateCampsiteCacheKey(a){const{bounds:t,types:r=[],amenities:i=[]}=a;return!t||typeof t.south>"u"||typeof t.west>"u"||typeof t.north>"u"||typeof t.east>"u"?(console.warn("CampsiteService: Invalid bounds provided, using fallback cache key"),`campsites_invalid_bounds_${Date.now()}_${r.join(",")}_${i.join(",")}`):`campsites_${t.south}_${t.west}_${t.north}_${t.east}_${r.join(",")}_${i.join(",")}`}async initializeCache(){try{await this.cacheManager.initialize(),await this.cacheManager.clearExpiredCache()}catch(a){console.warn("Failed to initialize campsite cache:",a)}}initializeFallbackService(){this._fallbackService=void 0}async healthCheck(){try{const t={method:"POST",endpoint:"",body:"[out:json][timeout:5]; out count;",headers:{"Content-Type":"text/plain"},customTimeout:5e3};return await this.request(t),!0}catch(a){return console.warn("Overpass API health check failed:",a),!1}}getServiceStatus(){const a=this.rateLimitState.get("default")||{count:0,resetTime:Date.now()};return{primary:{name:"Overpass API",healthy:!0,cacheSize:"IndexedDB"},fallback:{name:"OpenCampingMap",available:!0},rateLimitInfo:{remaining:Math.max(0,this.rateLimit.requests-a.count),resetTime:a.resetTime}}}async refreshCache(a){const t={bounds:a};await this.searchWithOverpass(t)}getCacheStats(){return{size:0,entries:[]}}}const Ye=new on,bt=()=>({visibleTypes:["campsite","caravan_site","aire"],amenities:{electricity:!1,wifi:!1,shower:!1,toilets:!1,drinking_water:!1,waste_disposal:!1,laundry:!1,restaurant:!1,shop:!1,playground:!1,swimming_pool:!1,pet_allowed:!1},vehicleCompatibleOnly:!1,routeOnlyMode:!1,maxDistanceFromRoute:20,openNow:!1,freeOnly:!1,acceptsReservations:!1,searchQuery:"",searchLocation:"",maxResults:100,sortBy:"distance"}),we=[{type:"campsite",label:"Campsites",icon:"â›º",description:"Traditional camping with tents/caravans"},{type:"caravan_site",label:"Caravan Sites",icon:"ðŸš",description:"Sites specifically for caravans/motorhomes"},{type:"aire",label:"Aires de Service",icon:"ðŸ…¿ï¸",description:"Motorhome service areas with facilities"}],ln=[{key:"electricity",label:"Electricity",icon:"âš¡"},{key:"wifi",label:"WiFi",icon:"ðŸ“¶"},{key:"shower",label:"Showers",icon:"ðŸš¿"},{key:"toilets",label:"Toilets",icon:"ðŸš»"},{key:"drinking_water",label:"Drinking Water",icon:"ðŸš°"},{key:"waste_disposal",label:"Waste Disposal",icon:"ðŸ—‘ï¸"},{key:"laundry",label:"Laundry",icon:"ðŸ‘•"},{key:"restaurant",label:"Restaurant",icon:"ðŸ½ï¸"},{key:"shop",label:"Shop",icon:"ðŸ›’"},{key:"playground",label:"Playground",icon:"ðŸŽ "},{key:"swimming_pool",label:"Swimming Pool",icon:"ðŸŠ"},{key:"pet_allowed",label:"Pets Allowed",icon:"ðŸ•"}],cn=[{value:"distance",label:"Distance from route"},{value:"name",label:"Name A-Z"},{value:"rating",label:"Rating"},{value:"relevance",label:"Search relevance"}],dn=[25,50,100,200,500],mn=[5,10,20,50,100],hn=({className:n,filterState:s,onFilterChange:a,onSearchChange:t,campsiteCount:r=0,isLoading:i=!1})=>{const[o,c]=d.useState(!1),[l,m]=d.useState("types"),{calculatedRoute:h}=ne(),u=d.useCallback(p=>{try{localStorage.setItem("camper-planner-campsite-filters",JSON.stringify(p))}catch(w){console.warn("Failed to persist campsite filters:",w)}},[]);d.useEffect(()=>{try{const p=localStorage.getItem("camper-planner-campsite-filters");if(p){const w=JSON.parse(p),D={...bt(),...w};a(D)}}catch(p){console.warn("Failed to load persisted filters:",p)}},[a]);const g=d.useCallback((p,w)=>{const D={...s,[p]:w};a(D),u(D)},[s,a,u]),b=d.useCallback(p=>{const w=s.visibleTypes.includes(p)?s.visibleTypes.filter(D=>D!==p):[...s.visibleTypes,p];g("visibleTypes",w)},[s.visibleTypes,g]),j=d.useCallback(p=>{const w={...s.amenities,[p]:!s.amenities[p]};g("amenities",w)},[s.amenities,g]),C=d.useCallback(()=>{const p=bt();a(p),u(p)},[a,u]),N=d.useMemo(()=>{let p=0;return s.visibleTypes.length!==we.length&&p++,p+=Object.values(s.amenities).filter(Boolean).length,s.vehicleCompatibleOnly&&p++,s.routeOnlyMode&&p++,s.openNow&&p++,s.freeOnly&&p++,s.acceptsReservations&&p++,s.searchQuery.trim()&&p++,s.searchLocation.trim()&&p++,p},[s]),k=h?.routes?.[0]?.geometry;return e.jsxs("div",{className:S("bg-white rounded-lg shadow-sm border border-gray-200",n),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"text-lg",children:"ðŸ”"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Campsite Filters"}),N>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium",children:[N," active"]}),r>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",r," results)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[N>0&&e.jsx("button",{onClick:C,className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),i&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"}),e.jsx("button",{onClick:()=>c(!o),className:"p-1.5 rounded text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:S("w-4 h-4 transform transition-transform",o&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),!o&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[we.map(({type:p,icon:w,label:D})=>e.jsx("button",{onClick:()=>b(p),className:S("flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all",s.visibleTypes.includes(p)?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-gray-50 text-gray-400 hover:border-gray-400"),title:D,children:e.jsx("span",{className:"text-sm",children:w})},p)),k&&e.jsx("button",{onClick:()=>g("routeOnlyMode",!s.routeOnlyMode),className:S("px-2 py-1 text-xs font-medium rounded transition-colors",s.routeOnlyMode?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ðŸ“ Route only"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Max: ",s.maxResults]})]})}),o&&e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsx("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[{id:"types",label:"Types",icon:"ðŸ•ï¸"},{id:"amenities",label:"Amenities",icon:"âš¡"},{id:"advanced",label:"Advanced",icon:"âš™ï¸"},{id:"search",label:"Search",icon:"ðŸ”"}].map(p=>e.jsxs("button",{onClick:()=>m(p.id),className:S("flex-1 flex items-center justify-center space-x-1 py-3 px-2 text-sm font-medium transition-colors",l===p.id?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"),children:[e.jsx("span",{className:"text-sm",children:p.icon}),e.jsx("span",{children:p.label})]},p.id))}),e.jsxs("div",{className:"p-4 space-y-4",children:[l==="types"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Campsite Types"}),e.jsx("button",{onClick:()=>{const p=s.visibleTypes.length===we.length;g("visibleTypes",p?[]:we.map(w=>w.type))},className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:s.visibleTypes.length===we.length?"None":"All"})]}),we.map(({type:p,label:w,icon:D,description:V})=>e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.visibleTypes.includes(p),onChange:()=>b(p),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:D}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:w})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:V})]})]},p))]}),l==="amenities"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Required Amenities"}),e.jsx("button",{onClick:()=>{const p=Object.values(s.amenities).every(Boolean),w=Object.keys(s.amenities).reduce((D,V)=>({...D,[V]:!p}),{});g("amenities",w)},className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:Object.values(s.amenities).every(Boolean)?"None":"All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ln.map(({key:p,label:w,icon:D})=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.amenities[p],onChange:()=>j(p),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm",children:D}),e.jsx("span",{className:"text-sm text-gray-900",children:w})]},p))}),e.jsx("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:"ðŸ’¡ Only campsites with ALL selected amenities will be shown"})]}),l==="advanced"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.vehicleCompatibleOnly,onChange:p=>g("vehicleCompatibleOnly",p.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Vehicle Compatible Only"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Show only campsites that can accommodate your vehicle dimensions"})]})]}),k&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.routeOnlyMode,onChange:p=>g("routeOnlyMode",p.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Show Along Route Only"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Filter campsites within distance of your planned route"})]})]}),s.routeOnlyMode&&e.jsxs("div",{className:"ml-7",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Max Distance from Route: ",s.maxDistanceFromRoute,"km"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:5,max:100,step:5,value:s.maxDistanceFromRoute,onChange:p=>g("maxDistanceFromRoute",parseInt(p.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),e.jsx("select",{value:s.maxDistanceFromRoute,onChange:p=>g("maxDistanceFromRoute",parseInt(p.target.value)),className:"text-xs border border-gray-300 rounded px-2 py-1 bg-white",children:mn.map(p=>e.jsxs("option",{value:p,children:[p,"km"]},p))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.openNow,onChange:p=>g("openNow",p.target.checked),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Open Now"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.freeOnly,onChange:p=>g("freeOnly",p.target.checked),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Free Only"})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.acceptsReservations,onChange:p=>g("acceptsReservations",p.target.checked),className:"h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Accepts Reservations"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Max Results"}),e.jsx("select",{value:s.maxResults,onChange:p=>g("maxResults",parseInt(p.target.value)),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 bg-white",children:dn.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsx("select",{value:s.sortBy,onChange:p=>g("sortBy",p.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 bg-white",children:cn.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded mt-4",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Map Legend"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Campsite (tent/caravan)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#3b82f6",stroke:"#2563eb",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Caravan/Motorhome site"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#8b5cf6",stroke:"#7c3aed",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Aire de Service"})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#ef4444",stroke:"#dc2626",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"May not fit your vehicle"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 text-white text-[8px] font-bold flex items-center justify-center border-2 border-white shadow",children:"3"})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Clustered markers (zoom in)"})]})]})]})]})]}),l==="search"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search by Name"}),e.jsx("input",{type:"text",value:s.searchQuery,onChange:p=>{g("searchQuery",p.target.value),t?.(p.target.value)},placeholder:"Search campsite names...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search by Location"}),e.jsx("input",{type:"text",value:s.searchLocation,onChange:p=>g("searchLocation",p.target.value),placeholder:"City, region, or address...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:"Search Tips:"}),e.jsxs("ul",{className:"space-y-0.5 text-gray-700",children:[e.jsx("li",{children:"â€¢ Use partial names for broader results"}),e.jsx("li",{children:"â€¢ Search by city or region names"}),e.jsx("li",{children:"â€¢ Combine with other filters for precise results"}),e.jsx("li",{children:"â€¢ Clear search to see all campsites in area"})]})]})]})]})]})]})},Ie={campsite:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 12h3v8h14v-8h3L12 2zm-1 15h-2v-3h2v3zm4 0h-2v-3h2v3z"/></svg>',caravan_site:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 7h-3V6a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v6h2a3 3 0 0 0 6 0h6a3 3 0 0 0 6 0h2V10a3 3 0 0 0-3-3zM6 14a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm12 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></svg>',aire:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 15c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 2.5c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5zm12-2.5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 2.5c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5zm-4.5-12H11V3H9v2.5H6.5l1.38 1.38C8.51 7.45 9.2 8 10 8h4c.8 0 1.49-.55 1.88-1.38L17.26 5.5H15V3h-2v2.5z"/></svg>',parking:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.5 2h11A1.5 1.5 0 0 1 19 3.5v17a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 5 20.5v-17A1.5 1.5 0 0 1 6.5 2zM8 8v8h2v-3h2.5a2.5 2.5 0 0 0 0-5H8zm2 2h2.5a.5.5 0 0 1 0 1H10v-1z"/></svg>',unknown:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"/></svg>'},$t={campsite:{icon:Ie.campsite,color:"#ffffff",backgroundColor:"#22c55e",borderColor:"#16a34a",size:32,description:"Traditional campsite with tent/caravan pitches"},caravan_site:{icon:Ie.caravan_site,color:"#ffffff",backgroundColor:"#3b82f6",borderColor:"#2563eb",size:32,description:"Caravan and motorhome specific site"},aire:{icon:Ie.aire,color:"#ffffff",backgroundColor:"#8b5cf6",borderColor:"#7c3aed",size:32,description:"Aire de service for motorhomes"},parking:{icon:Ie.parking,color:"#ffffff",backgroundColor:"#f59e0b",borderColor:"#d97706",size:32,description:"Parking area with overnight stays allowed"},unknown:{icon:Ie.unknown,color:"#ffffff",backgroundColor:"#6b7280",borderColor:"#4b5563",size:28,description:"Unknown campsite type"}},Pt={electricity:{borderColor:"#fbbf24",backgroundColor:"#f59e0b"},wifi:{borderColor:"#06b6d4",backgroundColor:"#0891b2"},shower:{borderColor:"#2dd4bf",backgroundColor:"#14b8a6"},toilets:{borderColor:"#a78bfa",backgroundColor:"#8b5cf6"},drinking_water:{borderColor:"#60a5fa",backgroundColor:"#3b82f6"}},un={small:24,medium:32,large:40};function xn(n){const{campsite:s,vehicleCompatible:a=!0,isSelected:t=!1,isHighlighted:r=!1,isInRoute:i=!1,isMobile:o=!1,size:c="medium",showTooltip:l=!1}=n,m=$t[s.type]||$t.unknown;let h=o?un[c]:m.size;(t||r)&&(h=Math.floor(h*1.2));let u=m.backgroundColor,g=m.borderColor;if(a||(u="#ef4444",g="#dc2626"),t&&(g="#f59e0b"),r&&(g="#3b82f6"),a&&s.amenities){for(const[V,$]of Object.entries(s.amenities))if($&&Pt[V]){const z=Pt[V];z.backgroundColor&&(u=z.backgroundColor),z.borderColor&&(g=z.borderColor);break}}const b=t?`
    animation: campsite-pulse 1.5s ease-in-out infinite;
  `:r?`
    animation: campsite-glow 1s ease-in-out infinite;
  `:"",j=Math.floor(h*.6),C=l&&s.name?`
    <div class="campsite-tooltip" style="
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      white-space: nowrap;
      font-size: 11px;
      font-weight: 500;
      color: #374151;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      margin-bottom: 4px;
      z-index: 1000;
    ">${s.name.substring(0,30)}${s.name.length>30?"...":""}</div>
  `:"",N=i?`
    <div style="
      position: absolute;
      top: -4px;
      right: -4px;
      width: 14px;
      height: 14px;
      background: #22c55e;
      border: 2px solid white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    ">
      <svg viewBox="0 0 20 20" fill="white" style="width: 8px; height: 8px;">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
      </svg>
    </div>
  `:"",k=!a&&!i?`
    <div style="
      position: absolute;
      top: -2px;
      right: -2px;
      width: 12px;
      height: 12px;
      background: #fef2f2;
      border: 2px solid #dc2626;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      font-weight: bold;
      color: #dc2626;
    ">!</div>
  `:"",p=h,w=Math.floor(h*1.4),D=`
    <div class="campsite-marker-wrapper" style="
      position: relative;
      width: ${p}px;
      height: ${w}px;
      ${b}
    ">
      ${C}
      <div style="
        position: relative;
        width: ${p}px;
        height: ${w}px;
        cursor: pointer;
        filter: drop-shadow(0 3px 4px rgba(0,0,0,0.3));
      ">
        <!-- Pin/teardrop SVG shape -->
        <svg viewBox="0 0 32 44" style="width: 100%; height: 100%;">
          <!-- Main pin shape -->
          <path d="M16 0C7.163 0 0 7.163 0 16c0 12 16 28 16 28s16-16 16-28C32 7.163 24.837 0 16 0z"
                fill="${u}"
                stroke="${g}"
                stroke-width="2"/>
          <!-- Inner circle for icon -->
          <circle cx="16" cy="14" r="10" fill="${g}" opacity="0.2"/>
        </svg>
        <!-- Icon container centered in top portion -->
        <div style="
          position: absolute;
          top: ${Math.floor(w*.12)}px;
          left: 50%;
          transform: translateX(-50%);
          width: ${j}px;
          height: ${j}px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: ${m.color};
        ">
          ${m.icon}
        </div>
        ${N}
        ${k}
      </div>
    </div>
  `;return Ce.divIcon({className:`campsite-marker-icon ${t?"selected":""} ${r?"highlighted":""} ${i?"in-route":""}`,html:D,iconSize:[p,w],iconAnchor:[p/2,w],popupAnchor:[0,-w+10]})}function pn(n){const s=n.getChildCount(),a=s<10?30:s<100?40:50;return Ce.divIcon({html:`
      <div style="
        width: ${a}px;
        height: ${a}px;
        background: linear-gradient(135deg, #22c55e, #16a34a);
        border: 3px solid #ffffff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: ${Math.floor(a*.3)}px;
        font-weight: bold;
        color: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        cursor: pointer;
      ">
        ${s}
      </div>
    `,className:"campsite-cluster-icon",iconSize:[a,a],iconAnchor:[a/2,a/2]})}function gn(n,s,a=!1){const t=a?s>12?15:s>10?25:40:s>12?20:s>10?30:50,r=[],i=new Set;for(const o of n){if(i.has(o.id))continue;const c=[o];i.add(o.id);for(const l of n){if(i.has(l.id)||l.id===o.id)continue;fn(o.lat,o.lng,l.lat,l.lng,s)<t&&(c.push(l),i.add(l.id))}if(c.length>1){const l=c.reduce((h,u)=>h+u.lat,0)/c.length,m=c.reduce((h,u)=>h+u.lng,0)/c.length;r.push({...o,id:Date.now()+r.length,location:{lat:l,lng:m},name:`${c.length} campsites`,isCluster:!0,clusterCount:c.length,clusterCampsites:c})}else r.push(o)}return r}function fn(n,s,a,t,r){const o=n*Math.PI/180,c=a*Math.PI/180,l=(a-n)*Math.PI/180,m=(t-s)*Math.PI/180,h=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o)*Math.cos(c)*Math.sin(m/2)*Math.sin(m/2),g=6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))),b=156543.03392*Math.cos(o)/Math.pow(2,r);return g/b}const bn=({visibleTypes:n,maxResults:s,vehicleCompatibleOnly:a,searchQuery:t="",isVisible:r,onCampsiteClick:i,onCampsitesLoaded:o,isMobile:c=!1,filterState:l,highlightedCampsiteId:m,selectedCampsiteId:h})=>{const u=Qe(),{calculatedRoute:g,waypoints:b,addWaypoint:j}=ne(),{profile:C}=ie(),{addNotification:N}=oe(),k=d.useCallback(x=>b.some(L=>Math.abs(L.lat-x.lat)<1e-4&&Math.abs(L.lng-x.lng)<1e-4),[b]),p=d.useCallback((x,L)=>{if(L.stopPropagation(),k(x)){N({type:"warning",message:`${x.name||"This campsite"} is already in your route`});return}const B={id:`campsite-${x.id}-${Date.now()}`,lat:x.lat,lng:x.lng,type:"campsite",name:x.name||`${x.type.replace("_"," ")} #${x.id}`,notes:x.address||""};j(B),N({type:"success",message:`Added "${B.name}" to your route`})},[j,N,k]),[w,D]=d.useState([]),[V,$]=d.useState(!1),[z,F]=d.useState(null),[G,R]=d.useState(u.getZoom()),A=d.useRef(null),T=d.useRef(null);d.useEffect(()=>{const x=()=>R(u.getZoom());return u.on("zoomend",x),()=>{u.off("zoomend",x)}},[u]);const E=d.useCallback(x=>{if(!(x instanceof Error))return{message:"Failed to load campsites",suggestion:"Please try again or zoom to a different area.",retryable:!0};const L=x.message.toLowerCase();return L.includes("timeout")?{message:"Request timed out while loading campsites",suggestion:"The area may be too large. Try zooming in to search a smaller area.",retryable:!0}:L.includes("failed to fetch")||L.includes("network")?{message:"Network connection failed",suggestion:"Please check your internet connection and try again.",retryable:!0}:L.includes("rate limit")||L.includes("too many requests")?{message:"Too many requests",suggestion:"Please wait a moment before searching again.",retryable:!0}:L.includes("bounding box too large")?{message:"Search area too large",suggestion:"Please zoom in to search a smaller area.",retryable:!1}:L.includes("no data")||L.includes("404")?{message:"No campsites found in this area",suggestion:"Try zooming out or searching a different location.",retryable:!1}:L.includes("http 5")?{message:"Campsite service temporarily unavailable",suggestion:"Please try again in a few moments.",retryable:!0}:{message:x.message||"Failed to load campsites",suggestion:"Please try again. If the problem persists, try zooming to a different area.",retryable:!0}},[]),J=d.useCallback(x=>C?!(C.height&&x.access?.max_height&&C.height>x.access.max_height||C.length&&x.access?.max_length&&C.length>x.access.max_length||C.weight&&x.access?.max_weight&&C.weight>x.access.max_weight):!0,[C]),Q=d.useMemo(()=>{const x=[...new Set(w.map(L=>L.type))];console.log("SimpleCampsiteLayer: Filtering campsites",{campsitesCount:w.length,uniqueTypes:x,visibleTypes:n,filterState:!!l,vehicleCompatibleOnly:a,hasProfile:!!C,typeMatches:x.map(L=>({type:L,visible:n.includes(L)}))});{let L=w.map(P=>({...P,vehicleCompatible:J(P)}));if(console.log("SimpleCampsiteLayer: Before filtering",{count:L.length,compatibleCount:L.filter(P=>P.vehicleCompatible).length,incompatibleCount:L.filter(P=>!P.vehicleCompatible).length}),a){const P=L.length;L=L.filter(v=>v.vehicleCompatible),console.log("SimpleCampsiteLayer: After vehicle filter",{before:P,after:L.length,removed:P-L.length})}if(t.trim()){const P=L.length,v=t.toLowerCase();L=L.filter(_=>_.name?.toLowerCase().includes(v)||_.address?.toLowerCase().includes(v)||_.type.toLowerCase().includes(v)||Object.keys(_.amenities||{}).some(W=>W.toLowerCase().includes(v))),console.log("SimpleCampsiteLayer: After search filter",{before:P,after:L.length,removed:P-L.length,query:v})}const B=L.length;return L=L.filter(P=>n.includes(P.type)),console.log("SimpleCampsiteLayer: After type filter",{before:B,after:L.length,removed:B-L.length}),L}},[w,a,t,n,l,g,u,J,C]),Z=d.useMemo(()=>{if(console.log("SimpleCampsiteLayer: Clustering campsites",{filteredCount:Q.length,zoom:G,isVisible:r,willCluster:G<15}),!r||G>=15)return Q;const x=gn(Q,G,c);return console.log("SimpleCampsiteLayer: Clustering result",{inputCount:Q.length,outputCount:x.length}),x},[Q,G,r,c]),se=d.useCallback(async()=>{if(console.log("SimpleCampsiteLayer: loadCampsites called",{hasMap:!!u,featureEnabled:pe.CAMPSITE_DISPLAY,isVisible:r,visibleTypes:n,maxResults:s}),!u||!r)return;const x=u.getZoom();if(x<7){console.log("SimpleCampsiteLayer: Zoom level too low for campsite loading",{currentZoom:x,minRequired:7});return}$(!0),F(null);try{const L=u.getBounds();if(!L){console.warn("SimpleCampsiteLayer: No bounds available from map"),$(!1);return}const B=L.getNorth(),P=L.getSouth(),v=L.getEast(),_=L.getWest();if(typeof B>"u"||typeof P>"u"||typeof v>"u"||typeof _>"u"||isNaN(B)||isNaN(P)||isNaN(v)||isNaN(_)){console.warn("SimpleCampsiteLayer: Invalid bounds values",{north:B,south:P,east:v,west:_}),$(!1);return}const W={bounds:{north:B,south:P,east:v,west:_},types:n,maxResults:s,includeDetails:!0,vehicleFilter:C||void 0},H=await Ye.searchCampsites(W);if(console.log("SimpleCampsiteLayer: Search response",{status:H.status,campsiteCount:H.campsites?.length||0,bounds:W.bounds}),H.status==="success")D(H.campsites),o?.(H.campsites.length,H.campsites);else throw new Error(H.error||"Failed to load campsites")}catch(L){console.error("Error loading campsites:",L);const B=E(L);F(B),D([]),o?.(0,[])}finally{$(!1)}},[u,n,s,C,r,o,E]),re=d.useCallback(async()=>{if(!g?.routes?.[0]?.geometry||!r)return;const x=g.routes[0].geometry;let L=1/0,B=-1/0,P=1/0,v=-1/0;x.coordinates.forEach(W=>{const[H,q]=W;L=Math.min(L,q),B=Math.max(B,q),P=Math.min(P,H),v=Math.max(v,H)});const _=.1;$(!0),F(null);try{const W={bounds:{north:B+_,south:L-_,east:v+_,west:P-_},types:n,maxResults:s,includeDetails:!0,vehicleFilter:C||void 0},H=await Ye.searchCampsites(W);if(H.status==="success")D(H.campsites),o?.(H.campsites.length,H.campsites);else throw new Error(H.error||"Failed to load campsites")}catch(W){console.error("Error loading route campsites:",W);const H=E(W);F(H),D([]),o?.(0,[])}finally{$(!1)}},[g,n,s,C,r,o]);d.useEffect(()=>{A.current=se},[se]),d.useEffect(()=>{T.current=re},[re]);const[y,O]=d.useState(null),[K,te]=d.useState(0);return d.useEffect(()=>{if(!r||!u)return;const x=()=>{clearTimeout(window.campsiteDebounceTimer),window.campsiteDebounceTimer=setTimeout(()=>{const L=u.getBounds(),B=u.getZoom();if(y&&Math.abs(B-K)<1){const v=L.getSouth(),_=L.getNorth(),W=L.getWest(),H=L.getEast(),q=y.getSouth(),U=y.getNorth(),ee=y.getWest(),ae=y.getEast(),le=Math.abs(v-q)+Math.abs(_-U),de=Math.abs(W-ee)+Math.abs(H-ae),ue=U-q,be=ae-ee;if(le<ue*.1&&de<be*.1){console.log("SimpleCampsiteLayer: Skipping load - minor map movement");return}}O(L),te(B),A.current?.()},250)};return u.on("moveend",x),A.current?.(),()=>{u.off("moveend",x),clearTimeout(window.campsiteDebounceTimer)}},[u,r]),d.useEffect(()=>{g&&r&&T.current?.()},[g,r]),r?(console.log("SimpleCampsiteLayer: Rendering markers",{totalCampsites:Z.length,isLoading:V,isVisible:r,zoom:G}),e.jsxs(e.Fragment,{children:[V&&e.jsxs("div",{className:"fixed top-24 right-4 z-50 bg-white shadow-lg rounded-lg px-4 py-2 flex items-center space-x-2 animate-fade-in",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Loading campsites..."})]}),z&&!V&&e.jsx("div",{className:"fixed top-24 right-4 z-50 max-w-sm bg-red-50 shadow-lg rounded-lg p-4 border border-red-200 animate-slide-in-right",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-red-900",children:z.message}),z.suggestion&&e.jsx("p",{className:"text-xs text-red-700 mt-1",children:z.suggestion}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[z.retryable&&e.jsxs("button",{onClick:()=>{F(null),se()},className:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 bg-white border border-red-300 rounded hover:bg-red-50 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Retry"]}),e.jsx("button",{onClick:()=>F(null),className:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 hover:text-red-900",children:"Dismiss"})]})]}),e.jsx("button",{onClick:()=>F(null),className:"flex-shrink-0 text-red-400 hover:text-red-600 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),Z.map(x=>{const L=m===x.id.toString(),B=h===x.id.toString(),P=x.isCluster,v=k(x),_=P?pn({getChildCount:()=>x.clusterCount||0}):xn({campsite:x,vehicleCompatible:x.vehicleCompatible,isSelected:B,isHighlighted:L,isInRoute:v,isMobile:c,showTooltip:!0});return e.jsx(ke,{position:P&&x.location?[x.location.lat,x.location.lng]:[x.lat,x.lng],icon:_,eventHandlers:{click:()=>{if(P){if(x.clusterCampsites){const W=Ce.latLngBounds(x.clusterCampsites.map(H=>[H.lat,H.lng]));u.fitBounds(W,{padding:[20,20]})}}else i?.(x)}},children:e.jsx($e,{children:P?e.jsxs("div",{className:"p-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900 text-sm mb-2",children:[x.clusterCount," Campsites"]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Click to zoom in and see individual campsites"}),e.jsxs("div",{className:"space-y-1",children:[x.clusterCampsites?.slice(0,3).map((W,H)=>e.jsxs("div",{className:"text-xs text-gray-700",children:["â€¢ ",W.name||W.type.replace("_"," ")]},H)),x.clusterCampsites&&x.clusterCampsites.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["and ",x.clusterCampsites.length-3," more..."]})]})]}):e.jsxs("div",{className:"campsite-popup-content p-3 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm leading-tight pr-2",children:x.name||`${x.type.replace("_"," ")} #${x.id}`}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${x.vehicleCompatible?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:x.vehicleCompatible?"âœ“ Compatible":"âš  Check Size"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs text-gray-600 capitalize mb-1",children:x.type.replace("_"," ")}),x.address&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["ðŸ“ ",x.address]}),x.phone&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["ðŸ“ž ",x.phone]}),x.website&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["ðŸŒ ",e.jsx("a",{href:x.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"Website"})]}),x.opening_hours&&e.jsxs("div",{className:"text-xs text-gray-700 mb-1",children:["ðŸ•’ ",x.opening_hours]})]}),x.amenities&&Object.keys(x.amenities).length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 mb-1",children:"Amenities:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(x.amenities).filter(([W,H])=>H).map(([W])=>e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded",children:W.replace(/_/g," ")},W))})]}),!x.vehicleCompatible&&x.restrictions&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:[e.jsx("div",{className:"text-xs font-medium text-red-800 mb-1",children:"âš ï¸ Vehicle Restrictions:"}),e.jsx("div",{className:"text-xs text-red-700",children:x.restrictions})]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:k(x)?e.jsxs("div",{className:"flex items-center justify-center py-2 px-3 bg-green-50 text-green-700 rounded-md text-xs font-medium",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Already in route"]}):e.jsxs("button",{onClick:W=>p(x,W),className:"w-full flex items-center justify-center py-2 px-3 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add to Route"]})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Data from ",x.source," â€¢ ID: ",x.osmId||x.id]})]})})},x.id)})]})):null},fe=[{type:"campsite",label:"Campsites",icon:"â›º",description:"Traditional camping with tents/caravans"},{type:"caravan_site",label:"Caravan Sites",icon:"ðŸš",description:"Sites specifically for caravans/motorhomes"},{type:"aire",label:"Aires de Service",icon:"ðŸ…¿ï¸",description:"Motorhome service areas with facilities"}],yn=[25,50,100,200,500],vn=({className:n,visibleTypes:s,onTypesChange:a,maxResults:t,onMaxResultsChange:r,vehicleCompatibleOnly:i,onVehicleCompatibleChange:o,isVisible:c=!0,onVisibilityChange:l,onRefresh:m,isLoading:h=!1,campsiteCount:u=0})=>{const[g,b]=d.useState(!1),j=N=>{s.includes(N)?a(s.filter(k=>k!==N)):a([...s,N])},C=()=>{s.length===fe.length?a([]):a(fe.map(N=>N.type))};return e.jsxs("div",{className:S("bg-white rounded-lg shadow-sm border border-gray-200",n),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>l?.(!c),className:S("flex items-center space-x-2 px-2 py-1 rounded text-sm font-medium transition-colors",c?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e.jsx("div",{className:"text-base",children:"ðŸ•ï¸"}),e.jsx("span",{children:"Campsites"}),c&&u>0&&e.jsx("span",{className:"bg-green-200 text-green-800 px-1.5 py-0.5 rounded-full text-xs font-medium",children:u})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.length,"/",fe.length," types)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m&&e.jsx("button",{onClick:m,disabled:h,className:S("p-1.5 rounded text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors",h&&"cursor-not-allowed opacity-50"),title:"Refresh campsite data",children:e.jsx("svg",{className:S("w-4 h-4",h&&"animate-spin"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("button",{onClick:()=>b(!g),className:"p-1.5 rounded text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:S("w-4 h-4 transform transition-transform",g&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),!g&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:fe.map(({type:N,icon:k})=>e.jsx("button",{onClick:()=>j(N),className:S("flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all",s.includes(N)?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-gray-50 text-gray-400 hover:border-gray-400"),title:fe.find(p=>p.type===N)?.label,children:e.jsx("span",{className:"text-sm",children:k})},N))}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Max: ",t," â€¢ ",i?"Compatible only":"All sites"]})]})}),g&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Campsite Types"}),e.jsx("button",{onClick:C,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:s.length===fe.length?"None":"All"})]}),e.jsx("div",{className:"space-y-2",children:fe.map(({type:N,label:k,icon:p,description:w})=>e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.includes(N),onChange:()=>j(N),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:p}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:k})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:w})]})]},N))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:N=>o(N.target.checked),className:"mt-1 h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Vehicle Compatible Only"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Show only campsites that can accommodate your vehicle dimensions"})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["Maximum Results: ",t]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:25,max:500,step:25,value:t,onChange:N=>r(parseInt(N.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),e.jsx("select",{value:t,onChange:N=>r(parseInt(N.target.value)),className:"text-xs border border-gray-300 rounded px-2 py-1 bg-white",children:yn.map(N=>e.jsx("option",{value:N,children:N},N))})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"25"}),e.jsx("span",{children:"500"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Map Legend"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Campsite (tent/caravan)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#3b82f6",stroke:"#2563eb",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Caravan/Motorhome site"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#8b5cf6",stroke:"#7c3aed",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Aire de Service"})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-6 flex-shrink-0",children:e.jsx("svg",{viewBox:"0 0 20 28",className:"w-full h-full",children:e.jsx("path",{d:"M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z",fill:"#ef4444",stroke:"#dc2626",strokeWidth:"1.5"})})}),e.jsx("span",{className:"text-xs text-gray-700",children:"May not fit your vehicle"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 text-white text-[8px] font-bold flex items-center justify-center border-2 border-white shadow",children:"3"})}),e.jsx("span",{className:"text-xs text-gray-700",children:"Clustered markers (zoom in)"})]})]})]})]})]})]})},_t={booking:{provider:"Booking.com",baseUrl:"https://www.booking.com",trackingParams:{aid:"camper-planner",label:"camping-search"},enabled:!1},pitchup:{provider:"Pitchup",baseUrl:"https://www.pitchup.com",trackingParams:{utm_source:"camper-planner",utm_medium:"referral"},enabled:!1},coolcamping:{provider:"Cool Camping",baseUrl:"https://www.coolcamping.com",trackingParams:{ref:"camper-planner"},enabled:!1}},Bt={electricity:{icon:"âš¡",label:"Power"},wifi:{icon:"ðŸ“¶",label:"WiFi"},showers:{icon:"ðŸš¿",label:"Showers"},toilets:{icon:"ðŸš»",label:"Toilets"},drinking_water:{icon:"ðŸš°",label:"Water"},waste_disposal:{icon:"ðŸ—‘ï¸",label:"Waste"},laundry:{icon:"ðŸ‘•",label:"Laundry"},restaurant:{icon:"ðŸ½ï¸",label:"Food"},shop:{icon:"ðŸ›’",label:"Shop"},playground:{icon:"ðŸŽ ",label:"Kids"},swimming_pool:{icon:"ðŸŠ",label:"Pool"},pet_allowed:{icon:"ðŸ•",label:"Pets OK"}},jn=["electricity","showers","wifi","toilets","drinking_water","waste_disposal","shop","restaurant"],Nn=({campsite:n,onClose:s,onAddAsWaypoint:a,onExportData:t,className:r})=>{const[i,o]=d.useState(!1),[c,l]=d.useState(!1),m=d.useRef(null),{addWaypoint:h,waypoints:u}=ne(),{profile:g}=ie(),{addNotification:b}=oe(),j=u.some(A=>Math.abs(A.lat-n.lat)<1e-4&&Math.abs(A.lng-n.lng)<1e-4),C=d.useCallback(()=>{if(j){b({type:"warning",message:"This campsite is already in your route"});return}const A={id:`campsite_${n.id}`,lat:n.lat,lng:n.lng,name:n.name||`${n.type} #${n.id}`,type:"waypoint"};h(A),a?.(n),b({type:"success",message:`Added ${A.name} to your route`})},[n,j,h,a,b]),N=d.useCallback(()=>{n.contact?.website?window.open(n.contact.website,"_blank"):m.current&&m.current.scrollIntoView({behavior:"smooth"})},[n.contact?.website]),k=d.useCallback(()=>{const A=`${n.lat.toFixed(6)}, ${n.lng.toFixed(6)}`;navigator.clipboard.writeText(A),b({type:"success",message:"Coordinates copied to clipboard"})},[n.lat,n.lng,b]),p=d.useCallback(()=>{const A={campsite:{id:n.id,name:n.name,type:n.type,location:{lat:n.lat,lng:n.lng},address:n.address,phone:n.contact?.phone,website:n.contact?.website,email:n.contact?.email,openingHours:n.opening_hours,amenities:n.amenities,access:n.access,source:n.source},exportedAt:new Date().toISOString(),exportedBy:"European Camper Trip Planner"},T=new Blob([JSON.stringify(A,null,2)],{type:"application/json"}),E=URL.createObjectURL(T),J=document.createElement("a");J.href=E,J.download=`campsite_${n.id}_${n.name?.replace(/[^a-zA-Z0-9]/g,"_")||"unnamed"}.json`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(E),t?.(n),b({type:"success",message:"Campsite data exported successfully"})},[n,t,b]),w=d.useCallback(A=>{const T=_t[A];if(!T||!T.enabled)return null;const E=new URLSearchParams(T.trackingParams);return n.name&&E.append("ss",n.name),n.address&&E.append("dest_id",n.address),`${T.baseUrl}/search?${E.toString()}`},[n]),D=()=>`https://www.google.com/maps/dir/?api=1&destination=${n.lat},${n.lng}`,V=n.access&&(n.access.max_height||n.access.max_length||n.access.max_weight),$=g&&V&&(n.access?.max_height&&g.height>n.access.max_height||n.access?.max_length&&g.length>n.access.max_length||n.access?.max_weight&&g.weight>n.access.max_weight),z=n.amenities?Object.entries(n.amenities):[],F=z.filter(([A,T])=>T).map(([A])=>A),G=jn.filter(A=>n.amenities&&n.amenities[A]),R=typeof window<"u"&&window.innerWidth<640;return e.jsxs("div",{className:S("bg-white shadow-lg border border-gray-200 overflow-hidden flex flex-col",R?"rounded-t-2xl":"rounded-lg",r),children:[R&&e.jsx("div",{className:"flex justify-center py-2 bg-gray-50",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-semibold truncate",children:n.name||`${n.type.replace("_"," ")} #${n.id}`}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1 text-sm text-green-100",children:[e.jsx("span",{className:"capitalize",children:n.type.replace("_"," ")}),e.jsx("span",{className:S("px-2 py-0.5 rounded-full text-xs font-medium",n.access?.motorhome?"bg-green-700 text-green-100":"bg-orange-500 text-white"),children:n.access?.motorhome?"âœ“ Vehicle OK":"âš  Check Size"})]})]}),s&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-green-700 rounded transition-colors ml-2","aria-label":"Close details",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:S("flex items-center gap-2 mt-3",R&&"flex-col w-full"),children:[e.jsx("button",{onClick:C,disabled:j,className:S("flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-colors",R?"w-full":"flex-1",j?"bg-green-700 text-green-300 cursor-default":"bg-white text-green-600 hover:bg-green-50 active:bg-green-100"),children:j?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"In Route"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add to Route"})]})}),e.jsxs("button",{onClick:N,className:S("flex items-center justify-center gap-2 px-4 py-2.5 bg-green-700 text-white rounded-lg font-medium hover:bg-green-800 transition-colors",R?"w-full":"flex-1"),children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Book Now"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[G.length>0&&e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:G.slice(0,8).map(A=>{const T=Bt[A];return e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-green-50 text-green-800 rounded-lg text-sm",title:T?.label||A,children:[e.jsx("span",{className:"text-base",children:T?.icon||"â€¢"}),e.jsx("span",{className:"font-medium",children:T?.label||A.replace(/_/g," ")})]},A)})})}),e.jsxs("div",{className:"p-4 space-y-3 border-b border-gray-100",children:[n.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("svg",{className:"w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"text-sm text-gray-700",children:n.address})]}),n.opening_hours&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-gray-700",children:n.opening_hours})]}),!n.address&&!n.opening_hours&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("span",{className:"text-sm text-gray-500 italic",children:n.type==="aire"?"Motorhome service area with facilities":n.type==="caravan_site"?"Caravan and motorhome site":"Camping site"})]})]}),V&&e.jsx("div",{className:S("p-4 border-b",$?"bg-red-50 border-red-100":"bg-orange-50 border-orange-100"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:S("w-5 h-5 mt-0.5 flex-shrink-0",$?"text-red-600":"text-orange-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{children:[e.jsx("div",{className:S("text-sm font-medium",$?"text-red-800":"text-orange-800"),children:$?"Vehicle may not fit!":"Size restrictions"}),e.jsxs("div",{className:S("text-sm mt-1 space-y-0.5",$?"text-red-700":"text-orange-700"),children:[n.access?.max_height&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max height: ",n.access.max_height,"m"]}),g&&e.jsxs("span",{className:S("text-xs px-1.5 py-0.5 rounded",g.height>n.access.max_height?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",g.height,"m"]})]}),n.access?.max_length&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max length: ",n.access.max_length,"m"]}),g&&e.jsxs("span",{className:S("text-xs px-1.5 py-0.5 rounded",g.length>n.access.max_length?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",g.length,"m"]})]}),n.access?.max_weight&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Max weight: ",n.access.max_weight,"t"]}),g&&e.jsxs("span",{className:S("text-xs px-1.5 py-0.5 rounded",g.weight>n.access.max_weight?"bg-red-200 text-red-800":"bg-green-200 text-green-800"),children:["You: ",g.weight,"t"]})]})]})]})]})}),n.access?.motorhome&&g&&!V&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("span",{className:"font-medium",children:"Compatible"}),e.jsxs("span",{className:"text-green-700",children:[" with your ",g.height,"m Ã— ",g.length,"m vehicle"]})]})]})}),z.length>0&&e.jsxs("div",{className:"border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>o(!i),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["All Amenities (",F.length,"/",z.length," available)"]})]}),e.jsx("svg",{className:S("w-5 h-5 text-gray-400 transition-transform",i&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&e.jsxs("div",{className:"px-4 pb-4",children:[F.length===0&&e.jsx("div",{className:"mb-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-700",children:"â„¹ï¸ Amenity data not available from OpenStreetMap. Check the campsite website for details."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:z.map(([A,T])=>{const E=Bt[A],J=T===!0;return e.jsxs("div",{className:S("flex items-center gap-2 p-2 rounded text-sm",J?"bg-green-50 text-green-800 border border-green-200":"bg-gray-50 text-gray-500 border border-gray-200"),children:[e.jsx("span",{className:"text-base",children:E?.icon||"â€¢"}),e.jsx("span",{className:"flex-1 capitalize",children:E?.label||A.replace(/_/g," ")}),J?e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("span",{className:"w-4 h-4 flex items-center justify-center text-gray-400 font-medium text-xs",children:"?"})]},A)})})]})]}),(n.contact?.phone||n.contact?.website||n.contact?.email)&&e.jsxs("div",{className:"border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>l(!c),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Contact Details"})]}),e.jsx("svg",{className:S("w-5 h-5 text-gray-400 transition-transform",c&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[n.contact?.phone&&e.jsxs("a",{href:`tel:${n.contact.phone.replace(/[^\d+]/g,"")}`,className:"flex items-center gap-3 text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx("span",{children:"ðŸ“ž"}),e.jsx("span",{children:n.contact.phone})]}),n.contact?.email&&e.jsxs("a",{href:`mailto:${n.contact.email}`,className:"flex items-center gap-3 text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx("span",{children:"âœ‰ï¸"}),e.jsx("span",{children:n.contact.email})]}),n.contact?.website&&e.jsxs("a",{href:n.contact.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx("span",{children:"ðŸŒ"}),e.jsx("span",{className:"truncate",children:n.contact.website.replace(/^https?:\/\//,"")})]})]})]}),e.jsxs("div",{ref:m,className:"p-4 border-b border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Book This Campsite"]}),n.contact?.website&&e.jsxs("a",{href:n.contact.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium mb-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),e.jsx("span",{children:"Visit Official Website"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"Search on booking platforms:"}),Object.entries(_t).map(([A,T])=>e.jsxs("button",{disabled:!T.enabled,className:S("w-full flex items-center justify-between p-3 border rounded-lg text-sm transition-colors",T.enabled?"border-blue-200 bg-blue-50 text-blue-800 hover:bg-blue-100":"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed"),onClick:()=>{if(T.enabled){const E=w(A);E&&window.open(E,"_blank")}},children:[e.jsx("span",{children:T.provider}),T.enabled?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}):e.jsx("span",{className:"text-xs",children:"Coming Soon"})]},A))]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-xs text-blue-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"ðŸ’¡ Booking Tips:"}),e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:"â€¢ Check availability directly with the campsite"}),e.jsx("li",{children:"â€¢ Book in advance during peak season"}),e.jsx("li",{children:"â€¢ Confirm vehicle size restrictions"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("a",{href:D(),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),e.jsx("span",{children:"Get Directions in Google Maps"})]})}),e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Data from ",n.source||"OpenStreetMap"]})}),e.jsxs("button",{onClick:k,className:"flex items-center gap-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Copy coordinates",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),e.jsx("span",{children:"Copy coords"})]})]}),e.jsxs("button",{onClick:p,className:"w-full flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-600 hover:bg-gray-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"Export Campsite Data"})]})]})]})]})},wn=[{id:"welcome",title:"Welcome to Camper Planner! ðŸš",content:"Plan your perfect European camping trip by clicking on the map to add waypoints.",action:"Click anywhere on the map to start",icon:"ðŸ—ºï¸",dismissible:!0},{id:"first-waypoint",title:"Great start! ðŸŽ¯",content:"You've added your first waypoint. Add more points to create your route.",action:"Click another location to continue",icon:"ðŸ“"},{id:"route-ready",title:"Route ready! ðŸ›£ï¸",content:"Perfect! You now have a route. Use the controls to zoom, add layers, or go fullscreen.",action:"Try the map controls on the right",icon:"âœ¨"}],kn={mapInteraction:{title:"Map Interaction Tips",items:["Click anywhere to add a waypoint","Drag waypoints to reposition them","Right-click for context menu options","Use mouse wheel to zoom in/out","Hold Shift and drag to pan quickly"]},waypointManagement:{title:"Waypoint Management",items:["First point becomes your start location","Last point becomes your destination","Numbers show the route sequence","Edit names and add notes in popups","Use Ctrl+Z to undo actions"]},vehicleProfile:{title:"Vehicle Configuration",items:["Click the vehicle button (top-left) to set up your camper","Choose from presets or enter custom dimensions","Accurate dimensions ensure safe routing","Toggle between metric and imperial units","Profile is saved automatically"]},keyboardShortcuts:{title:"Keyboard Shortcuts",items:["+/- to zoom in/out","Arrow keys to pan the map","Ctrl+F to zoom to fit all waypoints","Ctrl+R to reset map view","Alt+F for fullscreen mode"]}},Cn=({className:n})=>{const{waypoints:s}=ne(),{profile:a}=ie(),{addNotification:t}=oe(),[r,i]=d.useState(null),[o,c]=d.useState(new Set),[l,m]=d.useState(!1),[h,u]=d.useState(!1);d.useEffect(()=>{localStorage.getItem("camper-planner-visited")||(u(!0),i("welcome"),localStorage.setItem("camper-planner-visited","true"));const N=localStorage.getItem("camper-planner-dismissed-steps");N&&c(new Set(JSON.parse(N)))},[]),d.useEffect(()=>{o.has("welcome")||!h||(s.length===1&&r==="welcome"?i("first-waypoint"):s.length>=2&&r==="first-waypoint"&&(i("route-ready"),setTimeout(()=>{g("route-ready")},3e3)))},[s.length,r,o,h]);const g=C=>{const N=new Set([...o,C]);c(N),localStorage.setItem("camper-planner-dismissed-steps",JSON.stringify([...N])),r===C&&i(null)},b=wn.find(C=>C.id===r),j=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ðŸ’¡ Quick Tips"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(kn).map(([C,N])=>e.jsxs("div",{className:"border-b border-gray-100 last:border-0 pb-3 last:pb-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:N.title}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:N.items.map((k,p)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-500 mr-2",children:"â€¢"}),k]},p))})]},C))}),!1]});return e.jsxs("div",{className:S("relative",n),children:[b&&!o.has(b.id)&&e.jsx("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-blue-600 text-white rounded-lg shadow-lg p-4 border border-blue-500 animate-fade-in",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[b.icon&&e.jsx("span",{className:"text-xl mr-2",children:b.icon}),e.jsx("h3",{className:"font-semibold",children:b.title})]}),b.dismissible&&e.jsx("button",{onClick:()=>g(b.id),className:"text-blue-200 hover:text-white p-1 rounded transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-blue-100 mb-3",children:b.content}),b.action&&e.jsxs("div",{className:"text-sm text-blue-200 bg-blue-700 bg-opacity-50 rounded px-3 py-2",children:["ðŸ’¡ ",b.action]}),!b.dismissible&&e.jsx("button",{onClick:()=>g(b.id),className:"mt-3 w-full bg-blue-500 hover:bg-blue-400 text-white py-2 px-4 rounded text-sm font-medium transition-colors",children:"Got it!"})]})}),e.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:e.jsx(Je,{content:"Get help and tips",position:"left",size:"sm",children:e.jsx("button",{onClick:()=>m(!l),className:S("w-12 h-12 bg-white rounded-full shadow-lg border border-gray-200","flex items-center justify-center transition-all duration-200","hover:bg-blue-50 hover:border-blue-300 hover:scale-105",l&&"bg-blue-50 border-blue-300 scale-105"),"aria-label":"Toggle help panel",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})})}),l&&e.jsx("div",{className:"fixed bottom-20 right-4 z-50 animate-fade-in",children:e.jsx(j,{})})]})};class Ae extends d.Component{constructor(a){super(a);ce(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,t){console.error("Component Error Boundary caught an error:",{component:this.props.componentName||"Unknown",error:a.message,stack:a.stack,componentStack:t.componentStack}),this.setState({error:a,errorInfo:t}),this.props.onError&&this.props.onError(a,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 m-2",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Component Error"}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsxs("p",{children:[this.props.componentName?`The ${this.props.componentName} component`:"A component"," encountered an error and couldn't render properly."]}),!1]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:this.handleRetry,className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors",children:"Try Again"})})]})]})}):this.props.children}}const Mn=({map:n,visibleTypes:s,onCampsiteSelect:a,onCampsiteHover:t,onLocationSelect:r,className:i})=>{const{addWaypoint:o,waypoints:c}=ne(),{profile:l}=ie(),{addNotification:m}=oe(),[h,u]=d.useState(""),[g,b]=d.useState(!1),[j,C]=d.useState([]),[N,k]=d.useState(!1),[p,w]=d.useState(-1),[D,V]=d.useState([]),[$,z]=d.useState(null),F=d.useRef(null),G=d.useRef(null),R=d.useRef("");d.useEffect(()=>{const x=localStorage.getItem("camper-planner-unified-search-history");if(x)try{V(JSON.parse(x))}catch{}},[]);const A=d.useCallback(x=>{if(x.trim().length<2)return;const L=[x,...D.filter(B=>B!==x)].slice(0,10);V(L),localStorage.setItem("camper-planner-unified-search-history",JSON.stringify(L))},[D]),T=d.useCallback((x,L,B,P)=>{const _=(B-x)*Math.PI/180,W=(P-L)*Math.PI/180,H=Math.sin(_/2)*Math.sin(_/2)+Math.cos(x*Math.PI/180)*Math.cos(B*Math.PI/180)*Math.sin(W/2)*Math.sin(W/2);return 6371*(2*Math.atan2(Math.sqrt(H),Math.sqrt(1-H)))},[]),E=d.useCallback(x=>c.some(L=>Math.abs(L.lat-x.lat)<1e-4&&Math.abs(L.lng-x.lng)<1e-4),[c]),J=d.useCallback(async x=>{if(x.trim().length<2){C([]);return}if(g&&R.current===x.trim())return;R.current=x.trim(),b(!0),z(null);const L=[];let B=n?.getCenter(),P=null;try{let v=[];try{v=await Ye.geocodeLocationMultiple(x,5)}catch(q){console.error("Geocoding failed:",q),z("Unable to search locations. Please try again.")}if(v.length>0){const q=(ee,ae)=>ee>=34&&ee<=72&&ae>=-25&&ae<=45,U=[...v].sort((ee,ae)=>{const le=q(ee.lat,ee.lng),de=q(ae.lat,ae.lng);return le&&!de?-1:!le&&de?1:(ae.importance||0)-(ee.importance||0)});U.forEach(ee=>{L.push({type:"location",id:`location-${ee.lat}-${ee.lng}`,name:ee.name||ee.display_name.split(",")[0],description:ee.display_name,lat:ee.lat,lng:ee.lng})}),P=Ce.latLng(U[0].lat,U[0].lng),B=P}const W={bounds:B?{north:B.lat+1,south:B.lat-1,east:B.lng+1.5,west:B.lng-1.5}:{north:72,south:34,east:45,west:-25},types:s,maxResults:20,includeDetails:!0,vehicleFilter:l||void 0},H=await Ye.searchCampsites(W);if(H.status==="success"){const q=H.campsites.map(U=>{const ee=B?T(B.lat,B.lng,U.lat,U.lng):void 0;return{type:"campsite",id:U.id.toString(),name:U.name||`${U.type.replace("_"," ")} #${U.id}`,description:U.address||U.type.replace("_"," "),lat:U.lat,lng:U.lng,distance:ee,campsite:U,vehicleCompatible:U.vehicleCompatible}}).filter(U=>{const ee=U.name.toLowerCase().includes(x.toLowerCase())||U.description?.toLowerCase().includes(x.toLowerCase()),ae=U.distance!==void 0&&U.distance<=100;return ee||ae}).sort((U,ee)=>{const ae=U.name.toLowerCase().includes(x.toLowerCase())?1:0,le=ee.name.toLowerCase().includes(x.toLowerCase())?1:0;return le!==ae?le-ae:(U.distance??1/0)-(ee.distance??1/0)}).slice(0,10);L.push(...q)}C(L),k(!0)}catch(v){console.error("Search error:",v),C([])}finally{b(!1)}},[n,s,l,T,g]);d.useEffect(()=>{const x=setTimeout(()=>{h.trim()?J(h):(C([]),R.current="")},300);return()=>clearTimeout(x)},[h]);const Q=d.useCallback(x=>{u(x.target.value),w(-1),k(x.target.value.trim().length>=2)},[]),Z=d.useCallback(x=>{A(h),k(!1),x.type==="location"?(n&&n.setView([x.lat,x.lng],10),r?.({lat:x.lat,lng:x.lng,name:x.name}),m({type:"success",message:`Navigated to ${x.name}`})):x.campsite&&(n&&n.setView([x.lat,x.lng],Math.max(n.getZoom(),14)),a?.(x.campsite))},[n,h,A,r,a,m]),se=d.useCallback((x,L)=>{if(L.stopPropagation(),c.some(v=>Math.abs(v.lat-x.lat)<1e-4&&Math.abs(v.lng-x.lng)<1e-4)){m({type:"warning",message:`${x.name} is already in your route`});return}const P={id:`location-${Date.now()}`,lat:x.lat,lng:x.lng,type:"waypoint",name:x.name,notes:x.description||""};o(P),m({type:"success",message:`Added "${x.name}" to your route`}),n&&n.setView([x.lat,x.lng],10),k(!1)},[o,m,c,n]),re=d.useCallback((x,L)=>{if(L.stopPropagation(),!x.campsite)return;if(E(x.campsite)){m({type:"warning",message:`${x.name} is already in your route`});return}const B={id:`campsite-${x.id}-${Date.now()}`,lat:x.lat,lng:x.lng,type:"campsite",name:x.name,notes:x.description||""};o(B),m({type:"success",message:`Added "${x.name}" to your route`}),k(!1)},[o,m,E]),y=d.useCallback(x=>{if(!(!N||j.length===0))switch(x.key){case"ArrowDown":x.preventDefault(),w(L=>Math.min(L+1,j.length-1));break;case"ArrowUp":x.preventDefault(),w(L=>Math.max(L-1,-1));break;case"Enter":x.preventDefault(),p>=0&&p<j.length?Z(j[p]):j.length>0&&Z(j[0]);break;case"Escape":k(!1),w(-1),F.current?.blur();break}},[N,j,p,Z]),O=d.useCallback(()=>{u(""),C([]),k(!1),w(-1)},[]),K=j.filter(x=>x.type==="location"),te=j.filter(x=>x.type==="campsite");return e.jsxs("div",{className:S("relative",i),children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"pl-4 pr-2 py-3",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{ref:F,type:"text",value:h,onChange:Q,onKeyDown:y,onFocus:()=>k(h.trim().length>=2||D.length>0),onBlur:()=>setTimeout(()=>k(!1),200),placeholder:"Search for a location or campsite...",className:"flex-1 py-3 pr-4 text-sm bg-transparent border-0 focus:ring-0 focus:outline-none placeholder-gray-500"}),h&&e.jsx("button",{onClick:O,className:"px-3 py-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),g&&e.jsx("div",{className:"px-3",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 border-t-transparent rounded-full"})})]})}),N&&(j.length>0||D.length>0||$)&&e.jsxs("div",{ref:G,className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-96 overflow-y-auto",onMouseDown:x=>x.preventDefault(),children:[$&&e.jsxs("div",{className:"px-4 py-3 bg-amber-50 border-b border-amber-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm text-amber-700",children:$})]}),e.jsx("button",{onClick:()=>{z(null),J(h)},className:"text-xs text-amber-700 hover:text-amber-900 underline font-medium",children:"Retry"})]}),K.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 border-b border-gray-100 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),"LOCATIONS"]}),K.map((x,L)=>{const B=c.some(P=>Math.abs(P.lat-x.lat)<1e-4&&Math.abs(P.lng-x.lng)<1e-4);return e.jsxs("div",{className:S("w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-50",p===L&&"bg-blue-50"),children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0 cursor-pointer",onClick:()=>Z(x),role:"button",tabIndex:0,onKeyDown:P=>P.key==="Enter"&&Z(x),children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",title:x.description,children:x.description||"Go to this location"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Z(x),className:"px-2 py-1 text-xs text-blue-600 hover:bg-blue-50 rounded font-medium transition-colors",children:"Go"}),B?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded font-medium",children:"In Route"}):e.jsx("button",{onClick:P=>se(x,P),className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded font-medium hover:bg-blue-200 transition-colors",children:"+ Add"})]})]},x.id)})]}),te.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 border-b border-gray-100 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"CAMPSITES (",te.length,")"]}),te.map((x,L)=>{const B=K.length+L,P=x.campsite&&E(x.campsite);return e.jsxs("div",{onMouseEnter:()=>t?.(x.id),onMouseLeave:()=>t?.(null),className:S("w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors border-b border-gray-50",p===B&&"bg-green-50"),children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0 cursor-pointer",onClick:()=>Z(x),role:"button",tabIndex:0,onKeyDown:v=>v.key==="Enter"&&Z(x),children:[e.jsx("div",{className:S("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",x.vehicleCompatible?"bg-green-100":"bg-red-100"),children:e.jsx("svg",{className:S("w-4 h-4",x.vehicleCompatible?"text-green-600":"text-red-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:x.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center space-x-2",children:[e.jsx("span",{className:"truncate",children:x.description}),x.distance!==void 0&&e.jsxs("span",{className:"flex-shrink-0",children:["â€¢ ",x.distance<1?`${Math.round(x.distance*1e3)}m`:`${x.distance.toFixed(1)}km`]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2 flex-shrink-0",children:[x.vehicleCompatible?e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"âœ“"}):e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"âš "}),P?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded font-medium",children:"In Route"}):e.jsx("button",{onClick:v=>re(x,v),className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded font-medium hover:bg-blue-200 transition-colors",children:"+ Add"})]})]},x.id)})]}),j.length===0&&h.trim().length>=2&&!g&&e.jsxs("div",{className:"px-4 py-6 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("p",{className:"text-sm text-gray-500",children:['No results found for "',h,'"']}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Try a different search term"})]}),h.trim().length<2&&D.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 border-b border-gray-100 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"RECENT SEARCHES"]}),D.slice(0,5).map(x=>e.jsxs("button",{onClick:()=>u(x),className:"w-full px-4 py-3 text-left flex items-center space-x-3 hover:bg-gray-50 transition-colors border-b border-gray-50",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-gray-700",children:x})]},x))]})]})]})},Sn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",Ln="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",Dn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg==";Ce.Icon.Default.mergeOptions({iconUrl:Sn,iconRetinaUrl:Dn,shadowUrl:Ln});const Re={defaultCenter:[54.526,15.2551],defaultZoom:5,minZoom:3,maxZoom:19,maxBounds:[[34,-25],[72,45]]},Tn=({onMapMove:n})=>{const s=Qe();return Wt({moveend:()=>{const a=s.getCenter(),t=s.getZoom();n([a.lat,a.lng],t)},zoomend:()=>{const a=s.getCenter(),t=s.getZoom();n([a.lat,a.lng],t)}}),null},En=({onMapReady:n})=>{const s=Qe();return d.useEffect(()=>{n(s)},[s,n]),null},In=()=>{const n=Qe(),{center:s,zoom:a}=yt(),t=d.useRef(s),r=d.useRef(a);return d.useEffect(()=>{(s[0]!==t.current[0]||s[1]!==t.current[1])&&(n.setView(s,a),t.current=s)},[s,n,a]),d.useEffect(()=>{a!==r.current&&(n.setZoom(a),r.current=a)},[a,n]),null},An=()=>{const{center:n,zoom:s,setCenter:a,setZoom:t}=yt(),{waypoints:r,clearRoute:i,undo:o,redo:c,canUndo:l,canRedo:m,isValidForRouting:h,calculatedRoute:u}=ne(),{addNotification:g}=oe(),[b,j]=d.useState(!1),[C,N]=d.useState(!1),[k,p]=d.useState("openstreetmap"),[w,D]=d.useState(!1),[V,$]=d.useState(!0),[z,F]=d.useState(!1),[G,R]=d.useState("info"),A=d.useRef(null),[T,E]=d.useState(null),J=M=>{E(M),A.current=M},[Q,Z]=d.useState(null),[se,re]=d.useState(null),[y,O]=d.useState(pe.CAMPSITE_DISPLAY),[K,te]=d.useState(!1),[x,L]=d.useState(!1),[B,P]=d.useState(!1),[v,_]=d.useState(pe.CAMPSITE_DISPLAY),[W,H]=d.useState(0),[q,U]=d.useState(bt),[ee,ae]=d.useState([]),[le,de]=d.useState(!1),[ue,be]=d.useState(!1),[Me,ye]=d.useState(!1),[Se,Be]=d.useState(!1),[et,tt]=d.useState(!1);d.useEffect(()=>{const M=mt.getMapState();M&&(a(M.center),t(M.zoom),M.layerId&&p(M.layerId),M.isFullscreen!==void 0&&D(M.isFullscreen),M.layerControlCollapsed!==void 0&&$(M.layerControlCollapsed))},[a,t]),d.useEffect(()=>{const M=()=>{const Y=document.fullscreenElement!==null;Y!==w&&D(Y)};return document.addEventListener("fullscreenchange",M),()=>document.removeEventListener("fullscreenchange",M)},[w]),d.useEffect(()=>{const M=()=>tt(window.innerWidth<768);return M(),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[]),d.useEffect(()=>{const M=setTimeout(()=>{b||(console.warn("Map ready timeout - forcing map to be visible"),j(!0))},2e3);return()=>clearTimeout(M)},[b]);const Le=(M,Y)=>{a(M),t(Y),mt.saveMapState({center:M,zoom:Y,timestamp:Date.now(),layerId:k,isFullscreen:w,layerControlCollapsed:V})},ge=async()=>{try{w?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(M){console.warn("Fullscreen not supported or denied:",M),g({type:"warning",message:"Fullscreen mode not supported in this browser"})}},Fe=()=>{a(Re.defaultCenter),t(Re.defaultZoom),g({type:"info",message:"Map view reset to Europe"})},De=()=>{$(!V)},me=M=>{p(M),mt.saveMapState({center:n,zoom:s,timestamp:Date.now(),layerId:M,isFullscreen:w,layerControlCollapsed:V})},xe=()=>{j(!0)},Te=M=>{Z(M),L(!0),P(!1),g({type:"info",message:`Selected ${M.name||M.type}`})},f=(M,Y)=>{H(M),Y&&ae(Y)},I=()=>{L(!1),Z(null)};return e.jsxs("div",{className:S("h-full relative transition-all duration-300",w&&"fixed inset-0 z-50 bg-black"),children:[!b&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading European map..."})]})}),e.jsxs(ds,{ref:A,center:n,zoom:s,minZoom:Re.minZoom,maxZoom:Re.maxZoom,maxBounds:Re.maxBounds,maxBoundsViscosity:1,className:"h-full w-full z-map",zoomControl:!1,whenReady:xe,style:{height:"100%",width:"100%"},children:[e.jsx(Ba,{currentLayerId:k,onLayerChange:me,collapsed:V,onToggleCollapse:De}),e.jsx(Tn,{onMapMove:Le}),e.jsx(In,{}),e.jsx(En,{onMapReady:J}),e.jsx(_a,{}),e.jsx(bn,{visibleTypes:q.visibleTypes,maxResults:q.maxResults,vehicleCompatibleOnly:q.vehicleCompatibleOnly,searchQuery:"",isVisible:v,onCampsiteClick:Te,onCampsitesLoaded:f,isMobile:et,filterState:K?q:void 0,highlightedCampsiteId:se,selectedCampsiteId:Q?.id?.toString()||null})]}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-30 w-full max-w-md px-4 hidden md:block",children:e.jsx(Ae,{componentName:"UnifiedSearch",children:e.jsx(Mn,{map:T,visibleTypes:q.visibleTypes,onCampsiteSelect:Te,onCampsiteHover:re,onLocationSelect:M=>{g({type:"info",message:`Navigated to ${M.name}`})}})})}),r.length===0&&b&&e.jsx("div",{className:"absolute bottom-24 left-1/2 transform -translate-x-1/2 z-20 pointer-events-none hidden sm:block animate-fade-in",children:e.jsx("div",{className:"bg-white/95 backdrop-blur-sm px-5 py-3 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Start your trip"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Right-click on the map to add waypoints, or search for a location above"})]})]})})}),e.jsx(Ae,{componentName:"VehicleProfileSidebar",children:e.jsx(Za,{})}),e.jsx("div",{className:"absolute top-4 right-14 z-20 w-64 hidden lg:block",children:e.jsx(Ae,{componentName:"RouteCalculator",children:e.jsx(Ka,{})})}),y&&!K&&e.jsx("div",{className:"absolute top-4 left-16 z-20 w-72 hidden md:block",children:e.jsx(Ae,{componentName:"CampsiteControls",children:e.jsx(vn,{visibleTypes:q.visibleTypes,onTypesChange:M=>U({...q,visibleTypes:M}),maxResults:q.maxResults,onMaxResultsChange:M=>U({...q,maxResults:M}),vehicleCompatibleOnly:q.vehicleCompatibleOnly,onVehicleCompatibleChange:M=>U({...q,vehicleCompatibleOnly:M}),isVisible:v,onVisibilityChange:_,campsiteCount:W})})}),K&&e.jsx("div",{className:"absolute top-4 left-16 z-20 w-80 hidden md:block",children:e.jsx(Ae,{componentName:"CampsiteFilter",children:e.jsx(hn,{filterState:q,onFilterChange:U,onSearchChange:M=>U({...q,searchQuery:M}),onCampsiteSelect:Te,campsiteCount:W})})}),u?.restrictions?.violatedDimensions?.length&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 w-96 max-w-full",children:e.jsx(Ga,{restrictions:u.restrictions,className:"shadow-xl"})}),e.jsx(Ha,{map:A.current,isFullscreen:w,onToggleFullscreen:ge,onResetView:Fe,onToggleLayerControl:De,layerControlCollapsed:V}),e.jsx(Ua,{map:A.current,isFullscreen:w,onToggleFullscreen:ge,onResetView:Fe,onToggleLayerControl:De}),e.jsxs("div",{className:"absolute top-4 left-4 z-30 flex flex-col space-y-2 hidden sm:flex",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:o,disabled:!l(),className:S("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",l()?"hover:bg-gray-50 text-gray-700":"text-gray-300 cursor-not-allowed"),title:"Undo (Ctrl+Z)","aria-label":"Undo last action",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),e.jsx("button",{onClick:c,disabled:!m(),className:S("block w-10 h-10 flex items-center justify-center transition-colors",m()?"hover:bg-gray-50 text-gray-700":"text-gray-300 cursor-not-allowed"),title:"Redo (Ctrl+Y)","aria-label":"Redo last action",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:()=>ye(!Me),className:S("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",Me?"bg-indigo-50 text-indigo-600":"hover:bg-gray-50 text-gray-700"),title:"Trip manager","aria-label":"Toggle trip manager",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),r.length>=2&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Be(!Se),className:S("block w-10 h-10 flex items-center justify-center border-b border-gray-200 transition-colors",Se?"bg-violet-50 text-violet-600":"hover:bg-gray-50 text-gray-700"),title:"Trip planning tools","aria-label":"Toggle planning tools",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("button",{onClick:()=>be(!ue),className:S("block w-10 h-10 flex items-center justify-center transition-colors",ue?"bg-emerald-50 text-emerald-600":"hover:bg-gray-50 text-gray-700"),title:"Trip cost calculator","aria-label":"Toggle cost calculator",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]}),u&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("button",{onClick:()=>F(!z),className:S("block w-10 h-10 flex items-center justify-center transition-colors",z?"bg-blue-50 text-blue-600":"hover:bg-gray-50 text-gray-700",r.length>=3&&"border-b border-gray-200"),title:"Route information","aria-label":"Toggle route information",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),r.length>=3&&e.jsx("button",{onClick:()=>de(!le),className:S("block w-10 h-10 flex items-center justify-center transition-colors",le?"bg-orange-50 text-orange-600":"hover:bg-gray-50 text-gray-700"),title:"Optimize route order","aria-label":"Toggle route optimizer",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})})]}),e.jsx("button",{onClick:()=>{!y&&!K?O(!0):y?(O(!1),te(!0)):te(!1)},className:S("w-10 h-10 flex items-center justify-center rounded-lg shadow-md transition-colors",y||K?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-700 hover:bg-gray-50"),title:K?"Hide filters":y?"Advanced filters":"Show campsites","aria-label":"Toggle campsite controls",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),r.length>0&&e.jsx("button",{onClick:()=>N(!0),className:"w-10 h-10 flex items-center justify-center bg-white text-red-600 rounded-lg shadow-md hover:bg-red-50 transition-colors",title:"Clear all waypoints","aria-label":"Clear all waypoints",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"absolute bottom-4 left-4 z-30 hidden sm:block",children:e.jsxs("div",{className:"bg-white bg-opacity-95 rounded-lg shadow-md px-3 py-2 text-xs text-gray-600 animate-fade-in",children:[e.jsxs("div",{className:"sm:block hidden",children:["Zoom: ",s," | Center: ",n[0].toFixed(4),", ",n[1].toFixed(4)]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("span",{className:"text-blue-600 font-medium",children:["Waypoints: ",r.length]}),r.length===0?e.jsx("span",{className:"text-green-600 text-xs",children:"Right-click map to add"}):r.length===1?e.jsx("span",{className:"text-orange-600 text-xs",children:"Add 1 more for routing"}):e.jsx("span",{className:"text-green-600 text-xs",children:"âœ“ Ready for routing"})]}),h()&&e.jsx("div",{className:"mt-1 text-xs text-green-600 font-medium",children:"Ready for Phase 3: Routing"})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-30 sm:hidden",children:e.jsx("div",{className:"bg-white bg-opacity-95 border-t border-gray-200 px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:[r.length," waypoint",r.length!==1?"s":""]}),r.length===0?e.jsx("span",{className:"text-green-600 text-sm font-medium",children:"Long-press map to add waypoint"}):r.length===1?e.jsx("span",{className:"text-orange-600 text-sm font-medium",children:"Add another point"}):e.jsx("span",{className:"text-green-600 text-sm font-medium",children:"âœ“ Route ready"})]})})}),z&&pe.BASIC_ROUTING&&u&&!x&&!B&&e.jsxs("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Route Details"}),u.alternativeRoutes&&u.alternativeRoutes.length>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:["+",u.alternativeRoutes.length," alternatives"]})]}),e.jsx("button",{onClick:()=>F(!1),className:"p-1 hover:bg-gray-200 rounded transition-colors","aria-label":"Close route information",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),u.alternativeRoutes&&u.alternativeRoutes.length>0&&e.jsxs("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:()=>R("info"),className:S("flex-1 py-3 px-4 text-sm font-medium transition-colors",G==="info"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"),children:"Route Info"}),e.jsx("button",{onClick:()=>R("comparison"),className:S("flex-1 py-3 px-4 text-sm font-medium transition-colors",G==="comparison"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-500 hover:text-gray-700"),children:"Compare Routes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[G==="info"&&e.jsx(en,{className:"border-0 rounded-none"}),G==="comparison"&&e.jsx(tn,{className:"border-0 rounded-none"})]})]}),x&&Q&&pe.CAMPSITE_DISPLAY&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsx(Nn,{campsite:Q,onClose:I,className:"h-full border-0 rounded-none"})}),le&&pe.ROUTE_OPTIMIZATION&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-orange-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Route Optimizer"}),e.jsx("button",{onClick:()=>de(!1),className:"p-1 hover:bg-orange-200 rounded transition-colors","aria-label":"Close optimizer",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(an,{className:"h-full border-0 rounded-none",onOptimizationComplete:M=>{console.log("Optimization complete:",M)},onWaypointInsert:M=>{console.log("Insert waypoint at position:",M)}})})]})}),ue&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-emerald-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Trip Cost Calculator"}),e.jsx("button",{onClick:()=>be(!1),className:"p-1 hover:bg-emerald-200 rounded transition-colors","aria-label":"Close cost calculator",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(nn,{className:"h-full border-0 rounded-none",onCostUpdate:M=>{console.log("Cost breakdown updated:",M)}})})]})}),Me&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-indigo-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Trip Manager"}),e.jsx("button",{onClick:()=>ye(!1),className:"p-1 hover:bg-indigo-200 rounded transition-colors","aria-label":"Close trip manager",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ja,{className:"h-full border-0 rounded-none",onTripLoad:M=>{console.log("Loading trip:",M),ye(!1)},onClose:()=>ye(!1)})})]})}),Se&&e.jsx("div",{className:"fixed inset-y-0 right-0 z-40 w-full sm:w-96 bg-white border-l border-gray-200 shadow-xl transform transition-transform sm:translate-x-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-violet-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Planning Tools"}),e.jsx("button",{onClick:()=>Be(!1),className:"p-1 hover:bg-violet-200 rounded transition-colors","aria-label":"Close planning tools",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Na,{className:"h-full border-0 rounded-none",onPlanUpdate:M=>{console.log("Trip plan updated:",M)}})})]})}),e.jsx(Cn,{}),e.jsx(Vt,{isOpen:C,title:"Clear All Waypoints",message:`Are you sure you want to remove all ${r.length} waypoints? This action can be undone with Ctrl+Z.`,confirmLabel:"Clear All",confirmVariant:"danger",onConfirm:()=>{i(),g({type:"success",message:"All waypoints cleared"}),N(!1)},onCancel:()=>N(!1)})]})},Fn=()=>(cs(),e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"flex-1 relative",children:e.jsx(An,{})})}));export{Fn as default};
